[{"_id":"e60aa50b-efc0-30ca-af78-087860f19554","authorName":"Alexander Turok","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/13902719420774359982","authorUserId":"","authorFallbackAvatar":"","message":"Being posted on my birthday this feels like a personal gift.) Thank you for a very helpful post!)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2012-11-10T04:38:01Z","timestamp":1352522281},{"_id":"979dc165-d208-3b6a-bab8-8d59bfd9e99e","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Nice post. Give a better understanding about Asynchronous in C#. Thanks! :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-02-12T09:43:39Z","timestamp":1360662219},{"_id":"858e3ed5-3751-3d39-bb67-4704294466d8","authorName":"Joro S","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/09342130902585558504","authorUserId":"","authorFallbackAvatar":"","message":"Being somebody who is currently trying to \"formally educate\" himself on the subject, I feel that mentioning explicitly the synchronous blocking behavior of Task.Result property would have clarified a lot. I read most of the referred answered questions and most all of the people having the problem were expecting a magic to happen and return the result from the task - a magic similar to what async and await give us, hiding the complexities of CPS programming from us.  \r\n\r\nHere's what MSDN has to say about Task.Result property:  \r\n(from here [http://msdn.microsoft.com/en-us/library/dd321468.aspx](http://msdn.microsoft.com/en-us/library/dd321468.aspx))  \r\nRemarks  \r\nThe get accessor for this property ensures that the asynchronous operation is complete before returning. ","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-03-04T09:01:30Z","timestamp":1362387690},{"_id":"2fadabb7-8790-34b2-ab8f-e50120a16286","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"This saved my day!! Thanks very much","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-05-25T00:05:42Z","timestamp":1369440342},{"_id":"a5ece6b0-b1c0-3532-a87a-89c8e025dd2e","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"This was very helpful. Every code example wrapped the HttpClient portion with Task.WhenAll or Task.Wait. You explained the deadlock that I suspected. Thank you.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-06-21T02:46:30Z","timestamp":1371782790},{"_id":"c0aa9e50-07fc-38f2-9341-4bc9bce0ef7c","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"The ConfigureAwait(false) saved my bacon! Tacked it onto the end of GetAsync() and 3 or 4 hours of painful struggle magically disappeared. Cheers! Richard Hammond","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-07-25T13:25:15Z","timestamp":1374758715},{"_id":"3977220d-0733-3870-be56-dafb767ffdc0","authorName":"Edouard Paumier","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/04306692752169881908","authorUserId":"","authorFallbackAvatar":"","message":"Hello,   \r\n\r\nFirst of all, thank you very much for your post. It saved me a very long investigation, I believe.  \r\n\r\nI just have on small question. What does it mean, for the asynchronous call, to not collect the synchronization context?   \r\n\r\nIn my case, I'm in the opposite situation. I got an In-Memory WebAPI server, which I call from a long stack of non-async methods, which in turns is called by MVC (don't ask me why a MVC server would send a request to an In-Memory WebAPI server, I feel we would drift away ;) ). The non-async method waits for the response of the call to the SendRequestAsync of the in-memory server, and in a MVC context, it's the deadlock.  \r\n\r\nTherefore, I either have to change all that stack to make it async (and I don't even know if that's possible), or to simply drop the synchronization context capture from the In-Memory WebAPI server, using Configure Await.  \r\n\r\nI assume there are some data that would not be available anymore? What's the con, what would I loose?  \r\n\r\nThanks a lot.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-08-22T11:46:01Z","timestamp":1377171961},{"_id":"35191810-a26e-3238-8b06-25a7c5134b12","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I assume you mean WCF instead of MVC. It sounds like the root host is still ASP.NET (i.e., your WCF is hosted within ASP.NET).  \r\n\r\nYou can look at your current context by doing a \"Debug.WriteLine(SynchronizationContext.Current.GetType().Name)\".  \r\n\r\nTo solve the problem, it's best to actually make everything async (WCF in 4.5 does have built-in support for asynchronous implementations, and if you make your server async it won't affect your clients at all). If you can't do that, then you can put in a workaround such as ConfigureAwait. Stephen Toub describes several options here: [http://blogs.msdn.com/b/pfxteam/archive/2012/04/13/10293638.aspx](http://blogs.msdn.com/b/pfxteam/archive/2012/04/13/10293638.aspx)  \r\n\r\nThe disadvantage to ConfigureAwait is that you lose your request context after the first await. So you can't access anything on the HttpContext, or depend on things like culture being set appropriately.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-08-23T00:59:07Z","timestamp":1377219547},{"_id":"0e8ffee1-9ec6-3bd6-8145-c296bfc737ce","authorName":"Adam Miller","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/14489064019295295604","authorUserId":"","authorFallbackAvatar":"","message":"I'm using .net 4.0 is there a ConfigureAwait equivalent?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-11-13T23:42:41Z","timestamp":1384386161},{"_id":"2b943f4e-bf3e-32ce-ae75-b86b9863720a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If you have Microsoft.Bcl.Async installed, you should have ConfigureAwait available.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-11-14T00:53:53Z","timestamp":1384390433},{"_id":"4baabd4a-6985-30a5-bb25-38bccb51ae6e","authorName":"Joe Enos","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/17203532207216246426","authorUserId":"","authorFallbackAvatar":"","message":"Is there any way to detect a deadlock? I just tried your WinForms example and see exactly what you're talking about - looks like it will hang forever without ever returning. I doubt there's anything we could do at compile-time, but at runtime, is there a global \"deadlock detection\" concept or anything that would help troubleshoot something like this? Like in SQL Server where it will eventually kill off one of the connections that's involved in a deadlock.  \r\n\r\nOf course if we build things properly, deadlocks won't happen, but I can see this potentially being a common mistake.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-12-02T22:43:20Z","timestamp":1386024200},{"_id":"131b4b66-dad3-346b-b894-137a2b37cfda","authorName":"Joe Enos","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/17203532207216246426","authorUserId":"","authorFallbackAvatar":"","message":"Cool, makes sense. Thanks.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-12-03T19:49:31Z","timestamp":1386100171},{"_id":"51981bca-f694-31f0-be59-a4e6a94c229d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The problem with deadlock detection is that you have to hook the Wait or Result calls; this should be possible with the profiling API. Alternatively, Joe Duffy has a blog post on deadlock detection but you need to provide your own SynchronizationContext (in this case, it would need to be a wrapper for the WinFormsSynchronizationContext): [http://joeduffyblog.com/2008/02/27/hooking-clr-blocking-calls-with-synchronizationcontext/](http://joeduffyblog.com/2008/02/27/hooking-clr-blocking-calls-with-synchronizationcontext/)  \r\n\r\nEither way, it would be quite a lot of effort. I think it's not worth it; in most cases, if a deadlock happens, it *always* happens. So we're not dealing with a deadlock caused by a race condition; this is usually just a one-time learning experience, not a dormant bug kind of problem.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2013-12-03T06:50:45Z","timestamp":1386053445},{"_id":"4a95efe7-2c06-374b-9421-bf8ebcf5c826","authorName":"Todd Nichols","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/07992525698042552121","authorUserId":"","authorFallbackAvatar":"","message":"After reading this the clouds lifted. Thanks a TON for this post.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-03-05T22:13:03Z","timestamp":1394057583},{"_id":"545d9cc3-fd93-3460-bc04-707cdbc8e877","authorName":"The Answer","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/04409498104469646011","authorUserId":"","authorFallbackAvatar":"","message":"Hey Stephen,  \r\nThanks a lot for all the article you've published thus far. They are super useful.  \r\n\r\nI have a question for you. In your code solution 2 above  \r\n\r\npublic class MyController : ApiController  \r\n{  \r\n public async Task Get()  \r\n {  \r\n var json = await GetJsonAsync(...);  \r\n return json.ToString();  \r\n }  \r\n}  \r\n\r\nNow if you make the Get() method async and you call GetJsonAsync() and if this method is a long running process, wouldn't the request just return back to the client without actually waiting for the GetJsonAsync() call to complete. Could you please shed some light on this.  \r\n\r\nThanks.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-03-14T20:47:48Z","timestamp":1394830068},{"_id":"858ac585-d7bd-36c4-9362-4505882f510a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No, it will not return to the client. The ASP.NET MVC runtime sees that the action is returning a Task, and it will (asynchronously) wait for that task to complete before sending the response to the client.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-03-19T17:06:31Z","timestamp":1395248791},{"_id":"a5a69ee0-8cc7-389d-a6b6-de91bbd3909e","authorName":"anurag sahay","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/04914115527262751779","authorUserId":"","authorFallbackAvatar":"","message":"This comment has been removed by the author.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-04-26T22:47:11Z","timestamp":1398552431},{"_id":"d0fd57ba-c2d8-3b73-bbfe-a2c9f553a1fd","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"I would bring this piece of information way up in the blog. ConfigureAwait(false) causes a lot of headaches because HttpContext.Current stops working.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-04-26T23:33:55Z","timestamp":1398555235},{"_id":"6f4cb468-6a02-3f3f-b380-2e45ba361621","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"There's no point in blocking on an asynchronous operation in ASP.NET. Take a step back and think about what you actually want to accomplish.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-04-27T01:13:12Z","timestamp":1398561192},{"_id":"a9088361-0232-30c1-9c0b-0e1a92fa286d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The decision of whether to use ConfigureAwait(false) is independent for each method. So, in your example, if GetStringAsync does not need the context after the call to SaveChangesAsync, then it should use ConfigureAwait(false). The same goes for the caller of GetStringAsync, etc.  \r\n\r\nYou'll find that ConfigureAwait(false) ends up being in every async method that does not need the context. This can actually act like a kind of divider in your code; e.g., if a ConfigureAwait(false) method is in your UI layer, maybe it should move into a library; and if a non-ConfigureAwait(false) method is in a library or domain layer, then it should probably be moved out or refactored to use IProgress instead.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-05-06T16:16:22Z","timestamp":1399392982},{"_id":"f6df9666-5f24-306f-9a44-d0341f2ac071","authorName":"Doremon","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/14870211394909595410","authorUserId":"","authorFallbackAvatar":"","message":"Thanks for this information. Do you recommend setting .ConfigureAwait(false) for all async calls in case of multiple levels of async (e.g. GetStringAsync method calls dbContext.SaveChangesAsync(), so it should also do dbContext.SaveChangesAsync().ConfigureAwait(false)?).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-05-06T05:54:50Z","timestamp":1399355690},{"_id":"580d10b3-6002-3658-8514-0d572c0df99a","authorName":"Alan","authorEmailEncrypted":"dsoETrRowtLqd0JP2ZjCKw4OgI56SlW0F/ubzuPfW7kQuq5yXs+m391hVsH8FeePb6O4zT7Xih4pVZFqYbg55CY/tkOKFKwpjpV1GjojEeBq9wtRpKhVT9A9abjUqTSle7MghhQMfDEiTJg8BPWp3UmYo7TVvbDY2ughhY7N0f6iCZbX/DJ90SOlsIpynOMrR7ftvBk0haUPh5KzBgL8e7wHKTB49Oa8uNNfY7yIvzUyDl2FmXt/HmhIdvBm2317mMJBANQYHp1mFIwtZ5vVWJWWe50lrq4bmgT7d20uxwrNLpP00Kmr8OoB/e+SeANWuOjFj1HTVA8nXH8y+sBlMRtKCNPPamBNOO2FyDEVzZdBE6vPQfOZ4je6XpcWZoKBz1T0/VnqrkmP1C7oGiO4ItlLveVWVvfKsTYAIPErJ+Skrni8ElJd3pTPCUCJqoqhMcBmR5ZA2wfbMMVCfxmSajNioMNv8xxBy1rDLVcedU9zWadrABhs/0SWTRnOdGb8vXcx/vgeb3jiE2lf0jh/+attsM/bcjmbkmMxKf3402dCGZDMPLuVntpoiRpzf9sblgJN34uSVRMl96gts/PDmtMuqzMSc80YCEp2dcDGimSL0dWMgzbGGwYjkgGbpizJtdrsP+Fj4ks8JrRpsHtRUoxsr+XI5Ce8r5Fdwf2/NeA=","authorEmailMD5":"77bc87278652ee1d0b74cf4fe97f4ed8","authorUri":"http://mylifeandcode.blogspot.com","authorUserId":"disqus:disqus_pbqrmE9MG5","authorFallbackAvatar":"","message":"Thank you for posting this, Stephen, and for taking the time to clearly and concisely explain all of this.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-06-13T13:09:25Z","timestamp":1402664965},{"_id":"0a4ff6ad-963f-33e9-b85e-5aced672119f","authorName":"Ed Chavez","authorEmailEncrypted":"wEFKHQqP81q+0Odbyr18bknBiLErkIDqPu+xGURP5xpCouVzU5y3QOOgeCtkVu+UV00RE+iPFIG4sFMFK0Russ6pbzkO0S5+x+zoeuPdcymK4j1NyQb3x7CydoqynIr/Lri12Hii+G5hGZouuQqqDVSbELFQk8K8brQxa/eWTxRX2jlZdsZvJ46r5OK6p6fWZJPcOh5yL+VqtEaGgLBar9Sdqzrbl6mvxiAimZbDwrtcSyKq7fN3jtc065fEjlawCXvRrT2gY/dFjW/XIQh+uOvAl/ZXrxMp4eWBRB91fbuGQHCKblRKLRq9WO61Qd4bw9vGm04RZrFTLcBbawHRBjjwgPlmKYejcvi6y/nGES491xfGylakus18Qr1i3IJYQ2lIbZP1RFwnc3r1DtHjn0aNcy838hEOsPxKCP0b/X6Fo/Wo1pNe4ZiCCOcM9GJsmtIjPfa6X5migbN/9B4OSjgmEf8ESQ0RzGZw+DKpRIavHzLSXSRIAtqifzy4i6951RXD8u3XgWoDuzx7Fv5ioJP/iW0gZqvgmq67IR3deU3fiBphe3wvhcF2+Q/+AmVVk5TEiDfUN5vgOfscHZFf0LNVGV9dfi5ysuNSGz6kWFKeDx/apUEienX4YCtlkCau3tBWcTpLFdbLYyN7HIoOyrOIFnkww5gMNr48CzHqlbU=","authorEmailMD5":"a368a438821317d80a5913198e430b70","authorUri":"http://google.com/+EdChavez","authorUserId":"disqus:disqus_k1OetduG0j","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_k1OetduG0j.jpg","message":"No kidding...it's been 2 years since your post and still, I'm guilty as charged. Dropped on this 2 yr old post in my almost Quixotic quest to see if I can do async in WebPages. Got it to work based on this post - though the \"use both\" is a mystery still...\r\n\r\nI'm getting away with it via ConfigureAwait on the top level request and if there are other async calls that's where \"async all the way\" occurs. Is this what you meant by \"use both\"?. Seems to work...\r\n\r\nThanks for posting this - am realizing how much I don't know about (yes, late bloomer). Hopefully your book will change this (just got it). Thanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-07-12T05:18:49Z","timestamp":1405142329},{"_id":"61d229be-050a-3854-8739-74751916ba76","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I recommend using ConfigureAwait for any await that you can. This is usually all await calls *except* the top-level request.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"0a4ff6ad-963f-33e9-b85e-5aced672119f","date":"2014-07-20T17:28:05Z","timestamp":1405877285},{"_id":"dcae6040-8dd3-3a15-93d3-7d27c7f2fbd4","authorName":"fred","authorEmailEncrypted":"PKx9hP0d0HxsUA0ozXOp8gK/ZD/CTcHXHCAUs5kH4bzjDUvIyejlNN0mynKoCgBVyqHtPlJrlH0r9hNP7XY4dqV7j0MGzlWJ6bVP1f8h80cJOSAMqmq6Te9q61hneoP4ZGp+5hKRgRapHH/P6gD1WUP3PI1UATzGIcf/4xHM9yxAQ3b8e/0HGZ19jr/wkfTmXnVjbJbb2zOqzpHyZwgjzA/ApMdWOzcgeNls8byjwiMrP0t0+FL3eIoNHAQlSTlzb4LvG8HUB6ZNkaNCjmsW6oUMHZ00+Fb/tbcIwXe1jDofGpMn12fKE4dfZBBAXJvYs/mYhEHajEfgRE4PmVjn08oRc+9iUBVATGbNRqJOS7Kl9j6uD5sr1/UbO8TFbQZga6/tPWRFM9AoaDkDIUQe6Hkj0GJkuqbtu66rXA4jza7OmAio2hRAun6jURtHIx37pZqCNIVZmpe3IM9fL3rhSxQpCQ6T4+ZP8/n9Ww43vmBtNAKDNfsaKziWlX5RMj8YK+YO1es6T79fNPVFxo5wKxfkAB/dxp0okGStAsi4I/9G/gUbFARXeHdKRn5vUNfg8EjBe3sLgkPtva5noEfFS+nDn1zia03lv2Q5/0vKL4HPHUoDsq1xAe6E4gqoOi5u677Ip8aQ+mgK1A2Tutogq9Vcfo4FfT/x3Vr+oIXthKg=","authorEmailMD5":"d61245c33aae0a801f7ac706b884b6e5","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Your font is a bit big","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-08-22T15:52:29Z","timestamp":1408722749},{"_id":"4d68e660-af9a-3444-ba89-797d965daba7","authorName":"Ibrahim","authorEmailEncrypted":"tCSp+GFYG07wG96DpVuoyey49G/C+LecoYZ6KyV42CZ0JKobdoj2wGqyLeAtJUtErkVd1wO/TZNcH+o/wm7t3xrdjuOR0wUgjKZnspEWN163o3sqw/Nnsd2JQXXHjlEGcPhuSMaSofyvH9Wo96zXP/gSPCc//1ODbh5AfQgL5u+pSMm5M6FxaQvfo6Un47aJlmHIArWmmruaXNJw+fTRiATh4xtP/HKO1lVEXym4XhAN23gyzN7QRl3ctewb3UnYmge/GCPoCk52Vcn8rybP3WRAJyy+9bR+pyLCkUA+mcQeWEUStrnXu86riUSd03aYQs0VuWRmjQolgTkeBdtGrPH9vOeMXdkTGf0JbcMKXJpp/tDzutG/r93fiDejkpG+z3y2A9Zf7a8gzXvucAOarCPUp9lQInbFect98FPmjS7nFZ97Y13aVB2ew7/ivIJ8lK3Lc5Xt9kFPuHd8CZ63X2AioZhFFKfWLwaupLr2MUA4WmR1DOyq2ki61+J+DgIwnNE3DWUSLa1q5RvnHi4AKmv77+sdH8EJ62YzDTpElhevqoH3/IOhGILW3Nom7F9odBD5USFMMOX6000gqGJdpPyuzHqdiNNlq6srUa1UMKQGE+s43vWCxuLRDaxicEnLw/X/pNf/SzEM36CNIYnGDFIYltDfv6/7HY+lGCYAWZE=","authorEmailMD5":"9b6b1ef9d92de1784d74f0d74941a99a","authorUri":"","authorUserId":"disqus:ibrahimdisqus","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ibrahimdisqus.jpg","message":"Really helpful post. Thanks.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-08-26T06:12:40Z","timestamp":1409033560},{"_id":"8c80ee29-3baf-3e5f-94e2-da7adc31a006","authorName":"Tommy Sadiq Hinrichsen","authorEmailEncrypted":"m1nDqoAonKJiodiR6/J7np+iAB/KtX+kGTjPEawLMn8pC6zGGQKw5yaZjEyBPPUJ1pbMohYCP2nttjNihE0hzKSOY2cyIfKNlkB0BR+z1Lgfrw3NIViBZfUV4ggaB633kWYRVV/jVn+Vmc2YWmbeNiKyf6I9cXgFk39oT+mYcHME5iLnrXfym591e5f19yC4z+3yX8OfrSgnpqHmmmPhlEgvotbOVQOaMWCsX2dDLFQyYGO7cZet0XIUcWHsVZAne5VtKCEoGCm0G6Pvc0auzNeGdGnahH8NVC1xAVcgb7cVeqQORjTDCy5RTRXU71sVBC3IBfw3riMhOgaMI95IZRgMDICSJp0JdINXUU7si6j1GBAb/lXrY1mECtvWvuTjhx9p/KPJrnuqAeBahvoaWQIo4fMY7M+sD7pWPIEQvVRRYj5g+FZYAHAZ5YKSTp2prgh7EeUCZZC8ok/PxkhyqscFRrkNKQ8Ux2sb0JlP0cX5xD1+y05bPckEdMc9AwF1ejSbLUvFtPezD1GopEtV1D2QH0DK9RvXeaFx40GRunZ8hxG6LLqUjq6OqKQLEnYpPFrjit7c7VxsFghpWDiU2kadxXiBU58680QxSHOq0XymOW2QW/5eOl11l74qJlmymQYl622RMoyJCuVqNB6or33xmjxe/ls5Y5cH/FT0Yeo=","authorEmailMD5":"4d09ae82c6ea4a5c31d31e83ef0bb9bf","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thx, this helped with a problem I had for 2 days now.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-09-02T13:41:06Z","timestamp":1409665266},{"_id":"32c7dddd-175d-3d37-8968-e1bb5b85645b","authorName":"Anthony","authorEmailEncrypted":"DdkkwT1kOT3WvrgN++MiC4PIcTqbcAYnANjzNc0Vah1UJQC3dLQKN7rNBZGS2Hd48A2hFn7vMTvZ7k45Ow7jmaHMnY9EW6sv62xLzrpGs2RKNqM6Ci0gRTW2om90wsWV8tqbypclIBpMB1IapjZ+dV2FNafhs3ZUN8wkxI05sONPf5zn6HJkEUybOEMpSNzp269mZYdenG9Hk1Lg07Lqymhn6lPrX0zXwCeoyzONhmnSIpIRdWpe418bRmduOPkSZb9xoRtYUxIPcEKcoXSesLfqPFr2PU1XylkARZpkAZIvbP0NosFBvu8QuYBWXeaE7TZXICJDMURB3oAYi2yzZwNKvIYOtkyfIBca+kY2Khwo+4jSZ5UvR6YrDBPFzPdIqjdWR8fbMArrgkXusJf5lGbAtXbpmniVvvtMpKfSzcFdxfEU9nsWqSa+veq5qFTa/dx4mn3G7zJzqxz2LR/csFWKdZ2Od/Pbnd/MIFzBuZ6rAln8ifBCJFFbpbFaVeMWwmhXeZGixCx48SYcRw1wAgcDIVNDBp9/s3Gl+MsH1cGDUqjS25QaNZFlVRBDUPJEGfobNcrXzUAvbcdyt2mfhfR1o/vIRedgeIt7pLT1lYWwZncCp0D76oaKoIjv8UN1Z0FDK5IrLw7g01iDU+6+n10G+hptYPwUk1ukQG8Mpz8=","authorEmailMD5":"657f338955d79aa0599059751723c6f0","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks, everything makes much more sense now !","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-09-09T08:49:30Z","timestamp":1410252570},{"_id":"646b261f-a3b9-3e2c-a9ca-b8a6a78466ae","authorName":"Peter H","authorEmailEncrypted":"bCviXWZ2+iC3DVIfEMNfXw8q6Gge9RLSMHX4yqeqaVRSZ3VXQwzTdXdc8EvvfebIpJ8vFdyBDPv153OYfDmUkJRfhaFKtTVlFCoN3ozUZlxqNjKLCDgKTRRAKOL3Kk2i6c0uXQzmZm4Kw8wZiFf7vBEI8GnuINlbzzGBQrDvia22j6akcVR3GwFDPDXgEZhUlpON5pb7sVp925axpbhuEhFrM6C3n6Twh/22kzJWPMdKz86axERCv94oUWr8Mi7eeHmqku4UIzi1E3PN4sw15b1j/VpGC4JPNY/PCACRErwqGNJcKAkMS0GEzXyap9YunUByoeSjkL2fxnx4MbpssWzWRKVke7KQoVnq9YlbMJPDyHODJOPjnSZgA1sDgRbXBk8DexxKJvl+lB7d/llFfkT8t+f1URVC/yzpFexLs8qNXCAhxLJL+jSEZbmxMzWRky0AplfXbz7wGlurJh0KaeAb/n1UCNhmh11m6a6IpkpZqdsdVUvKu+vSlYHut0tuLYCzOqDmv62jyGz28oOpK98vl5glCFvVMDAftscyTFyK/Ah/CgaDK7qUUn2/e9dsxFMA7AdEok/w4n3SXZdLLie7JY1nK0YPlfqHYQ8oB2R4DiNfVbLJW3aeuMTyTxoHUQzgkVY81PyyrfRjBawDdDAPxvFFErJqCEep7pwC/vw=","authorEmailMD5":"e4d448fe79820066f2c0dc7b6a0a3496","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Fantastic post. This helped me out of a conundrum which could have had me stuck for many hours to come.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-10-24T10:26:16Z","timestamp":1414146376},{"_id":"b4327312-0569-35c2-8992-9d9c39bb60dd","authorName":"alphadork","authorEmailEncrypted":"uaaxV6zUGlXTNz38C1n7EzGRPEn0Z/TnHIQ89Fz6ko5lth+M8CEcseLodmgTUf82jso0zzzQbvJHrTNv/iW5AJ6Td3wYT1ybaDAw6Za0R3cSm64paIqafRGZn4W084qhR2PHLZtM7825FJu9vzkTPQk+UqY0lCHAJiffGnMcOmE9GMz0z1T92xi7M/L00XBhl5jlKAWECWHKmr6ITIr06f6CAi+vb9XfMAFmQx3+WiAyu2uugQnrl6k12n5Cic1GEt83Pqxm9ktnA8so8mQqwMTZER1cG035nXotGT0MEBlqqeJsw9CkZX8oJshbwrOQhvYf0SuESTCMeEuMvfmVi6qA6E7czdiDt00nWxhy35xABunRZZJaafGGuHxPG8sCQJSuL/kqhV5khAhBiKMpoeXZsx3hU/+aT182hgpbb3qDJDcUEpfjcNJTAwcV+lCY/y+UvnlJziPo+1WDfHMY1UkKre07t2eqxKPoOFeMQOpgNWDBWGgIHcGSS205E3u4NCuqhGELELxXtTAECVST8emFegqXiGp3PD2TgFTiDH24qQOIjO+T0Vu7g/Jp0oMOCPPb9lOKlSRoW7jtByq8iZNQMS3oI8f2Z+P4mqmMP4QZ4FXz8qFpqFUjXbcIqzbj3FiorSFE4k80nNoaWAMXjGz66ROpNr8SYoh/D6fLXZE=","authorEmailMD5":"a3dd2551dfa0e39c054ff5e32824b539","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Clarity is a beautiful thing! Thanks for the post -- also -- loved the intro to the book. I'll never drink coffee again BTW.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-10-24T08:42:33Z","timestamp":1414140153},{"_id":"96503b28-d00f-3693-801a-d9113ce95532","authorName":"Sampath Lokuge","authorEmailEncrypted":"f9R/4UUoaRcpmg5ZV1a0sWY90DB3X1Honb36xK4Pb2lFnCe4YkCFa5IwPCf7T6WmcNFqX1TMSD1JsV9733C8DEsclBLtY30A4qncW5Cud7j1FjFbL56nIzau7TRMyUa6s8Yy/YHwR8KRkCHmGI1rmS25sPrkoolba+dLjWZF3ajV8t2qVeEvzQq46y9izHWPZCrYaeliNPlP+8L7XUWMdNcORI+nznDKwlVcAb4H+F0DdHr5ia5VBRjZtnlBB6xdkjhAy02mwmKuO/jk26aBwcg8ZcDLQOgaxYOL/OHNaVktkfP91i6L8nrCxAJxMcJiOFyjSrhMc3y311+p0h0kHCBO7MFS+UAKgYYxfHjO2Aej7tTxPClteeC8p/Kn/lxKHN6gtlEbHOMxPTou7OPXaQVBKIisYZJiR1ZYEPhc+FoJjrtaSwyXIhT2+bKRtTeOB1/3D6hEJhm6evhwkya7uXrh8yY4sNWRbhjPjEI+L3HsRlcf7BqigGxnXqpUtK3WFYQt72inkNOnivy3e+Vnwp0kAIADxNtb0tVHykkGcRXyKLu/3tPA22jnTzXcpfe0QGkiHW3caCCvvQhiC0poQ+0ZMBsIto+ipuTCNaJwPUs+6sLEas8B1sNlrKFTKKDXkDVoXTfngV3L7ewH1bskAgcuf43f082hC+hJ8zNcxhs=","authorEmailMD5":"38e2dada2990af52ba6c55463cfbeaf1","authorUri":"http://sampathloku.blogspot.com/","authorUserId":"disqus:sampathlokuge","authorFallbackAvatar":"https://disqus.com/api/users/avatars/sampathlokuge.jpg","message":"Thanks.It's working like a charm.I have used \"ConfigureAwait(false)\" method.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-10-27T20:01:21Z","timestamp":1414440081},{"_id":"c09e7fb4-6444-3378-a975-c1126416fd86","authorName":"Ireneusz Patalas","authorEmailEncrypted":"T0YavoAqgx5ESc667H/f/nIuAKPqhgShFUIh3xT8sgcnEyoxAUo9l+7bZgpE7QxVu2umkuPZAiwIcOm3xmaxy3eidJv1a4bHzXdu15hDe5Bmdse22qLhq0/ga6709xJeqc/xerf5y2DGI5VETKOnOyjABn6Vum21OOFWGB+lnFAdVrPeyii3yR4xwYwJbXV4YQ/4+4d9VWvG+IgeS+lNv6F/q0J5P3ML61k5jRJqQ9RosclhNaj5Wx8uGF/lIzJdoQalmW/nsEULbMuS9B5f3h4pADCWIdoZt9NbS7d2/Vp9yKKg5eEd0QBY+RXe8jKlXJquDpRnaKdwOAN7WvGxs3uSjL0Yo/MqYSXr7ipsjp/8hpVE2J4xTxNEDg3Np1iAS3zqoBJMm7r1JpICP8Li682TAPyfM2r1bIUeu4Jc7zMcOnoDG7VIs4dl6n5q2GZez1JblKbR6MjqUK1FQhEYjie7+LO/uWdWhosD38K5lsHKACemobJeDRPMIChOkZFdFIL0ypq0l9iEODZhTGQHbIXTd/gzoioA9AH5BsWrXNFKlcZz3FEf97Sp4l0mHQ1+lFks6sPiOkaHFypCu2iPIf4e72e5+OHKGQx6Wk7CCRllk7vklUXwUXrCx4R4e7JqT46UHXiYN6XslX3kggWPRK9JWSfNKErQ6S6u9jDLSEk=","authorEmailMD5":"3892e1206cca25d573ebb7cd198d6a69","authorUri":"","authorUserId":"disqus:ireneusz_patalas","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ireneusz_patalas.jpg","message":"Hi guys, I'm just struggling with the same problem, but these hints don't help. To make sure it's nothing else in my application I've isolated the problem to the simplest code possible. The inner API is very simple (created from wizard):\r\n\r\n``\r\n\r\nThe outer API just calls the inner one and adds another item to the list:\r\n\r\n``\r\n\r\nNothing fancy so far. I thought I did the async/await handling correctly. The point is it begins to choke when I try to make 10 hits to the outer API at a time. I'm using Fiddler for that and for the inner API it works flawlessly even with 1000 requests at once. For the outer API which is calling the inner API under the hood it goes flawlessly for about 5 requests. For 10 (or more) at a time all of them stuck for about 100 seconds and then fail (sometimes all of them, sometimes only a part). Those which fail do not return any response (*[Fiddler] ReadResponse() failed: The server did not return a response for this request. Server returned 0 bytes.*)  \r\nI've already tried with single instance of HttpClient, but with no luck. Any idea what could be the problem? When I do the same from console app (multiple HttpClient calls in parallel to the inner API) then it works fine, so I guess it has something to do with thread pools being used by ASP.NET. I've also tried to reproduce the problem on a different machine and it's the same. In case anyone wants to try, here is the source code: [http://www.fidek.org/WebAPI-HttpClient.zip](http://www.fidek.org/WebAPI-HttpClient.zip) It's a test project, the url is hardcoded, so you need to modify it to your needs. Just call the outer API multiple times at once (Shift-R in Fiddler on the request - easy way to replay it given times) and see what happens.   \r\nAny help appreciated, I'm struggling with this for a day and can't find a solution...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2014-10-30T12:38:20Z","timestamp":1414672700},{"_id":"2a6b4f1b-ebea-39d6-8d9c-4ec8e9349d90","authorName":"Ireneusz Patalas","authorEmailEncrypted":"roQ1LpklKIW3hF8IbJnhG8uiU68hEWC+QBX8UyyBJdkq/b4LjEcRyr7IZtPEAlnuQX3yylFHB0Kj2MNZU0t6t0yRhnFD2xrZmyaN8bZ2yPyr5IBKTgRs2CEv6Fr1kTagfhkbINUbFgW0ZbRg+6vGs1SMPJ5K6nyw/io8kU5go0t9Een5ALUgKaG17M/5Ue6tmTkT+GkFHO/dmhzPA9dk/BPG+vU/IOP+LDw7hZcxxTDG/WLeCReUf+dcy332ElgM5+JRD/PDOYhp3ZZKf5Kc+QDgYyao6PZGtIY/kIgtMcIEYd5JKWGwf7kZzip0WpVfi13jW6PGZQA7QkgW9kbFeqNFCNGaLLS7VFX1qJeTY89YpPMXfvJRQ6dixNwAYWtoByOzYTfGU3Bop3G4fwyYmPzOqbx8lOi8SAXOc1BSOZmGd1Zew++2VEp5ft3qoevS1WQg+ulBQCA/dGKL2Ji2P1awkCDbxDJVEvvXXsEXTaK+ck77E/YnOB2NUSrmSjzNMoPLRU6IfQcij67rxFB4/bC/L1Lx6XzfVNBFmp3dQDv9j/lw/uMvzpO9gFKdkyNKXkjE+JQ0HHd+1J8gJPins+nRTYShQS9ckk775KMkM5raLmuGrITD8qL95deIi4e7ymOE7+cMlSzyhgx2uBBZhYDvhyaYl/iL2+c+s/2xhNE=","authorEmailMD5":"3892e1206cca25d573ebb7cd198d6a69","authorUri":"","authorUserId":"disqus:ireneusz_patalas","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ireneusz_patalas.jpg","message":"Ok, so I'm gonna answer myself :)   \r\nI found the problem by accident. The situation only occurs when both apps run on the same AppPool. I just changed one to a different one and now I can do a 1000 at a time as well... fortunately it was only an issue on dev environment. However I still don't exactly know what's the root cause. Seems like the requests from both apps deadlock with each other on the same apppool. Why does it happen? Anyone?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c09e7fb4-6444-3378-a975-c1126416fd86","date":"2014-10-31T08:31:22Z","timestamp":1414744282},{"_id":"e767ed95-511c-3241-a06f-0b48ed2db80a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I don't know why that would be happening. Could it be related to session state?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"2a6b4f1b-ebea-39d6-8d9c-4ec8e9349d90","date":"2014-11-03T23:12:14Z","timestamp":1415056334},{"_id":"818dfcf9-5139-3f91-98c5-a6fb8f1e85b7","authorName":"Ireneusz Patalas","authorEmailEncrypted":"K8r2w3TTDQsu4JsETBq7V3tpa5isG5GLBqVuscd3skY7ol7VTIVfdec83Brolq6c1qKIcnJTdJVXugI04uUhx+4qykYVB1qGFd9/9/rqDuQ89FSJ2xGvIv+R4D3EMkCWw0td/pOQIwpTvX3V+UaMjQs7+GQ06Hn4+FoEeOYeLtlN99X+eBR4gvP4xZUyHY6qOt6lleEhRMOZZB/xjMQMyT/6Q66zRGZSa68qEt+pgoMych4M+112UfwUzd0NWJHF6HsbEdaRGDk1yAzRoi9IzE+ree94bFzBKEGoWkCkREHlBMLHGZrRnxmjbHjGz6KycoM1riBjgrIhQpn/qb1vMEmGXk04D+9zVqhe47vhrd3prz9ACH7wF0nV3qJRdm+DP1ZUI9z5ZO7FphF1FQZNugswf4hklwh3eRmRorrY9ZdQXsTTeblab86ieVr2jBb+8AhkE8RBnMPvtgmYARj5jjoK1vHB21i2+O2v9DiD82XE/OaEiUaolots9uZGQmIcEiOYTUzBwe5yWIiEqboGwpMMmiToyBt518HW9PABYJ/q6SHiLwnZitnt95V9aoB9Uy/MFVsiRK8Urnh/SrW/2zx7aXdzYRzw7dXqrpBCwluS/NEKtprS5WmWfcdG2gsbLRjjMr7gQp0jV9R94/aI8b9QXxGWUk8Pwn6sgGuUJmY=","authorEmailMD5":"3892e1206cca25d573ebb7cd198d6a69","authorUri":"","authorUserId":"disqus:ireneusz_patalas","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ireneusz_patalas.jpg","message":"There is no session at all. Have you tried running it for yourself? Does it deadlock as well when run on the same app pool?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"e767ed95-511c-3241-a06f-0b48ed2db80a","date":"2014-11-04T12:11:32Z","timestamp":1415103092},{"_id":"5fe81e58-ed21-3874-a367-eed3e46e8910","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"There's a session state by default unless you explicitly disable it. I have not had a chance to run it yet.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"818dfcf9-5139-3f91-98c5-a6fb8f1e85b7","date":"2014-11-05T20:02:48Z","timestamp":1415217768},{"_id":"79b767b1-4f74-3e85-b37d-888f2ba3497c","authorName":"Saurav","authorEmailEncrypted":"uplI0O52aRYkLxHPyTYDVRe9mThJnFg7pwg+lL3haanpHwbAUk9HkIDq+cE2N30+JQhrcAQqLu6FDK0kTfaL0XBbF+1h4zUcGCsxNjN7R8VcjS+H3evjvdXai0f3JjKh0fRTEm/hXPzDEz3GUIV59OTeT6tVbVnOf5z+F97x1CBjcuOveJpAbjYyxePFLYvekxIK66OAAuel9bQFDCp28BrLyFRwq+TseN2XpID8dneu1RkiicuMcX+d71ZxmopGitTF8Mozi7ME52L9KycalommlSZqpozo8QwVitmclHYzNc0epxMicVO9AxkR9vcQrB+cHbjrG0yy2B6BgycAS38nhKv3R839gwJ577/nBQCaBlPKPTUQwRU9NEE/hi4i9uADKj+XoLPuB2mlMjRnHFtWNROAe4wcEZZuKGTn5tX/0I7Cdqki8rvGfZ/b8OPUTEU4asLAxx52zJxvKPmr7pW5AYFB1KpUQ/2NX86BXpLOT81WVORl2XWQSLLfmZJO1NlR+L75gj/gl/ge1FCdqfPwKVjo1A3Slv+t682GU7iJQWlL0dGt+ajlr9ArFh9Ec4nSh6B59uWPKngWKL4GDYsCo9pYD8vhOdjBKabts0j7tdstNafkrOnjwbzRfDW9kzHH3gsI92MO5djKGnOVfNZbfMKqJa/dTlrr0qofJOg=","authorEmailMD5":"c3787ecfcf2037d405102513f6b64b94","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Perfect article for my current problem. I stumbled across the same problem.\r\n\r\nI have a Windows 8 application. In OnNavigatedTo method of my first page i want to call a library method which internally calls await on a task which fires http request. I can't change the library code.\r\n\r\nSo i guess the second approach of making the top level method async should work for me.\r\n\r\nIs my OnNavigatedTo method the top level method here ? , can i make it async and let it wait asynchronously ?\r\n\r\nRegards,  \r\nSaurav","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-01-07T16:38:52Z","timestamp":1420648732},{"_id":"af9439b8-da8f-3e9f-af51-18e21e4e2944","authorName":"$40786381","authorEmailEncrypted":"SzePyiQShiThvIpn+YRf7sLBwm51CBLkTyc0g2kZNDi7Dw3rc1fARPlLa3UOQVsR/klPFNeA4kLeaLAV1Pz2sAuzMS74wMz6AZeg518+HpwAg/hdXYpUfKMDlP1Qir1A+lko/zMFkGI6UHDkLngTvr6Zzh/sJLxRqwln/q0BQ9nquJxa5BHbf5GMunnXG3en4/rwrjWxlnlG7XiGTLbpVo3tbnfwAOxcf0/6KrCNab9Xy5YoarvrnwgEUY2XQhUgErx4u+16hdAhAAktIozPrSdtWCbd461wlnvW7BbS1EJpfyQmeeiLhq6P64BJ+AQ8qMVVLVdConqGzpawtB9a1jVUs7HzOkYtvYmhFUG3o0f43f+UhQv3PWpVVxvyiQfxCT2L3ExubXNhT1vqMxqdcMcwmYFJD2pR0qrj5qy7x9ZC/wHLfwSHsVNjCf+Nz8Wcpu/81COMQhIi73ZFyrUWv8slEgH8q6rT7w1BCNC1AKhmNJMyZSyhO24MRogFvPgifN0PtwMMwHWYDwJoJxlIWIPtnQgnfPe10Je60mIzoKAq1RGV+HmSNOHEOS8I4FTxIK9JTPQboA2Tx4ZPWG0FC5/G6nPalDhJXHfr+htP4uAiGyS8r8T+szNHyLICNUMLyj4iZi8z2rQHCYEKNgW29zgVGSa9oKXmtnxrl1JCiVo=","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thank you thank you thank you thank you for posting this.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-01-08T23:51:42Z","timestamp":1420761102},{"_id":"e0b7b401-9314-34cb-9204-55e9b1aa80bb","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, OnNavigatedTo would be the top-level method, since it is an event that is invoked by the runtime.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"79b767b1-4f74-3e85-b37d-888f2ba3497c","date":"2015-01-08T03:36:37Z","timestamp":1420688197},{"_id":"dc02ba96-d453-3071-8850-77c9d43ef78b","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You're welcome! :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"af9439b8-da8f-3e9f-af51-18e21e4e2944","date":"2015-01-09T02:08:33Z","timestamp":1420769313},{"_id":"34a692c7-5c46-306e-9d73-5df819c8dd86","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Actually, the problem isn't the SyncCtx. Each request gets its own SyncCtx, which is independent from all the other ones.\r\n\r\nAlso, the problem (and solution) doesn't have to do with async vs sync. Async on ASP.NET only returns the thread to the thread pool; it does not return a response to the client.\r\n\r\nWhat you're most likely seeing is the ASP.NET session state behavior. A \"session\" is shared between the requests, and (by default) each request will want read/write access to the session state. This is what causes all the requests to wait for each other - because they each want that write lock. To work around this, disable session state whenever possible; i.e., apply [SessionState(SessionStateBehavior.Disabled)] or [SessionState(SessionStateBehavior.ReadOnly)] to your controllers.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"afcdbab2-aeaa-3ce6-b8df-bc9876183b86","date":"2015-01-22T18:07:20Z","timestamp":1421950040},{"_id":"afcdbab2-aeaa-3ce6-b8df-bc9876183b86","authorName":"Cherie","authorEmailEncrypted":"bsGgfHS7N7054Y8m/EcW884NfKlzz+P0EZPjV+xxOGLW3V1tfFLDhLk0ozN+f/TPWp6qJqKvuWaoLYuoxvUtHhg0bFeW4Jq0/UX94jBnfbe6D5aB3BABOn0T2gbAQ01XBbKnBM8jirsT4JplT/5Nv0S7y6yO3flmuJcZQTegQIj3i9FUAy2aEN9CneODyNz26djMQU7R13OAxGwF5poAgHq0K4rEqhHpqNCgePgNxEpnvyQ+vwVyWQhIGMv/Pv8gEO8BLfl4Llx92/xw9MLdUc/KT87W/7kifZ7doX7xVyK9OgxX2SwP2SMCY8bszzmmWwpNas0ECwLa/mUQfkLPzGVfbqJQIDWCAUZhN3q1yq/50xnx58SX+JK9EHLoBcaUS+OLg7YeUuUflcv6H1KXezCBJNkvfVlP9eZFhNFrSYE/33S6E5fh3xa+grcSVMPoRMrUD3rOF1jvhidOp2vTIsJOGk6S2kLJq1tDxjJIjQNreEx2wmWNCQYH5vQ3XBuhitfwBE7XexIv9FlSPy/Eve9/MtTREQOwZOJCPTyAA2+x50sgFM0XxhzCLSC3KkSgGKdmh45yzBXanwRRN2g6XzCRcb88j2CXju8FbnbPeDTxsgn9mWGOIt317d/QK8GI4KmaIbGK7OOCLfth/rld32xSy9LxyngPgWjfW3SD6fc=","authorEmailMD5":"e0d78c9fad417af042647d56544078ee","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thank you so very much for the post!!!  \r\nI have question about SynchronizationContext. I have a MVC5 app that triggers multiple ajax calls to load a page, and one of it is slow and other calls wait for it. After reading the MSDN resource you provided, I am surprised to know my MVC5 will not process async ajax calls at the same time even if I change them to use AsyncController. Is there a way to make the ajax calls not waiting on each other?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-01-22T17:43:50Z","timestamp":1421948630},{"_id":"d06f2d76-7fd7-3bca-80ca-9382104c775d","authorName":"Cherie","authorEmailEncrypted":"iTIYJ8aCOv/WmuLj8EKW8maxa4oeukdR9gCJX/xq3cYTrX/nTU784NzO1Dw8N+VDg102PuIorv6XWs8Gnspc4Oq0iIAW6kse3WJ2QyDPTKzv06mUO8b86O/LgcOQo7bJdWIOrP8/9lFMB8yXjxpHhIJlkKfkR919au/egDxF05pHHbYtKKRqBLX/pzWUavuKlNvoD60VkYsr3c3MK/Km/KJNB9vrVkrMAvKPwLfZ7JSm6IR8BBmiEhem+8xhN8ShHBBDNLuVCXRu2vgTsvrr+d61dojOcnY7aHkftw4iRj9j8yLSM/FIsUbvoVf/QDtYxVj5cZWp9ewF9wNOvZgof/ndJhQTUU4P0L2ysOtHmkJY4JLo255h9iBTm+CD+kFW3lHzVEE02YdKOKeO06ExLyMZTOQeyuBhZ3iS8ttQ3mnPKPNRj+4OpO5EJqK6J007sMdYjOJi6O7YK3xmFDLupkDXcXuY4tmEPm4zytf4L/1aDHsKFuzNhjeptf6B4lgT39yZCgIwesiE1FGbjdhopQz3oj5DPzeVnUpC7Rulsgl/c+3Qq29XnJS35dctWp/udKWKkh2HSx7PMPORqA/CN8NHqTbpjwUPyk5iHTh5iAUVbETaXOEeR/Qt5rrpgCOB61s+j0FCvIIX82tumPgc97hPWFXqB2qC9EYdhzd8pSM=","authorEmailMD5":"e0d78c9fad417af042647d56544078ee","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"OMG! You are a life safer! Thanks a ton for quality and quick response!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"34a692c7-5c46-306e-9d73-5df819c8dd86","date":"2015-01-22T19:15:27Z","timestamp":1421954127},{"_id":"95cc32ee-675f-35b7-a613-cb03dcff17d4","authorName":"kylelib","authorEmailEncrypted":"J0B4FyNtcedOBXRU6qahUdjq1casuQ8OeDYSmyGAQQfgzcrZTuam2Qx+eT4uvt4zy5k+I7X7Gtd11eC/czw2oq6FWigydi90qEE4VP9O84rs/VfKUaaD3S+j2a+/SNkoYBo6MgRENetTiGBd4vM1IwRlNoXL1xsXthph+aBpqEidZ2/a+W4jCeWdS/ECtEpUWiEgFy7zbfVvyaty9kEv/fVfeWAV4RF0GwZyAv+DIWvzyH7OzuGhoCOZ7vXaXBJFpaExMxScmgmberoJZkCpS4O+58boNl/MSUCVMrQistsJfh03hjiutPfoU3ClXfYSXiCjxGefAfv+WGLWkV5XhLzWlVNYME6rW1qTGYCTmaFUuiCbw29sdoBCx3XM0lwmHToATe/PrUnUrHGozjI1FGG8kfJOeq3X5BF87Q96MM0hHbM5UQL5m8gbqIfSYPSSjmIfoj/Ylr2u5j+Fx/q7K1QoJ8j2RJgVZLCp3k5PWk1/7cfHpDOYjNBEjeUYkwJkNntRwRWvmWwHwKmR0vdo+dn+rduxw9mCVDXyYmQ5dHJO4M+bFBOB0WItCekwzXgL/etGYtARnFRuNwYOt7sp8S6e6lqEQopyuFK23JGYinzAt56k4Y4VUe6xG7njp3DeNs3islCL/+D4bfG0GSOiBiZqcOlPKgqcSn80qVyqzac=","authorEmailMD5":"8ce46d76f8f901b0cff4a2c4d15b5068","authorUri":"","authorUserId":"disqus:kylelib","authorFallbackAvatar":"https://disqus.com/api/users/avatars/kylelib.jpg","message":"On the subject of UnitTests, or even WF where you can't make use of \"async\" and \"await\". I've run into scenarios where I need to call a REST service from WF CodeActivity, or even a non-production unit test that I'm using as a debugging test harnesses. I don't think I've run across any article that addresses using HttpClient async methods in those areas. I'm experiencing the problem addressed in this blog using a unit test (debugging test harness only), and am not sure how to get around the problem. Any suggestions there?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-02-06T17:33:08Z","timestamp":1423243988},{"_id":"a3242b1c-23bc-3495-8783-6b2566b019e0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Both unit tests and WF are capable of async/await.\r\n\r\nI wrote an MSDN article on async unit testing: [https://msdn.microsoft.com/en-us/magazine/dn818493.aspx](https://msdn.microsoft.com/en-us/magazine/dn818493.aspx)\r\n\r\nI haven't done this recently, but async WF should be possible by using AsyncCodeActivity ([https://msdn.microsoft.com/en-us/library/ee358731%28v=vs.110%29.aspx](https://msdn.microsoft.com/en-us/library/ee358731%28v=vs.110%29.aspx)) and converting from TAP to APM ([https://msdn.microsoft.com/en-us/library/hh873178(v=vs.110).aspx#TapToApm](https://msdn.microsoft.com/en-us/library/hh873178(v=vs.110).aspx#TapToApm)).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"95cc32ee-675f-35b7-a613-cb03dcff17d4","date":"2015-02-06T18:44:27Z","timestamp":1423248267},{"_id":"dc859b04-1355-3cf5-9b1a-7c779f5b3431","authorName":"$40786381","authorEmailEncrypted":"Ag4GOgZHPcmzys6WOzSkLwz2EwKS32aWoAUhFfgDN0ufZQRBDUAFuGHO1UILECT2jE1eVLhnAbkockBVNIWSzkXvwulAQPRDoeUBfcp03AqvkIUOYsqHm3RXmw7l2rFV0lRBp+/83q/YzSrXTXhLobJHRAc2I+yjxLfay3TjFeLJZX3tGkJjsN35WiSeKEZ/PtJqcussGQVyNMpTZDqmx3p8xDdeUi0xEgDheKRRYDgE/hNVzhfoF5uY39YM7bP70wKpP92RX8IfzikLiEYacTnObha59Q4/87g8iPBTNcnUgjNatkLZMJAx6a4GtNSgwvEj0jaUe81IxqLaNgPyYGTyCGwzxKZGTR+nEdr0zseIhj5eWxZpesbhMENTBfIs090N0Xyq9H1wI2SW6dcB4qg0gJBmKH8AT1rBqXi3BvphgWtsm230coTCZ8jnDj4lhoY62AnRr7+cpUxMymmDhjV8Mxcx8KUA58fzpre38+zv0RTSSZhc+mx5mR2Xypuek4hw29OLNORdIT0g3jnpLYVjMVP5o34tQr3OCm354gC7C3dSHrOyEMkZHcv4sib/txt0wZTflEBzvwZD2mg8EHzADvZYmhtuDxxs0JPgecVJIP91RAwxTrFoqPpYltq4K3Hq4JqcHmhsPnog8+YyDz9bR1QdHLQ9hfYm7EfMYsc=","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Stephen, I noticed in your example above that the return type for the Get method in the MyController : ApiController method returns an \"asynch Task<string>\"...are ApiController endpoints synchronous always unless you modify them this way? Thanks! -Bret","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-02-18T15:01:21Z","timestamp":1424271681},{"_id":"f8d8955e-80ac-3922-b758-b6cd3f92ca2f","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes. Reflection-based platforms such as ASP.NET WebAPI/MVC, MSTest, etc, all determine the asynchrony of a method by its return type. A method returning \"string\" must be synchronous, and a method returning \"Task<string>\" is assumed to follow the Task-based Asynchronous Pattern, and treated as asynchronous.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"dc859b04-1355-3cf5-9b1a-7c779f5b3431","date":"2015-02-18T17:39:53Z","timestamp":1424281193},{"_id":"8dbc2cab-c45e-364e-b060-158fef1a4fcf","authorName":"Max","authorEmailEncrypted":"NsOTRV+JwqWl8AqEHm7K01C2Ek1osSN2s/1ifEAhQ0gQ3irLyfGJ8ATauLPjkgdLFG4z36D7ASc8Xj1W4cFstAx0DOgK+fzcpfDgOVuLnsEaIyRcJLe1rDDZp/ziR2nmhUu6E4VnTBr4KzVCIny4/YKGsMMfaqG9yTxI3LGhqgAejaykdFINcxhlJ4rnMkIYDbp66yiO+RuyCJa7jpxGV/9nEu0KqeGNiztQf/P/hgb9dUNH1003j2WekC37HdIe5wUcYdbFKcfUPTOQWsMDX72ce/MVQMh6zUE2QDogbNfEAei88RxWW5bSAKivtJX4PVxP8y7fcn2RhifApviHCgMn3xStlWqb6zjSnElZfxNI+d7vsgvzuzxN5MsRW8SEFWRDTMeQCSLnZ5CtF9mi5wG6lUXIFIoLHu4SH//PmZ0ZUy1iBUzERkg5POFVILzmJar4FeRefQV8MYN6ESIBx5CJ5vgcO0gEYalHRizvRf/5HOZQJBrwbv64lvXno+gmxfiBcZYfr8FpOhBEe9R5/rGEi+Qox5sBIlrfuszUMQAVIJ/YOUTOLWGQoBnYxBFrtREi8czB1/kdrU2vjKjFtZDvClaYj2RQld0re+1/SPlaSUDpHVGDpwDZb825rDeKKrCCWcHWMEG5qAQBIQIXsjtYD/AvceRKilJDzDttNSU=","authorEmailMD5":"4f0f72c8d3424d9e613a09747eacf7b8","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Also seeing this problem whilst using HttpClient from within a WCF service, although both services are using different app pools. Changing the call to use HttpWebRequest to synchronously within the Service resolves the issue.\r\n\r\nJust to note, this was not using async all the way down (a lot of codebase to change for that) but was still occurring whilst using the first solution presented in this article. It also only seems to crop up for concurrent requests, and it happens when there are as low as 10 concurrent requests.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c09e7fb4-6444-3378-a975-c1126416fd86","date":"2015-03-19T09:38:42Z","timestamp":1426757922},{"_id":"4161be7d-9ed3-3231-b9cb-fe50681e2259","authorName":"Andrew Stephens","authorEmailEncrypted":"o8cbPGR/TUpYs8rasvNENLopmArVnHdZoUo3Lrr4lc6JqBHBdhMULdHOCBQnbPc0nGFBYF7r1W8Pu1JcwO/xU3KZu+DdyJ0t+L6o3+NZAdfQEImhoaIMSMCCStksq2oYhaton0dwfNqIikgIt2BmS6zQ/zfVtwkNiBkP5grLUX0No7+mnT1TsHFmDSfhHR98ijoi6qn6O45HH0bd+UlXkJ3msq+LHMt1vb0tDumTECfSoNTcNwsL3PNn2LSMrztQ9B0ncuHWkYsboQULpeeGjeqPJVGYgjzGcLdnyCyh7Uao5795L/UtKpJc5T7DAGkuDefpXE0GkmDCunGNOdGqsVD4kZVlC+TcilTOvoKKWbul+wqlhBTIAN2IJOMeLMtN0dsxwF7eGLX/MZXvafZgeP7ZTlKMYidqs9n/7ynB3N4RqVXHA1ZV7q9dKACJOTjf+5IyqNhOPiNcXsrpS2nbcoIBobZxQ7Z7mOPt/IO0VS/YtvpAi8SjppZPN/GlGxi340/88xbeQ8ebuAY1IDIlqB0fNcoyuqkEwT3eyFApTjuAjq6Kwjl2f3pbc+/94itPjEXY5/OEfUWqBMXHc9R8qAijDDZn7Hcrflk3ds4U/ONDeRkkNa8oi5uEipwr/FwZ3fkEhSNMwOd+LbcBTrwmRNf6lxQw306CnjRTy4TFOY8=","authorEmailMD5":"89bfbacc849835ca831d84ae6bd014aa","authorUri":"","authorUserId":"disqus:andrew_stephens","authorFallbackAvatar":"https://disqus.com/api/users/avatars/andrew_stephens.jpg","message":"Is your advice still valid for SignalR? i.e. should I apply ConfigureAwait(false) to all hub proxy Invoke<>() calls that my WPF client application makes? E.g.:-\r\n\r\n return await HubProxy.Invoke<bool>(\"Foo\").ConfigureAwait(false);\r\n\r\nAlso, say I have an ICommand in a VM that takes a slightly circuitous route via several methods (in both the VM and other classes) before the SignalR Invoke eventually gets called. I should presumably make these methods \"async all the way\", but do I need to apply ConfigureAwait() to all of the awaits, or is it sufficient to have it just on the SignalR Invoke?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-04-08T08:23:29Z","timestamp":1428481409},{"_id":"8ccae577-719b-363c-9028-2f97b18d00a9","authorName":"Andrew Stephens","authorEmailEncrypted":"YnrxMNW6MUyEQ15IChD3mOb+CqjIrDv8ZBI4DGBBLTG7JQAzKPb96Utt+3DUdwK1qg7ZjGxKunNqOwlcObx8UTFgNxzlzJGz9kNzoEmRWEEYLHhBLkOkwOMCheL0gMJtjkJSFtvnCJaPxc8VnY/RQeWUva45j1GEU8280YBJdZtoF8s8YqVrbKg8n7Gs+4AYon7+KldWIGOdMd4mneitScskGm0COIbhqCHm4B9+Ws5w1r+ssZ2zGLuD8hgyacbBSWRSpRptkks63axVY5GkJKCV4FmPCFMzXw9naxzfU2kjYoVBGD62J73BW5WLi9pJxiibVBwgYiurBKZdIVXiDYdniFYQFTc2q+0z+euuUV2lAatbBlq1XDLDZyrg7fxpy7Rn5mGgvMF3SclNrR82iQeLKg2Iy7u4+Qp0rZs2YaBv4qqhETiAbQmdcNOdgtusqj/DbXSAsyBvepsu9OI0zenc/QN/+VdCgJVHOeuK8+FcimHotiyc0zsCeITL8xulgvd6pCBVkaA6I8RM/XIv6r5twc5/IIq98E9wEpUO7Xk8GofKU04FU+tR5b6THL7p0EU3KI5V5tpo43YmkQMo8Tu0wogy5sEXRxmMmWnkfH5+gbqM6CjqMmrZP6bLRcek16jR1xeVx5/locxKGuTAxnUwW3O4Rqcm5DyejOhI+Ws=","authorEmailMD5":"89bfbacc849835ca831d84ae6bd014aa","authorUri":"","authorUserId":"disqus:andrew_stephens","authorFallbackAvatar":"https://disqus.com/api/users/avatars/andrew_stephens.jpg","message":"So if I did need to make a blocking call using .Result or .Wait(), where in my method \"call stack\" should I use ConfigureAwait(false)?  \r\n- on the \"await ...\" line inside the method that is being called with \"await ...Result\"?  \r\n- on every \"await ...\" line in every method in my call stack?  \r\n- or, could I just use it on the SignalR Invoke, down at the bottom of the call stack?\r\n\r\nAssuming it's feasible, the last one would be ideal from a maintenance point of view. All our SignalR Invokes live in a \"facade layer\", and it would be easier to apply ConfigureAwait() as a matter of course in here, rather than rely on a developer remembering to apply it where required.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"8ce98a17-5954-3073-ac60-d4b11c05ecc6","date":"2015-04-08T12:36:35Z","timestamp":1428496595},{"_id":"8ce98a17-5954-3073-ac60-d4b11c05ecc6","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If you're not blocking on asynchronous code, then ConfigureAwait(false) is just an optimization. I would recommend it in general, but I don't lose sleep if I forget it (which happens)!\r\n\r\nIf you are blocking, though, then yes, you need to have ConfigureAwait(false) everywhere. Note that this causes a maintenance burden; it's usually better to just sit down and convert the code to use async all the way.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"4161be7d-9ed3-3231-b9cb-fe50681e2259","date":"2015-04-08T11:49:49Z","timestamp":1428493789},{"_id":"9c770301-f0e0-3a6e-9502-ec17df91e0d9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's best to apply ConfigureAwait(false) everywhere from that point downward, in every await in every async method. At the *very least*, it *must* be applied at the first await *that yields* in every async method. The problem is that it's difficult to know whether the first await will always yield or not. E.g., if the first await in your async method is a call to SignalR, you'd think that would always yield, but it may not - there are exceptions that can be thrown *synchronously*, which means that first await wouldn't yield, which means you'd end up with a deadlock unless you have ConfigureAwait(false) on the *next* await in that method. So this is why it's best to put ConfigureAwait(false) *everywhere*. And require all your third-party libraries to do this, too (AFAIK, SignalR always does, but HttpClient sometimes does and sometimes doesn't).\r\n\r\nAnd yes, this is not maintainable code. It's definitely better to use async all the way.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"8ccae577-719b-363c-9028-2f97b18d00a9","date":"2015-04-08T17:49:51Z","timestamp":1428515391},{"_id":"b33394c9-39cc-30c3-bcaf-92e0fef43faf","authorName":"Guru Rao","authorEmailEncrypted":"RgJXIjsoguRMUXk6VWjvsx3hWyaXE4bJOHvqOkCGV/Ny7PBpYwHnT5QsJKnnUGo7owXixaBWY20lwGeE6RKEGWzEgD5VJOTAc/BjQXI9o2r9QqZ8dp6IHKovcRNr35VNh7AhhwC3f9uoHbWYqMc9P3GYF3HAbg4vN37owWV3durVuretz1M6e/cOe/txO1QBgIsmTDJyM6JQIudSnBJUNKgr5AfB1Y3tHYaQjnSp/kQ6rdoilpknO7Iq1khO/zaFh9mZBKCqoAPMg5NOfvWk7e5Vw22FB/45ajwsupGnIMWrCkwJJtOyplWU+QT9avLCjLFOy9/pzBKVbcthdweZ33SzDxyoJd7RBkLpN9Tluu9pWjx66qgcxV/VMSuwnAOsgQRuNxb78KsjCYh8iOTgsEOQnr83NJ+CwMfbe02CSE5WTZ71IJ/iv/kY5yxhuTmPX844NS1Qy63Cpv3awjSYst0JJbz5txH9snH5F0L7C7uo+nKuATYd0Cu+HG9n9FKgv3CsitYhILnSQX0HeBYpMCER9fOPb5LhDOAcN2nEkq8FDTcWuJjx1BqAtLUaRfckUjTGEkFqmum3TZqDr6BRJjJPUwTVo6/hacguhiXTtg23Uiy03VPFMOplm9q21GO8GIDU+5KHHcocSMJmdoOGQ0PA03ytBf7VnVbjTNMU8PM=","authorEmailMD5":"8860e4cfac92a67cb031f9c5c48123a0","authorUri":"http://guru-dotnet.blogspot.com/","authorUserId":"disqus:disqus_crOF1vvGyM","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_crOF1vvGyM.jpg","message":"Very helpful.. Thanks for the post!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-04-08T21:49:36Z","timestamp":1428529776},{"_id":"6a356d77-5c2b-38aa-82e5-45ab41a3cccc","authorName":"Rahul P Nath","authorEmailEncrypted":"BWCFtwBlBZcHS7T8er9vwadymdiOIkGTd9CZcUxNcx/KKNV2GRJhoX4urJgLVU8BmIbkoyq7BpLGjgA1UhLWIbNAn7M9dPmHhynZIZUA1U0BeW9D3gNEe/TzOPnGbmA0tA9dslUFGaRvDZBgLq/xEWGri1hrxm4cLZz47tuyaU+6Meg/yqJasov3jT6vukZq3Ypt7dlN4FYG+Vz6sko9EZPCIoBVX5CUN8WAHTOhDi8yIBGv4HOOXaGMJsKbsxqj2XtWtYp3XfGSGAlbsWB+g+6nEi+DBnD/x/c+FXW/egOtr1rqTGbQt5r5bPUqh7m48eYHchzzeqRbV8N2L1+Z4hejzr86HrStlv3wbd26wuDSba6SxLrP8mQoVZCKXd3ZXbVPAAVVZdwDPipDrrDGhVB1WbrmDbwTqka6MEVfNr5tVgO47SQtkgkh6k8BiymxKtuEtTjsA53UNgzdoPkR9mPUsGu3fpm0GPNBk2RrducaSiSRaFHsloZSdvv0OuTK1IVrIEhn9652A+/i6H7MNUHR28jCs1xt9QDiTu0yXz+t/sjKqT+DHeq4+gABG1uf7sT64m1Zzvrpm2aRrcHa2EbN1o1wDJQZX8LzPu+vYo42U6n/d3yWwj6q98xwiYR4LNOkc53R/dlZm2j1qMJY/QYhkCweNWKhJLvglkioK8k=","authorEmailMD5":"52158e6893b81b7fbcf1af52c6a5a81d","authorUri":"http://www.rahulpnath.com/","authorUserId":"disqus:rahulpnath","authorFallbackAvatar":"https://disqus.com/api/users/avatars/rahulpnath.jpg","message":"Late to come across but still :)   \r\nExcellent post. Really elaborate, clear and to the point.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-04-20T15:59:09Z","timestamp":1429545549},{"_id":"b0d02674-707a-3243-9763-10ff4da26da5","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You're welcome!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b33394c9-39cc-30c3-bcaf-92e0fef43faf","date":"2015-04-20T23:41:37Z","timestamp":1429573297},{"_id":"b20b7f0b-1e39-3313-9f11-81666e08b357","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Thanks for the kind words, Rahul!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"6a356d77-5c2b-38aa-82e5-45ab41a3cccc","date":"2015-04-20T23:41:23Z","timestamp":1429573283},{"_id":"1e386be4-5ea0-378b-8c64-a1e3cef75250","authorName":"1antares1","authorEmailEncrypted":"ItF0SR08dJvT8CittJgCRpPXAGkwzZvpjTxr6bQ+Lo46IBPmaQk7WtyysQ0QcUF8eK3tKDxlV9lehzEmtujDLXZMpw1vVgNeA26fY9G22kVwmW+o2qS3yWp4Bt//x+oOafXtrjaC3hLn2RssoGx+hDJyFP9v15AFZWGq/xtOCgw3EHfOFniDi1KuG9lZuukmJMnDHgSpUYWLR5UY4RoRI9rp4/suQsGZIKGfLQDRomABo7wrB6gvO2bFpOTYbk+egfP4+Phdzlix8J0KVjU1AXTygdPq1qKYy4j54JP11c/q1PaTr3Er9lRcj29keOXy+WBWXgeyoZxqfKFeLKMDiGKhdtMCeSFgr1NWfbg1WK1jCghjlXbn8SyApxh3nZDICHscVrVFqfUmiRdCy/xgXueyXHo8MRTj+VDNyKeMpSzWNaIS0BgTCHObHzbwc1tkAt/DGHb4NVfqyhOhLokcc6mPUenG6j2eMh6V+eKDFresN3CUP3xXcve/lVrxmRqaS01VuhqVNbP5hB/uYCKc/l944D9pr1TB+t3cBoWEtrHgjDFs9T8hKRZgLwlbVXxcVLlzXt1Uw/kgnB+tmd+DVDgjZ5XzMr4l6PifJnBipp0yw7x1+VgfH1eycBnGh0UsJsmfW+Q3RjqUvJa+cD9WZpDeKhELZu0DkM8xr6dxjnA=","authorEmailMD5":"a4c40adc5bba16f42f6b3f6493035b92","authorUri":"","authorUserId":"disqus:koaltares","authorFallbackAvatar":"https://disqus.com/api/users/avatars/koaltares.jpg","message":"Mr. Stephen Cleary, your article has been rapid and great.\r\n\r\nMy doubts have been clarified. Thanks for taking your time to share the network.\r\n\r\nKindest regards.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-04-29T13:15:09Z","timestamp":1430313309},{"_id":"e9bab685-901a-3431-ad01-039eba924768","authorName":"Germán Andrés Aroca Silva","authorEmailEncrypted":"GRlcMumg7nnESusUAM1a8fvJoUIFvuAAuHrqjEFHFYqy6qhkLHxhLPJmliuKyWi1g0dH20fc098jOZpVFTX5rfs5czjVpbdywznrxZ4avg2qHD3lWN/uOUJh1PqwyY3V57M81Al41ikJKZkEUL1XMOOD7/GpFzSe1UQvJFGnEj7xpXXi0VYxEmSiaUlVENY7xIw5b0LZzkWL82qPEB9q9o7WNCMhey5iCx2iN/ocm55PWpT3K1oRVTIqvJZMRhGR3HhF2r7xb6/MhAe8HFocEz59f9RSioXSGC13X+dr5pUHsEBHIMHSuutqui7D9t70GMitGbPBInel3tFh6LDrD5LSAtKgFAaXz9HYbQPJPEBBkm7Iva2MDgmy+AgvONVMJEPy9sUFkdEhNkoqOh4gndrTlxL1ZLPkmepdwTeQT+y2drK2e6LMcrxgaZQB5h3BRqncUr8ICpBQLYAQTjbdtqb5ije6Pt+Mcwrq2T/Fi7iUdVD5RclNZlHRTskQJyB32j1j+hZ+p7ZAV1uugTqNMK2d+q++LYa7/SCzAKPsMbrHXI9XCmLQMEbPgbv0AbD5gNy17vOUTDvnY7O4CeEAc1l+ogT7jyCCxt2noTAmdae9XXMRQoS4DyhTAu1bpEpZCY0F0PYYsxIvYWk8+7uIsLVJhhFtBSaaSQ8peR6m+zs=","authorEmailMD5":"d6dab27c8ed1bf8c8fcbae0d3f56fd8a","authorUri":"","authorUserId":"disqus:germnandrsarocasilva","authorFallbackAvatar":"https://disqus.com/api/users/avatars/germnandrsarocasilva.jpg","message":"thanks for the post, helped me solve the Deadlock problem :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-05-10T04:15:52Z","timestamp":1431231352},{"_id":"c5b836f6-52d6-3eef-9e01-53ccb7cead21","authorName":"Bhavesh Sharma","authorEmailEncrypted":"liF9RCZQVWwFL5PwVZXiJaWn0pxB2P4ot6B1XOO/AwZ6HDyo8VdKgQoRwAP4EFNAXULA3kPgACxLk0m8QhEG2XQ4dyG+kYtyuvP3aECStXBjubL4eNIg5at1wYWG3eMYsFkIJWSto28lRMlon5381uO7J5KjJgHQJVB/z/Hf4StAMimj0KYWHZ5rwQHbGGdUwuX+pGqKgcFf2TYMZIciReKPHhwhWq2+KQbjGE39AoP3Ny2NUzvxQ3fwcCla3T6fys3/OBpkMWdLKGpMEvgFGJc5cwFXGaqODk9edqFjdT25dITyta9jm3DtP1EyWYQUEKIQTq/QZQjB5A2vfN4vGsfTqhedxDbTuWMaepO3/jFwgIrttWHDihaIFwoTdNNIr/YDmRCIuB6iXPgcYFaOEEbrnt9gOG0zSl7T9t1IQ3a5lAnfnp45/17bUjZFLWDFeRO7Hjnnu/xh2gjfWiI4xEq5PBZ3JofWobcng1Z0ZCSD7oEHvc2+pGORU+iE97uoSaLj0LqeS9hf/qXUvgVouTNu9yAVlSSNWc53M8Y06Pd9TFTNqn6H6XZq24AtyLmvOX8whGnAK65PKf5r39ZeYVuSyloOQG9AKBxy/SyeiyF52IVLzT6z2sPIPmsPrJTwgvD1/QjAUdle9Qp/VzutKSDu+VXEh0nZzR5as/londo=","authorEmailMD5":"45687bf2326d8269e68de87f5e202118","authorUri":"","authorUserId":"disqus:SharmaBhavesh","authorFallbackAvatar":"","message":"Awesome read, Thank you very much Mr Cleary.\r\n\r\nCan I ask the following question?\r\n\r\nSince AspNetSynchronizationContext does not have 1:1 mapping with a thread, would it be safe to assume that the deadlocked resource here is the synchronizationContext instance rather than the thread? As opposed to WindowsFormsSynchronizationContext where the deadlocked resource is the thread itself.\r\n\r\nForgive me for being pedantic. I understand that in both cases the outcome is the same.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-05-22T20:26:07Z","timestamp":1432326367},{"_id":"698065d9-858c-37fc-af5b-ba91bdf00f87","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, that's exactly correct. In ASP.NET, the resource is the request context.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c5b836f6-52d6-3eef-9e01-53ccb7cead21","date":"2015-05-26T15:40:08Z","timestamp":1432654808},{"_id":"0d4c1429-a460-32e2-9e2b-9c0bf692f405","authorName":"Ryan B","authorEmailEncrypted":"YFiqM9OL1wGvuAaZCovpKoUZSnXOh5mtKgKX03al79t6XR46KLIaBU138EcLJtjRnuzwUBln/V5wwpaJCGpQju2xKUnBv35UHdcpkB/z1dVofolTbyg+vZ2CAtz5behIO6f9dbMq8gz988Dad8rUDNLrVPoyUbRmWfLAwUBikurh4CG7kMKpYQehxNV+TPesRiBKotmhXkDNkZgQeq90MPhUzIIeF4Opdj7RDH3G4rT/GVW/F1tHzF91kVuFf+6oVu2jPjAIRC+bBqZDOh6n0SbENboxMTjTU0p2DZ9KKfpMIBPv5JwaK2X8/htBO28ZL6vR6ndG7Zfbve5DOSSdwIPzua9oZY+lWI7UYEeAcpjPmIgNLqNeZLz15IboLmyHYhiwODS1mTAQiySVTMqk2xPY6ZikykRdHY4vw0AC4oIasPNuyQjbwUkjTXf4ZnIq3N7T3TT/OhQz2PmYr89t8pginocQcK7pMv930G+2kOitNoqlN0GfXiGe7oIhXpW8p2+igDbGimj6wWB2qqb4Vhu+4iQXnbQ7erW2a/K4w/plCZnzLpF1aP+b2fKvjEjPg5Ok2FJlDMk5Ltd3dIrZT51aWB5McROAKzRDfSdG+SCOzPNF3UlW/9tsTD7n3FSSOPJ4CU5CEN86i1a1ADaWSfvlUS4FDQgWDAz0DWrcUUw=","authorEmailMD5":"40659dd4ee1805890967e536271b28cd","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"This just save me hours of hair pulling with calling an async repo from a legacy app. Thanks, boss!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-06-16T22:45:01Z","timestamp":1434494701},{"_id":"9821635f-7c2e-3c93-ae65-13114fd7fbbd","authorName":"Veverke","authorEmailEncrypted":"vFHNSav4IVR72X3xRWqQB4UWFK2f2NCR2wcgd5TOttIeAThN897QNDJh93UleNNWeHUJgBVMUcMMqkrhA29WU9EGp74lTh0tZSBmFhPlQchkf/gPYSg9OIvCzoNUHtUHE1+vwTF1OXaJ0laqc1O/6drWpllFTYltFDnlx6ev8gnYfZA2ju1t7FknLoj8ZPvygprSCBXQg0hd1IqvHAQslhoewPqhnbwfdmyBz1XHzJu9CUaftQ0O38axWApxlgslvZYTP4HhDr0xhUVeY3gVMMAMSdnSfsg3kGYqWxMm3UOMNFyIa4Gg0vdZmtJa5mQrXn0ZnILu05iJuLNNb0gj5GLqMH/ISJT+zym4MinfulcYXQuRLDkX4N8LLF7sZRTXjocjkJdNO2tOEY6HqaVp2Uq1iaRbU1KPVRN15yu/FFbc49QUqfD/dTNrV1iOCb0WZYNIFiQkYaBehnNZKd8Y3v5PNpyCIvJGQ1ZE0ms0Z1bvGpuGpU8aK0iZXhigoBz7Hz6XctRyGlpIixWMKjGnZpoezRcNTd3L67tMkSiIzQmgg9GV6tz52F/JZhXo4D6zaAhASOsMImcchXLceqZQydBR7g5glr42CekHR8RKfIfzWB2HBJQVSLRDlFF9pS4ozkRCNsX8FDWa3slz9dvzI1j14yZALcv5A93YEhN0mRg=","authorEmailMD5":"fded734fdc8e94cb19a184c528a0d9ae","authorUri":"http://devrecipeshb.blogspot.com/","authorUserId":"disqus:veverke","authorFallbackAvatar":"https://disqus.com/api/users/avatars/veverke.jpg","message":"Great stuff indeed. Wherever I land upon seeing \"Stephen Cleary\" I now know it will very likely solve my problem.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-06-30T14:19:40Z","timestamp":1435673980},{"_id":"3702b3bc-a67a-3ecb-828f-3d3d0ac3062e","authorName":"yodaflame","authorEmailEncrypted":"Ma437ETxrJk2PMyqo4mTa0RDtx3jA0SQavzz38+WOuNDHgiegLv736tASMhYvoMWQzLrO8mvDT1L4HVp+5UQOzj54nYP9Kij0caWGV2JzBbhvxPePLIYjNaKJgRha6EqEvejUh7j63AVYgzfiJ8uDykD86IhcdNB0Fq+/W/+iGM9IZT7jv5quyjqG4Y3uM7HjRfX/JqCEZxrM5KCY0T1HeihM+FG5NL3EP5SQ15wDok/lGKAJ59f+qkv6QL1F7VUsOXyc7HG4OMPLeI4LwRa0lMAOYqfvAXyMQqOX4SpBaIFr/3AIxhQHhBihWnDPsNy8fOOx4wi4j9WUIrCFp7h61su8LIbAY8Gu5BLeIMfXrpAh6DT6zyCauaDMfeKbmTJHlNxROw4eXYKFYz0zANlZrwKP8aLdIXd4teYq+34DHrYiuP1LZgo0mIgpmVwbymdKYZoqe1WfHm+PDOJ+lMt16ugMm9pSO5vWr0g/W5eVaxmeMeXxNwrLtTEFJw0p0whG0YRm5uXV4sdzGdD76MiYdsrekgM8r/LF5EJHMnjOFXZPrnjJFeVwxIItMQKk/f6TIkwkr6R5nZ65MN7I9B8TdIhtfqnCDPdrNbOKNCnkEhaqJmxghLfWK36XHD6J0ZnJV0anyHDa+y7RzwN50jfRGKbhgel6kgJdSCzpSy+VlI=","authorEmailMD5":"9f04ecb40189a4e4543b6c44993166b9","authorUri":"","authorUserId":"disqus:yodaflame","authorFallbackAvatar":"","message":"Not sure this is a good idea. When I do this and an exception is thrown, it takes several seconds for response to come back. When I also use ConfigureAwait(false) on the top level request as well, the exception comes back immediately.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"61d229be-050a-3854-8739-74751916ba76","date":"2015-07-04T23:29:30Z","timestamp":1436052570},{"_id":"d2fcb531-0607-3f1b-9435-dad9b3faa4ea","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"@yodaflame:disqus: You must be seeing something else. ConfigureAwait(false) cannot have an effect like that on execution time.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"3702b3bc-a67a-3ecb-828f-3d3d0ac3062e","date":"2015-07-05T01:55:30Z","timestamp":1436061330},{"_id":"b770c62c-b45b-36b9-876e-3a3f2b1785f5","authorName":"yodaflame","authorEmailEncrypted":"eacdir75Hrlb72KmVl3VA05P0+OwOAspi4kUKHS9D3d0ShzCgou3SDfCHJDSB//lAJlkdO5fGiQcmP4j7Yp02D7FhbdQqVDoYwVHuM7bc276nFRzfbxUs7fARAy4YoFVZomjanTMGf6gix7Utlt1YmjIxBrtG2x5l39sqdOQUpMOWh5GRFnXmvXlc+0pbm5Zyz9zgM6IOKEKr2vcy5b7Q5eu6TjywTH34vbgGpCqFToiZSzyGo/1TWpfGIcDBNg8TK65Y8xKFkS18NzN6tQMOLiAnPRnU5OkzHz0ujLz7VrptNx1agSBji0YbzPSYM6MfLsO0wVoWw2kttuh4hBBcr6ygC9z6KGPwiGi0syMXyKgmRpoMHzAQprYbeyu1CuuR14lLwXJlQC9oxIEM/RDLPNegeoj99uDa1iKXOUzy/l/lBQzUb55C2n2lGGfVwi1fxyqOGNEvzlhhPmmAS42ofeNbRJb/O2LxYkMAwVego4832nY3wOfGu6wXQDBJlStiSnB2gImLoBNthUbycppYC7l2VSo60dU8MVeS5LMMCbq/E9pVrM9Z8h+bIc1UL96ugTBCwXwoL+X1pl7sYun7KCNz7ZtxXnfGC16yg1sbSKGPQ1HYmnhOLMpxQnu2U1Quf9x8X/zMppAdqwAGEvzGcSCUaf1NieufeifZOK5UCc=","authorEmailMD5":"9f04ecb40189a4e4543b6c44993166b9","authorUri":"","authorUserId":"disqus:yodaflame","authorFallbackAvatar":"","message":"yes you are correct... there was a configure await missing in my chain of calls. I noticed you also replied to my SO post. It would still be nice to understand why you don't recommend using ConfigureAwait(false) at the top level. Also what context is lost by doing this... just the httpcontext or the status of the current class... such as private variables and properties that were set?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"d2fcb531-0607-3f1b-9435-dad9b3faa4ea","date":"2015-07-06T21:31:29Z","timestamp":1436218289},{"_id":"25c9405e-c1e1-3695-905a-fcb0afcc366f","authorName":"Shlomi Sivia","authorEmailEncrypted":"wujMNGGUezt/oGjVR7aiR9yJ08I6QYTgyKNbWhiBxEh3svPQvsW8Hjx06xn4gicmEbirMJIox9PIkIPHd/6jIG2HqW8/njSKu1ph35TofFyGCd6WwDfUu2M7ya+4q3NEHfauv3h1A7TSZMV7wNuf0ApDV5UvZ8f7JaM1By0Vvkz6AtS7xPmBMvvUgRCWwIYEk94J09aw3nBexadpEug7vYKgRaojLMACujr4MK1e0tc/RXcv5l7g9F72Fzh8G5rGcRhwf9Ft1XR+jkf9y+G1SYXw0k/TwEllq7k/Q4u9hcWtfc0lXsIsnNQxVoFORv96S/lEaKjj60c0i9JwQdqeIKETbR7/4lTsRMBkuVksRu/QzJLyiCKlLhvViwdTq4XWUWzwMhG/Nk/6hlI36sgig/nPWvvX7ze5BRcEC9XfoKkVjzdG6pg/MENBOKNDLwkMpCC2lpH/tlKzYhlKuJ1BKUAjlnd+K/C5OZafmN9PNSWHs8I24rFZx20LNDW5ruWcvozDNtnAgjPXuuJVvOypoJUd3LPjTSiZIGBEuz7UqNlssubkdSdCYesFFBpqxlE2icH5XZOt35ozazRWkU3G4SnGak4PG1kSG0xHVKacEh0hJDbZRNRt9bQcJkXnO8E9x/1denYZMB3IMVHjm4h0MRwqH9iSoLkeHXFk+rCt4F0=","authorEmailMD5":"ecd06e4edcdc2c47e4aa237c141d48f6","authorUri":"","authorUserId":"disqus:shlomisivia","authorFallbackAvatar":"https://disqus.com/api/users/avatars/shlomisivia.jpg","message":"Hi,  \r\n The deadlock is solved when using the await but what if i have old code and i can't use async await but need to call async method.  \r\n when i do T.wait i get deadlock.   \r\nthere is away to call async method in sync way?\r\n\r\nthanks in advanced","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-07-16T17:13:12Z","timestamp":1437066792},{"_id":"a53d7f26-f127-3e0f-bd2c-2c568390b4d0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"There is no clean way to do this. There are a number of hacks, but each one has different pitfalls, and none work in every scenario.\r\n\r\nThe *proper* way to solve this is to update the old code. However, if you need a hack, I describe them here: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"25c9405e-c1e1-3695-905a-fcb0afcc366f","date":"2015-07-16T18:16:35Z","timestamp":1437070595},{"_id":"65004c6c-007c-39d2-8c12-65883d0f38f6","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That's the whole problem with the future monad: you can't just jump out of it; instead, you've got to wrap everything else inside it.\r\n\r\nAnother example is IDisposable. Having unmanaged resources is really just an implementation detail, and callers *shouldn't* have to care, or use special constructs like \"using\". But we got used to IDisposable/using, and we'll get used to async/await.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"acde32c3-9dd5-38dd-8695-36c7f60cc8c1","date":"2015-07-29T15:31:24Z","timestamp":1438183884},{"_id":"acde32c3-9dd5-38dd-8695-36c7f60cc8c1","authorName":"Anthony Plant","authorEmailEncrypted":"sMZrciANI9pjy4WW/AOdN8Gg9SIQBCfkEOLJ71CnItshxRxeZU4pS6MGlveQz5PDIvuigb0oD0JXcrisnuZNYSxMkVPgFWFpDknt+X3kH7T8jdQhU297YG4WE0dXASTdSmAVqNWzIhcrBd/m4fxoYFj5x9UYUJDRJE5vJfKUouefQ4qwUEHuKDbDy4UZ9DAE5qYJCxPiXd3FQivkR909qzOPCTzgOAaeWPsF06oHPsPhbxBBW5zzHkRZCBPeVmKMeuhEaId8g69NPaUkElnth9aZ3FqSvNqGW1Cw/uFCjBn5UD4/zoNyDvLNhrSexQL+SfYTZzxJ6IWGuLgrZktgDrXzQYQ/d+Rt69KAs0ceNeoG9vlKPy5iRhWBOhRnDIRVlbYFeXA5AEh0mHBjVnsZJQD9G60YcuwEXIUInB7VF1VLBtgkb6YwhUC8GB6KEDpXWGEAklcGfgXhYKyUpg/Y0Hb/hdnJJ9j8d3MfIrVSKkSfU2HMafwNdygXQbLbilB0G6GjPhFYGcRu8uioffwply8eLMLcIzHcsXq4FeHSPtE3DL95ZRb3R1y3Qe9RGPVQwezBXRw8qzj7of1OmNf6sJFRNLqBmEafhBEqC4Ej4nEchh7UHg/Me2nk1a8a6y6pVot+xIStaHXFBTyQU3ej4aBIw/H+hKoui+S1uXbdhZg=","authorEmailMD5":"bbc5ecbb4bdcaad916239ffd687d028b","authorUri":"http://www.ramblingincode.com","authorUserId":"disqus:anthony_plant","authorFallbackAvatar":"https://disqus.com/api/users/avatars/anthony_plant.jpg","message":"This is a great post and a really useful follow-up to your equally great introduction to async/await. This is a real bugbear of mine, though. I can happily block on a Task unless that Task happens to come from an async method, in which case I get deadlocks.\r\n\r\nFrom an interface/implementation point of view, it *should* be the case that - as far as the consumer is concerned (and given that it's all that's specified by the contract) - a Task is a Task is a Task.\r\n\r\nNot that I would encourage blocking on async code in *principle* either; however, it seems to me that something's not quite right (from an encapsulation perspective) when the caller needs to be aware of implementation details of the interface method it's calling in order to know what is/isn't a valid invocation pattern.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-07-29T15:22:19Z","timestamp":1438183339},{"_id":"b8bbda6f-f72d-3e84-a5b8-45c6c76fa255","authorName":"Anthony Plant","authorEmailEncrypted":"NbeKJ0+ldh9o19GfJxB+ZIh5OepoXORISu2+0M7e/wjItrXXg+lhtWajZF0c/V4TY3GqYkI0/cXvdqFgNIdQhnt4hQ8NOEpTVEMgkDVqq6IQOsd1rnAm2u6bvpOix+YOhWAQme4ouSEu+PaZUQ3J5QPvXnevXg0AbxQlk4hUBqerqEMCYgDSAYNf8ZvOuMlsyflOHCLDMoya/rbMpZ3F/g6/rqTfuHPyU8TZg9qWepwQJbiAVriK0LjIcoP65nlJstpyNSfdG/IN15+/sQKAAih2ybi3y4NKJRUetGJUZOId2Ge6ZfbfYMgMI1QJzm89Jptpqge6UwdUEu+x5lx0RVRLIfW7tD4MM3Z6GNMMtAb7vPxTtMfYwbkkHqg0BNBfEJpPQs9mVcbwJnbp3dQKE7ariQozH+fa7MUBtlS7syyTHiwI7YXthYo3Z6Imy1Z480xNX73oo1ixREq59A8OZ6Sn5ArGKdwjc4YeUh/PjEc3T5YDYhCAhakExkGk/cKOSrSD/wygAHeCdyT5H1yX4nuRcNGxF2IApRRugale6SFjfP5WqOgTuIe/xGGfkCSrzHsv8KT/IAbWy36cmaMkEgs64dtrI/ThxXnXOc7p9mRHGhPvR48pdCD6FjuCfk43dCgcJ76FXVQOV8A8Fk5e3+5cdCZijxLnmhUTK/OOQyc=","authorEmailMD5":"bbc5ecbb4bdcaad916239ffd687d028b","authorUri":"http://www.ramblingincode.com","authorUserId":"disqus:anthony_plant","authorFallbackAvatar":"https://disqus.com/api/users/avatars/anthony_plant.jpg","message":"That's true and in practice it's rarely a real problem. I just can't help but feel that it somewhat undermines the programmer's effort to implement good software engineering practices when a language effectively contradicts its own semantics.\r\n\r\nStill, I would much rather have it as it is than not have it at all!\r\n\r\nI suppose IDisposable is a good parallel given that, while it's at least specified in the contract in that case, it's not necessarily the contract that the consumer is interested in consuming...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"65004c6c-007c-39d2-8c12-65883d0f38f6","date":"2015-07-29T15:46:40Z","timestamp":1438184800},{"_id":"317e0731-4504-325c-b71e-f4650a74f0f5","authorName":"Merritt Melker","authorEmailEncrypted":"XU9w5a0dZDFfd6uHqI7fjKvEl4SwNRMODThXdztBy5pBew4E6R1q92WoF5YMU5ejIGQM3ndavlgI26FtzZ+QxZz0YHuYkPK6udCDdIKno0YnfmK/3QxZoWhCdO5HEurrLBiYnqXenV3MPFfppgB3vAXD8+vNteCrrxJQNYUg/Xpv139VAP6z/0OZN7KeO8MapDqEWRSJ7y6m1+pLGiQhosj4EvvrPDv22c99TulvmtlPimm5EmN+WXnGEMiRMzJ9Qao+bcE9ziv5AVJmKwy0Ur13F1r3EBOaNlXey/20XOaOu4uMXumFWMiG7XHWxM+ln61gli6Zm/hvj7SK+7YS5ge7nwWRic3subWJJiECYIK6oL4JDKLNqTbMBwPBhpZDSHVpcmTrcOoZgsyev0xzeJBMxKtp9dnRspMPF3L/UC3TL/vswaQwCLYpf3asGmkQAqAsIJ2fAcY0opIfucnTcUyhop6ZTfE7JerOj2TIctyhcGf1T3xyMAF7bZxfKM59BJdVZi2GiuZscCHLxuyJnFiQCd7EPrdiypgpAojY5UXyuvbDA03yHP3Fpyr8GOL5CgwmChVQklqL9B8YiukhyiyrtpCuvZJnJMZNykYwsATssDzeGGlKfX6ibclzvyEfMI2gKl7Uitw8jMQXx4MVTDWo2ZJvRH5VzoLNNdcGFj4=","authorEmailMD5":"105e238d0b3bf4406ddfe7a78e65c3c7","authorUri":"","authorUserId":"disqus:merrittmelker","authorFallbackAvatar":"https://disqus.com/api/users/avatars/merrittmelker.jpg","message":"Say for some reason you can't convert an MVC controller's action signature to async Task<actionresult> (my scenario involves mvc widgets in sitefinity; something about the ControllerActionInvoker is used rather than the AsyncControllerActionInvoker) and you are considering using some built-in async methods generated by a Service Reference.\r\n\r\nWould there be any benefit to this? Let's say the service reference method takes a really long time to complete; am I not still blocking the thread from being \"released\" while it awaits the result? Configuring the await to false prevents a deadlock, but I don't get what resources I would be saving or freeing up. In fact, it seems all I am doing is incurring cost by creating another thread:\r\n\r\nHere's 2 simplified examples of the sort of thing I am curious about:  \r\n\r\n``","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-08-02T02:05:44Z","timestamp":1438481144},{"_id":"7fff1e25-7d76-3a1d-bea9-5fc6ac70e338","authorName":"Merritt Melker","authorEmailEncrypted":"Ku1rvDFSAoBTlYzxmcMF+5TFcwQrgm99r9KbuQjXmhEFg33WSXas8X53QA8o1ZrRpzG4maVymMtMKsYjhl9T+URGufw982x/YeNSGRJDJd5ikOOdcuJ68k/a0mq+PRi2tjHt9zh56UZW8nVIzNkLCPnqdY94FPrv7qkCmqHggT33NdNmvmuuPqYOokfKjEPtlNY/HVB/RXU5km8SrsGXuZHvmndo+0zJDexlIgv3oKvo8M6Eo2Hx6v7hFt/HF4BZpPth9VcxeRJsWldQO86PzTNzXHq+tWC4xaH/9dKxH20SPnyPwwqQfYb63kv5V8z6x7xbszRsXhejxoP5cjeSB6N/E9CIWv0mmbqxEVBynnb5WA+fs4Q4y/kn5a1ldIQFZdrQJsxtDB5MucT2FCAOYNv6PT+3ZCbIX2wwsGqM/rR7zePZO7EAVYJ4ZxL2K5G77phYY1aHJaQ6wR/4wcc9u/JImlr/CEs35fi2SV0LO0S2gKHR2qoeOhKMxLPOolYtwammVpY2Bep/9OKaue4Plm+4tsKTniEM3kMF2vkRtwUrYdDFMci0DFbUDgnrlRCqmrlw4lIZz3hSzxeG8zq1h4NWADrz4iMtlzT3FPk7HfzWjcG9rmU8XguoiSasVQyCH/jiAXH9WQLgA5YLYOhwvCDqGYggseaEOwVzKPnGz0A=","authorEmailMD5":"105e238d0b3bf4406ddfe7a78e65c3c7","authorUri":"","authorUserId":"disqus:merrittmelker","authorFallbackAvatar":"https://disqus.com/api/users/avatars/merrittmelker.jpg","message":"Say for some reason you can't convert an MVC controller's action signature to async Task<actionresult> (my scenario involves mvc widgets in sitefinity; something about the ControllerActionInvoker is used rather than the AsyncControllerActionInvoker) and you are considering using some built-in async methods generated by a Service Reference.\r\n\r\nWould there be any benefit to this? Let's say the service reference method takes a really long time to complete; am I not still blocking the thread from being \"released\" while it awaits the result? Configuring the await to false prevents a deadlock, but I don't get what resources I would be saving or freeing up. In fact, it seems all I am doing is incurring cost by creating another thread:\r\n\r\nHere's 2 simplified examples of the sort of thing I am curious about:\r\n\r\n[https://gist.github.com/MerrittMelker/84d824a33d60288bcc07](https://gist.github.com/MerrittMelker/84d824a33d60288bcc07)\r\n\r\nMy last post got marked as spam because I kept playing with pre and code tags :(","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-08-02T02:25:27Z","timestamp":1438482327},{"_id":"be8e5238-5fa4-3f30-8169-ee4d93481ef3","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No, there's no benefit to doing this. Since you're blocking the thread anyway, blocking on asynchronous code would just add overhead. (It wouldn't add a thread, since asynchronous service calls don't use a thread, but it would add other overhead). It would make more sense to just call the service synchronously. Or lean on sitefinity to support asynchronous actions. :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7fff1e25-7d76-3a1d-bea9-5fc6ac70e338","date":"2015-08-03T14:08:01Z","timestamp":1438610881},{"_id":"7010add2-83b4-39b3-a48a-142098fdfd6f","authorName":"Travis Miller","authorEmailEncrypted":"pLJkYDi93oH6YKZJfZV3ZPKTsmppNSzkAaEnJEajsKF+HDIQP3bZNHR2umpSS1zT8P+ecbO9eksQJnaMDPcMN/qduiGiAcFypWinPfPFZ5bn3jwCARW70/FQwJs8+fVD+eRmrUhrr1hwrbbfRcHpftMACBBGKOhdQRyRm3o+exFgXuQRRiWQHhmAsUoYMQt1jIaAUzHQ0OK+dOdGu2Fwx65w/idb1asqupr/27aJbb+LCsaDq3NtCJO7E14itlFRp+aPcf5udaqI+/CXcvPIiPoggAfNbTKZn9O3zrmIZeOz8IGVKqYmqxhVOX+3UY5k9+8SjVfDsXIgbTXNuxStJ3atxhYG47PGWt897Ou86VM08wOozA3BKWMn7OXQxHtIjpkUnqq6G2muSQqDrNDNwe35vmvXQtmDJ6ucFPjHgHFyab9BqJGqqYbUwsII6dGhwtL3JQ0p1U+B/4u2xtqWSF//9559ZMuaD588J8+bYWL9ScN/TKzwrRDRrcRPHvNSZZoXzlUUmNnWO/QjDdcuL9ReR7Y1p/iFqoyWQDhhybQoWnn3ElhIuuEuPI9Xkw/tnBtIVUm5c91I0jTK7ObM8d9kt1gckc/5K07x9yDt6K2lVlcET+4insfHGGOSBOXwk5vES242s7X+yYJTbPXa5DuLdCPcwIWFQNbhJwE7Rl0=","authorEmailMD5":"5ff8450847affd497243329156fbdfe0","authorUri":"","authorUserId":"disqus:disqus_K3GdVi5TJo","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_K3GdVi5TJo.jpg","message":"Thanks so much!! This prevented me pulling out what little hair I had left.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-08-20T14:51:05Z","timestamp":1440082265},{"_id":"b8b80388-cfbb-3b50-a6c4-cabc282ebc96","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No, it won't always cause a deadlock. It only deadlocks if the calling code is in a context, the task needs to sync to that context to complete, and that context only allows one thread at a time.\r\n\r\nIf the calling code isn't in a context (i.e., it's in a Console app or a contextless thread pool thread), then it won't block that context.\r\n\r\nIf the task doesn't need to sync to that context (i.e., it uses ConfigureAwait(false) all the way through), then it won't need to enter that context to complete.\r\n\r\nIf the context allows multiple threads (i.e., a custom context, or a limited concurrency context that permits multiple threads), then the calling code blocking in the context won't prevent the task from entering the context. This is extremely uncommon, especially for asynchronous code.\r\n\r\nHowever, I do strongly recommend against using the Result property for asynchronous code, because both of the common conditions can easily change.\r\n\r\nAsynchronous code running on a Console app is usually proof-of-concept code that is later put into a UI or ASP.NET application, where it suddenly *is* called from a context. Asynchronous code running in a contextless thread pool thread is usually in the middle of being refactored from threaded to asynchronous, to run on the UI or ASP.NET request thread.\r\n\r\nDepending on all the asynchronous code using ConfigureAwait(false) is dangerous. If one of them is missed, then it's possible to have a race condition where sometimes the context is avoided and sometimes it's not. This is easy to miss even for experienced developers. It also assumes that all your libraries fully use ConfigureAwait(false) properly, which, again, is easy to miss. Note that even the common and excellent HttpClient library has some platforms where they missed this.\r\n\r\nSo, I always recommend against Result in asynchronous code, unless it absolutely cannot be avoided (e.g., the Main method of Console apps). Even if Result doesn't deadlock, it will wrap exceptions in AggregateException, so even in the rare cases where it's needed, I'd say to use GetAwaiter().GetResult() instead.\r\n\r\nI've written more about Result and other ways to retrieve results here: [http://blog.stephencleary.com/2014/12/a-tour-of-task-part-6-results.html](http://blog.stephencleary.com/2014/12/a-tour-of-task-part-6-results.html)\r\n\r\n-\r\n\r\n***If*** you're writing Dynamic Task-Based Parallel code ([https://msdn.microsoft.com/en-us/library/Ff963551.aspx](https://msdn.microsoft.com/en-us/library/Ff963551.aspx)) (which is very advanced), then using Result is appropriate.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c49570dd-ae97-3846-aff1-423b4651f05c","date":"2015-09-08T12:56:48Z","timestamp":1441717008},{"_id":"c49570dd-ae97-3846-aff1-423b4651f05c","authorName":"Bilal Fazlani","authorEmailEncrypted":"cEWL8LH87sXkUjmm09cSobyHulrni/+oahdhnqNJ+0h5Mpo8xIFpNqFRpf3NC598m1olTg6K1S+dZI4n7q3ckVpjhwblOyWecta582okTYdbNERybAaslSn/ekQrQd92Bva6tqa9M7lgc/fwqccLvnahsh/YZI45z7nOaB2hz+3Jow9BpMOj3C0S842cuWu8QCQx8NQeJe3wo02P5X/ffGIQJ3lbIAhpqTXU/TIl+XDrY6xQKZE9HTKrL0IVrM4YtEoqgorLphiBj7OzE9V/Pzca7yrJFPkR6q39l8tFwDkxQC0yxdHkMnTtYq9oFHZ5AzThszh6fsBI25yOcLW9VKvw2N7oMVZXvBRAqps1xAIJJoSa4TZoGHAmsySxpwkcY7VdA2k4VxSo3ji4hoHnzczb+xn91v2mx8AMOYwckiUR7xir+SxIPwaR4TErmOqZUd3aTbivYunQreekqSDv6Hf4EQPCUxRUhSdMeq0FTNT3aT/WtM1Eu5aVfat6+wKJ9GIrc2YV6ousowt4JLp1iLlvEtrQZ5zNdTM94h1cqCFqNYnlREe4r69VzygjJMUi1GdNILRALwZPUYYkdG60c5RAR6OztWRFysP7lm6RxtMc39IJ3D8yy7D7PNofrHFW4lyWfvp4hZI7NOhRL/67YlW8SHYTvyrpA46mMFmmny4=","authorEmailMD5":"329381200b3974c701e3a84cdbf3a440","authorUri":"http://bilal.tech","authorUserId":"disqus:bilalfazlani","authorFallbackAvatar":"https://disqus.com/api/users/avatars/bilalfazlani.jpg","message":"So according to this article, we can never use Task.Result property ?, if we use, it will always end up in deadlock ?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-09-08T10:58:59Z","timestamp":1441709939},{"_id":"e59b81ae-8886-31d0-941d-c85c6f819a4a","authorName":"Thomas Eyde","authorEmailEncrypted":"dNF1EoJdgDOudh4fcv1v4Q064gkXKM29u7lignPppQ/qx7VZ6iwEy+XrefmhWLBcmKm0oHkrWMhnpzCRjlF6IL4oUmhJyIOBPe11FN1TWl9TeuUYcOCEPf0te+A81e3LQiLFT9IObFp+Duz0i+mQaFdE8WlWWYH6jRn0D4/fvi6sS4YcO8E/jRmdluwTxuptvUT048SSN1GWsCiyYQT1Eo4r1Cnir6qdZHKb28nANs58X6YzQIoHcQw6SZiZKWcfCTVZfGSIbgWo5pvYGCniNm9y4XCTppjGlYVswaQ6KQQSBaqJT0TaiXouJQsvzbXncbgCRrkDz2slrLDHdsMRLl2CJUOmSML0wqvDEpRyrMk12qBIRe4VN8jJWNmzEYAbx3IM7UqitqbnnPh8o07xWbWFZ0Bs9EBAcDpD5QRrJ3Np64+QRGc5XmFef/rambV75rH5C6VaNNT7zoYydKxGjL9kf331lh3fiUYUQHRCUxCsoTGCsmaFUbeFTg8n816lDnWG8MXNIMhkc8PRErR/ZT8XPmthsUBI6AZBn0HbmGFH4Wi2M4Spzkqa8eckJN2H6MFhDK3tAcRtznnEldMpCBGd2ffkfTLDL6/dnxuy8P/stPLUACVV8St2PjlGYPTh72WqlEEbrFC9Yjd5dQL5MD7uQfZBECG8gkwqS6xp88U=","authorEmailMD5":"459097b9ced4413093907cbbcbcab2e8","authorUri":"","authorUserId":"disqus:thomaseyde","authorFallbackAvatar":"https://disqus.com/api/users/avatars/thomaseyde.jpg","message":"I have an issue with ConfigureAwait(). It may help technically, but it's not very userfriendly. If I have to call ConfigureAwait() almost everywhere, then the defaults are clearly wrong. At some point we're bound to forget that call, and if that's what causes the deadlock, it would be really hard to find. Not to mention that all those calls pollute the code base.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-09-16T14:58:13Z","timestamp":1442415493},{"_id":"44e38063-900c-34eb-b8c3-4865de7b26ce","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I would say that deadlocks are more caused by sync-over-async behavior. That pattern is unnatural and should be avoided whenever possible. If your code isn't blocking to begin with, then ConfigureAwait just becomes an optimization hint, as it should be.\r\n\r\nIf you think about it from a higher-level (architectural) perspective, blocking on async code just doesn't make any sense - the blocking is actually preventing the async code from being asynchronous.\r\n\r\nThere is almost always a way to avoid sync-over-async - the only non-preventable scenarios AFAIK are ASP.NET MVC filters and ASP.NET MVC child actions, both of which have already been addressed in ASP.NET vNext.\r\n\r\nThat said, I do agree that I wish the default was ConfigureAwiat(false).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"e59b81ae-8886-31d0-941d-c85c6f819a4a","date":"2015-09-17T12:17:30Z","timestamp":1442492250},{"_id":"6065c7ad-a888-3901-8f15-f1d75b106821","authorName":"Thomas Eyde","authorEmailEncrypted":"f996YtptA4Lw36LCacn0O+Ok9U2VjyFSo1D8xuEJYDqpLpaRzGLDEkeMrsnF4xrPPZ2VHYHNu8tIJNfCEmXw8gcU0vyZid91X2OiS/x1Okg5ntMazQVbLAWwk5AtbGWCBiRssYYrbckwj/yeOlF39PUBFJiNIHJDDxPZ9b9wKR9pTqika6GLTK60xI+6teaf0E29LejP2+Beg0OHvi32hFFoUSGq9Vl699NaRnNMU5Xgr6XpJnq8LbItP6+DRyDdcmSn08K+LvAw5RPxOBdX3ZV+SZWwcSEyOEiJP5Jd2bICZ1IKlJLL4ZQB8NJLZIKZ8tvrujjg++ySAz++z+zYzZlm30AWNtNCCODKsXgI5WUC+ojIMfkvDGY53F3eqyWhquPYGHwiskRP+caG79hVJ7nFxK5qSxKNIxrG78kZYTXhR+lOGQMbxD9XR+aTpZZaa37jNVd+XS+MiQq4XPZ/Z+tqFBzhPEkpollyRwR2ZgQSFhxBAx0o8o3w7e0oqh9Vi7ISrxsXhznc/SrhlY8eprpBKYRYe7nRV0wQ7BmakAewMIy62ZWSU10M59Q4kZFk0Su8cSziZnLrMFsYbcdCWwpMfawmvyDIdHQI3gzEPPsBjBrxK+FkQD4q9eE++uH2wyVMoQI/triRAhNMxwYxk+IYD0Mx8/WjK0681sCtmyE=","authorEmailMD5":"459097b9ced4413093907cbbcbcab2e8","authorUri":"","authorUserId":"disqus:thomaseyde","authorFallbackAvatar":"https://disqus.com/api/users/avatars/thomaseyde.jpg","message":"I need more time to wrap my head around this, but my initial reaction is to disagree: It's easier to write and reason about synchronous code. And from a client's perspective, I couldn't care less how a component is implemented, all I care of is when the result is available.\r\n\r\nIf all my code is synchronous so far, no component should force that to change. I am in charge of my architecture, not a component from [nuget.org](http://nuget.org).\r\n\r\nIt's a shame there is no safety by design here. Calling Wait() or Result on the same thread should throw an exception. No async code should run on the main thread. I know thread management brings overhead, but we can afford one extra. Anything else is an optimization and should be controlled explicitly.\r\n\r\nI've wasted hours to pinpoint that call to Result. It would have been so much better if I got an exception telling me to run that async call on a different thread, or if the runtime just did it.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"44e38063-900c-34eb-b8c3-4865de7b26ce","date":"2015-09-17T12:47:55Z","timestamp":1442494075},{"_id":"e452b4ee-6fde-3a12-abe9-23c532f75500","authorName":"Bilal Fazlani","authorEmailEncrypted":"A8oWO8OONHu/sJvVkONaVAJa9zFz8cXWRm21deR9O0KWRv4ezQm3PLZIB86p5oxxeG31mWCQGo13aUdt5Z3TCY9r0ZsD8S/M7Jag6t3sk2MflI8t6VQpEspFhc39dox10BqvRqAgOqpuw993lAv070iZtciFuJzzTOVKKISm922sJhkYVUaIKGYwlY7KbHpFFG+TW4Pf1VvGXcd2caOyxVbpD0HEbMydKuPrR1gMNjkfZw0D+hVNTR7YnBQkdEQC7mvdQc9jJ66k4FTOJHu0cWHTFHLqeRsmu7Uk18Bg0xWjokCmkkHE08kU6eTf5xe7oB5v92sTQsxeVYtbFhPv8U3SpaZXk1s/ZsvpJ8KomYFm4KCmO3yYJk2J4VUjNHuyEKDaF4MozKP8s+2h9R3eiCJ5qWNI9aHDPShL8ivSMmEGG3lI1UHhentU6MM0Orj+RjUWa/0Tzekyytj/BDqpxKfsUwGLYHPg9P3ogJ1lMKOWTGgHnQDL0uK+ytT5PfTkpK93Mio2ldo6dplQbHxaqCQGl/tOGb9IkqThOFoCBdrtXnc6zaMUHrfsuXYvZJQNqQs1JRHixS47jBbbZVxSsaSe8jS8nPcpXr0UDwsyMGBr0ZqRBKtHm78HjgRv7DCmt7i4wPvCUGDz2YJJJ0DjBNMjBB11ytZTzKmZgj/wcio=","authorEmailMD5":"329381200b3974c701e3a84cdbf3a440","authorUri":"http://bilal.tech","authorUserId":"disqus:bilalfazlani","authorFallbackAvatar":"https://disqus.com/api/users/avatars/bilalfazlani.jpg","message":"Thanks Stephen. that was a very detailed response i must say. :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b8b80388-cfbb-3b50-a6c4-cabc282ebc96","date":"2015-09-24T12:52:46Z","timestamp":1443099166},{"_id":"6811cb55-f3cd-37a9-80fd-bc08f4731bef","authorName":"Greg Benedict","authorEmailEncrypted":"eGS7tdsLyoX2WDVd2g94eDHD/CpYsTNnrZ0A0sB8/Xroe8kvkJ/or/McjYFVb5qxZ0b4mhLQiF4gpINuEsqCx6XQGGtMAaGz8+9BlFdtaCD5toYC0VjfzAXRZJzTwsOakmg2lWzJJRST1s8TRVUS5KbdhNenSgvb+MG0c3KIJLYbgr490TzaA0nIuNmDpDLlJg6YGdeXaeyZyIrD2vJpN5CR6UPSpTQ39DWLaIccGebqD1rV4i5uLAXmuvhsR/0qhJ/eh0cP8FFE4OZikCkNM+WSF61Jao8gBLe31H24kSRgEoGM+9/Jbu22aES4YJ9BvlwS4TeyHfSArUuuSM+VhgW3SDg6laR9YeFS8JpHfQOBqjJambl2PryAZYW0DU7Y+BEUGf3zjR6d672sTXoELgSco1wFLDrq93KDfiRqzJxEQXmnH1RR6gSh1rpkjXpXHOMvnEFyfCAfhEWKpfp94BVW6AbppOwnkeg/woTxQVNew1Jv8gFwuBDLKgCejbhBseqU8U0ZPvrFEsFKSNY7HsWdA4zJCRHpHv5Cm3Pm62jfgSPp4Bdwzr4u4PePH9bkkjGFoEqeYNBHfypDsypjwMYVpxNutLGdV33h0kifD79XAoRcd1Do87tuLfIic3UOJ2a/rA+whJrF6jDYwMxGGvdYisyuAErPEvMfsnqpL6w=","authorEmailMD5":"20f5a99e420216df3537f059481fb1a3","authorUri":"","authorUserId":"disqus:greg_benedict","authorFallbackAvatar":"","message":"Great post.\r\n\r\nIt always frustrates me that all the simple function example usages out there miss out things like this; I found, and tried 3 different exampels of HttpClient GET functions, all of which displayed this issue, not that I knew it until I found this post.\r\n\r\nThanks","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-10-05T13:31:04Z","timestamp":1444051864},{"_id":"1fd877bd-6ec9-32d4-8c11-e21f10018d21","authorName":"jeremiah johnson","authorEmailEncrypted":"OchwNYpj5Qj8KpqYecgMxn+6u6G0U+W0FvWz9uMIA2z1ppqLYu1t4//YI1n1Z+na4V6uB7ACc/uiBILf/26Ahmm6GpaW47FJTR+TltFfCTSuZ2kagC/7M+n509HajreBk3uDIZjiUw2VW5whGepZqS3WaSMPJyRpYB9HCkx4LIjHuj5WoJ9obZY2L/WAP8j78xAUwBAWRUgcWQCbcPGPHuzjsOE1q5e/s74S23tccNqidK0EUk2JXCSRbTR7bDUT5tee5tulq2H9UTCYSnPnkEGd2WaXu9cSk5qddT0/3AbyJRk3Acl7GnhqRNhWTfuMGod6EY4gO84a/MHKdu3yZOA9P0sbmiHqyNZGMQxtS8NYbzFIjrM1Yv/EsGmFAXbKCKVg3bocuB7OrSlfqhgdhLN8tAosnAOkDhJFJfJOIWH0HF5i8xyRZSNtBqgJq7sXoF0i68KEahpWM/hF5CUFv7/IkvWQ9hLmHnBrXKkCUfEgmghh7WHKEsVfzlCOEnESjrv1NOge1tkcvx/wXQZeIUxqk9a/e3n7PD9I5iJ//uoaErYECh4AQpcsqLDBR62ONk1LqMByVDx8NijXuSy0DuNrzxwDzSxDHGgXJ28fu4AoJ1fa4jt/rA5isxetSUKC3hDQMt9dmYIqodfQjTN/vXXoc8QHrIXQLDRmyZKqZvQ=","authorEmailMD5":"54c3a69343a951a798a6c436ac66bc7f","authorUri":"","authorUserId":"disqus:naikrovek","authorFallbackAvatar":"https://disqus.com/api/users/avatars/naikrovek.jpg","message":"Why is teaching this so hard? Couldn't you show what changed between the methods before and after? I'm so run down from trying to chase this stupid problem that I had to copy/paste the before & after into a text file to see the difference. Why is teaching this topic so hard for people? NO ONE can do it effectively. Microsoft's own example on this ridiculous crap blocks when run from a UI! [https://msdn.microsoft.com/en-us/library/hh191443.aspx#Anchor_1](https://msdn.microsoft.com/en-us/library/hh191443.aspx#Anchor_1) That is some absolutely stupid API design. To avoid this in the future I have written an HttpClient library of my own, with with raw sockets, because that was an easier problem to solve than this stupid deadlock-by-design API, and no, I'm not joking.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-10-27T19:26:08Z","timestamp":1445973968},{"_id":"11a5ad5a-a039-373a-95ea-9cb7d8cb8d08","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Sorry I was a bit defensive last night. I haven't been getting a lot of sleep due to a newborn in the house...\r\n\r\nThat said, I do disagree. Well, I mean that I agree that async/await is definitely hard to get your mind around at first. But if you follow some basic rules (like not blocking on async code), you avoid most of the pitfalls. If you start with my async intro ( [http://blog.stephencleary.com/2012/02/async-and-await.html](http://blog.stephencleary.com/2012/02/async-and-await.html) ) and followup with my async best practices ( [https://msdn.microsoft.com/en-us/magazine/jj991977.aspx](https://msdn.microsoft.com/en-us/magazine/jj991977.aspx) ), that should give you a pretty good grounding.\r\n\r\nWhether threads are easier or not is up for a bit of debate. I think it's actually a lot easier to shoot yourself in the foot with plain threads. I suspect that you've learned all the problems with threads already (like figuring out when you need locks, when not to set thread priorities, how threads affect shutdown, and establishing lock hierarchies), so threads seem easier to you. And there's definitely a *lot* more information about threads available than async, and (at this point in time) most of it is good info.\r\n\r\nBut I think once you get a good handle on async/await, you'll find it easier than threads. (Technically, async/await doesn't solve problems in the same way as threads at all; especially on server-side code, async is actually the *opposite* of multithreading). At this point in .NET development, threads are practically obsolete. This is why in my book on concurrency I chose not to cover threads *at all*; the concept of threads is described as necessary in the sections on parallelism (which uses TPL / Parallel LINQ instead of plain threads).\r\n\r\nAlso, async/await is in the process of taking over the world. I'm actually writing a talk to be presented at CodeMash on this exact topic. Python, Dart, TypeScript, and even PHP (Hack) already have it. Scala, JavaScript, and C++ are planning to add it (or at least considering it - not sure about the C++ proposal). I'm afraid there is no escape, even if you switch languages (cue evil laugh).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"146625ec-e9c1-392e-b5d0-5c2c0b5c2414","date":"2015-10-28T12:47:34Z","timestamp":1446036454},{"_id":"146625ec-e9c1-392e-b5d0-5c2c0b5c2414","authorName":"jeremiah johnson","authorEmailEncrypted":"dNi6yWPpL34IzfnLPWrE98AHVOrWG1jLD6sI5GMLCsgVYXAJ2w53NoCiXxkOmhR3dOzS497Vn6j/EydNKiFDlvuf1PkjvUkbFSM4rNVCsd9c8c0a+I8jCZPrbYxlaxqrjDHsJjnB9FZ+JcM3FOlFB5K9omEdxsIYNe/wq4UQJDCeFPOV+pmouRHSh646yuHYXFOUhXJbVm95YBm4TuaDBjuEUcde6lVPnSZdMq3BCxPbnhozl0cwRGWq2xnN48cQ2AohvaXCXI2P+2hqNp39so3So1seFUlzYaF9RZSTHyoy7qEcFIRnDrrnOhZrdLknrhcrX9E53H7YWjgN7yaW6glT7PnQ2LgfsjLsauxhTzLxoeolrvI7r30bGnFr0hVrrb1q6ZYpbD59Q2wu8Hz3kf6hbyiHIqEzYTaK57RCOivEteLU2jhSpdA3SJPYP4nJztEwOsk8dZH7IozeL81rUdAArb2uYsV5+b3Nk7c3/oDYmQlb4h/9A6i9KRBX8gr9BX/NyUXWx0pZWib2R2mguD461IYTE1YOWa1RiKz5hn/3Vffk2NX18tlAATCpgM4bvqPtst7WhifMhY6IkkdyXPdnZ6svconeeEEY5EX6WMfwNOySdNRYLCV1g4QnPEDsvwasvxiIOsK28pYimMWxeDoiN9Y355VDQxq3YX4GE6k=","authorEmailMD5":"54c3a69343a951a798a6c436ac66bc7f","authorUri":"","authorUserId":"disqus:naikrovek","authorFallbackAvatar":"https://disqus.com/api/users/avatars/naikrovek.jpg","message":"Well, clearly this is all very easy for you, and that's awesome. It wasn't easy for me to figure out. Using await instead of .Result didn't stop the deadlock, for me.\r\n\r\nIt was FAR easier for me to learn how to create a thread and start it years ago when I was just starting as a developer than it was today to attempt to learn this daft deadlock-by-design approach MS used.\r\n\r\nHonestly, async and await, to me, at this moment, look like nothing less than the stretch marks of a language that is trying to do too much at once. Bloat.\r\n\r\nIf I need something to work asynchronously, I'll create a thread that does what I want and call a method from it when it is done. That is SO MUCH EASIER than debugging a freaking deadlock that is designed in to await and async.\r\n\r\nPlease understand that I am not criticising you. Your blog post is the only one that pointed me in the right direction. For that, I thank you.\r\n\r\nI am just kind of done with C# now. I loved C# yesterday. I loved C# 5 years ago. Even 15 years ago when it was a virtual clone of Java.\r\n\r\nYour post got me through today. It won't get me through tomorrow. Time to find a healthier language. For SharePoint work, it will be hard. I'll miss linq dearly. But I am not futzing around with async and await ever again.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c1fae95f-05d9-300d-944d-240b3cbd22c9","date":"2015-10-28T03:03:39Z","timestamp":1446001419},{"_id":"c1fae95f-05d9-300d-944d-240b3cbd22c9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Um, you just use await instead of Result. It's not that hard.\r\n\r\nAnd writing your own HTTP library isn't going to avoid the reality that asynchronous code must be called asynchronously.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"1fd877bd-6ec9-32d4-8c11-e21f10018d21","date":"2015-10-28T01:59:20Z","timestamp":1445997560},{"_id":"2264f711-4d92-31f7-8d59-9134bd4e9e43","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The deadlock you're seeing is precisely because it is in a *single*-threaded context.\r\n\r\nThe thread is blocked on the Task, waiting for it to complete. Meanwhile, the async method is ready to continue, but it's blocked waiting for the thread/context to be free so it can finish executing.\r\n\r\nAsync code enables single-threaded concurrency, and so permits single-threaded deadlocks.\r\n\r\nWhile I agree that it would be nice to avoid the \"async all the way\" rule, there is simply no way to do that. No language is going to avoid this. In functional language terms, async is a \"future monad\". And in functional languages, all monads spread through your code \"all the way\" just like async does in C#.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"313ed9bf-9461-3363-9941-37c40e29a3e6","date":"2015-10-29T18:29:35Z","timestamp":1446143375},{"_id":"313ed9bf-9461-3363-9941-37c40e29a3e6","authorName":"jeremiah johnson","authorEmailEncrypted":"D5z/cvn881XEs6oTYuE/dLkFO6xxBjPhjjqTXczpdShA+nkz4DdraYdM9rP/5hbju89YZqOc8egK9JvxPkemKny4WWgzuZnBdiuvUV/8lL7qdgCEoxGyqgOO186usUTXPUD/rnDctD+rN+mDrlGgtJw6yDbn8MwH6bJnwLdfuIefpTw5+Q8MyTFcZIqCR78Tp2KUvdFhtqUd15Mcz2+3CQqOX9scsL+vRRhc/sgZmfBNJiRas2k2XUBH1KTCL5QvamZT02bDRySGCEzA3BXS2Nym6QnsIDgGyVDh/iwiGq5GcV6VVg1vb/nt9vMK1OiaF7pws4nbSx0ilIPJKanbM4brD5VeA11NjhVXXudDki0EqTgllJkiydins93eSlb1QmBFrUL6SvCn4IcjMkH+Uu2Z0sM847Bk7YxGUO5lVamKJsJ2lG3YazDQMke7f/U4+zgD2vUgGyzQgQyWae9EJEbSt0Xw7PQm1Y96pC2afRQV/DtqBVCT3xJFCnobv/Yt4kZ3emVl8JNP8pYt3GbJqWpoHkxfAJT+gmeQBIafNfd6lvXw6uCfhwN8bPrcJCCeLVBsTDe2hZ2FU42gEhmI68ZJHbbbpkWygHKEdsGlQnmoxlfPsJpRRXD3DwkoLrDgfNeSDxZYB7vk+c6/YNF93WZLqdnsc77fwAHUwLSpQ7A=","authorEmailMD5":"54c3a69343a951a798a6c436ac66bc7f","authorUri":"","authorUserId":"disqus:naikrovek","authorFallbackAvatar":"https://disqus.com/api/users/avatars/naikrovek.jpg","message":"Well, to me, async and await have everything to do with threads, because if you use them incorrectly, you deadlock. Deadlocks do not happen in single threaded applications.\r\n\r\nYou and I will have to politely disagree on this, I guess. I shouldn't have to modify calling or called methods in order to prevent a deadlock. It is completely unreasonable.\r\n\r\nThe requirement that I use the async keyword all the way up and down falls well short of the encapsulation that an OO language like C# is supposed to provide.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"5b7a240a-5388-315e-a1c1-6fe767cf531d","date":"2015-10-29T16:24:31Z","timestamp":1446135871},{"_id":"5b7a240a-5388-315e-a1c1-6fe767cf531d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I agree that languages get bloated and end up with bad design that is then kept for backwards-compatibility reasons. C# has a fair amount of this. But I disagree that async/await is an example of this. :)\r\n\r\nI think the primary difference in reasoning is that async/await has nothing to do with threads. Using async/await to, e.g., download a file, is *completely different* than spinning up a thread to download the file. It's because of this fundamental difference that you have to use async/await all the way. (The MSDN example doesn't deadlock if you call it with `await`).\r\n\r\nOn a side note, the new async/await can work fine alongside threading. If you want to download a file with a thread, you can just do `Task.Run(() => DownloadFile());` - and then you can block on it if you really want to (I can't say I recommend that, though).\r\n\r\nAlso, it is possible to use callbacks with tasks (Continuation Passing Style). You can attach callbacks to the Task object by using ContinueWith. This is essentially what await is doing under the covers (wiring up the \"remainder\" of the method as a continuation of the task). After writing much asynchronous code, I can say with confidence that the async/await approach results in cleaner code than callbacks. This is why languages currently using CPS are moving to async/await (including JavaScript and TypeScript).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"80339fa2-ba0f-3128-bee5-6225eb28cf31","date":"2015-10-29T13:57:18Z","timestamp":1446127038},{"_id":"80339fa2-ba0f-3128-bee5-6225eb28cf31","authorName":"jeremiah johnson","authorEmailEncrypted":"fGZ6awrroNqHbXwm+kyu12I+SoeGI30S+CxSvHqnhIuPhXEH9I6c8X4eVqIz7cp+6S6Btmu8K1KpapB8x7+vVi9aI+LUBeqzQRE7E0rIREgqXZjp3CpCVlJLMl6Hy5ougCjxj0GAL7kQhTSph7DCZVF11YlxAYZpD6nP1v+o3i3Oy3f70gVqOCHhJzDF1V8p3kKP/rn3O1qAa0gZIEkuC3L39+rj6E1WT//w4Devjbx0jv/eMtvyFDu6fQ5PNHKYTjiqEWG0C4xoPLccYg9H0uNUnpPkDgROzJlzef+EAQVsooC+B1n//A1XuR3UuWDeawb4lQ0mmKAseqwpMPTNq/jJBjJS4kSCcow+2iltCx83HtPJt2KIT5BMKB+c7DmlRpYtPv01ZAGdooVuN3ppjL2LBX2gFkwVBmParFMznT9uOupDv4p9ChHy16mE0s4+rbjQ9bKZbF+vTTj/W6RW3pNMXallpJ1nAnR2nWAexJyPbPEW5EhTZ2whgI1YPea/96NRBnTK6ECdlpBSsQ8BB0yolqBQFhRbs3aRUgDcnSni45HbFI8foh39ou2nfqI52mgvDLUxgEPnW4YGQp6Ztoa9/M7MiViGXYBsdMcB5Xrykk42pWbjcXriFlBkpC7NyljA6IzcNPohCyzfrw2tScguG3uLX0pUX49/OWxXStE=","authorEmailMD5":"54c3a69343a951a798a6c436ac66bc7f","authorUri":"","authorUserId":"disqus:naikrovek","authorFallbackAvatar":"https://disqus.com/api/users/avatars/naikrovek.jpg","message":"And I apologize that I was a bit offensive (in that I was on the offensive when I posted.)\r\n\r\nI agree that asynchronous design is the way of the future, and a better way to develop in general, but I disagree that the async & await keywords are the best way to go about it (if that's actually what you meant.)\r\n\r\nI absolutely love how JS, TypeScript, and (I think) any other functional language handle it, and possibly even languages with event support, which include C#.\r\n\r\nI would much rather spawn a thread, then fire an event or call a function upon completion or status update than use async and await. I just hate how async was done in C#. And I hate that it's the only asynchronous paradigm allowed in the UWP APIs.\r\n\r\nAfter reading a few blog posts like yours on this (now that I know what to look for) the solution isn't going to be so hard for me to find in the future, which is nice. It simply reeks of bad language design when the clear-cut, bare minimum await & async example that MS publishes freaking deadlocks when run from a GUI. That is ... well, like I said, this is one of those stretch marks you see when a language gets too big or starts doing things poorly; it's evidence of a fundamental design flaw in the language.\r\n\r\nIt's like how cracks in a wall (which are an easy thing to cover up) point to a building foundation that is not as sound as it should be.\r\n\r\nProgramming languages should not get in the way of the programmer. They should not interfere with the programmer's intent. As a programmer/developer, any language whose syntax is not well defined enough that ambiguity is *introduced* when I type in the code, is a language whose design is probably fundamentally flawed. Sadly I can't think of a programming language that is not fundamentally flawed in this way. There are probably a few out there, but I don't know of them.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"11a5ad5a-a039-373a-95ea-9cb7d8cb8d08","date":"2015-10-29T13:38:54Z","timestamp":1446125934},{"_id":"2a770dc0-cf21-352a-b17b-8ecaf9241d1a","authorName":"Erwin M","authorEmailEncrypted":"js1bpgwGhz8STVBuxIR671JCm28ty/chYrc+CV7htu1x2q/sGqbFak7aUyh24kpX97t5ODy+021hoa/7F7ORLPr/XGl4P4IhXHnCw/4p7GDyIBGJoNMsU1KwZ7FRxfS9GFrQfpa6fbiV424ukWLD7HE1zekSUC9UEerAhRxYS5ciI06fR8qrPg4UK9vQv+YJj18LocRXm+cNM3iaWAQ+H3znlZHD9h2ynRhOiKvpV3Dcc/ccqw7DIvmwlbXb57psVTQZDHWx3DHhlAqWtH9/slHj3i0oJg0nCZCCid/QAk26WJX3h8ChPQ2UCYgGvJ3/eNjK7tWbwNmhHZrIS+jppi/AML3CK7YPRUlBz9G9amDGXBAQh06UFk6gfnop9yeb268Eo6GjMI0I53O2EeLGSePTsepwKlZSc9/hY9oqIuvrNQ00lKVb/k7A7VNEcfgKKetomNLEYtTQewbBs6QuLWbrjw1cq9pIrsLO4K0FcHhs7pwoP/c9IWO8LPZZT1hy1F218EMGRPn/C5XsPzIaEpgRu9hokMlG9YbnHzyi3rmQDHdmtHbXVIAPQWvZPUwSu0239J57pfCLyPe9oDnsZ3QiMwYujOVckmDmMkzPeUNhoMQuJfMoLFhIrd1HZ0DQwkYnBRebSFjJJeINVM5Y7pm9flFapsYtU0m1/bXqmkM=","authorEmailMD5":"92a359c378b8045bd801c715630dac42","authorUri":"","authorUserId":"disqus:mayerwin","authorFallbackAvatar":"","message":"Extremely helpful, thanks a lot!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-10-30T08:41:39Z","timestamp":1446194499},{"_id":"50f7875b-ef7e-3516-b4a5-2ba91aaf283a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Hi, Piet,\r\n\r\nThere isn't enough information in the question to be able to answer it. I recommend that you reduce the case to the smallest reproducible example and then post it on Stack Overflow.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7407f97b-dbe4-34cd-b893-12472c158ded","date":"2015-11-11T13:17:07Z","timestamp":1447247827},{"_id":"7407f97b-dbe4-34cd-b893-12472c158ded","authorName":"Piet","authorEmailEncrypted":"B16fKHKGKKB5G8IL+/gKYKHChkQ8Edkrb3sG9JnJbGYvED2JW+YeDnTep04DHKlGpp261ivoKQ/rwGvtJoWvnK69Ayl8jwmkGNcIQ1NmhqzCrXI5/ijzOU9rCKzoAX7iTwPjZHnnXgdVbp4kUw6MKbDZacxOR/SqIT1hG4dQvi3BXRS6JQcfZi9qIp9zwNjPBBfIgQjONGkoIWXm0EJAYyhre/UdAIPZxvt8gNyBWPNhKG1tN4qFq2OR4MKNtAfhRUzeYljkPzXwAG+ccF33gLHHSmLDm1Q0PSIW+K9eZVyyxg5abTGbqo1MzzHIKT9mKDbTIilEMf6DxBswafkDz/GN/Icnab4XCfFbaLLHPa4cf3BVBDTiuvT7tag6h0qRdrRX0MIW9vzPZY6vHgNq6DJkbNS/ujQ1w/XFt62BYUfY0wuhVPoTLk8hDPs0NJPyOYFb7WIzCPC2LjBb0G1wS64uvMbFNAGa7w7tdWBEeULmuPQx7oHpVULeHdXICXRfv8LMDGror1bWcDxDh387eaoH9SHFgXyNFg4L9YfoCIu6cOkJG+61l1EvlRpRnCqPrzQXtJnc8fEtpXXH1GmxLLCxF9uJ3FelZFb7/h+EyCJj8x1wy6C9NEdpFuTK8Mo21/o16tRi9Z4IsGiauPC3YK0ULxDUBpIzZ5lAmcdUz+g=","authorEmailMD5":"b3029fe9f1cea0938143f07a0dddd5d6","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Great article!\r\n\r\nTried all the solutions but it did not solve the problem i have...\r\n\r\n var httpResponse = await httpClient.PostAsJsonAsync<guid>(string.Format(\"StoreFile?filePath={0}\", storeEssenceParameters.ImportPath), storeEssenceParameters.EssenceId).ConfigureAwait(false);\r\n\r\nhttpResponse.EnsureSuccessStatusCode();\r\n\r\nProblem is with the above code. Sometimes this call takes a short amount of time, and than it finishes with no problem. When the call takes a longer time, say 15 minutes or more, it never returns. The actual WebApi service on the other site always finishes with no problem.  \r\nTried already different things, with and without await, with and without ConfigureAwait(false), none of it solves the problem. What else could cause this call to never come back?  \r\nRegards","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-11-11T12:41:37Z","timestamp":1447245697},{"_id":"750e3399-d230-3501-a17f-b4cbfa1080e6","authorName":"Piet","authorEmailEncrypted":"LBOXGdBBULi9jaIw9apd1CtUsS8H9iPFHSeGVG5YQ09Siu5UpfFiizBjjow0FeGrlK6nhoCujJ2Ezxy6GpZUzHw2X7jl3tLjs0XHpsGiAQ6+6PGQn1/DwfjUxDoIulKLhLgCzk7JiBtmTo4Vdxj0coJLDvOt+8ax9mMPGZFpyXSipkOcMkSoMTgblmlvGbfexCMh+pXGNegNe/rX6xo7HB3Qn+jUlutvETqZKGaguALoC/foW5C8pWTLdorEmeYLksjaqXLBA4A7x3Ro5WAJD6XaFIm8qL/UFfETA5UbmyoFusshyS9+I0PndDbYYh21QVVXBZcGtScEPgoihxDGfgEVb0BPBGYWvVNxwhTRPa+jbyjbcOzhIEb0T8ONKMyaVJUBndt92bK0Feo04zum+ekcc6f5HGJ4nVo3vnmpOwRP9pctGxEz7/+xb0n4HJUawtyWfnNBcG1sBOWgZJuy1gNMFMYsJ6RqLNTmAYNjXnnLZ2B78pR71v2/o++kzZM7Htrludc5XI74mKjMAcMy4hj5spkE16yJDG9N9Orc8n0lRILSW8E56+/UJQ6PlYrrpKN5bY98edtmwvMjulJ7IkIavip1CFNZGl/JDD6hbUON5CU2kb7QaquhO2SpH1CPGMTAypU+bWEBroGsOyAWFeYOenIavmCI/Ope1Px/+1k=","authorEmailMD5":"b3029fe9f1cea0938143f07a0dddd5d6","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks for the quick response..\r\n\r\nFinally found the problem, turned out it had nothing to do with async issues, but with the folowing:\r\n\r\n\"Azure Load Balancer has an ‘idle timeout’ setting of 4 minutes\"\r\n\r\nSo after 4 minutes the connection was closed and no exception was thrown (or catched) and my call keeps waiting.\r\n\r\nSolution:\r\n\r\n var servicePoint = System.Net.ServicePointManager.FindServicePoint(new Uri(ToolboxSettings.GetSetting(ToolboxSettings.Settings.StorageServiceBaseUrl)));\r\n\r\nif (servicePoint != null)  \r\n{  \r\n servicePoint.SetTcpKeepAlive(true, 60000, 60000);  \r\n}","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"50f7875b-ef7e-3516-b4a5-2ba91aaf283a","date":"2015-11-11T16:18:13Z","timestamp":1447258693},{"_id":"84b90a7a-4cec-357b-baa9-b811ae62d543","authorName":"Nicholas Vella","authorEmailEncrypted":"vyleFYszjV7Rl1ctmf6w1521H7XHeyVGVh04GT3MIuEQcDozUfhdh7UeN8t3BrwPW1v6rR0PsNbzFIIK5rABZxMkLd4fqwK7HUBt3/ZHFFiRJELqBNb8nqfyi29LFIp3ugNhd8JlP65DhJQGamg/oRxJJONa+8d84VjwXsoovJdewdwcBfJ81fkczWi478a/Tobp88zyeTdFmOUMdzh6YVVzeu/G61FAyn+B9RRpMXVMPn3GlpUa2CxOFIaFREPAf5txwrkIYnOjA/joEDiEOWvqy9nN5RUBnTzxF3R6JSbdSZSJCaTtZHvBpYtu+Rf4kOVaNUFiE621w0UnyynljRMypUPrq2hwiIbETdL/hy2R6HwTiyHutbfGFqeTZ69aHhL6PUna8AutMfRZO7YTccYd4m5gUdhwU0Wl6Jut4iTcoJkxVaa0HreUqNdBP1PF0v9PtLRucZlSKOYZGdvXGij+SGeoVzAb28ZRBSSQg+JCzKBBHOlpOEs7nJfsASGd9DSsPzhXzV1zXW4vJjkJhXxJRevuptAW/DZhhFvbcX4OMd8DE0vJSoXVtkaipwg7ILZI+nfLUQ8S6QxDpTFydyuCjM3q6bX33B/U+NwjCaO3+lSo+NYQuxAw6uS5trZ6pEb4acMcfJwaORp57GnQ1zKVoQLtpqFh6OE1eM+auw0=","authorEmailMD5":"1f0659a5aba1ec68a31d366299458630","authorUri":"","authorUserId":"disqus:nicholas_vella","authorFallbackAvatar":"","message":"Hi Piet,\r\n\r\nI am having the exact same problem as you do.\r\n\r\nI am trying your solution but it does not seem to work. What are you passing as the new URI? The current URI of the page?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"750e3399-d230-3501-a17f-b4cbfa1080e6","date":"2015-11-17T09:10:48Z","timestamp":1447751448},{"_id":"c1ffd794-5234-32df-8832-55d3aaa79eb0","authorName":"Suhan Shetty","authorEmailEncrypted":"ai+uJ2AoMhx2wZ9KJk9JNsb/rmLjku/Bbc81QxmzPOf3aGydMMIRfJGNbl1TFZOAVabANmPsFZigpNsVu0HkjfC2NU32F3spU2UG3q4capsSulBANSnkeL1n60rH9hrwjCAKhupHyDEdGA9HDOOJJIf/Di+MnDFj3tXuLGjFk48Sv0hf5dCELQoYHkROUwqO/52PNGww+CJk4XWyUp2etrjbhfl0is6q5YqC1KixCSaE7KSItlUr5/DtmhOPelbc00pFuejFX9708FKom45ZV3vIb7y667vWBpY+4P9HkVex0WL3fTQKEI/9rnj8XIM3XSrEli7FLzDdPAriNviehZHySOfj3ZwFyNtXc/sYxfTWBeJ2AJCAxCiORzU+3tHWIwS3VEU+NMp+wpizbT7SaXMfEXNp3/yPTRFG4FHmSy+1/1D8ZxsGwmN808lTWMEs56V7SRLo/mKbyuy6LfPhfUFfmdFldKFmnMQSQslbb3aYp4YcL5d9RwdY6gIfuEv3/hwi6ArH0mIxF6yj2v+XksZ0frWXTxNzc1USZ90MGmXDYr3Jyk4NZu1kmc+ttN8DXGQ8xmgCg9t6wc2pwSbcU4J6zo/mA29MxNDw2LG+gSAMDlnZnrFXfyO5NOcXH/rxzkn7LGuHxqrcFrEMtj+XOgJH4/R2zueP+Jda3cviNQc=","authorEmailMD5":"6e0f58d5c678f3c3938593f5f8e14018","authorUri":"","authorUserId":"disqus:suhanshetty","authorFallbackAvatar":"https://disqus.com/api/users/avatars/suhanshetty.jpg","message":"Thanks a lot. ","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-12-03T04:34:08Z","timestamp":1449117248},{"_id":"101f66fe-1600-39f5-a5a2-78e911c39402","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You can use async/await with .NET 4 if you install the NuGet package Microsoft.Bcl.Async. [https://www.nuget.org/packages/Microsoft.Bcl.Async/](https://www.nuget.org/packages/Microsoft.Bcl.Async/)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"411fe941-a4c3-3edb-a0d6-0fd0feb654c2","date":"2015-12-11T13:52:40Z","timestamp":1449841960},{"_id":"411fe941-a4c3-3edb-a0d6-0fd0feb654c2","authorName":"CIARAN COYLE","authorEmailEncrypted":"iYDDgLiEUOl7st5Qo2mwc9yT/06tKIBb0l4mVTlIfC4lXIs241g+leNuEuFR6x18xfHCr5qlSy/DfiLgbS99lPRcvR7I+KzWKjTFu0PMPL1bSKno+csr8NDpH0PCR1jpI/+ivuxkWOdgrd8rpswnnjeojqEe76OIyWdgVU3C/RJnSlR76aDO+oSIYsg2iDaI/gIrL56qFn87wIxDgiTZNLR2YV+CVHPmCmQUt034YPAggC06rwTvmluloaitsnresRwQWT/1uF/LSqAw6xfCY8vzrDjc07Gt8w5BxeVGL9l31qPWRQEo0pXjxOZdwhnLIiqntJSVTFwHwrft3jwu/bBjVvhalzI1kZUwTN/ZRHgrT9HhuDv7fMEk5rmg3u4ZI0XLFFUqALOPLrBp6/qrNmO0YVRzh3oTORu6oCcrJC1q4m74I6CD7W0SV94tBKEGNrpxxLudvGbBc+FmaGkxQd0zOLV/vg/EdaMeUnUoij6YBgRMncLii6WxmeDm9LzkZZ07bCfAj4p4/MO+uNa6QKnhFpln2IBM3081wOieqCE3O3wh2oUk7l6IPaRoSGQFBdT/z7WWibOswx+QZxTj1DR+MS2EgJKLTm7/8KfIqLKcIGJH0v+nZ44c+mrOQ/NvsUk0Cy8mePKY5MeTeFBWC8MR8dRmBP/xDreb5onO4p0=","authorEmailMD5":"8b7d42be8366d47e24fdff0aa954cb8e","authorUri":"","authorUserId":"disqus:ciaran_coyle","authorFallbackAvatar":"","message":"is there a solution for .net framework 4 because i cannot upgrade my target machine to 4.5 :(","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2015-12-11T11:25:56Z","timestamp":1449833156},{"_id":"c83c164a-799b-3b34-9de2-332d09c7aa78","authorName":"Asim Shaikh","authorEmailEncrypted":"LMFi9A0RZoOi9bzf1S9PHe/paSU4CpE5Gu7xfiD2Q1QnS90CC2RfIlgig5QNh1bXRT9LpUVjms82eZD6odJC2x3Y+F+glMDXCTAcaNOOF9KpXJuSAjWHMY3XmICBNg/87EkcCAw1o/lgCy3+ahxdNcLXfEHXc+5J5i99mMl3+Ypb940VEJP1a2nVgyHS04K6LQGmQ9+d5RPb7NmNRVQ+FomyaKhQgn0RCFfGkBW/M9o0aQTpSyhztNVDWshQsOE/plAe64oXFa6lHH6uA8vB0NeerTTEcwJcCw7IkEKfa+OUTq3uIwOBiMWQFjOCmi/Id02d4JJRBMpz5/DiP7uY4Trn4/ZKkpflgZJQ7ETOYp4pylPAXDcl/6kYSXTan3ZsYWlDPKTY0tRR6+Vkn30AGy0iyWoi+Y6gmpmqXiALStF1Jnyab1FLi0YmOStmMuf7kwxO7rTwTzVZ8jOzbwNRJkMD+u8cRrW7vwcO0fN9PPc/tlw+nADOSO/ucr9dW/BIsWt5cJ5pE4mU6ZnymrMR1gN1dTIDU4z0xttaxre8o8SUnp+ZF7YNZ/2LNkPkfi6wY99fvTy4uNVRiJWlnhQ9SBYVPO+SBaW1SFFzCW0/CAeTF+5vF5h/hkDR5qRE5pZ4d2AZiIfywsZctJl77QWLdQjTAIZH2tr7D1yvpOExwls=","authorEmailMD5":"a2baa34d4bd155eb55e9bdb7b459f5e2","authorUri":"","authorUserId":"disqus:disqus_tkcyn7VLxk","authorFallbackAvatar":"","message":"Thank you so much for the blog. Pheww it made me toil hard this problem.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-01-12T10:25:12Z","timestamp":1452594312},{"_id":"2d4a0607-3fc3-3727-88c3-b2b01cf38385","authorName":"‫שירה נוימן‬‎","authorEmailEncrypted":"HHXtrb6aqyn10QywW1p68h5IRaKiF1VE2Zf2Y2LCKie4vqHboiGGZY3hnSGlGAp6z7T15OdCx30B29Yi/egXwmNEIrM7G4XZi0SJYmRq++qxSTSX6RP8rjuF2rJXRgJ6iKi150y4emABQu9gPpPHlaxsEcGpW/jOVb6KX91ObSNpzYLGn6puJcHDM0HM/wPSw6sw3XOBEp6EFw3AF1NTO4AD9zBqwreLu6EgAMp4n1DTbQvowlYLEh/aBDcE4eO/a//YfgZSwfcxXqiPCAHbI1DKoEJwFXXiITFLc8/J0rK4nEBinCNeEKKovJoPZZVf/+pZsF3+icCDjaS6uycWJhAXFDzQ1lsZspbFCcBbz2sP4WmW++vzTlYxDMQeTurR6cUJsfwLP2zABbZpFm5eIxHtfH0xDHN8lc7oL80i3TmizQufLKHZlPjDtafIaj30l/HkwJWKWOdLhCx0GRoQg/5Xi0uxQkSoN/nqmq4Y8C0T6pSVsk1MS7MrQdoE9dOAJWPi99rmqk9m0GcMX1Z0gyQCs1qGBMyinWA8IMgRuq7oSIqbBpr7CEsjg7O/MUNSf10oV3eVwb8tkjdlxt03FV2+dbHs3mt1ulmONz7GsHPl1Qv/Os7fBKTbXNtB9YfBIUULqIS/WNteAtwNxJARszf6Y2XXCNysHRvqh+AG+z4=","authorEmailMD5":"8804fba3ffe872e2d1811822821ede55","authorUri":"","authorUserId":"disqus:disqus_2xnuTOwktK","authorFallbackAvatar":"","message":"Hello,\r\n\r\nThis is a great article, and all you'r posts are, thank you!\r\n\r\nMy situation is like this  \r\nI develop an generic auditing solution to all are controllers (mvc, web api, services etc.): I think this should be synchronize so it wont stuck all services. but using Mvc action filter there is no async action for that. do you have any suggestion what I can do?\r\n\r\nThanks alot  \r\nShira\r\n\r\nThis is the action:  \r\nOnActionExecuting(ActionExecutingContext filterContext)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-02-21T17:56:20Z","timestamp":1456077380},{"_id":"766d3b6a-9fdd-32e5-9651-e4eb7dbab87d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Unfortunately, there isn't a good solution in this scenario. ASP.NET Core is rewriting the MVC library so that it will support action filters, but today it just doesn't support them.\r\n\r\nI'd say the best solution for now is to maintain both synchronous and asynchronous APIs. If possible, use the \"bool flag\" hack from my recent article here: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"2d4a0607-3fc3-3727-88c3-b2b01cf38385","date":"2016-02-22T03:20:52Z","timestamp":1456111252},{"_id":"962c2497-d0a8-3758-85fc-0a4024531da0","authorName":"Amit K","authorEmailEncrypted":"ZzPdid1dlVpVJktNqgOUVXTUF9ErYXQAsLhz/J3Tjwoyr4lrn/NnAqoC5SK36CgH4cs1SR61Kx1aHJphQrSWllnrhc/Bktk+PIVEyG7w81IuvRgw7Ai8T2iSfQ88/zRDisv9RlHdDlTMbP6uLxNcwhPgQdYXlDXvXkOZRpxsNliBbKLQ0AjCbGzQ1R44G55rogswjVgEApIkmM0gd9Zet24FWR4gIuXbUWa2r9DrYzSOXsZsaYZkkQu43LULCJGbuH7AGHJW0wNqvlD2Kb12CDSf4XBAcbBem27ntJqOm6cJcEIaKr+2l2qVWqSLykQiIi3M9wUrwHw4n6YQnQVAOrXE2d/rksCP/2ztGES6j1FN4lbn9tp4dE0t6kORLVeYGzI+nBDzgKoLXx4MiiNUL2xIYcurq+/2y4sF/IWj+mSMtYL4QPC1QF6Bxl5/Hs+lG2nWB8muDGvXPfCv/D5Tp74Q4PvovIdw5x0ajV909i9B7RHwwoowi7UQdbBgYJJUoDlHUJBrHsRY+bhAvjmjTnhi1cN5CEXv3G1PoeDUYwetwHt138S05YVxjSiSRcc5q6z0TcsZckuWquixYePdqo6/XBUVd0A/DccAoAlMqq52CeeMHcpXf/e5Th2FWeK/GPPO+T2qxtHT5XFRzgXPxL8VKZql5ujWVzR6DBh7LPU=","authorEmailMD5":"565e76718bd3e68e33ab802bc177d910","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"I wish guys like you were working at Microsoft :)  \r\nGreat explanation.. Thank You","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-03-08T06:15:09Z","timestamp":1457417709},{"_id":"4fff66b7-384c-3275-b411-49d69153711b","authorName":"Jarno Montonen","authorEmailEncrypted":"uFyhOAlmX24TFYQnLlDPVBA/TciNG2twvxgoHSUdBg7beuOuZId00ZwgezASkBOzlG2VLDlm2BiP4QLtbLdEeurMVnDxQjVM71qNJNlacqBJUrINO3rgO57/TDRoqDw3oKNsTPI+J0vgqfMD2ucb6UGkWFev0ijnNEhXfyGxTVCnugiV+2HRCUayO/SNejO9/dvZuDW+3vXh9olKaFlI/M4rSSgjO9O1MF0yjmmAQOQVd/9fiBPKoNUXpaG6msmJzNbZI71nksbvfc4LLQ/Bwpg99Bbdp6bXqGFy2dRNlh7N10bqWodJr0GJgAKJn/7lW5e3m70izixeFmDjiXCvtDqy6tKCTfFvMrafUsyR2HFhm2frvcpReZGs7o7VVAoj8ffMSxQMl/70UL8b9QH58gCiSaA8stkqlyxYQN4/DroFssRvyj+hPzHpPiMS4euvaAx9GrNozT1iBuJylumRT8d7wURUU4wOZQHH45GUq1GghUUmeQdoQopcqG+L6gtHbF4pC7jRWFwxqlsHHfB2QOamR0Lv/9GYowopKfn3bEpJMhKyTQ92lO4iSwcI0/I7WMDpJ8hSimlZflsOD3xDnCAJZoSl436wRNh9C/CSkfvzXCmK+zsj2utbWVMCZZ3a2I5m5JEAJLMvgowaYC48CfEEb9IdAhXG6SrYBPINBjg=","authorEmailMD5":"32189d4bdf842885ca2edfdd0f3214e6","authorUri":"","authorUserId":"disqus:jarnomontonen","authorFallbackAvatar":"","message":"Great post that saved my day a while back. We have now added this to our Windows App Devevelopment Best Practices repo in GitHub ([https://github.com/futurice/windows-app-development-best-practices/blob/master/README.md#use-configureawait-to-avoid-deadlocks-when-making-a-blocking-call-for-an-awaitable-method](https://github.com/futurice/windows-app-development-best-practices/blob/master/README.md#use-configureawait-to-avoid-deadlocks-when-making-a-blocking-call-for-an-awaitable-method)). I would like to encourage you Stephen (and everybody) to send pull requests for similar additions in the future.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-03-11T10:58:47Z","timestamp":1457693927},{"_id":"7dacad21-40e0-3920-9df4-b4a8e96b0084","authorName":"Илья Казаков","authorEmailEncrypted":"E4/BSphLGmVkLjcG3NbhAvdExcc9gWYXTpJaysGHusrGivsvcb76LDc9I94AOPvkW2iJX/BwY3S5IgjnHIaHVUvaNt2u5nDtH9WdYpmloJ1wY1A5uL0vBzC9YHkwOt+sbX2eNU3wZhlSNXZeMN1218tyaxGk5QtsFP72sSMcTc2Nwe50JkvFIqDLrWHTsWUCg6vKjO+1KJCZJvoGPcN0OaA0b4r9a9uqv2P/ukweAMWUe6S3reXjvgw0i5D8o4WDe3Y+krhD34GTTUne0NM3y26+yY1J+00pCg0bD/JgKt/jf+dHDVrAk75O1vxDZuLAIgoS0TL7Sa5xdt69KeS/qN3bf5vDkTyLLVZzMx82A62MzGzqYNcQzd4pHSfLV9h/LRgl4j905pjieYdkDhwgY8i2yr7oOzR5/04+DBMCP5j5W5ZlRoNIMGFhqUz6MoDoVlCLFSmAdCGhrr7Ilb0YI2aXxIO6pufCzkwnJojtHVw3iZIZiURNFmpdisVUTzN0bVWzE1zO55LUABMu+Tdb36QJLQihIvqsJdw3FsNCN/aQotFGaf8s3a5jiWBtBkYi8xzoSIcu4RPETPTRQYghwPvCYAcpuU5edjkVaahxNos9hI1awuC3mRcLvq7oHzO4lS/gqzeqUD0dqaWEWWcVk8M38eR2j6C0B3mcW5F51vA=","authorEmailMD5":"16bf78d2c5584eb76c60c672f8fef2a4","authorUri":"http://Cossack13.com","authorUserId":"disqus:Cossack13","authorFallbackAvatar":"https://disqus.com/api/users/avatars/Cossack13.jpg","message":"So thank you!!!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-03-20T20:37:46Z","timestamp":1458506266},{"_id":"4a15d280-b7e2-3409-9a3b-c68a45c677fc","authorName":"Prashant Dudami","authorEmailEncrypted":"If+Q6bFKm2tQbjWH1RVYscUzA557GhH8RW5lJVuw//QeBddUlEjKR+fh4rbuOvjoV69GY18M8pNiGhKDgDYUN0lJOkXtjWU+EB8KcvcrIYa0ELKtsoheEc8IBDUILOcduwU/8V9ai9xJBg06R0gVA4842MXW8amRiYYe3ClIBNzLlx2UiPrTOnE+BXD+rdBGCj/ckHCV7AgC+k1/wymYf/W8TL/EUqsWTOyqCkvD93mBevtUoIjU/8GcXzcIvf1vViYgHDZCdR+YjXS005OWI/hzi1zbmw9R8NjBDK6K4z86x4dgjeLB61Mvxb508B9A7/RTdyAUMh4C4Q4N1pc9gfdiw4iKGAbVo8l7NNeouvSnE/IEstE027pF+IVkSaAk2sGFSLBgUuzs8MM0bF5EXXkr/PMJjhGW4Ro6oYOML3h61ChfMR810KmogiWVE4/JfM5jCXqwIqf9NqsXNQztEMGi3UZy1yGHnUVShW1KYWQDOJvg1O/tCuu/NCnQAA5Eeg4wdUnFliDC5UGjCeKJUarPtWNheKn/It47wNxZbPyZkYGQ251Kwgk6u4bGhs8ire2HSkJBIV86mothUOpxxjYhfSBbTBlKkhpS5UZb1Z2vvfNET/uB/06+HUhTC1SfSsIeP4PQzDS92hwrPlBp45LE2/fwElNfOdbmo0ojGFw=","authorEmailMD5":"4bf4fc5523df3019e5dc88c408038c96","authorUri":"","authorUserId":"disqus:prashantdudami","authorFallbackAvatar":"","message":"Stephen. Thanks much! This post saved my day. :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-04-08T16:14:23Z","timestamp":1460132063},{"_id":"a9f8732b-e487-3705-995b-bd2d53435715","authorName":"Pradeep Chellappan","authorEmailEncrypted":"MzmnQ8ODEoj+BhPMiV1gGpXILldiI0A5olbEg/HM5utpU5kaDfCKZhI54q3LxAiFnae1Dx20zINk0pcdYlXvm/gsma8qsXZHtAST38teWRXTF4zod195TRqXbxllFDQWGBvKvhBn2QNz5p8pakqhQEtAbqZXpRCCwBV2OHeenB9CzGIuQfAKW0n1N0n+WqB2iIySVElzL5pc3VoiA2w3UtYyznbTB7PA1dDAW3UsR9NgebXw1evUFoN4IcGwC5bW7fqfmHWwInPTFVtrf77CvXJwAfuMCLcVYP5ccRYmqP7Hqcxf3j1SMqZfzMnF2YW2rhGKOxqU5FTQI0IxXqBYxaArNkUxJ/D5aUJ4Ua+hIKdyAOr52VsYcNDncB9viDivLnj5uIeGIrZydTw+WcGF+16Q9QpZH0G7RYKzfnozO5DzfnWhT+XM/hvPC/OO/eicyYx40nHpFJJf9dVme9+s96wV6iUbPUvPyZ02M/Hyk9qze9qt4Nk7CODHXM9hsDRH5Ahj5Y/FOv2ZcWdmKDhKFjLAAfJCcXpUSo9sJg0dKc6AY6cqUA9A/NjPFzAQtF1s7WdSW8WfVSWUS2HJuVzeW4BKXJhKfcgwY0zb9u79MJgpzZHtBY7/kWZzvlgdQmEHSnmJ7H+o25S/T9yhHHqmok75fz0vVAHzsVD5DxcsPGo=","authorEmailMD5":"8f77198639317e4e2dfe37e8a6546bfb","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks for the nice post Stephen. It is very well written and cleared my doubts on the use of ConfigureAwait with [asp.net](http://asp.net).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-04-15T18:41:23Z","timestamp":1460745683},{"_id":"c1f3c18c-74e9-3e96-be41-d5c0fe6fd565","authorName":"Gustavo Maloste","authorEmailEncrypted":"BjpUca8rJvaTCY9nmjoXFpgVaBNn/FjYGCcNL6qerxBsF+yZ30U/WXR8DZQk8oV9HLJMyO6pQi25evQF75il4Y+tK77N5T8EE+0njZLnDbBagdLTEXZvInc4d/WCRFPLlYCgvllRW9mk+FXof5tSrPewMbUvYQHZVVzb1wlz73XdLg4XhMtT6zyynxGhPH1rGpvSzgoTpDjJWUOaO9qiMz04jkkMsdhOqAmuuC8fIb8DtPh1Zm2VNEH/CY8fy8129fnxTuQ6mr06g7CClumtrrkULiTDKVzAKraiWmT+aiLgOhxjp/e4A8f26PHdMeqqa0Y1WkYXK75SDF9/WvFbmb4F6KiezKkXaRVmmQrc9IRwyhZ6mxLE2cO0TY+H9HPNqXCh/5dN6IHj1oYLeqqixWWFUzGLNssyffwoX7eqzXTvpzMtdXtCzJ40v6aFLcwh4tRYGrw9HlmP7T1drDl/rkZ5JPCB02ACWg0QRdtN3ksKmNOpju4TNBzUQecufhbl3aEaOnbTLYtWAVl5DD1JrgKIbs7ouIQwM6tLIZgQPgz86TaCzAY4fkM22BXOy6BLETdYnU/qcyoateQupkzI5w2OJfi7kAEJVsc/klxlXXqJAlUlen8x+GvFS9kZl7hVB1vw719zY3VjVNaaM+oLRPoGEZv2qXWH9sb2/NSa2gw=","authorEmailMD5":"02d7adea7c89f5ffb6039d29089844d0","authorUri":"","authorUserId":"disqus:gustavomaloste","authorFallbackAvatar":"https://disqus.com/api/users/avatars/gustavomaloste.jpg","message":"Incredibly simple and objective post.  \r\nThank you","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-04-19T22:17:25Z","timestamp":1461104245},{"_id":"e553b1ea-4497-3df8-b8dd-9975a466bb31","authorName":"Francesco F","authorEmailEncrypted":"kzvAKPXN+EeGS0TAFt/PrbuSIsLfDy+QGGWagLM1V3JEV/SmGK0FuLcC28B+H+a/aTHf4PAJEiCN2VA5ZuqqY7nPEPUSG91EB82H7MgASacuNz5Pbly1SXJxENi5HWzA3wRhNeSCWYD2+mZwdHtouQEzCozWDVHLNE+Pff77/aJrPfehqFxJoUV0ABn2/6TjAr5vIA6Zj1i/6UET5MW75s5y8VwGXNecWb6JbdOC76UrCopZPS8odkKgPHbugg9yM5p60X9NgU1P0JBZrV/Aem9KM0PJnTS83+llaAQFXsmSrqAAHuLTyI5PFJszOsi/g/0glDcy2GQliIMBHfSY1P9c8f5lYerxkGAiWMCdEbMbzddMhY3L0Zpew+1y0tUuKtHOXJWzP3Wdz47pxjq8fnzo3ul7Z7DSs+zMzcqwi4B89XFgGAhkPtIWa6nBe+NtdeHzz9m3afPDvEC+kUj4plMcDXsQngjQz6ZqPGFzjpO0Wk8+6rcmpb/DXJtrwc04MwPNck0AmwF/qBYv3kTDBK3MGFhlsvOIl53n8+nVbtTlwe+j2qtPWfJl3540+pyjDS2T009YyMZOS1vn2N8vIsVRVTdAATzNW/gPGB58BLGyNZrSjq12/itv+Qwcwb+2GGIQnDjx7BTiPLmgs3UIN8eP6dgtGOz8xtBvRhhdpcw=","authorEmailMD5":"4ce1372658ca28dc4e0e8d78f6a4f757","authorUri":"","authorUserId":"disqus:disqus_xMyF9KPP2w","authorFallbackAvatar":"","message":"Wonderful post.  \r\nThanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-04-28T12:29:31Z","timestamp":1461846571},{"_id":"9eb8f0ec-e4ac-3c2b-aca3-7cde9152edbd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, assuming you leave the Task.Run's in place (that is, WaitAll is waiting on a bunch of Task.Run tasks). When running on the thread pool, there is no context to capture, and so ConfigureAwait(false) would be a noop.\r\n\r\nThis would be a good first step, reducing one-thread-per-request to one-thread-for-all-requests. The next step would be to replace WaitAll with await-WhenAll and remove the Task.Run's completely; this would give you zero-threads-for-all-requests (fully asynchronous).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"e681e320-b131-37d2-85a9-1950bed6308f","date":"2016-05-14T12:56:11Z","timestamp":1463230571},{"_id":"e681e320-b131-37d2-85a9-1950bed6308f","authorName":"Brondahl","authorEmailEncrypted":"gqeFXTs0eqr4svcYg4CI+s5lg7y1Vt3LiP9f+MRS9EDeEnBVKqDOAX/7wTBzgIw/U0P6Gy7D5DtY47SE/sn03R6cBXaXLi8W6B6ryPdsbu5RYp/V/V9xngosaQC8RCKtN/zCew53xQ5LCFu/X9nQej1OOhg96Ey8ClVvzxnAz8f89G0XBElCxV0zWHs0ayUrSScU1rMLgRX5iJnBcnyjvtYK8/B1u0U6W2Ej5cAPZS/nqxtUEf95HPu+tOCQR5bszgnqElI5VZdHrrkwzynsgA+jAKNFWStljz4GW+B/o4aG0H+HQA9PuqnE+deRyWNRCzRrNsiYlH8XM0kCJ7jn1r/X7ELq7jG9AxHYojVbg31eQS91WQUWOJtaBVlMdzCcgqRG8O3Dhj4mEz3u5VBQ73FRWSrNYdueg2RjAiiCk9smG82skutQJ6jjmSXWsU1T8n4xpxM72AI7S63B3517D8kA/YMZ8A8lhIb7Xu4CRmystMYxTjxp1tR7LzwcTFzJnS23RVr4Utk1Ehij55/8ec3rcvgFkK8ErGYx4tlvZPIwHgcbXfjHo9dUmybTR2dYBl0Osy7kCh1nj2dIyMpTDzIYkCcziYIXRc8+72Y2yhahuSskkB4XygIHWgtbH0UvZqKg6kYSVLh1fJ12WJHdfy90W00H7vSsOyhx9LZq770=","authorEmailMD5":"c807195c3caef0cc89ed8bbf9717a710","authorUri":"","authorUserId":"disqus:Brondahl","authorFallbackAvatar":"https://disqus.com/api/users/avatars/Brondahl.jpg","message":"Hi there,\r\n\r\nThanks for this great post.  \r\nHave I correctly understood, then, that if your current code has been triggered by Task.Run() (or even TP.QUWI, if your code is /very/ old school) then the Context is NOT one of these awkward blocking ones ... it's a ThreadPool context and thus it's fine to call await without .ConfigureAwait(false), and then to block on the result of that call.\r\n\r\nI've currently got some multi-threaded code that is Task.Running a bunch of threads, each of which currently calls WebRequest.GetResponse() and synchronously waits on the result, and the initiating thread is calling WaitAll on the collection of Tasks that it ran.\r\n\r\nI believe I can convert to await GetResponseAsync, bubbling async through the methods until it hits the initiating thread, at which point I leave the WaitAll untouched. And I can do all this without needing to use ConfigureAwait(false) and also without triggering a Deadlock.\r\n\r\nHave I got that right?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-05-14T09:42:01Z","timestamp":1463218921},{"_id":"9cc3a836-07d2-3147-ae06-57507b5b8463","authorName":"Luís Fernandes","authorEmailEncrypted":"pa8X3w3sOjYU3FFJeeYpF+GnxwP6rz4xC4xXwY8PsqcHySqacWjjzU1PGddKlopoGVzXa+Acd0/7OYRh9iTyZvLQirz/AuQNPTltcGVAr1W+dGzNULOJ214K94xLJN0em8EQSR4bddRwAVdWu0KhB3MKjLoSBrqJADJDxDnXpkhW7LtjdxDWQdFK/YNp5S6gtxF1xp0MIFTfKratH/xBS28sffjd1BfBLO7v6hRNReOkiRpQVGeO67Z1SHEqi6ZqUeyY8Kzqd7mczlr8Fr4kUYZ2RMYiD1RDznkghEuwIHglPfJlqIRyQdIiI/hnYn/R4fRJK7lmxbVR8iWkKwwhtdFinlFOgpyaf8C77o3qqYmarRz7Y3pwoS1tRU0E9eMPJh/YfYO3pkLupHgja4riZs1szi0/E+BoCi69kxIq/XFnxbbLVUEQePRc6xsWnbWzAwOtsNOTCMAqy4dfIOsheAacAHoK58TwqhjdHOSLji14BJqF5BazQ7LZ1ZdB5ZmM+gHkzbPjRpaXezfxMlAvuY6oF7/HyOl5NED1j3OGV7zpywzUEcIVftWkee9++ZnzcvSCZ8EjhTFLca0MxhFmnk4K43z2V0fNVSTKLgLehBg/7XHkECmzNuiQWrQCswCwgbq/RPIPIM9G05xcoy7lOFgURv0gJxh1W1ZhQz8fYs0=","authorEmailMD5":"3587d6e1f69adc340c89c46d11a95038","authorUri":"","authorUserId":"disqus:disqus_LfgagoSDen","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_LfgagoSDen.jpg","message":"Good afternoon!\r\n\r\nDid you ever have a problem with client.GetAsync() when the host is unreachable? In my case, the client.Timeout goes up to 3 minutes and only then throws a System.Net.WebException - Connection timed out - as described in my post at StackOverflow ([http://stackoverflow.com/questions/37369180/async-download-and-deserialize](http://stackoverflow.com/questions/37369180/async-download-and-deserialize)) .\r\n\r\nI tried to base myself in some of your book recommendations, namely 2.1 - Pausing for a Period of Time - Discussion, where you say that CancellationToken is usually a better choice for a timeout; and 9.3 - Canceling Due to Timeouts - Solution, where you show some token timeout examples. However, the CancellingToken is being ignored when the host is unreachable; works fine otherwise (i.e., if the whole download and deserialization process isn't completed in 10 seconds). Still, the (real) problem seems to be in GetAsync method.\r\n\r\nMind to take a look? Thanks! Your blog posts and book have definitely been helpful thus far.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-05-22T15:38:16Z","timestamp":1463931496},{"_id":"01df4366-f192-30ad-afc0-435a671413bd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes - essentially, you'll be cancelling the *wait*, not the *http request*. I would use `Task.WhenAny` instead of `Task.Run` and `WaitAny`, but the general concept is the same.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7c9c7e86-5705-3d37-841c-cd572975a9e4","date":"2016-05-24T16:14:44Z","timestamp":1464106484},{"_id":"7c9c7e86-5705-3d37-841c-cd572975a9e4","authorName":"Luís Fernandes","authorEmailEncrypted":"S6z0W2dGjt9r06U11jpOhPD15Mj2tSUXkDjnwGDjbmhJV17Pmw87t8y7wzqGkSO+AVooTS7uozFQ3FI9sFB6vr8vlt3VQf72WAKWqWxZIEKBFfEtok2tWX17cHM2BgKMIcUl7Wvt0cr7Sznzhs/eR+WJNxhNYuaiJzAYZQzreZLN/baNMu0Ibl55RaYIukOMv+7u5g13ror5lvcAVKRt1bIK+D1Ntop/19ZI8YtDXTwx4f5f/xUIW1Flz1xSPfOmKko2QpLk/qeahp4B67o8nOP7kRPw4ZeTIiAIEoF2nbkny/kghNUXW77oTq2/ejX0HTZu/Kpq7OFCdgR+bHWvOnwdDHCnvbMF6YGUjUgZiyWEkZF7VnBX3j97I+qvDr35GjW+7I4YNPrWM22EBb78gLQ/rubSsmq63Zbr+K+71wQFNUFPENIry82zjC4Ww9b7o4PNWzmvq1R1a+yko5gNDpbmdliOCJNLjPMkHGC0NpVgTPZjn/qn+N9Rm1aTSflJrpMj9V7SkXKMhKRNM1HEUPm1DU73bCkErVASpEpq3kEOfVz4kWYa2D46rUCNnb6eXYXfqY1jGBkvgWB/0Ao0DuceuH7ciruJefmCe70bLY9OOptj/MYh8jxRCcAcYyBzfYUxwZ735xjEcXB4XgKsF5alAcag3jJPUAZIcoeA6XY=","authorEmailMD5":"3587d6e1f69adc340c89c46d11a95038","authorUri":"","authorUserId":"disqus:disqus_LfgagoSDen","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_LfgagoSDen.jpg","message":"@stephen_cleary:disqus Sorry to bother you again! Still regarding the same Timeout issue... Would the alternative described by DavidJohnson.9477 at [https://forums.xamarin.com/discussion/5941/system-net-http-httpclient-timeout-seems-to-be-ignored](https://forums.xamarin.com/discussion/5941/system-net-http-httpclient-timeout-seems-to-be-ignored) be viable? At the end of the day, I think it's the same as what you describe in 2.1 recipe with Task Delays. What do you think?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"9cc3a836-07d2-3147-ae06-57507b5b8463","date":"2016-05-24T13:58:38Z","timestamp":1464098318},{"_id":"c47649df-6d38-35a3-a436-b4b5b4075ffe","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I took a (brief) look at it seems fine. Again, `WhenAny` will not actually stop the download; it just cancels the wait.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ee111c09-ef1d-3fb7-8323-06f9431944a4","date":"2016-05-26T18:09:01Z","timestamp":1464286141},{"_id":"ee111c09-ef1d-3fb7-8323-06f9431944a4","authorName":"Luís Fernandes","authorEmailEncrypted":"QYl4M/mfs8740C/11rcYF2k5qJfAWM637O2RS5B9I7i1CIwv/g4eHqFjg09NY9b9W0hS8gZwXLpQCxIePzW64/ktEyuafFTjJ07zupWHL88gXxujXnw8FUXlwSjZuPPxCdMIwKHWRWni0JV1RhexnAo8VVOEqHBHBmqOKX3NS4d/QGpO8WsZ6T2ijYAl2QN5NeZCLjUkKBcRtucSuNGDVmGuXZ9VRRP6CYHPiN55chx7xIIBWJJYujmzbBAcApVanPkAnoTc8GinQjPl0rzOqGC6UiHjSc3iFE9XNx0ST9vRyeB1FV1gi1/mo2tAQXW7Hme8qtzQh55YmSWZUjzeiWIJmelljJDSin9ebwt7ymU4khLKOaKlF8d8wQ9L5B4YqwGMkc0hGb9jOyraspcYxsz60N/ZeZrjKcdoQC++rf+B9MeJZW2uQ21XjbJ6Fep4HVaSJboblo3tJbxEtrO03wVwk2GpeYiYrbEE/sKuWfl7LIvu2wA/HbeuVBl7b7fMBjdbGAEC0S6Vc9FmEszsnLmf5fIEnm/JSDfvwk4mOWUl774NlGoK7Qn0o2L09GfbnihpKcVoVwTwngr2vTNuDENz6JYBhBT6P9ADLSAEsyUzPO0K1fnwguuGpIoIzQY2umiNyI19kK2PTk1nwmFxIjQN/HU4jPYkzbZeiAex5rY=","authorEmailMD5":"3587d6e1f69adc340c89c46d11a95038","authorUri":"","authorUserId":"disqus:disqus_LfgagoSDen","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_LfgagoSDen.jpg","message":"Thanks! For whatever reason, with no changes in the code, the timeout is working today, though yesterday it was hitting a Mono Http stack error and couple days ago it was ignoring the specified timeout as I described in StackOverflow. Some outstanding sorcery going on here.\r\n\r\nThe 'WhenAny' alternative seems to work fine, too. Care to take a look? [http://pastebin.com/Fgc89AAv](http://pastebin.com/Fgc89AAv). I will also try ModernHttpClient to avoid the Mono stack. Thanks for the help!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"01df4366-f192-30ad-afc0-435a671413bd","date":"2016-05-26T17:57:00Z","timestamp":1464285420},{"_id":"af590369-87a8-3efa-8a2a-d4a810665eab","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I would be surprised if Mono supplied a SynchronizationContext to its Console apps. You can always check SynchronizationContext.Current - it should be null.\r\n\r\nThat said, I have seen the droid and iOS versions of Mono behave very strangely (and incorrectly) with thread pool semantics, task schedulers, etc. I believe they've already taken the MS implementations of the thread pool and at least part of the TPL, and they're planning to move even more to .NETCore. Looking forward to that...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b41922b3-fe90-390d-a3f3-b6c3081d1755","date":"2016-06-15T21:19:50Z","timestamp":1466025590},{"_id":"b41922b3-fe90-390d-a3f3-b6c3081d1755","authorName":"Dan Gershony","authorEmailEncrypted":"XqINr+Acd7i04Y4bkoPYy6zx0JqEPPcMt3IYEpOQSTbwvXsrdxHHxQW52ZmP1KNAXDfo3+3jazmjM1FiAd558GwLxe7gh+2RIYzWWtb+raQGt0Ob7j4bQdiC1091irUjRHHaZSzrfVQjGY8VaUid2eX3xT0eASVz78mRZr9WqJC8Nusl08riO6l7hVH5WgMyzw1w/n/srlTsSwYutebuPWb/4Dg4ibFh+pTYp4joPxTDWabZcM7aUbbGnk2crZi9CLovPX+jqLEPDvki45/u5fgxrwtNjR+SEJvIzr/qU3ESgINWe1CR7yv/G/PyPdsZseYaPlue3KFucGOQNBvKTPhMGgZvUCrnTjagH6vLMnAEwUkANH1twYdokXnsXYhAWIQIpfuu0HIA+aikgiPkmaqYHpeIZ3HIOA2yEitVr+UWbMUh7h787ZO5CRsolBQtG/WdHihGLz/5KfLXaxsqXx3bh2NYU9jgycz5d1qmUsGWWgWttNPCTGMmMesaxjbuLZooPwyrkMH5qDQ9Xt1X+jhElklZl6fOtHRVkPBkcK3E4WUmTaLFa5a90HVIwEJlA5qKpDc4QqfqlhjIAkU0l3H4I0IvKODZwskGjy5pMxNVy2tu80m3apNFqKBMuIYqCXjdIOg2554sLXACTvQytInvCSiwE9Jc6LgE6SG7Tck=","authorEmailMD5":"71adc1449fa9b5644d69a5d25db9ecd8","authorUri":"","authorUserId":"disqus:disqus_Mq904YACXH","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_Mq904YACXH.jpg","message":"Excellent post @stephen_cleary:disqus I was wondering if you had any idea on the behaviour of the default SynchronisationContext in the mono run-time (running in Ubuntu)   \r\nWith a Console app I got different behaviour when executing in Windows and Ubuntu (app was hanging when calling .Wait() )","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-06-15T16:50:11Z","timestamp":1466009411},{"_id":"bacb2d16-4ca6-33ef-a1de-262e2237c070","authorName":"Dan Gershony","authorEmailEncrypted":"oC+Uf96Z/rMGRu8fmLsdUoDFEaUh1T3EhIBYx5fmuiCR5BaZDLd2Hqko5oW+jQOPIGsx2uB/hckK9loi7W/NQmOnUYVAZvUANFUkNRmZpR3w8HxWVEHtGhV4UzBBCN2FaZhhoUXvJkaIvQgCtrcEHmAA9kOxrBRtEv9M3qc/ygOK95mb5ZFUFOjxBdMXCeAcgjNrj5CsShqduZyF0u54z7wPOquNbj+nm8EGA8tmr0cLHMGsTCPGedzbPQA8KdbQjNTNcQbw+n6OQWV0BjcyeMcCFubFakIoi1Y7GhlO3tjPYgbdVyuYE8vFJar30/V9LoFg8Pq3uKEGQLrlY3X0oM8mR/j44czk8zXLyb12M/I/YqP8NROhS2/eG9ukrkmTciMb2OmwSF+cm6OM/+kpk9ePGDNWXJ+5nDlvVK0H3wEDdRCd7nCbbpMvLRD9VADSBjaXztF2rlAHo3eeDItKc61GYxdU6/VCQkvZd5kpzX9op3Y9Ab8/7tHykY4PT5usjgkbks1E0ouKaKMX7Jb4jfHCYGOcRw0sPeem6WxzcaVyRlD/MmHd7Ftt99SHWYT9cwBCC0lX3sM/zPYn3I2tzvYTo+ERJZHZ5M1Xn/JqKZjO6YI9t+wBK5jAxvTmk9CI87gh1gNt2Oo+FGiCf06VzegvjX558GKMhnK+sJqcfog=","authorEmailMD5":"71adc1449fa9b5644d69a5d25db9ecd8","authorUri":"","authorUserId":"disqus:disqus_Mq904YACXH","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_Mq904YACXH.jpg","message":"It occurred to me that I was running Ubuntu 16 which may not be compatible yet with mono (I didn't find anything about this in the mono docs), I tried running my console app on fresh Ubuntu 14 and the app behaved as excepted.\r\n\r\nIndeed SynchronizationContext.Current was null\r\n\r\nThanks for your help.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"af590369-87a8-3efa-8a2a-d4a810665eab","date":"2016-06-16T16:37:57Z","timestamp":1466095077},{"_id":"25847a80-373b-3aea-8482-7bbd80edeebc","authorName":"Shamal Badhe","authorEmailEncrypted":"sBU/zwUY0oftjbnsRIYlqAWvXXSXYMfk/MN35gGNoyNJ8Mvfx8tNPajH+0DbZ7wWCYgCRMVrR6/p39rCpfgMhQLX7XxFFEt4eVrapBx8N91uUHTxnB/UDEa+BLXfEDX1qeNA5c1lMFbzTICdUj0E3eKO2+Z7oT0dI3ZWir2m2UTX6/+SpIZVhjoEQ5/5cy/LE6zpMfEg3eoL+eUC45KIxxl4WV+CB46ClpU6rGPC1kdS0ZcS44Ks32ZNo4UIwYtBDwVCYAEL/BWEhF4CHQyOzqvNeQZ0HB6uodHvUvoDh0Bp1t9xiMdtZI1TnzOTEM2JF0PcEee0+SxXsxIiMCv5I3XtBJQF8iP992Fs3T+MHq9h1I2NUdN4yb/tIXn74bMAv0PjpPBgakS8armb5S33jPB8yYQXcyj2T4ed8PMauk0Z71oJgpOhP2eaik3hjQ5Mnj08Lef8fagW1O+9QyLc1YkdeD6q1nepIYaxVlT7KT9znxB0kxp2KcsPwPE8SO59wrsQPFa/AReKL+tOUsGni+JYpWNntorKkns6qwH48KQ275K8ZOz43HCTBZ8EuIoqO0IBRNzxE7WIpSS1Kef6GSDOvMi0OsDAcxkMotYHBhu0vhsg7avPXtcD/sIkntthQW7Xb/TWsMmtH2OgK9uy1tXR40GAue0TDgLQ4VJDQUA=","authorEmailMD5":"7e4527c5bd0b4f1b2b5af7eccbf9cfe6","authorUri":"","authorUserId":"disqus:shamalbadhe","authorFallbackAvatar":"","message":"Hello Stephen,  \r\nI'm stuck in this issue: This is my coding structure.\r\n\r\npublic static async Task<string> A()  \r\n{  \r\n .....  \r\n await Test1.Get();  \r\n ....  \r\n await Test2.Post();  \r\n .......  \r\n await Test3.Send().ConfigureAwait(false);  \r\n}\r\n\r\npublic class Test1{  \r\n public static Get(){  \r\n .......  \r\n await Inner.Pass();  \r\n .......  \r\n }  \r\n}\r\n\r\npublic class Test2{  \r\n public static Post(){  \r\n .......  \r\n await Inner.Fail();  \r\n .......  \r\n }  \r\n}\r\n\r\npublic class Test3{  \r\n public static Send(){  \r\n .......  \r\n await Inner.Send();  \r\n .......  \r\n }  \r\n}\r\n\r\nWhen I run first time, its works fine. But when i try it second time in a few seconds, deadlock occurs and get like these lines in output window.  \r\nThe thread 0x7f8 has exited with code 259 (0x103).  \r\nThe thread 0x19e0 has exited with code 259 (0x103).  \r\nThe thread 0x1aac has exited with code 259 (0x103).  \r\nThe thread 0xb2c has exited with code 259 (0x103).  \r\nThe thread 0x1b18 has exited with code 259 (0x103).\r\n\r\nCan you please explain me how to fix this? Please reply asap.\r\n\r\nThank you.  \r\nShamal","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-06-17T17:52:02Z","timestamp":1466185922},{"_id":"a4f56dec-bc10-33b9-8778-4a15ae7d4d84","authorName":"Shamal Badhe","authorEmailEncrypted":"aHTKEtu5NPgtDz92gN4j8D0p9I7SVr1eNsg5GWPvgXxKNc/0IZdaXgazwdadiKln0HOcC2P0OgHuf4jtDqYjycVQA1kVVgcRbq9yrClZE0hKJ14lTG5zZ7+A343jF8Xu8iXudCTBJgzT8eR1dDBdCGSYmY+1ZT9Nk0kl+jig41Uujorr6CIR7gbP+NXy43QRqjMBL4/s7oCAuxoJgOfdHSCEXjnFQsBSQUyTkzv01erQB56MJDsgTod8YS6I3/yIDPeE6Apu20ugnKs3EArYYUVhV+H+aauv9z64jQS06GzwrCjpkpB7R3xuN914IS9OJpqhxw1T0Lf6QusXHC81piXzuI0Tgd6m9e84/Ws9pn9PWW7G18kk38R1qTAtwGMoBXsQWmyEQxsHeESgt+EI4bQlhhBCsb/HeHcgM3gTpMDDz404v69CWWFZe+RA7CGObkaVUI8e0aaTp9TehFBGI5TJ+2atmFCXMguM8jizT2wNyT+sz7oxEzVw8YHMf44b4lp+BK98eG+yIT2DBEWLc05aNFXK+6wh9RqQv2ooNntAM2Ra9eAcLrsX9k0WCBnswt+Z2/zHFURV/mo6SKdQkt90Z1792Bv0CcPdP+9d41S9pv7S58ezGo/4FCpt2y65NYrJMVTeJ6KSEAh2zWJp0/ZrbqK9sd+/7TcCze7CPY4=","authorEmailMD5":"7e4527c5bd0b4f1b2b5af7eccbf9cfe6","authorUri":"","authorUserId":"disqus:shamalbadhe","authorFallbackAvatar":"","message":"Thank you Stephen!  \r\nI reduced the code as well that was causing deadlocks. I fixed it.   \r\nCan you please tell me in what situation, await method does not return the value? It executes very well. But after completing the function, doesn't return the value to its parent method.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c7afb080-9b18-3d66-a405-cdc3dd04b70d","date":"2016-06-17T19:08:22Z","timestamp":1466190502},{"_id":"c7afb080-9b18-3d66-a405-cdc3dd04b70d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"There's nothing in the code you posted that would cause a deadlock. And the \"thread has exited\" statements don't mean anything useful in this case; you can just ignore them.\r\n\r\nI recommend that you:  \r\n1) Reduce the code causing the deadlock down to the minimum possible code that still causes the deadlock.  \r\n2) Post a question on Stack Overflow with *all* of the code necessary to reproduce the issue.  \r\n3) Send me a link to the question.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"25847a80-373b-3aea-8482-7bbd80edeebc","date":"2016-06-17T19:02:21Z","timestamp":1466190141},{"_id":"e749a7b9-6acd-3170-8348-98bbd704229c","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If await returns at all (i.e., it doesn't deadlock), it will return the result of the task (if there is any).\r\n\r\nYou can think of `await` as \"unwrapping\" tasks. When a result is placed on a task, then it is completed and the `await` gets that value.\r\n\r\nIf you `await` a plain (nongeneric) `Task`, then there is no result type at all.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"a4f56dec-bc10-33b9-8778-4a15ae7d4d84","date":"2016-06-17T20:04:43Z","timestamp":1466193883},{"_id":"116137f5-c2b0-3b36-8f85-729a3b46630c","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's not clear from your description (or SO question) what exactly you're seeing. The VS debugger will take special actions to allow you to \"step\" naturally through async code, which is why I asked about whether you're stepping through your methods.\r\n\r\nRegardless, as long as your DB queries are truly asynchronous, then they should all be running concurrently. If you have any warnings saying \"this async method lacks await operators and will run synchronously\", then it's not actually asynchronous and won't be concurrent.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"290d5ea3-4e28-3a19-8866-37060145d8f3","date":"2016-06-24T20:07:13Z","timestamp":1466798833},{"_id":"290d5ea3-4e28-3a19-8866-37060145d8f3","authorName":"Chiranjib","authorEmailEncrypted":"Q80HocW0pc1uTPyqzo29oE3f57LHzbsebnC/hi/ymQrBfkoFU2PP2Wz9GMCEtbH+IHrIDdsoptHijXMXLRfMcIEVYiZhe8fFrUf0Lw5PRbzRymPnx3eXxONDAC8zhpp+pNnSK2xKthxAsTjbyg0txOQtri8CvmZYjGiiPC30KcbdToxJew3juQYo8Z3NP05PT7q18Vghj7i+zV2g4UW9Ij0tC5M/Mmi9Qyl7OgUkphCtnPjwwsJ72U0xRo6eHs4xCcdv0smbpsynerNz2aXvE7IEo841Widupuk9/4Xtv1FvZmkmoMmFD46WHgRG0t3hUNDN47Yjjb5RbSWpLMZF9rcYqHmOoV4lBO1RifayeaVZwAKXwf2UKO6qRpLWLhov8RBOQhLu8m9anJ91+RqToBSFpUi+wLTqGmb8uuVwqXMXG7g85xKKFX95s5v+wWnx2JXIz0nlxjcZvXMMe4wt+P8kedWJzx8aTJxnmjAxWWeP3T3NY444EaC/r5WsKN6lmm+RPF5m8BhpFHbfOL9tD8w7JX7rmhbpjr0N8FkBFRBISkEw9rRG5NZ8Sah35TJP2iuTkKKwtF3fDGmsX91nvbhERS06KIBaDBQSvCC3raujKq1HidKEsDet2l8NOAURyPr8321BKWvzDkC5cO5W+5cV5Obw8Alu/tFvwvF/nFM=","authorEmailMD5":"6fb9392412fb481f785a114073349699","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Awesome post . And I am eager to discuss a problem that I faced.   \r\nOn the web service side here are four layers : controller,business and DAL and DAL talks to DB.\r\n\r\nNow from service side I want to invoke the three methods like\r\n\r\npublic async Task<groupmembershipvalidationoutput> validateDetails(myObject _input1)\r\n\r\n{\r\n\r\n Data.Upload.UploadDetails gd = new Data.Upload.UploadDetails();\r\n\r\n var firstTask = gd.myMethod1(_input1);  \r\n var secondTask = gd.myMethod2(_input1);  \r\n var thirdTask = gd.myMethod3(_input1);\r\n\r\nHere is how DAL methods look like\r\n\r\n public async Task<ienumerable<aout>> myMethod1(myObject gmvi)  \r\n {  \r\n Repository rep = new Repository();  \r\n var _validCodes = await rep.ExecuteSqlQueryAsync(typeof(AOut),SQL.Upload.UploadValidation.getCodeValidationSQL(gmvi._codes), null);  \r\n return (IEnumerable<aout>)_validCodes;\r\n\r\n }\r\n\r\nI want to invoke all the methods in service parallely without waiting them to complete one by one . Only I want to wait for their results . So I followed what u suggested here ...\r\n\r\n [http://stackoverflow.com/questions/17197699/awaiting-multiple-tasks-with-different-results](http://stackoverflow.com/questions/17197699/awaiting-multiple-tasks-with-different-results)\r\n\r\n await Task.WhenAll(firstTask,secondTask,thirdTask);\r\n\r\n var _codesA = await firstTask;\r\n\r\n var _codesB = await secondTask;\r\n\r\n var _codesC = await thirdTask;\r\n\r\nBut these are not working as expected .  \r\nThe breakpoints hit show that one by one the method is getting called from service, going to DAL, execute the DB Query and comeback and assign to respective variables.\r\n\r\nAnd then call the next one .\r\n\r\nAnd also as soon as it hits\r\n\r\n await Task.WhenAll(_validChapterCodesTask, _validGroupCodesTask);\r\n\r\nThe next few lines are not hit and the control returns to the invoking controller. That is   \r\nin my controller ...\r\n\r\n var searchResults = ts.validateDetails(gmvi);\r\n\r\nIt is not waiting for the results to be assigned .\r\n\r\nWhat can be done to achieve the desired functionality ? Fire them parallely and wait for all the results to come back and then only return ?\r\n\r\nHere is the stack overflow question ..\r\n\r\n[http://stackoverflow.com/questions/38012332/async-await-not-working-as-expected?noredirect=1#comment63476795_38012332](http://stackoverflow.com/questions/38012332/async-await-not-working-as-expected?noredirect=1#comment63476795_38012332)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-06-24T18:19:23Z","timestamp":1466792363},{"_id":"0ca47572-0d99-34e5-a51a-940a4dd4a88f","authorName":"Chiranjib","authorEmailEncrypted":"V3SGpRrCI15Z6WCtspYAjtQACVj6+MlWFhnwVk9RsOgAWpp+CRiBnt7Ru4sRwr9B+asMYIL9HW4KcmFVgY8ulH37ic/AVHK7VTelxQC4dKZUaE+MVhOgUN1oebBbd/tkIe48Wuw2xX8Q6KHKmyO7MESGYkvG3bkR5NNGeANeb/HuZPGgCvKVwRkGxVxe4qCoGUa9TpbENmrMBv4z9xhu1IFkL4YaaOcqqJVl863vZ3F0OoOvf79zFbChDKhZvrYAHWIIcWHr2xN/Ncp4qhlWNG5O+ja1nIK61/urVcrysL1Vla/v5DbLHmVpFdTexfMLMybY2vsaia0Qm0gxi89Jdwq003unsLovDfcD685BcYmxHp1sxjVss+eTowSwlgDCQvSxRvr6qRIvAFQ4x+0k+o5pMHE+f1euRcdjSCKiAZ7DDW3sJlePQnv7yabv3S0EgXssScTe2jvDCdyXgD8QWP1vOqs7VF62WjeYZvOXSkxc9LPNHePEDtBVjqYfvsOv4G4OR9XfXII+s4olnxfPMRmU5JTCQaUuHOJFLVKPQ+2htlh5XvDhYGX167j7asRHzbhgvOadP6Uni8WkyUu8sWHpMd+hrJvhSKnt/4B022ym/cx7nTOm0ML5jzJfSoxLnhovMqG7k4xW7I2kCvNgU/Nt7qnJQXnh7HWTjAkZFa4=","authorEmailMD5":"6fb9392412fb481f785a114073349699","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"I put the breakpoints .. for each of the methods .. once in service class. then in the DAL class and then finally in the DB repository class. But as far as I could see once a method is called and the method call break point is hit , it immediately goes to the next DAL layer break point for that corresponding method. But accordingly , should not all the serviceclass methods breakpoints be hit one by one , and then the Debugger move to the DAL layer for any of the methods ?\r\n\r\nAnd , the main concern is , Why is await.WhenAll(task1,task2,taks3) immediately returning to the invoking controller ?\r\n\r\nI have not yet got the results .. and hence I am inevitably getting null as the controller returns results back to the UI side ? How can I avoid it ? Wait for all the tasks to asynchronously and then wait for all the results to come back and then only return the consolidated result back to Controller , so the Controller now can return successfully to UI ?\r\n\r\nPlease help.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"116137f5-c2b0-3b36-8f85-729a3b46630c","date":"2016-06-26T19:11:04Z","timestamp":1466968264},{"_id":"f2550fe7-c88e-317c-812d-fd4e6d4aa4a9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Once an operation is in flight, it can complete at any time. It's entirely possible that by running in the debugger and stopping at breakpoints, you're slowing down the application sufficiently that the operations *appear* serialized.\r\n\r\nawait will immediately return - of course it will, that's the entire *point* of await. It sounds like you may be missing an await in your calling code. Every task returned by any methods in your code should be awaited at some point - if you find one that's not, then that's probably your problem. (A good first step is to turn on warnings as errors, since the compiler does its best to ensure you always await your tasks. It's not perfect, but it'll catch a lot of them).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"0ca47572-0d99-34e5-a51a-940a4dd4a88f","date":"2016-06-26T21:03:50Z","timestamp":1466975030},{"_id":"5f80491f-e0ee-3ac7-93e0-278e9e846b99","authorName":"Fernando Ott","authorEmailEncrypted":"Aza0BTPRZ/IDgcDFfetMxcMbxFyp9R6/8RA6NqfB9rso7zGarP+MP+UULR4/d4CKhlLmPU+V813Xu/YpkGAo7iiVNw8VQMkwMcyD8VKIBIC1CHoDM/XDuN7g/yKAm/S/TCOJZ3SyR0Dtk9pUWElHObU0LgG7vmlWBHwDJ/2i4nDyRI8SozQXY4UqwYixB0ej1jVK/BCMBlR7ywAW9AKo52VhyWLV205t9/hOEJU5SI9U/ICWTfVEZ5aQJQ0/NpboOuD1CcFdSjHJDl7notKVUj79C1+FhGkkz94BoX3VCimvlFoL+4fjQTp2XvHHitHfdvxFjGZL6V02yq6MJUVhhdg3kWJz/HTgJYOtJqpVDQWs5bfAeFOVTCbBBtrOO5dTC2V6ep+BU6ZAQDJQ7E74sfS+uTZWXRDBWhlsxSUWUNmHXb5jVJlWIMdl976dq00yVIsknPZ2QFZP0mXFuQ5d+7eBVrciwP8awUG5RSGRQkwZdf4Y83n10SQVH2eajlk15tfTgfAcK/FS45/QsH+QpVbiNzTR8jio4mZlarjoHxOMGKb3jqd2Qv5atCKevkEXDBDrMzC5PRxh7S+T6cEfwEmiFDiSRZffPcwu6tuC8wOnVANjvkdvreHqXWNmlndp6LEOx7B8CHL1Sh6/OCViiV3ju0OKd50Nitsi7VMPJtQ=","authorEmailMD5":"7f6e9b7804a4802a1de4d87f40d2b3dc","authorUri":"","authorUserId":"disqus:fernandoott","authorFallbackAvatar":"","message":"Thank you Stephen. But this led me to another question. How call async methods on a constructor, when I can't transform this top-level in a async top-level?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-07-27T22:49:23Z","timestamp":1469659763},{"_id":"28640e2c-d533-32bb-a2ea-bbb220983e06","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I have an entire blog post on dealing with \"async constructors\": [http://blog.stephencleary.com/2013/01/async-oop-2-constructors.html](http://blog.stephencleary.com/2013/01/async-oop-2-constructors.html)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"5f80491f-e0ee-3ac7-93e0-278e9e846b99","date":"2016-07-28T00:41:26Z","timestamp":1469666486},{"_id":"07135cab-780c-3f04-a634-790fce7c5031","authorName":"7yhnmju8","authorEmailEncrypted":"VX8MAIa/8NoPP7mxXQc9phuCR5CuOgC17WNPSPbEVXx14YS4br4H2k3G+H14TQZCk15Ieb4DH8h6seTcfa/jG1r1c4io8ivttgfMPzLxcYd4hpIs9MHx3QmaakYlgsBO597PpPC95zbYAsx1GoGk1EX460bvUEihu1t6Ob52Oj2vEOtdQY/4CJqtCJftIM8lPzBQa8ZDahib74zoeoh9oAvZHc1HZN4bugTorIeyoLFCgKQnoMUAeKIut9T4TcWiuJBubxodvXS5qvbDTZNs/bxkdhbl3SFaoXq6EVZOf3V0znspKuwooJgo6l0h0rnHLMkD2+pWFj5o81M5+JuThyEPUY1tD582WN8h6izzDVhrYIrLZhRdok8AePnvnzb4Yxh7ghKYZu3QrdWsDDKOVxaJANSLWsb63QUk+4oKJeqActHMR5u73T0P8JVvAadLeQ9gpsGZgtF1xdZz8Y8ixjzGigpUH8Mz0ABjP5yfSfC2alhhK/Ne8K8fmzJdspRapwJTuIZq6ma3OAurpgISEynZvGKtorJXgywGEFJNdfgDPkxqoKgPqHkf+E2Egai+iKhl8KWIiuqDLttTCR5j7BIJYHK5veoyecBcDixESkzf2PiMpop1ioqbWnUMbRy5OJrwnBBViapUexpf1OT4q2Ih3qCPLox3Xz173bdi8qU=","authorEmailMD5":"b5cf36781e9edcd70b36dc54fa32474f","authorUri":"","authorUserId":"disqus:7yhnmju8","authorFallbackAvatar":"","message":"Thank you very much - your posts around the web have been a great help the last couple of weeks. I think I'm getting there, but I have a question about handling mixed code. I believe this example illustrates it - ideally the database access would also be async but right now is not. Is this code okay for a console or ASP.NET app? Is it helpful, or should I just use synchronous HTTP access? It's async all the way (no Result or Wait), but potentially doing a lot of work in an async method. Is it bad to have any blocking io in an async method?\r\n\r\n``","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-08-24T16:34:47Z","timestamp":1472056487},{"_id":"0a1e8f4e-033c-3250-a7d5-22c59ca85a62","authorName":"7yhnmju8","authorEmailEncrypted":"rabXTkxtsWiUqde8VyVrTu2VWJZrneb/UsU/zDuIxT3hFKqgy+/1PxpeMoq4qOpwPJFhRRPE92eHrY5hYSMm2zR8v5qM5Z3ejFupP/tyTQ5sz9q+jxi9NNlPxfJGE+cPcT5p50rz6kkuRHdGoPQRYhL1FNgt2fzhSTSCyaIawk38hxrOGLZazAe/efeMnxIshaFMPMlQ/1otjC1CWa98DQ9eDTsdculO+T3Mpo7d1jBNuQXyOdpCzt9ihmFVE02H+7ulLgkKPcq3+UU/04qjOgqqONWPSBnSlDEmD5wyaYES1Ld0ZuEnJSK2vHTOrhQOagP6gH0rVGjwe7eexhotUt97bKpaIIGEsQsiS1hvMDvdlM/kW1eD91b4Q6jeCtwtaEwf4L/v3tK1EAGQL68grgI5Mf1VbbJ++FbQSHKt76v03jcI23+tL70W0ltxm4qxVbXjghXXi1ulkT5tUcM4Okdf7ELeF8YtCqZQFK4mze46ufuHBiTZvhxvZ4yFCldsQOQsrJ8ZV3G7E+S5GHlgNEsFgy0gvGgjBRJrw/CMMmxuvY2pX9f7eXaiFtzCLglEW0PPgijRKiKBWi/86y86IJi8oChouxsPIolO3cat0w757/khkmPtKE/+WpwaYfLysbioe/1bQdbrB3spgI9R8o1fsbKrpGQnvmog2p8DXjk=","authorEmailMD5":"b5cf36781e9edcd70b36dc54fa32474f","authorUri":"","authorUserId":"disqus:7yhnmju8","authorFallbackAvatar":"","message":"Yes, I remember that post now, too, and it helped inform my reasoning as well. I doubt there will be an UI app, but I understand why that matters. Thanks very much!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"34739fc7-bd82-37e6-a412-86dac1077d1b","date":"2016-08-24T21:24:45Z","timestamp":1472073885},{"_id":"34739fc7-bd82-37e6-a412-86dac1077d1b","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"> Is this code okay for a console or ASP.NET app?\r\n\r\nIt looks fine to me.\r\n\r\n> Is it helpful, or should I just use synchronous HTTP access?\r\n\r\nI think it would be helpful to keep the HTTP asynchronous. Making database access async is more debatable - it's only really helpful if the database can scale. But you can generally assume HTTP servers can scale.\r\n\r\n> Is it bad to have any blocking io in an async method?\r\n\r\nIt's not too bad; I cover this in a blog post here: [http://blog.stephencleary.com/2013/11/taskrun-etiquette-examples-even-in.html](http://blog.stephencleary.com/2013/11/taskrun-etiquette-examples-even-in.html)\r\n\r\nI would say just add a comment to your method stating that it has some blocking in it as well as async code. That way, if it's ever called from a UI app, the dev knows to use Task.Run. It should be called directly (just like you already are doing) when in a Console / ASP.NET / background thread context.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"07135cab-780c-3f04-a634-790fce7c5031","date":"2016-08-24T20:19:06Z","timestamp":1472069946},{"_id":"4e027b4c-adb8-35ac-bf23-62d27d68a0ce","authorName":"paolo ponzano","authorEmailEncrypted":"Ig/FbY8OIwqN/ArKNxgtZkezL5jB6KNMqEwan8n1YW7wzebiVlhcS3cCAtezuTfDXz0q/qfkBiF0k1iSVVHG5gO41NfUR50Xj7tNbJgHWHTqhmWRSkkdI4WPleD8MGpQw3Cm+Qw0EAae+WhAzk7hc1degWAEk51hE+EgU3Hl4AsoAJ9qeErFGRWRXOAz1UOvVCLp4biqyO7kfXIukzsSaNq5WAbv2P0BYvwZLoPGyARYMIFhwFqT6mJt40ePSAGVcA5owuWdr9Fe04LsOJtZTwVNdBgVtK+fQ/mT4dA/VdAB29fFiKy8B/C2nhB0s20JOhmhPliic8UpyFaCUGRehsXkhpi6NEUIKfhcdoY4R2z0o5tUoi494YUMVeq+mVbb8+OJzhWbll84CUESaKbZvIhtWA1h2isnP5DJ/pwpoZrP2oE/QF3f6OGjJDuarOd1pBIMAkfV7t8Snso/pi0FiSHP7RhYUzJJsN2mnn4hyGm4TJUoKRyG2LJRkd4GYrxfAHY9btzqiKvy85pW6oENVtsb9HgrwAq0TaJXI3ItWMkmBBWxnrqysYIwiR+Bdbk/+z7gCanKtQh4arDu5wSmdaPkfCjztw+L5dnTmnUV3SGWICUDVjjVhAJOfIN/y+Al6cafSC5xfG5CFqH6Q7O3YcXEr4tDWt3Kpi0h3jVJGiA=","authorEmailMD5":"6a7ab997c42f99015f3cb779987ab080","authorUri":"","authorUserId":"disqus:paoloponzano","authorFallbackAvatar":"","message":"Excuse me, I've read your post and find it really intresting, but a Thing is not clear to me...I've got a WPF application that uses Catel as MVVM Framework.  \r\nI've some services as\r\n\r\n public sealed class CurrenciesService : ContainerServiceBase<currency>, ICurrenciesService  \r\n {  \r\n public override Task<currency> GetItem(int id)  \r\n {  \r\n return GetItem(x => x.Id == id);  \r\n }\r\n\r\n protected override Task Init()  \r\n {  \r\n return PerformInitInternal(InitCacheMessages.STR_GET_COUNTERPARTS,  \r\n InitCacheMessages.STR_GET_COUNTERPARTS_FAILED,()=> CommonRepository.GetCurrenciesAsync());  \r\n }\r\n\r\nprotected IEnumerable<t> Items { get; private set; }\r\n\r\n public async Task<ienumerable<currency>> GetItems()  \r\n {  \r\n using (await asyncLock.LockAsync())  \r\n {  \r\n if (IsInitialized && !IsFaulted)  \r\n {  \r\n return Items;  \r\n }\r\n\r\n try  \r\n {  \r\n await Init();  \r\n IsInitialized = true;  \r\n }  \r\n catch (Exception ex)  \r\n {  \r\n IsFaulted = true;  \r\n ServiceLocator.Default.ResolveType<iexceptionservice>().Process(() => { throw new DefaultException(ex); });  \r\n }\r\n\r\n return Items;  \r\n }  \r\n }  \r\n }\r\n\r\nWhere I can I use an async/await pattern to wait for the result, but in some pleces I used this\r\n\r\n public string Description  \r\n {  \r\n get  \r\n {  \r\n if (Currency.HasValue)  \r\n {  \r\n var item = currenciesService.GetItem(Currency.Value).Result;  \r\n return item?.Description;  \r\n }  \r\n return \"\";  \r\n }  \r\n }\r\n\r\nIs this ok? or can it leads to deadlock?\r\n\r\nThanks","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-09-02T15:17:00Z","timestamp":1472829420},{"_id":"4b29f3b0-a22a-30ba-a701-37d4c0ff7637","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Then I recommend you use NotifyTask:  \r\n [https://github.com/StephenCleary/Mvvm.Async](https://github.com/StephenCleary/Mvvm.Async)  \r\n [https://msdn.microsoft.com/en-us/magazine/dn605875.aspx](https://msdn.microsoft.com/en-us/magazine/dn605875.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b1a145ac-5e2c-3529-a1aa-a008e1a340f4","date":"2016-09-03T16:32:23Z","timestamp":1472920343},{"_id":"b1a145ac-5e2c-3529-a1aa-a008e1a340f4","authorName":"paolo ponzano","authorEmailEncrypted":"ro0xR48Hgy3K29vOTcEPXV4PKdOTg9CI6sS7UtWasOry0GCSvGhZv45MYih6S3yX+9Zz7NcoMW+rSqQ6uUQ85fHe5NWJv75L4nYBKPQfHINcccC7OMZ7576Z0BkInWppCCwwNbraosNt/UnIMDoGteJPD/czx9DDuvS6UaHPIFZopBaTbE+N/x5DYnwrYmxH48x6394SHmjBlXLF67IjAnvNZp2WP+9PiWpOyBMj85jXCVIRmp1EVWJuXh+q2Qy915/YZTEQCKVHRQr3TsSo3kAhLV9cpOxp5MJqKXu9gWQNPngo3lmy4gd25KSmXF5CZg5hCRY+yGveBdRyvpPq6PERJTUs+xppi+aPQ0+7hXBKor0YDkOkf3hhE99TYudWpsGaWtBXBOCgY0obldlXkhHcDmMTaU1NNWZmrFrkHof3lvbxF1Q8HeY2ruml6h+AgT/k09PCdIP664kIXrZx6yMHXxrg9Zzl4M96j8dXchYB0fhrsuGowDf+8Gr1w/BVq647RIA+PnUAq4gl+7MoIw/L4CWjBwk1anxgCydY37eGV+tR6fBTYCZ9M9vYSUtJ3o2zpLvawu4h1zZu+yn+t7kS3hDYI+4yIEqdlyGdPW3JLp58oeg7bqrqPBnG61Nh9GIRDf3tETFnSyXhYQDdBAVb4PdSvXE5Kd4VNnDRDMg=","authorEmailMD5":"6a7ab997c42f99015f3cb779987ab080","authorUri":"","authorUserId":"disqus:paoloponzano","authorFallbackAvatar":"","message":"But I bind that property to a xaml item...in that case I can changeasily it..in behaviors or converters no...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ceb9cdd5-2787-35f4-9b20-c4b673a2a3de","date":"2016-09-03T12:09:22Z","timestamp":1472904562},{"_id":"ceb9cdd5-2787-35f4-9b20-c4b673a2a3de","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No, that Result call can lead to deadlocks.\r\n\r\nI don't think it makes sense to do a service call on a property read. That property should probably be a method. For more info: [http://blog.stephencleary.com/2013/01/async-oop-3-properties.html](http://blog.stephencleary.com/2013/01/async-oop-3-properties.html)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"4e027b4c-adb8-35ac-bf23-62d27d68a0ce","date":"2016-09-03T12:03:22Z","timestamp":1472904202},{"_id":"2602467b-9cc7-3338-ba3f-d12b537eff03","authorName":"paolo ponzano","authorEmailEncrypted":"FyCJ7kHoWdbe/z9RnUrXzCfecRMYo9QYLdEUNClceFdJbvUtIiBMzNf/xh84fk32DN45Ake2xhkuvp90aWEC7AjMA4n7XInb7urjLFJGjE7pfds4VSjubrX7UC2Ux65MpInwZhdRShEEtoR5BfUpCE9ltFPBgzfVYjO/+XR4/DnAnjgACgldGNc4lxr+U6hg5yk+EazxnwLyY97YjasrkhPPPiTuKqlmsE5QbMZxSoDH5cKxB42ta/9R822Lh0BrqGmBvBIHIx1CQRCUmX+scKxI5yWUmj67HVck10coJGRJDEnxU3KCS2n3CdhydE3pPe2OjOiqQ7amH9W0T4LjtLg/nNDBMkEEWdyl1lEqAqDzqBkTaXKA2515OJyUfYID1s1rNTvEI8+CVLNZAmUCsOaNs6QWGtMRDrKA+v22r6Nzjo0dyzIwPhQNNJmA+zqCzADNLB7ghq6fg2N0blVT880ypO51dMkP4r/oT8ZXGs7uBp+Gp2b3A8MJxuYU5STqTexuHDqkyG/deKGl09wDzUTIMC7QXL5dFKI7SMFvnoRK08zkYxUjC/GFGONKmVS0DdGzK54tc2NG/N7fP0KW/5Wtr9eW+M2jmROg8CcwXtd4+vi6u5R8dxp1EdIUOs0IQd4gtIdLAWF9zcRhWZPYxL0Z/9dx/EK8NkZuWEDbdow=","authorEmailMD5":"6a7ab997c42f99015f3cb779987ab080","authorUri":"","authorUserId":"disqus:paoloponzano","authorFallbackAvatar":"","message":"Hello Stephen,I've read your great post on msdn and it clarifies a lot... About notify task can I use it in wpf behavors ( I register the notify on attached event?) and converters? ( how do I attach it since I've only got covert and convert methods?) should I care about de-registering them since they can lead to memory leak","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"4b29f3b0-a22a-30ba-a701-37d4c0ff7637","date":"2016-09-05T19:16:16Z","timestamp":1473102976},{"_id":"1e04dda7-8e59-3f43-a57b-e4f90dd2b4fe","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I recommend that you simply *don't* do asynchronous work in a value converter. There is always a better design.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"2602467b-9cc7-3338-ba3f-d12b537eff03","date":"2016-09-06T02:25:28Z","timestamp":1473128728},{"_id":"94c52a81-918c-3d83-b4fd-6dddc828d2cc","authorName":"Jason Shuler","authorEmailEncrypted":"F02pWGafONumV/4Yudg4eouo8fYjiyHS8wBxT/0kvmwWAGnBFYPK+2xA4DuZiA5Nfqlqbd8g+nnCG9B3DDHr1Ucl8JNNj6Ak33UTf9u2spm1wt5xN2zQkwXarfIKHdUdPIAWVTUFBMp17IFxVQlcojU/g1R4sgUWW1QYFanAYAeIKcbPkE0vke3fJtAdIGNFk1zk1h1KEpVwIF4iCTR1n1xZBjrCHBD+2X4QbQOw+teYJBmukPf50TJwjt0P6L35oSYtcliWMlN8k0EWJFY3dH+F981Mwfb/hxeNE6hRpXTlPmzLlk4qGAP/bZD/1Sx+SWdIra1eRWZGImllqBlTDCzVzH9X8pEm5BD0STP9rg8Xr7iChZr6Q0gJZcO/4X4nRutKNCPRjbZ5FeFiIfGyrBd/p98SDD/3szFe7A8HBTWsjjqNhwjDYowzF8C8dbzbvwmRTmJwKm7xT0esaTt5FTQoeS+G2FJ3DP6X6fVUcR49tLrUCwimrjzGM1VUDWWwgXtoYuix1Ulhm0zGANXGdW4FoAhuKB7ZwDbpLeUciVwnoWd6+T1jh3ObLZysWXBbP6MPhikjUgQRlfGaqj18eoupwcgVmGfvuUUEiEbYxtRjwDxbd1iK/7sjULzS7YNuXLJdv9s0wlwWB3hI7sHsb7cKOVbuSN88fKGd3os1BLc=","authorEmailMD5":"54072bce77fea3110f906f91a705fa81","authorUri":"","authorUserId":"disqus:disqus_Tff2hDjHfb","authorFallbackAvatar":"","message":"Thanks for this very helpful post - I do have a question however. I have encountered a situation where I have no control over the library implementation, and I do not have the option of using async/await. For whatever reason the library authors decided to remove all the synchronous versions of the methods, and I am implementing an abstract method on a base class that cannot be defined as async.\r\n\r\nIt appears that using the following avoids the deadlock:\r\n\r\nvar t = Task.Run(() => problemObject.ProblemMethodAsync());  \r\nt.Wait();\r\n\r\nBut I have read that this may not be 100% foolproof - some people suggested that it still could be possible for the task to end up on the UI thread and deadlock.\r\n\r\nAny ideas?\r\n\r\nThanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-09-07T19:24:47Z","timestamp":1473276287},{"_id":"4226db98-b543-3cb4-bf1a-57dacfb4ba52","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That approach shouldn't cause a deadlock (assuming that `ProblemMethodAsync` doesn't send updates to the UI thread or anything like that). It *does* assume that `ProblemMethodAsync` can be called on a thread pool thread, which is not always the case.\r\n\r\nMore info in my async brownfield article: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)\r\n\r\nP.S. Use GetAwaiter().GetResult() instead of Wait() to avoid the AggregateException wrapper.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"94c52a81-918c-3d83-b4fd-6dddc828d2cc","date":"2016-09-08T13:23:50Z","timestamp":1473341030},{"_id":"2490bea3-46b3-32ac-b94a-befeada7ffd2","authorName":"Chris","authorEmailEncrypted":"EzdIUOVUkh7Ld4aXYfxF4cv9XYCSoFAGgwcrPNMoBDchw81D+rE7oEiD8a/A3fajsEL0OwQHNLRrI91Jec3+E7GrGyzQssRTRBzpLV4BHKL+2Rr/CkTpRxaVMzLqAJuub4HSUf3U1CpLmJqJAmRMUJ4h+a1xoEK/9PbEZBAM5Ow7YzYPJNc5wSUKt/ULyGf56kV3Z3FDv/VX7ZM2KweARo+ZD8T3AR1/+QRWkgw0HiDcg0dRYZvIfvi1srJyOSqcKad9bQ474WwO+buP7MF9GCRpLr3VpA9gC46ToMEPFuGAb1h1+eCxVP2l8JaOPF3q+OnETsCXS80LTfpH0+m1k3Q47SJFgIn3sLF9eIIOrAvNx40UdRFujNb7ylR15fznQYFJVtCuKoI1aIXyOsoWfL9QZUr+0QgCT0CylahkEiIRf3XAvV5pzydBwZgUUviZed5q+zpB1NuARZPkL2SLp17ttIgMFbL5K0QzWdFkQuGud6knnAeNHfopebjANt7uraynHyFrWWGDMdP4CU0xLzB4UqLH5xoScKJMf7FTGbBXp3i5/+1AvhkrnnSzhQ3y2V2C4/t07T28Go6sQ3zK4Hp8IDVVlLTpfcSKCnE8xbpMC+n+XKBWnHvS+7faKQqyGs4uk1NdH7QNQggDaineX4o3iNy82XvKvlPLzBLwwtU=","authorEmailMD5":"ef7d53197de61d61cc22af343d2a6be8","authorUri":"","authorUserId":"disqus:disqus_mGiDRzy7cd","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_mGiDRzy7cd.jpg","message":"Hi Stephen, thanks for the great post.\r\n\r\nTo develop my understanding of this I have taken the ASP.NET example and put it in an ASP.NET Core Web API, but it doesn't seem to deadlock for me. Should it always deadlock or is it just sometimes? Am I missing something? The code I have used is below. Thanks in advance. Chris\r\n\r\npublic string Get()  \r\n{  \r\n var jsonTask = GetJsonAsync(new Uri(\"[http://ip.jsontest.com/](http://ip.jsontest.com/)\"));  \r\n return jsonTask.Result.ToString();  \r\n}  \r\npublic static async Task<jobject> GetJsonAsync(Uri uri)  \r\n{  \r\n using (var client = new HttpClient())  \r\n {  \r\n var jsonString = await client.GetStringAsync(uri);  \r\n return JObject.Parse(jsonString);  \r\n }  \r\n}","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-09-13T02:41:32Z","timestamp":1473734492},{"_id":"d760cfce-e6ad-31d5-91d2-4c2972ac62e9","authorName":"Glushko Dmitrii","authorEmailEncrypted":"Y4Ay2N9rXaG5IwM11DcvdPlZpriQe5KZXyMN4etyepl1fdvuEr3/VFvZD6RcgKYwJYIx3w2lYQ3FvB4iUYvV6FJZ+jrh9CbaScSiNtSd9Y1I5oTWiX9PZ0tcbQO4EOh5z0jILiJUiolev1BqfDMvydKjJGIHxdlttsVOFaVhMkFW8isMd7tU8wVwwNzMLkA+Ku81JWwEDszyK8O56R+rwDw0mjzYEAer/Shv4Zez65lnwFFdw/TSktwRFBLFbZhnAlLvcitdyNxtRMmaN5viCCc5WVTK5LDzbcLGLvT65G9x18/ABueTveIq9mofdLz0ENCJwzVd1amB6THdsEHrHKRHF37uWtmsoLdF750PAl+wqG1XWTHFntUhiZGKnRIdcICp8ASUUnrIKC9bvLY2byL4Fcd430wm7zQMKQt2olIJ3QeBwYfoUt3TNhTGbEWMJzBvB7WmKYr2OsF/mxTcboIHSMEo6z15Efujzz1N0BbMbu54th89lrceBOYLJLVRo2vm6u91c0RTBNv6yZP3Wqw4enSPxpu0eEG/Lzj/EnylvLJ2eZWTDKsOxs4NzmrhghCOMnpW9kxfl9xSPPWD1rnJxpMlWqgCpdUqg64q6x2XHf0rhWwmVKgcoAfvFxpE/mloV//bUzBKB5NnsFFj/5mz8aCVoqAzT1aMcI0qwqg=","authorEmailMD5":"0c2435c87cdce899d5ed83562c8faded","authorUri":"","authorUserId":"disqus:glushkodmitrii","authorFallbackAvatar":"","message":"Hello, according to your post I need to use async all the way down. It's not a problem if it faces page event handlers, because I can use RegisterAsyncTask and create method with returning type Task. But what can i do if I face overridden method (from external library), and that library doesn't have async method implementation? If I use Result then I get deadlock. Is there any proper workaround to stop 'async all the way down' and get a result without deadlock?  \r\nAnd can someone please explain what's the problem of using Task.Run(() => foo()).Result ? Because foo is calling without context?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-10-19T13:49:25Z","timestamp":1476884965},{"_id":"7a5c3eef-13d0-323a-89fa-da63d7fc9c99","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If there's no way around it, then you'll have to block.\r\n\r\nThe problem with using Task.Run on ASP.NET is one of scalability and efficiency (and, as you pointed out, that the code is run outside the request context). Most (>95%) of people using Task.Run on ASP.NET are not in your situation; they just want to \"make it async so it can scale\", and don't realize that by using Task.Run, their app is *less* scalable.\r\n\r\nIn your case, I'd say to first request asynchronous support from your library. And second, use the thread pool if you *have* to: Task.Run(() => foo()).GetAwaiter().GetResult().\r\n\r\nMore info on \"brownfield async\": [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"d760cfce-e6ad-31d5-91d2-4c2972ac62e9","date":"2016-10-20T13:34:55Z","timestamp":1476970495},{"_id":"a56bc6f8-5c31-37f8-bb36-e97917326f80","authorName":"Glushko Dmitrii","authorEmailEncrypted":"WMudZ/ziWPmdK1jP8oyRR+8TiBSienf9OAGksYH61e3DIfMIYsBKFLVlflFlljwMkWDFysYtcAgfa7nUtoF2acL0REdq3p1r4cFESEapTrvvvdaEC2tH5o9s7imBfrEdnnd2pxdu5s7gVcuvTC4s+CImpm0YfT0YPe1ZMC/W5/t9SAta4YkcTlef37KVVdUrLEQtatYkbLx5jurW1ZwPQ+5sVADGTaNpSRrEp7s6vFfLzs81bXcnPZS9PmBm9lKYQu/oKuWggCpz+Wp2nMaRsWw+ib8k5cnRwdFIxEjfvEGigPJfCJnFxqxBu+2z03PMwIIzsdNuY8pJvpxC3J3RW+x1o3WfLZoBeKa+uU8EEyv2+XPzqfZbtXQGPixhpVOyH9AnoQRhOs8R0rWXbdtEYOhWR+PnrwMATUGyHE18puf4AXSU5eBx0X8Yj6lyAjzvxBP73/T5nJYYfFt9VnKpenVv0v18t2gmEnGAk8pJUivVAJpSzcHH8OGMc2rgs+HtX9kuZXvIcn6KjR0SG6O2yqyw/SqDoli8B/XpbAC4yCy6ZeRjsDainoNRLlM/68HZcSbnjW7OxYI6AiX1UNlBGyJUrn4Gs8pgxdEVtUaQclCB4TXutbRsxApbJKgAP3S6ytbqegLsQ8rKxw7pqu9Tw1BL47erJLtcn4iySCXVkxw=","authorEmailMD5":"0c2435c87cdce899d5ed83562c8faded","authorUri":"","authorUserId":"disqus:glushkodmitrii","authorFallbackAvatar":"","message":"Thank you very much, almost spent a day of surfing internet and came to the same conclusion. Just wanted to know if my conclusion is correct. As I need my program just to work (no matter async or sync), I will use block for functionality that can't be done async, untill the library will provide async support.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7a5c3eef-13d0-323a-89fa-da63d7fc9c99","date":"2016-10-21T08:30:32Z","timestamp":1477038632},{"_id":"58fdcd04-b518-3b44-bd61-6bc5bbcb89f1","authorName":"Adrianne Cris Ledesma","authorEmailEncrypted":"LlQCFluX6EM/S55QPpJJ898J/N0iwpqlt2y5zD98CxbqKccRwC2z3buRWaL5ZWYyZjJf3JQlfhi2QTDyvkK0mTOutIsYYjfH1UzJrv4Cak3P1qfVGsxoUuGkyxJ37Mfr4weQkOJzNI8HDaeZD21CUwtxno5yj3o88hjElmNGrkMmkP0zglPdAVv4gdjzzgieTIT/iOIOWnWo4Ro8fiEt4gdAjxs7b30TiuPcBxLuNRAWXiaomSIGl1+M8CLP3jlWJbk+vfSV4DZK2f+i9lWPWTJ38jDm1wHR6208DBeIG3W+MEUZWlzj9dRhWxUrqqkY6G5k1N0vv55IDCoIFh2VeEQyalyVURt2B2qyot5Obh9ipxHvwHa8cZwX5EgRhmHjdyWZfYXAnJkzYk7nslG+B9QlQl2h18n4BbhgEOSqVpMyiN/L6gEM/c8ZAgDlnV8j4eImij00p9OswINvTAq4rKMJJILWdBJ57jVQP1ouKTQrhkuSkmJDj0uGscDiLrbNr+W8zdrJJJBqg/pc9dM0fFdEND0bH6Rqn3GY/Blv9wkIIxeBYUn5VXN/KmN0dS77k6iPSVgbOwy/zWrecloFfhq9FKi3MSa3O4Fu7v3Ar8buJJEXCkBsZaqcqLeZuKX/bPfQSfNw2eMNJ/xQoRzQtma6G1BX11nJB0t0eV2Vd9Y=","authorEmailMD5":"bf6450b2e9ccf089a96c84aebd6a4da4","authorUri":"","authorUserId":"disqus:adriannecrisledesma","authorFallbackAvatar":"","message":"Hello there, what a fantastic tutorial, I have followed every bit of your instructions but no luck at all, it still block the others. Can you help me or point me to my problem in my Code? I   \r\n\r\n``  \r\n\r\n------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\nAND I Call it in the click button like this:  \r\n\r\n``","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-10-28T03:07:56Z","timestamp":1477624076},{"_id":"388c91e4-8d2d-3647-90c5-6020306e07c6","authorName":"Ryan Griffith","authorEmailEncrypted":"nyIyPRxehmWdYDI5tfdj9bEFVkqY0Ebo/tlNNVBN90yjibc5MIqisRdlWKzURgdP+M0iREIs+qK2/jC86g9aY9P1zNm5kX/Qe3tQPvYssrvAay3wHQZdfk89IHMblg/R+BSNODyKsx6VP1xQCkYAnoho3j047KEfMJvJIr1mzEv6LOqrDypInvtuDNDOxsqlKQWcl8DKHFqbq/7f91j/mT8VfpgMxMt/+cew4MLlIz7F9anh5Ztzmv0rm8+KmH0usLN7Y0MaIU1blWY1Bb3jKRrukMKqM4DSEKTqTKgkPOCXOKK3nndDMZCSPd3K7TDd2RN0w9WS3C1m4jN25J00i0RAU5gWLmncLItFPNaT/jj/4ex6WJtyS6DEbu4bhT79pJ3oAT5BgZ2luFEPsCjsc/MpHkXfWY8mvszjbUUQwcYhWlvBAWkA/ur2CkDvyX6pJ/MtTPrpGM1/4vfGjqGF65ZgoduhZEvKMJj+2Ogf1q58R+RqA1YKRuhP44IpvzU294fSVZ9IEoDIT3zmOe/b3+QEY0buNKZd1VaG0RKsI44QGJOJoqpkACoMoPFpNPkwdDQ1kuXV4CmbcZ/rH7AWqpipjdcnE+dYNfg9rBJA81RMYVBzPs3LIGhQ5pK5BbeNmRnXPtxx8NJHzOfIu3t7LolPZ6PZphEmXFPTLiuSjrM=","authorEmailMD5":"93c1ca5d997fbe4cdef0b1bb074d152d","authorUri":"","authorUserId":"disqus:ryan_griffith","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ryan_griffith.jpg","message":"When would you want to continue in the same context (i.e. ConfigureAwait(true))?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-11-27T21:22:15Z","timestamp":1480281735},{"_id":"889760b1-0bb7-3db8-ab14-c45215631a5d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Any time that the remainder of the `async` method needs the context. E.g., if it accesses UI elements (for UI contexts), or HtppContext.Current (for pre-Core ASP.NET contexts), or implicitly assumes that it resumes on the same thread.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"388c91e4-8d2d-3647-90c5-6020306e07c6","date":"2016-11-27T23:55:53Z","timestamp":1480290953},{"_id":"5000b299-878f-36d0-994c-454e7d8ee7c2","authorName":"Arya Chuodhury","authorEmailEncrypted":"qyaB0yFPhkeEqnSI7ud/C5Cf7+m8/dCrgM/DbfRHTfcr4RO+Yt+UJv/v/lEXBM9J7bbiQVl2IWfUupJeZMT/wv1MsmTCp/Jn3JieH5n4p7yqsqU1TPOzuL7lu7EChl/toapfoxCesB5FIpnXMe8/gXRfz9cp/8zODesMULtXttxw8YBamKS2ERmAQyCwxpLCZ/2djtz7uTQwFX3fs6MR09Dq8CWBdk9q/IRPWfk5qikqqKjaLMNCIqfpi5EbJNjQz+m/bLIcMepnRjuuz0dygDiPIZJFpWDu+W2EvphTLnhX7MSawnAozsTLjj6J8vMc4Mp3KnkEOeViOTVGLSrD/wM9zZOJa3DsRze6bEJXWXD7QHb2uZhNylr/JbeIf09TJ7R+WqotanYZbvOTk8xH8IlIkS84TuRFg98jzaxrkA/E2/8XiPAiEbBUa5iWJJpEpzN6uW5OJLbg0oHASt3nLEy8VBzkqvnauNf9rYQUL4I6/l8T8q0sMVNuVXsjVg6RP9LmPR7Qeda1P2AJCDuqTmVOcZXNBpevYPi2f3I8WYzFhOxjlLVppSdjvGiI4qfIPrF19PMhVXLvWIg9kk8z3vLvNJ/5BkIhRT/MJFA42idgAfCa+H3r4Gb150Mq/DIiHHTlvA3jKdyzlO9ljEMLHAEVJWQq7ZxkdY6fWwvSyAs=","authorEmailMD5":"17d6b249f2320c161be56a97b2056c58","authorUri":"","authorUserId":"disqus:aryachuodhury","authorFallbackAvatar":"","message":"Thank you Stephen for the excelency","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2016-11-28T02:23:17Z","timestamp":1480299797},{"_id":"a460900c-1e60-3451-9812-e44f8eb79803","authorName":"mkazem","authorEmailEncrypted":"W/xoRJjYCzVRbZfmxNqYpR5Tmr3CrbvwNi2UnSf3Vy9TL9f8aFn5OeoYBnT5xKZDv+MvsvmjuUP9hTEG1hgbP9rCtj/IWC7EoLX5KMfNq+2flsEdCKjKHibxcxLN5bC0oCQAYjYjpAcXtXLNHXQo2Dpom3XHoOCdtkAFmtlyAlSV+P+uP5A7LS52i683Kf2kFhIV2tlk9rSqYxUWdrdtCUAPVXYbyv0aFV5LNGKA/krVivIAPUWgGGtZNDoFOSU1upSfWCRPFV4avjGauIBgjFW8E0yXfyCuWbjN4Gs+BIL5wdhtQ64+fzsEjr/X6PcAxb+3kjqx7vrrnfvv4Cpz5fWicdpaOE2c9relG9rVhlXkVt5Sd0gr4dZWXOukkro2YCAusFxcaYrl23ve5K8vSRauRAqndrOq7zC1mdpSjVxYgbOeuygRBpxExpr7tTO8HI2Htp56qRHFQYiYIqwfZTrgxzMh/EisrKZBYekF+08qbQsIvlOrG1ikmxgOsptSmvxOkXGS+ywhxSvUUnQJMtP4JlxJ7mNeQfILvWfSS6gOize6ypsLuk1s11/x9IhnYCIwT/nMzn4pjzxU1sj8IKdRwxkDXko0rLY9sx7IunWvJ1eObpOkeD226qAzKWv0e/SgtueTT4aYCHSGkObT6hu02yb0CoXx18KWQVlES0E=","authorEmailMD5":"9cb1b47c5acbdb064d4b11181de78162","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks a lot, it was very informative. I must read more on links you provided.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-17T16:40:48Z","timestamp":1484671248},{"_id":"de64cb4c-6cc9-3cd8-9a3e-e6337cfd6fb8","authorName":"Ramon de Klein","authorEmailEncrypted":"VXqLOahNwOkbzSunLPfQDdtyp+wGmiHCNJp3s4xwnrns0U+YhBqRw1c8jRVbPt2amEGLnlV+AW5+DIGZoTHgBYYNU/tj8tR45gz2WM14K1kdJoB/EFfJyRvlNbDdeR3qSvRvVEqITaKN+b3cD3E+lIINm/eAAMugBlmNBo4R4MzM0cKRQUHUExRrKx1dy6h8hLhE7JVwI4CQ00rpMdY9GEpeuxMgEy4V+kXInFnMmTkuqprGEDHsX3wW9TwV8Ngyv6mgSwfOeQN6HzsDgD6x7XhrdlZkKhvUiIJR9ZHjNnXvrh/89D/c99RUrkBpNxy2sOZDaDcX+Ces/wiLzjIP4sHng6OpGK8yMKjZLckp9IsAr91KYpFfyym2vidQTqsqBlIp402WFRsGc+dLCEOxat98cXfeD2ZkHUEaYtvV55+RnHeCtvkOFJnl5oyG7Cz37x8o50E/gy1tbjmujKBNQqroW0zR0cwe7KJGmqSmU3nxkqZBwAWH+NjSFw5xnlxzJAXIYehH2n+vZzC4OujHYWL+pTbk8nWoEruUu3ORp1TGThUdx3poIP7HZkaO1dAyjqWd2la4cvxx0YQ5Aq3RUej230cEbrQQwzZsj6Qkf9+2xYNbyBXn1EmMG0rLrQnElONdnnH/xOw1Ub3MQwt7yiAvS5mLch4tt8jfrojaByE=","authorEmailMD5":"cc4787d42130bb9cc4070f11470139c4","authorUri":"","authorUserId":"disqus:ramondeklein","authorFallbackAvatar":"https://disqus.com/api/users/avatars/ramondeklein.jpg","message":"Sometimes these deadlocks are very hard to track down. I have created a helper library to help you track down these issues. Check [https://github.com/ramondeklein/deadlockdetection](https://github.com/ramondeklein/deadlockdetection) for more information.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-19T10:35:52Z","timestamp":1484822152},{"_id":"075d539a-7b06-348c-baa3-07df93208f6b","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No; it's the blocking that causes the deadlock. Wait() will deadlock for exactly the same reasons as Result.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b5efc269-3519-3532-8360-98520e305ca6","date":"2017-01-21T18:38:58Z","timestamp":1485023938},{"_id":"b5efc269-3519-3532-8360-98520e305ca6","authorName":"SEO Slim","authorEmailEncrypted":"fwb7zB8Lxz4fspavRNOrsXMEYre1KbffuRPkOJXoRW4dkENIvZDWbL3+8g/UkrxV7FiYuItfuxKJdJS5OT/tneAZh7yTPpU9NCgfj1/mSB1QFjEfoP/tavPFI5SgDOaE8qhjsUKilOC31V71QRILvkncqLE0WBvFaxvaLfpXq73CPudch3XTRFRqE7R9/Qj7SFPYYfI2IrOfAXU7sGumSpe+ipcoKWXjf4x/KJVa6pszbLy3ZzhcHyHeW1xi6spMFh9cim8F1qLzmVEuOVT/us2JjP0xpa8DMj1kWmXMYmnm1x7yUPjGiLEn8bdCjfgIaXAXlrzt0K0MjQoGe8DvYPFRAcK4tDIvX43cB+BDCMdcDj5pDzoH2VmIRKwY2QA2pB1ub7xsb5NoXiubKlUhmD9CDYWysh98SGP/fV2xq+KNdcOGBjgaC9QvLustEXkTCh6WdaREGP2f69WNqVySDD7BQ9c++OxRyVMNgiQ9foluOds8216ZzrspNmqRKgvkEGp5nkkiMaoLSbowejK+dfVGiRoivKd821JtK690uJZcLrHEcat/G+vwdFcay2ia739HlaeR7Fg2AiUzAlOqiyFGTY4xR6cpaTkX2chCk2ssbEBfUkz0NBHS5wo+jL/xsTEh5NxhQSrNLds0YX7hHrU/vLq8zP1FwE25M8nuaQA=","authorEmailMD5":"5bce7bd9808cdfbd1c62ec6b988d0649","authorUri":"","authorUserId":"disqus:seoslim","authorFallbackAvatar":"","message":"Hi, very helpful post. I am quite new to to .net programming and async / synchronus actions. I understand that if I call an async action from my synchronous button click action that this might cause deadlock as you explained. However, what if we would just do this with your example:\r\n\r\nvar jsonTask = GetJsonAsync(...);  \r\njsonTask.Wait();   \r\nreturn jsonTask.Result.ToString();\r\n\r\nWon't this solve it too? If I understand the problem correctly this should solve it right? If not, can you please elaborate why not? Thanks a lot!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-21T12:48:03Z","timestamp":1485002883},{"_id":"178d2520-2c17-30ac-a8c7-8c87c7942ccf","authorName":"JFR","authorEmailEncrypted":"ptFbudrOIzNko3XwvLaz3yq6dyRR1QkKpCn/ZegHNp4eSxYwL6hxUoHNOg5fev4mVCYW3R67PZLKR8GIlubZ+PNHUxJqIs0DdrNiupcpB8dTIgT02/eTMMbGuYbUuHgYs99WK1uJWe/Z2xKO8u5KoJcHgA2ZQuJpNjLDj436IroCoC7isnNcn0TVEhWi2fMN9iUbXQhge9QsLQJ7Odu16NrPlVRRl/Aa19u0eIFNDseQcflDkHgvP4QKQdoegQyY/B7pROO5WW4yxLOHkfK88StcMvrxYkI6Exv3rSjpDBvF99M+C+0VP+8fk6q/j1ysGpZ42KUyBueAzqhGIeZRTyjECyMUdLAvu6Imb6l8dYcxdCyCuDhz4z999kjeEY55aNHd1hUOzqoSpeTkosDSWGX2a06Am/2Gbdd6rmqDyxl2XRHm+EpEagGrYXj+EFtwwj11fIlDP3IytwHYxUHuoVjnvWPzQw0CcBd+g2XGcre+rEOo9/xnd1tSVWi/TZQko66FIaNapip6lP5vRaYKCpjK/1i1AQbIngSmC+pOFnUPNpm8Dg2FovnYh0li6I5N0cO07lvn0dpIcTtypMetb+4qjSrRGlELwm/OY1LqAmDDKDu/xWMGgcTLz+U3rjlEkRoYi37oHlSGb/oYr2oPGjSDMdjV78vqFwAVPeN9Wiw=","authorEmailMD5":"ec2149490abc527762ddd48ce22e69c0","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Excellent!!! Saved my day. Thanks a lot.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-22T06:06:48Z","timestamp":1485065208},{"_id":"1fde2232-675f-33c5-ad09-f8888555e010","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Is there some reason CacheOutput ([https://github.com/filipw/Strathweb.CacheOutput](https://github.com/filipw/Strathweb.CacheOutput)) wouldn't work for you?\r\n\r\nIf you build your own, I would prefer the IoC solution. HttpContext.Current has never been considered a \"best practice\", and it's been dropped completely from ASP.NET Core.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"57228dd4-afb3-35e0-8c21-61a8354e5cfa","date":"2017-01-22T21:00:48Z","timestamp":1485118848},{"_id":"4bfd09b6-8376-315e-bdde-ce292ab477aa","authorName":"Nathan Bedford","authorEmailEncrypted":"nG/B7FBBROiqfGvYZqj+cfPaYcv5t05D88H+CLXGR7DaUJzeFTdLGByb1Xj8pSKyRiauv1hZuBe0xdnI+3wH4Xl9TDCb929EY5hXN5ZfFbESSoJoLhXoNV/5oT5WFpPUpG3jBQOUrSB6L5mAtKBMZczTSfcz/c4MEbgT+VeUAYChKdtKQixdeNJy+v8cm2u7Mcv2O97S0oZI1FoLtPEwJwUHZC8pA0+oxnba7GnVXfeLqK4dglN07BP1KXCf8oB/b+6MJn+I6Mfg8rYyI22HKHFuBrUEF7wDziFQrlAvkNKUtH3NkJnj7Q/oAftG62FZMEve97jPqhK1XWgBA6OE0IZKwwsu7zXDI8ZKV49e1VpTHXny+xIDZR3zlw8V2d7ya7bW4xcBuTRyDLcISoCwGlKQj77IXfcoSBqdtagMWC6jOYzb6AUdZHKP/h37l/RfWlg74lOzYHH/eWzs8j5SphcygPCEejHI0TvmqjMcVlw1XUVzyIS4TGEVINqOHSQsMKd9AG+e8stzU1yyBQ8xwnTrVuFy1A1pBYjTpbJabbp/YsTul+zu/iaeYY2Xvfa4uzXjoP88lnpI7ux3zNHREsqhCiWd0IWMH8DCSVcyiAJ12iluI/lCsSW7EwreskV7ZC1XTbtTbCIvYXoVaMQaNptrmtoMzNtUXbzUZRf9bO4=","authorEmailMD5":"27e1556933806ee470038c87b825605a","authorUri":"","authorUserId":"disqus:disqus_XjHcMS1ztG","authorFallbackAvatar":"","message":"Thanks for the response, Stephen. I want to cache at my repository layer, so CacheOutput (while cool) won't work for this.\r\n\r\nLooks like LightInject ([http://www.lightinject.net/webapi/](http://www.lightinject.net/webapi/)) has a slick way of using a custom handler to give access to the current Request object, and I could use the Properties dictionary off that. Autofac has a method (RegisterHttpRequestMessage ) that does this automatically.\r\n\r\n I'll look into that and a few other IoC solutions. Thanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"1fde2232-675f-33c5-ad09-f8888555e010","date":"2017-01-22T22:22:02Z","timestamp":1485123722},{"_id":"57228dd4-afb3-35e0-8c21-61a8354e5cfa","authorName":"Nathan Bedford","authorEmailEncrypted":"d2gwClQmwUnhpbHKVIjfuADFTs8IV3zKXxicmfPukIaNX3JzerILcBeuHtsH8rLDh8oHbR07dcYT5jeVS9tFRMq0GCPTS5RKMY31uz8npOta0auvOe6MdDiEbDe47QZeoNwOeWIh2jiI2ayWOGgxzJ2VjRXniMj9pWRGStquc/tJgSuIMEtvpSAlxwbiwkGZCfmf8TcLQab/5mpmlKGlvJ91bhP5htx1pNWV+xiZ4NTZEy80AxZX2MBbMDjxXIs8FKQD1h/rsVq4YnmFWZKq81elcZegCm4+gflKmTkst5/nDA9iHXJhwNLvuw6JKiK7k1JXQwhqjnAz6hla4tWRh7MXFMYXtiDI6mIzCqM4mSwy58f2NYqOMpve/JYebYakzpsJ7KCIhsm9T8H74ij19c13rgypO1UMC2xQIPxxHrq/ylVUjP2THD+8Cph9VNL6rdtOPIZkJ61Oe+GY9h2Bdjwg1EG/Fsom9YTKzK2g9L1P8FXEEJE5Qrnc86haHSvB1YxRyYmZXHaFfJeNIxuB0llvtED0C8NrdjS0DJA7xkiMb5a/FqJ/Fd51hkw+KZzJtmeSwDmgyifgKmllQudQ4A8rZY2On0c+wC19lGHVQVsnEK3haiNjnDy2GaBjzy/IMXePL7rPzPXyP6DGULKvV+7gnLSdfIo9HmQ5L3xI300=","authorEmailMD5":"27e1556933806ee470038c87b825605a","authorUri":"","authorUserId":"disqus:disqus_XjHcMS1ztG","authorFallbackAvatar":"","message":"@stephen_cleary:disqus first, thank you for your continued effort in this space. I saw you at the MIGANG meeting and it's great to see you are still an authority in this async/await :)\r\n\r\nMy question: you recommend ConfigureAwait(false) as best practice, and using it whenever we can. I'm looking into solutions for httprequest-level caching in our Web.API project, and HttpContext.Items seems like a decent place for per-request caching. I believe this will only work if any code hitting that cache has access to the original HttpContext for that request, so ConfigureAwait(false) will not work with my caching strategy.\r\n\r\nI considered using my IoC container's lifecycle management for caching key services during a request lifecycle, but the HttpContext solution has some advantages due to it's simplicity.\r\n\r\nThoughts?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-22T18:55:11Z","timestamp":1485111311},{"_id":"19c6a1b2-91f2-3281-ba8d-f05bee6b822f","authorName":"SEO Slim","authorEmailEncrypted":"bz5iAB1VaYnMLHlCt0HPG66HWHJvYZRVDqWQS9vyLpVHsd5JnvYeEMAuaeCfALI9fscmWoy1BQgv/cwyr7hrZoTiUnxYJsUdt3e4rAQ8xbNRGvcdq5R2q7YR1sHYewl7ijcMP+kTo9QxDs2g7JEMxDyKDcSBuXv1GhigzmCNLLDGUJZC617XkMCm6Ec0f6y2HILcuFuRP4CAsU80dmZAnUQnvupjQou3TWwuXT/Ynul6pEkfeghlKxFPHNUpKjTB190qYSkOauV7Jat9inGIsPlaAB3PhiLTJYr1wQrIrfrnygeoAmXYbce6xbodSgfJrpKhta6VBL5lflEQew7CG81Hl3FftydIzqH+jv1O+ujXB75HnXxD6k1y8+q+vev8vP4U5pJ9d7rG8Lkbfoq2V5YKmZ5MjJ2NdPsBtwBF4eD1rxYvmXmrKUvY8gHQD/V6oThgt/OuA6bFensCe9FRi8WjeI2WHWtbrmC9TOaoi5oEXXnPN6pBFi6MsJKeg/MtdrAu3XiBjlYvVtluZNtwY7USvWuiIW7MF9tHsvtpyFh+HdL6lLirKx/j9X1rjQXreSmg1cR2H38OPtSPYrxcfyCVK0NCd6HZkcq1MV7PLqcW/8i5EYTKa85qZ9SzK/6D7XHS31NBrZqUwSr/zG2aa8JNqcNXwmTo0B0a/NvfvtQ=","authorEmailMD5":"5bce7bd9808cdfbd1c62ec6b988d0649","authorUri":"","authorUserId":"disqus:seoslim","authorFallbackAvatar":"","message":"I see. Thanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"075d539a-7b06-348c-baa3-07df93208f6b","date":"2017-01-23T08:56:08Z","timestamp":1485161768},{"_id":"dd990e1e-dbbd-3904-bd06-999567348960","authorName":"Tengiz Tutisani","authorEmailEncrypted":"C071DDjta0qprC6xE0H7nEfB8UVLljQ1sZQlnlRjBw+CjFxFC16gmC5/+M7w63RFmDE4P9Sj+DB9E4JI5+5fxKxbosLY988tET8eGi7MNCSD5G1MPkSnlA+m8flLVuOWbzZdt5enzcBYbq6Y8z0sZg1sXR4ZFx0EGtPPzpMbg/IL9ysA2jAEVjYluTEXqPG3Jhi4E/Jgyi0x9AWg0Qkdz1Q0vXskL2osxJr+AQT5rm1heho3U9iTTyEM8IgJcpFoSyos/Di4mClaPaHJQ8jiqw76cG8tpveNImxqAPmGB+6kDqdIKdvReo9TSXkV56GJbbUc1zFToOOaqxhSMllCetStRbIv3U7+IAlQYqHJi1/6kVuAjNwI26zqI2qoH3V+cQjr6dsjICtINzHamMJnMz+FreS93biEFE6obW3+YtS13xSUQDdBaFTUAbSLZDDwXa4gvL5dGR771fumtyMLC0RrPSp4Zzh4cunKgNM5/2XU5xVBPzjTz5yIA+xcKrmYVeHP9afLBvuCt2BZyF72n7SZ7WfVZs5c2QMMiyU6Z9bLr7uc0htAXNJT1cmbXNWCR0JeZitLjd6XN+nECDgKAD40wAl+VKiKsAGumSPo1QdLB8Q1MVZ5tDnreCE3KBWN5vUrYUmbl78I5aa9zgkV/mPbrWzG/5/TxJXqVyDeYvw=","authorEmailMD5":"0c38a91503d5685bbee3b370fbe8827a","authorUri":"","authorUserId":"disqus:tengiztutisani","authorFallbackAvatar":"https://disqus.com/api/users/avatars/tengiztutisani.jpg","message":"Although helpful post in terms of showing the way to go, I don't agree to the explanations provided.  \r\nConfigureAwait(false) should not be used everywhere, definitely not. It has purpose, and the purpose is not 'swiss knife', I'm sure you know that. Deadlock in your example happens not because of missing ConfigureAwait(false), but because both examples are based on application types where synchronization context is allowed to be accessed only by one thread, instead of any (e.g, as with console apps). If you write your 'deadlock' code for console app, the deadlock will not happen. ConfigureAwait is not relevant to the problem, and it's just distracting in this context. If it was relevant, the code without deadlock would not work without ConfigureAwait, but it works.  \r\nConfigureAwait should not be used blindly everywhere. It should only be used in the UI layers of applications, where you want to have access to the synchronization context once the await is over. If you are writing a class library used in both UI and non-UI applications, you should not be concerned with ConfigureAwait inside the library, but only outside.   \r\nThat is the proper explanation in my opinion.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-25T15:00:28Z","timestamp":1485356428},{"_id":"ff5f686b-c6cf-3c0a-af10-197889527b8a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I don't think ConfigureAwait(false) should be used everywhere. It should only be used in methods that do not need to resume on their calling context.\r\n\r\nThere are two components to this deadlock. The SynchronizationContext is one component; the async method resuming on a one-thread-at-a-time context is the other. If you remove either, there is no deadlock. Real-world UI or ASP.NET applications cannot just decide to be Console applications instead, so \"make it a Console app\" is not a realistic way to avoid the deadlock. That leaves the other part of the deadlock - the async capturing of the context - which is avoided by ConfigureAwait(false).\r\n\r\nSince the default behavior of await is equivalent to ConfigureAwait(true), it doesn't make sense to only apply ConfigureAwait(true) to a UI layer. You can just use the default behavior.\r\n\r\nRegarding \"If you are writing a class library used in both UI and non-UI applications, you should not be concerned with ConfigureAwait inside the library, but only outside.\" - that is not actually possible. It would be nice if it was, but it's not. If you're going to use ConfigureAwait(false), then every method you call should also use ConfigureAwait(false).\r\n\r\nThink of it this way: if some code calls a library method like this: `await FuncAsync().ConfigureAwait(false);`, this is roughly equivalent to `var task = FuncAsync(); await task.ConfigureAwait(false);`. So `FuncAsync` has already been called, it has already executed to its first `await`, and it has already captured the context before it returns its task, and before the calling code executes `ConfigureAwait(false)`. It's too late at that point.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"dd990e1e-dbbd-3904-bd06-999567348960","date":"2017-01-25T17:46:56Z","timestamp":1485366416},{"_id":"4dbaaae2-a781-39c3-b6d1-5cb244da1a3b","authorName":"Tengiz Tutisani","authorEmailEncrypted":"MXvRlpPnJdZiyIu+WSaTzZ7SnfgpkeQWcbvwErizVkzTQKKAN2LvPYyiKnYrDKD07UONkbTvfkMQ60p+to7WIZqrwo+OhzwHrkAssZk1kPQYF5vjdU98DgYxrt99KoZ2SexNRzE62ciMaKGt+c+9sUU2Od1hm46GMsmDZtYhFadYEI+fY0piCPmkWXWTKlZGjwqO54JOtKpoAltWkm2Tl0+FtOrFsFcCT41y4MMwE1j1D9fzDguse5+aIRcP6F7V6uzjjwFm7xep7LJT7kKyvMZw0fFJVehfJyosOdLOKBhYkRN5y/ClyZaBYT1GpBNP9bQ58sTP5swr+KHb/LWjdGQ1tF9oNFUqbnNYpQfsj/J43nfzBbGahGgEQ97qF2lcXT8hGiioHb86se7SYbontRKXcNjNwcs3rBSEYIL1ArRHAUetfJ+HyAFnnEiM6eNHZ1k7Mrm/2jO/B8Orw2yDUCRo8eJk50U7SE/ShiKH/nqQkHgN8ajEbxcVC8OOqdtQOxpAMoQTFBtHvXkws65zmsGY3aRYdA3b8Rl59gVznhS0wWRo1t8MS4Cd1BYlfOdwVQrKSuxBVXvuajcDgcKibKwfbpLVMtdjMDPgOdxT4eo1PWcIYwYRHbP6BtsfjQdXwcuguLWyK+ZuKjs7NLFjwW6ZvNZ5Fr4lCH13OCUWSgY=","authorEmailMD5":"0c38a91503d5685bbee3b370fbe8827a","authorUri":"","authorUserId":"disqus:tengiztutisani","authorFallbackAvatar":"https://disqus.com/api/users/avatars/tengiztutisani.jpg","message":"\"If you're going to use ConfigureAwait(false), then every method you call should also use ConfigureAwait(false).\" - you lost me there.  \r\nI'm not quite following, why would you want every called method to do what you (as a caller) do? every method decides what it wants to have when await resumes, that's the exact purpose of ConfigureAwait() method.  \r\ne.g. if we have chain of all async methods calling each other: controller action A calling method B calling method C calling some operation D (A -> B -> C -> D), then A can decide that it does not need context after resuming, so it will say ConfigureAwait(false); then B can decide that it needs context so it will say ConfigureAwait(true); then C can decide it does not need so it will say ConfigureAwait(false). As a result, only B will resume on the very original context, while both A and C will not.   \r\nWhat exact problem do you see in this scenario? is it not how you would expect it to work? it completely meets my intuitive expectations. Every method makes its own decision whether it needs a context or not.  \r\nYes, by default you will get the same context, but who cares? defaults are just a question of taste. Every method in the call stack still has its own right to choose, regardless of all the other methods before or after on the same call stack.  \r\nI hope you see my point.\r\n\r\nHowever, I must say that if default was false, that would make things simpler, only when combining it with Task. Everything else about ConfigureAwait works just fine. It's just annoying that the default behavior creates the deadlock, so you'd need to explicitly opt out in the library code. That part I agree. I guess Microsoft didn't consider this combination scenario very well.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ff5f686b-c6cf-3c0a-af10-197889527b8a","date":"2017-01-26T02:46:18Z","timestamp":1485398778},{"_id":"73a82c1d-4016-36bb-8125-9431e3997178","authorName":"ayman metwally","authorEmailEncrypted":"Vkaa9SZGTKO5lbob83cpXlQuzE5yLr1+hCrWi3BgtHPz2JIWxDXDUibok3fg0Gq8OJbuXLqDvHou5CFoWssMLUV2Sntv8U5r4Dr4TRwOkEY31WVnfozh1dcO56KzLhX0YB+FU0Rkfjm46fEE+L+dGF6XawvWmL7PICmpAzgg2A9DHCQa+Gs7HWWKJoOiUh0WtTN88qyHqh6M8jsh3EmJQmqSj8yIraawxnHa1vT/togM60qx/bkN0Q7H9sBkcTwpJp0eIuUmlLt7J6+dfWz/bzry/tPFYrhvNcJfZ9xlchhBtk1ulLVoLoSFxk8SWO5KMlGZNZ0sJb5qt1+o0Uy138G3coIeHFSJq+dUC7UwkXhi0/kqCrpkV+fHkZYt1X4n7ShX+MahjzyXKKUwbb1gFsYOJ7eqkkc8Zw4h0dqKEMQPcM1IG2NIISIjVLjCBl0pZpIapDpwm9PJcFTuf+UM17S+nzrB/7LutO64gZICaImV5qw+Tsv6S19ZhjCyTy15GOQKUG7C0yiMBthVyUsE05DvfqTcplXNEqHH/E+cvk8t2+3zMvK/BFzhSCjmL9yL7zTwmLLJcFrf8D1zCYFw76W/n90dcnp1bAeh9awn4J5zZYTJgXWE/1zEnbjAW6+Ay82/lJmXLn7L0n7eJ82qmZE4/ZQ0lEXGp304Dj6+xYU=","authorEmailMD5":"424e448aee11240309cca7b0023de2cb","authorUri":"","authorUserId":"disqus:ayman_metwally","authorFallbackAvatar":"","message":"Thanks for the great article.  \r\nFor the 2nd approach:\r\n\r\nDo I also need to add ConfigureAwait(false) to the \"top-level\" method like this:\r\n\r\nvar json = await GetJsonAsync(...).ConfigureAwait(false);\r\n\r\nThanks","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-28T22:07:55Z","timestamp":1485641275},{"_id":"012ce9d3-7f04-3f85-925a-314dd68fd35f","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes. That is normal and expected. I call this \"async all the way\".","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"6eca1825-8c10-3378-b691-a3912ed855ab","date":"2017-01-29T18:33:36Z","timestamp":1485714816},{"_id":"6eca1825-8c10-3378-b691-a3912ed855ab","authorName":"Shibasis Sengupta","authorEmailEncrypted":"m6XJOK38YU6RMUFA3oRfF80WJf198YfKY9/kmBdD7kaVJWBFvEf+NPvQsQbBtWpYiBYhthgjWssB3yaXRmKf5fedeYNC35kbe582VcwRb8++ytUiDfZLLFre1jui8m5sB9pwgeugTcrGXVFWQ4uob1hfvNG6AhZ7tCzctoWlNTRombLQd4ZpUm20x45UyGZUsDtE1CfUoQR9CJtSO0P5pMRhtpTBJamsBdMLQlFzYQLQLjDmdbMR+CyTjVhemL0SIf97pipWtHaG5036El7uj0Cij1umEMjRMiMz4enXMuDSEexqO6kVt1uUuaz8ajOoy0qtkYIXecG4eLPY0YI66LCWL6jQK1tInoOUBWSm/LcjU6EMpKih3tJk6TjvNk2MPJRmJep3mxjDTe25OrJ0qILDoTxpxxuIGrqraf2wo5GkSZwRJRSI0XJQ6agrz4olS4g6+CMSSn7jhvGaqb+YEYJc1wVxkZzl2kKTaQoLcXfZ052QUPA+wGvUGhdvQv24Pnc0Lp4CINRIjNOcWukaPyLmNS5KDqobcx/mMYD/jYEgVeLFf0YbZ9naV1OENrlAsNRUmOWO7zojEn2JhaeGxBPmwtSplwOziry4DLLIX+fUhRGO1Fc8KmkyO90Aqqx2f6B6KwPymCObwoKWGNbFvwhtZXTliRpKp1N7YUTpOgo=","authorEmailMD5":"287ebcc391ebebd6332aaab93403ffd0","authorUri":"","authorUserId":"disqus:shibasis_sengupta","authorFallbackAvatar":"https://disqus.com/api/users/avatars/shibasis_sengupta.jpg","message":"Hi Stephen,  \r\nThank for this awesome post.\r\n\r\nOne question, if the caller method need to always use async/await, then the method which is calling this caller also need to include async/await? Does it need to \"bubble\" all the way-up?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-29T04:48:07Z","timestamp":1485665287},{"_id":"844f2453-d524-3155-baaa-d9eb1a74f889","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No. In fact, you *can't* do this because the remainder of the method *needs* the context. Setting a control label is a UI operation and must be done on its UI thread.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"73a82c1d-4016-36bb-8125-9431e3997178","date":"2017-01-29T18:31:21Z","timestamp":1485714681},{"_id":"79978958-e42a-33b4-af26-123b2cc3f2eb","authorName":"Nick Lechnowskyj","authorEmailEncrypted":"T2KltdxblAgqE9H3qwqyRsokLlPrq1ULXiFiLbQYXfxwpFEZprmSVE2opF4yC1ZxTPb2B6PTyk4YMveC8V78n4g1JILKas6Tpj8Ge9gJjd6NE8rj0tuOPhXzT5l5wQFpXfQ8xP85cKpb4hnqx4krnPIFLNDLee4ZdsdaALj8wPOa8MzplSiomR6LsNmoxaIEgu25ONEGv2A7Qin0HZ860Icgw7OQ80R0WaB21CPAMWPkeT43YSdelt1t6kBxblkXIGREvDeUTS9Zcb5YMYQ5755j7cPwMaHSPQYNesYVdFcbaLDrerQjNABYYtvTCLIT4AGKoQDf8d2QlcNWqzx6APEo+uIJAEnsQGodvWnFN+rC2ZcSibQH1vRFbuKcumY79nbZ27R1bYLL9TUVicR+rqbqVYJqSal67rBRP1w3QbLuxfUwgPG8hIW2Or45CMcxhotr8iEL07W1/w1PKMCRRigttEiqbpjPGKg4kfU5+ksuzALblNWCtAl/sMM2ycN58TsD2eMp5oWwHjLON/kzWOxN6vEMMwYQn86PokYTboKAXAcJj3MLjHvTPY2AjLI33lCBH+0CZ0hi3j7mi8lq7xzeibz9qsWarB3hCUVGO0OwPtkD10WkJ7KKJddmWOalFwCeA+PdpBpK3PeH8c6SIoiTZa45pBT8+aZdjDHO4s0=","authorEmailMD5":"2807e279ada3bb19bad41a54af66114d","authorUri":"","authorUserId":"disqus:LeMuffinMan","authorFallbackAvatar":"https://disqus.com/api/users/avatars/LeMuffinMan.jpg","message":"Say we consider a PCL used as a client library for some REST API. I'd like to just have Async methods rather than supporting two methods that are very similar, except one has async/await keywords sprinkled throughout and one doesn't. You've said don't wrap async methods in a sync wrapper and you've said don't use Task.Result, so how would I design this API client so that consumers who aren't using async all the way down can use it safely?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-01-30T21:41:27Z","timestamp":1485812487},{"_id":"912fcba3-6282-3b95-9585-c628539986d8","authorName":"Shibasis Sengupta","authorEmailEncrypted":"h3C/W3QgcjSv49suNfl5XujLGozOQX1OrNlPpVOUs+LU3zVsAgFN1djmbqrUX17ga1jzd/CRxzJBwh9I7MwGGmmAFm7l+g3boaHXbCNqAsPPrMBZOfMo6f6gXoySQhuXZe8GEW5dKtgbkrxxDTaPofCk+E6m3/dA55xNBSlbTNHA2BgRCy8kadoX04wZyJu3RTvn6LysFan1CV6WRtNX24avAVw20yajlYjPrkbva51D/FJtT1QflUvwatbkj7Bc8/mJNSr0QxtKXcVbVV6wPi5b6WyE/mv8f5rw+MZhJ4ioq2VOH1rO3RHdgXWtF+/1TDLOQiqVQ+QxaQivH7CrwYy8Pzf421DOLtAVm/CvxAt/+iNVoG9GPX6JwzGK78ZrieCWh9m66li7afPLQN5CIKgHqDIW6bu1HsuKB7bnOrXxQkBlHQH5mpvjDzauUa55evURnMyACY6B/s8kpuEoYQRJjhHquJPSLrLNmcgu+L+UffBnbCl1e0PP+aTNqA8zQzsZ2EbnlBFgawXcL/j1/teQm4nY+ium9ry4Y9LB7p76GxJMzz1Lg2ugoOxMabO/UlIfpN9Hfv6ijhIYub9ECuz7IxO+MwUk1MIgPAHpj2m3/rjGZOZQFcScVndl9VtmlEZ3mumpamOmrIv3jSxEqG6y4mgVTi9JavwR/lF1xug=","authorEmailMD5":"287ebcc391ebebd6332aaab93403ffd0","authorUri":"","authorUserId":"disqus:shibasis_sengupta","authorFallbackAvatar":"https://disqus.com/api/users/avatars/shibasis_sengupta.jpg","message":"Thanks again for your response","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"012ce9d3-7f04-3f85-925a-314dd68fd35f","date":"2017-01-30T12:17:39Z","timestamp":1485778659},{"_id":"4a339617-bae9-378a-811d-2f1e0a38ba74","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Personally, I would only expose async methods. It's extremely rare that consumers *have* to block - they just *want* to.\r\n\r\nThe only other safe way is to have both sync and async methods. You don't want one to be a wrapper for the other, though - what you should do is use the \"bool argument hack\" described in my article ( [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx) ) which enables you to write one sync+async method containing your actual logic, and then have sync and async wrappers around that.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"79978958-e42a-33b4-af26-123b2cc3f2eb","date":"2017-01-31T13:51:21Z","timestamp":1485870681},{"_id":"c777922e-2423-3106-bba5-239b39a235ba","authorName":"Joao Lebre","authorEmailEncrypted":"k6SUpCOqEPjvxsX8aPvfH8IiwoCeizZZ63I4zbf/wjG8Xs39YnG46NNrRaM9LbfGEr3OqrQxqWtWjFpSqwcjgeyeuQ/tJrltlUwYwBYfahZueY4XKxualekjJL+ncq4GsQexNUb+nQteVYIdQKwn8aXjlV68hMAeHaPt2Cz9/Cai5aE+jikjl0rJvCjIJaUrGwVaMV95u/IgZI1YE9G6mhpEGPvCrlgqiJcP1j1JCax405JkuI3nnlklF7CAqrqb0+nf4drgpQijgxS4jxa9YPJ68ZHkxUAGlUVLmU6ilgF3ah3duBk8ldq8Y2jctwBTEyset1qjjHY2pv44pZCkOCD6Si5YDR3v/uB6GNobwjvIpxGxTiYdw8iY6MbDIseHxlprppwEdKgJMSkjFlSnQFqC/H4ZdHoIEpDfSHKHQpyy+Crl1jb2Yk88iDl3oY3BtlFcRdwPWCbdKwZXFgWvY6ZGuBce7R/5MobQ+h5xZdSYPw/bg1vQRivLtmD5dEDgZ5yTU3sZGvYehPerL3Yu39ylMdo9ePfYMFrM+2cO+jcou8Cl2bUyH/W2Emi1O6nJEU+ULW6/NkZAOLMtoM38fEbn9hWymx95e/GH8H71EfBrdLD7DZF/cdsOS5lf7/fcpb3D3138xPxAPioQ7Sc6PAbOF4FThVK0Bk73TgAHeCA=","authorEmailMD5":"c1114bb4b8619d6a61f01d31c218d334","authorUri":"","authorUserId":"disqus:joaolebre","authorFallbackAvatar":"https://disqus.com/api/users/avatars/joaolebre.jpg","message":"Thank you! this helped us understand why I broke prod, when we were about to give up and just Thread.Run() pretty much about everything on that piece of software!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-02-20T14:44:38Z","timestamp":1487601878},{"_id":"8136bc08-2d43-3192-9caf-7902eedd55d7","authorName":"Eran Ozatp","authorEmailEncrypted":"nTwnguchiGoW6UZK/fN96ON30otXkpYQjukB03LpukZnXOv7owkFhF4+QoLkF2qDBf7DZj9Lxv8fK9HfChbaz88wJp30mktKM8GKB/HR5rTssOKJfzDEMrwi2S52cpUF4bAyncyomVlIdnIov8S8CtWiXUfAf+CFqRhp6urJ0+NJxxdM3CLngwoUQV13bjrT8pH5lNJ0mRlq5a0dv9rmPG5FkK+vfSE/Q8Wg0PLWS8OT6CoFi7cvZlcNDP/rN20v3KqJ+WHZUZWOo0x3mR9W4egUZhrzAphUz5yr9UEqZCi+/oAxBAUoWsvBIfv2ULRDyIHuM7vrGyDrmAkXC2TnEFaq2PI+AwO7xs0Y2kh8gFO+kddKS5U6il+/0YZPQ4u4k5q0g7drwSDptycYt3ctlPupw4yjzdwD6PTJeotg+ntHgv+i0SmXBYktp9Si4JLVgMrXmbu7E4eiQP+0aAuH5/lk+3wq1qpfGKdMS0JqemYNgaVqUCOpbFeu6Vxoz9IYiax/gYCqEPV0eSO7ERMLeWEcQwEIQYtud4crYaR7liWC022n6KAHY7VQImdZ+uB6YT0JWvk7d7CDfwUdGGXS9iWZ2ZC/AfKUngHy3tT8KeD+nJmz3c/DooqqNQq99Eylup8tnJRvYqYY5YP+aNN8HcLW6UVhG/zyAPtcdwyl9cY=","authorEmailMD5":"ed3c16678b7536774b5eef75cee2e764","authorUri":"","authorUserId":"disqus:eranozatp","authorFallbackAvatar":"https://disqus.com/api/users/avatars/eranozatp.jpg","message":"Hey, could you elaborate on why async\\await default behavior is to return on the same synchronization context which it originated from.  \r\n What's the gain here?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-02-21T07:49:58Z","timestamp":1487663398},{"_id":"f7ba6cc2-fa4b-3a0e-8476-662742ece8a9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Conceptually, I think the benefit is that a method runs in a context. So, you don't have to change your thinking if the method just happens to contain an await.\r\n\r\nPractically, I think the benefit is that it made for better async demos.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"8136bc08-2d43-3192-9caf-7902eedd55d7","date":"2017-02-21T14:31:49Z","timestamp":1487687509},{"_id":"3794c8a2-9cec-3671-8aac-608579641831","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That's what I understood you to mean.\r\n\r\nTo put my arguments another way:\r\n\r\nConceptually, an entire method will run in a context (unless it uses ConfigureAwait(false)). It won't start out in one context and then jump to a threadpool context when it hits an await.\r\n\r\nPractically, a demo that just uses \"await\" has more wow power than a demo that uses \"await\" with \"ConfigureAwait(true)\". The ConfigureAwait would distract from the demo.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7f650343-3f96-3a36-9b22-93a99d5669f9","date":"2017-02-22T17:53:48Z","timestamp":1487786028},{"_id":"7f650343-3f96-3a36-9b22-93a99d5669f9","authorName":"Eran Ozatp","authorEmailEncrypted":"Y+DvRlsqyXptJSezgsfYB0A0RC5Cl7k6vYKxEanReiqsCj57Fb0CWQ0NEllU5kAds25TpOjKSrCTbLA+z/T9X9STsJtwqFQEEWWA9ViZf7rr3pP5q614YMBxVf5FovoSOBnHRaMPISEZQQSR4zdBCOCOp+MIHQa1OBs1xvXpqtNWmbTRQMijb2yO/ooSfPySXl0s7ouu6EQwCw8wFtatOl4aYomD3A6ZxqLNuVUSyzhbpl5nKUmdWVeHrB9ybWVR39uHHZYga1pepzdwb70VZgPsalnEHLGFPd7b7Ocjtcm0LKJyLDhxTHOg4R9FWPBL4ANKWJ1+WDzWOQTnaNlP67ZccUpDkX8WfcpWA2k88mdwAdC7Qi9bgVKWH3M22RtSlC+tH+OvHnDE77kJQpJ5n6K6nh4GpUiqiJR5jg6XacTrAfURewgmVuJJWwKCIHyYby2/rLpNoOU8iDUgS2i1h8BMnxUTfayGHpjHkm4nB+dFMU/mJ2Fle/LdwO2eMuDCygwWSJPn4ALdQwKPymp/ikgF7GLQnxdClkRdiIk3BXPaxRyUTaQCFNJ6Q13D/4UMEbwUYMZT45vOQCDmIa9S6gxZ4Bk8C2J3SY6HVBATxC8Epvf1CeVsKtnYfvOLZB6YfyhblvSToJH3sYd2o34lbQXwbScOnogl5jDcvoAFVMw=","authorEmailMD5":"ed3c16678b7536774b5eef75cee2e764","authorUri":"","authorUserId":"disqus:eranozatp","authorFallbackAvatar":"https://disqus.com/api/users/avatars/eranozatp.jpg","message":"I think you misunderstood my use of Context. In the context i was speaking of (J.K.)  \r\nWhat i men't : The default behavior of async await is to return to the same synchronization context that called the await ( that's how the deadlock occurs in your post when that thread is blocked and you try to return to it.)\r\n\r\nMy question was, Why is that the default be behavior ? why not return on any thread by default ?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"f7ba6cc2-fa4b-3a0e-8476-662742ece8a9","date":"2017-02-22T16:26:59Z","timestamp":1487780819},{"_id":"7299b081-ede6-31e4-97bd-b3be9671e995","authorName":"Cembosaurus Rex","authorEmailEncrypted":"m9ATSrNhwzSqiJ6EnhzE08OZ9n+RxlX2T1H7UqwK09x4iu2Yz5bF3SQznwy55H/eRwjyhycdWH7+jQ0kkD3cKC3SH07m0T9JVsGlrlAMG/O9AcDVDqAyE9eXnfN5K30bCwKsVNaTo4LvYZV++OCtvvNc7sPi3DnbSmuWuIeSFrMOdzl7NZz5J5By1CZFSxHUzarJKq+8rSlB5JsOpy1GFdeKCxtbUPOeGb276zjCfJwEEYULYMG0oCKb+zJxmhByB5RZVTcRptju2/ewakZefd2lbx3kTJkxb1xPeDC1ME4DZgkOTCCjoNHXU8wIauTQQf4VObiWZV2z6eeMu/3g1YDFCFl2UT+J+yQcjwekh6UHcL1tQQTS19ausCrS35FTOY2aQ5IcrsoPRQa+zlCjjUudIGoGVxwUzJ1CdRyMR6W5wGCHNO/+9odct586g/v5SVX0A3GgVHq/o5B3b0lSBae7XTvlGoKmt29GP41yzM+jLJz7WsIttr3sprFJLI0Z1qnBes0VU4bUnP8ei8APQ6Dkznc+6TC5th7WinmL3pSjQjFgwSZHKr9DI6Fo88JJGPAKNOJC83GIHhPZVS7MqlhK4PSy1oZnrdHjgxJliOT5eHQ0lk3RbX94xDv5PPk5+F9IqEVhDll1Ws13hoBCkl/oDrYiJtyft4Yl12ZNBNk=","authorEmailMD5":"399ef9bd8820f1bcf79b227ce9f923db","authorUri":"","authorUserId":"disqus:cembosaurusrex","authorFallbackAvatar":"https://disqus.com/api/users/avatars/cembosaurusrex.jpg","message":"... I'm new in async approach so I might ask a dumb question. What is the 'context' you have mentioned in your article. For example: \"...it will continue in a context\". Is it main thread. I remember that UI thread is main thread in winforms ...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-02-25T06:33:53Z","timestamp":1488004433},{"_id":"c06059eb-e2da-3285-8f26-1896e5725091","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I explain it in my async intro article: [http://blog.stephencleary.com/2012/02/async-and-await.html](http://blog.stephencleary.com/2012/02/async-and-await.html)\r\n\r\nThe context is the current SynchronizationContext, or the current TaskScheduler if the current SynchronizationContext is null. In practice, it's usually either a UI thread context, an ASP.NET request context, or the thread pool context.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7299b081-ede6-31e4-97bd-b3be9671e995","date":"2017-02-25T14:27:13Z","timestamp":1488032833},{"_id":"f07e6cc3-a62a-34db-bef2-50823cd433b9","authorName":"Marcel Celaya","authorEmailEncrypted":"bCVtVK/ogZWapuPf5Ti6Mj54yuJBF4KqiEeJws1fYz/V4H+87fqRXY2UnI7CoY4lvwED4gAE5GCQaQJKN7NFawCFzgr7v7rt9xLgDfG/ME/hODXVY8SK5XX54kxCbSJJ6B7q1u7dMgHNuHn/Ud0CB5QWQnJ9pvefJ/k5hPs239HTigC6W1lFkuGCqeCt/A8rdQiuFBOGXskImBtRtNZBhy9Zxw+bMXTlpMrWzUv/CWI1taJQjL31onIXX4XnlRhTsyKVHsgtoly2SNnQ6dOCNB78CvxTBdu0DadczjiXmqHJeA65xar5TpAokdsfbSf4EZAG8msibVIKNC57uKWdiVlYiSTQn0Pk93eBpZnosPPg1HKQ/pF9HVYlpLztKuiGDYi54W+aa6VAbFafGeWJ8FB4GnoGqI8ZVTL/LhPd0uP6Z15KoYXs5iWXw32N1jlbO00jPM+a1tw8ZW4Mu1SDTlAbYga47889xNuwIIDCEWkgyxZ9GPDTtTDsH5AUYtMqMq5VMbuNtr6oZvaBlY3XnoQkQHrEbPMJ482olxzsQb6LbiamokgfU6r+PwyKHTO+DZncDATk8XT+IhQuJTELhu0yWj5bsfTKPFXgpNVodVTbQYIVepdnoR3XIBQVni8EKy1BGvK/S8MBKY0c3HZMhj7qVRx9DEPFpyt/6AByo5w=","authorEmailMD5":"684dae63c4be52d00b7bf32a1c86cbcf","authorUri":"","authorUserId":"disqus:marcelcelaya","authorFallbackAvatar":"","message":"Thanks!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-02-26T19:50:54Z","timestamp":1488138654},{"_id":"5176f405-619c-3def-8109-f5b817fc350c","authorName":"mh_amri","authorEmailEncrypted":"tjVPXC11ERUWKpjSSz7WZAdkoOaLL4kMw1gHeGYfxK6/5NRP9jcpF6Y36xZyntmGjUZ80Ux9OQgqlOCYQlN/AlkR4FbTDxpcBBO4MNZVwoABXKm6oUeNEcNorcm6Jv81KJv7w2+O3amV/9b34nHEkP0EcpB0WSnD7/JlMaVDVnlYK9tyAZ1iKCrRBTM9AS+kyzs2WMkM5lrYXw33jCUiNwBRFM2fnjfx7wTrGmF5yDPL+Mwus51Qb+wqWtmSfix59GrB4kBr8HGtdc3hxwomAanuQsSTtfn+4GkKA49kDaqodpzpweP8978AA0awokkecWwYykMsqs7C9pU/erx133f3FqEGigiKtaC15szh9GLVwzKxdNS4/XdA/2SWdo69P3DoeGCDklxP/O4CVOr+O3RGalLyJxY32D/OGYyR5acLAnL2CR3Ejpj5XwLbm+vrciCKhRRXIg19yzmaFyDMqs9mtYxvpJoofCtzfEkuoM7ewHEOEyK/AZOAIyBxdv7+21ww8eEbk5f4UBZY/S/5SthFITNeH1qLtgfhibcqZdg10nO5kCG7fPx/okha69YvAlN6/G4V3w4uKrF/JcqP5ZxcCl1/eJ4HCicgCnPccZeIF8Ib1+dkgZfItbzVj1y1xESVljO7IzRoNOkxwoHrCPCDpOiQFEB5XTzn8ym4x7k=","authorEmailMD5":"1b9854751400c96cffcbd9abdd4327e3","authorUri":"","authorUserId":"disqus:mh_amri","authorFallbackAvatar":"https://disqus.com/api/users/avatars/mh_amri.jpg","message":"these methods only works if the return value is void or Task or Task<t>.   \r\nhow do you manage the methods that are not returning void or Task.\r\n\r\nlike your [asp.net](http://asp.net) example the method Get() is returning string\r\n\r\nI wonder why you missed writing solution for your [asp.net](http://asp.net) solution?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-03-07T12:08:11Z","timestamp":1488888491},{"_id":"75300866-0aaa-372b-ac6d-c01e0e514c54","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"When you make a method asynchronous, you change the return type to Task/Task<t>.\r\n\r\nThe ASP .NET example where Get() is returning a string is shown right after \"The new “top-level” methods look like this:\".","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"5176f405-619c-3def-8109-f5b817fc350c","date":"2017-03-07T14:39:52Z","timestamp":1488897592},{"_id":"2765f5ca-0c1c-3cd1-89ae-704fa9ffb1d0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The best solution is to update the old abstract class.\r\n\r\nIf this is completely impossible, then see my article on brownfield async: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"678d9bd6-0df2-30f6-ba66-2fdf2cbb7e54","date":"2017-03-08T12:53:52Z","timestamp":1488977632},{"_id":"678d9bd6-0df2-30f6-ba66-2fdf2cbb7e54","authorName":"mh_amri","authorEmailEncrypted":"KZxkvBGJAoCneEqNujoAAFL7MfgMesm7DFgYl4WdJbE7Zrfx8TcMKnW06CsOSfHNdrduc+gS9W+UByDyXC42H58+YJZLdX5hkF5dNvQEavdZ6eklqzh7FSHYVeZZ5FYuTaqwvpzgUdZLPNffxyGYdLhezxJiU4J7wAo9hATKXMKVBTy3HcdkvYZWhHUpXaXPFFRUWNn2U2yST4V+5a5a9HXajsaLn52OSsMkr9yXad79PsNv/tk/KPmMCUuc5xOIk1hs38J1FOOBJPGoPTNn+HKmqkbrhPydJIwDEMQgslxJ8+T71GJsRQz8qM6Nbl4P2IWKwsGKtXd3zrwXPEQPuH8hTXar8aPO2AG7BPrVsB8679arp3bbpTNOjzPyMb4YyHg9u+qjt0/yfcK1zBORKTVawQ+JAUhxtv1ie2jZmkzBbzjJhE2Iq/T9RBwGdQqByKgPKmmeaKhZZCGIXSj3fakh1VgN/gJhBkNiGjxOLj1bZl+CjdY+8+Lp3Lc1+jzjWoQaUORxBzNGLqCQ3fo9YMf2qSG+LuNRkMX/uwpqp1rACjx4w7nhyuOoFwME+s3fqwn071156mR5JNavaPDwsiKzzo9KaieIe5FBAcfMtdR5+bDLz1VEoZBY5VBh2foNfm9O2VI4+1vj39rSxzB7Skvz1vQGtSZoslNfMOeiZkk=","authorEmailMD5":"1b9854751400c96cffcbd9abdd4327e3","authorUri":"","authorUserId":"disqus:mh_amri","authorFallbackAvatar":"https://disqus.com/api/users/avatars/mh_amri.jpg","message":"What if i'm inheriting from an old abstract class that is written in synchronous? is there anyway to prevent dead lock?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"75300866-0aaa-372b-ac6d-c01e0e514c54","date":"2017-03-08T07:11:18Z","timestamp":1488957078},{"_id":"1befd94f-4142-3140-b608-e13cf4385861","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I would never write `await Task.FromResult(0);` in the first place.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"de9320ef-c081-3e39-9320-fdf76b345803","date":"2017-03-17T16:35:46Z","timestamp":1489768546},{"_id":"87cc8d30-89df-3d8e-9f69-1952675b4f50","authorName":"Tomasz Modelski","authorEmailEncrypted":"NVL20Q2Dnx67gTzcaqM9BsI4M2pEyfNCM13SOToiRj/ckVz6sK5KuqEedW6RbQQ/1rGaN8FfoNLtArhVyjsZRH20pQBmO0kZ6512+MI4KfWUDHdS/3LzeMl3eXSQjRTYwZNfiaxYaFyGsYLW1Ji1DRbhi1cBZ16nkgofaupb2Wwn4IQVCYNR89nHGRfXWwLrDs33ESKMMlg94uGBdVkYPF3jnv3jkpIrUpRVRcd9j05JZcYUM/zxzPWTMpyZdvlw9z/ySPNP43GanvvOvkPl7Hz6wBbmyv0B0dGGeQagyJU5DcwiT4cu3rIyGQzQOnYUop/G/hJ9HJLhc+NbZxKzOtaGLhmdil+yksNfXHCO7H2d8y094nqbJIsMhosXRyhiKPOqm65pnpevImMln/f3FRJXcckjSqB3WQttTwY5zESzExytQ8B1o3j0JQEAcR52TrwR+l11iAcStRnNFlYmMLNxXpt9VW34ljG0xxoxpAWOQcZ8XWeqrMp146J9xtYHEwOIWS0nW5avZ+NHhfdWut0E6JPfuuaxVKHGsTOh3TNEtgaw1C6ZjnnTC+exCsLZCSNyJPf/cMD0+SUs6snh1HrvJwyFotfpw2KigFDMQrfGidpdLsLHX+CG0wEYm9+eY8Mgi14bjyIYXkAVkdiFtIVb+WlBUGfqR/gdQHCgwHQ=","authorEmailMD5":"981e6f0be2bcad7e6de0867420d6c855","authorUri":"http://sychem.wordpress.com/","authorUserId":"disqus:tomaszmodelski","authorFallbackAvatar":"https://disqus.com/api/users/avatars/tomaszmodelski.jpg","message":"I can write below code and it compiles and works (tested).   \r\nBut as I understand your explanation  \r\n> ConfigureAwait is used to configure the *await*, not the *task*  \r\n this will do nothing.\r\n\r\nThanks for explaining :-). Regards, Tomasz M.\r\n\r\npublic Task<string> GetEmailAsync(TUser user)  \r\n{  \r\n var task = Task.FromResult<string>(user.Email);  \r\n task.ConfigureAwait(false);\r\n\r\n return task;  \r\n}","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"f5f701f9-02d8-3d89-8c46-2231757055ce","date":"2017-03-17T23:05:12Z","timestamp":1489791912},{"_id":"c05991cf-e2ef-343d-bd6f-e96e2da56f2e","authorName":"Tomasz Modelski","authorEmailEncrypted":"AzK4d6Vn016y6Vh+lYJcZbvSFfh09gSYZi8fFTW1eVqd1mTTM32nhHOp/AER7/3x/uiv8/sqPLTOQWXFdvUq9WJqNNdXpfgzWV3PAi4sX4d9Z5LlF9dekOar0fpEX0TTYVSwuYuAlPkizeBst2nTFAAx0mfdO05M5b94DUoHQmzfqzkGA0XPE5kdRgQX5TrYjt4GkjynhNgvAx/gEf3rrb3CjuHNuNpaARP4uXNwkDxGZ9zXQwmBLqFudxokAyu72jBcQCSM4BJZ9wm7pfFv65RV9nAWDFGiH8Ja+v0hP6kuP8QxQ6O3kZx5gb3xJtUc/4gDwXu91oaF5+HEIMKHae4+BPtS8JOaYAjB9slmH9dsaUYYWZvGFku/2M1kqrKOz2iP7YPvsBmD4RMxKV+jPZKylQBj7HWvjZlr0YB40XI9DgEF5OP4XiClJoCT5yGmFih/l9tXkhL1/fDqfR+bTOwXRSE7404J3oYLaP9tbV21S7tF9KLcTRNVtcuhBLX1GITg83agbOFLogf8mn01WYyIKShqtUTmkKDz5xhoVtK1JMKc0lXTReXJaGxh6pDaMvJbD7pIfDkVD8qy60OmkeSc/DXORVTxdU5eflm8l7i+dvCN6h6tyh4Y+MPg+Lr/ykVOVK90pltKA7D2cusyHOkN2r2F7R+TwFUNsO2jLqg=","authorEmailMD5":"981e6f0be2bcad7e6de0867420d6c855","authorUri":"http://sychem.wordpress.com/","authorUserId":"disqus:tomaszmodelski","authorFallbackAvatar":"https://disqus.com/api/users/avatars/tomaszmodelski.jpg","message":"Thanks for answer.\r\n\r\nBut I'm writing my own impementation of MVC 5 Identity, so I need to implement ie:  \r\n> public virtual Task<string> GetEmailAsync(TUser user)\r\n\r\nbut email field is just in TUser, so I'm writing   \r\n> return Task.FromResult<string>(user.Email);\r\n\r\nso simplified method is :   \r\npublic virtual Task<string> GetEmailAsync(TUser user) {  \r\n // add .ConfigureAwait(false) to returned task ???  \r\n return Task.FromResult<string>(user.Email);   \r\n}\r\n\r\nSo, add .ConfigureAwait(false) to such Task.FromResult<string> or not add ? :-)\r\n\r\nbtw. I've created blog post with a lot of your expert content in async area.   \r\nThanks for writing such excelent posts.   \r\n[https://ordorerum.wordpress.com/2017/03/17/asynchronous-async-await-task/](https://ordorerum.wordpress.com/2017/03/17/asynchronous-async-await-task/)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"1befd94f-4142-3140-b608-e13cf4385861","date":"2017-03-17T16:44:44Z","timestamp":1489769084},{"_id":"de9320ef-c081-3e39-9320-fdf76b345803","authorName":"Tomasz Modelski","authorEmailEncrypted":"nCxHA19+J4PFMu42d1lmXzArZjD0SpA9BRz+MrUNbElO5APHRTUL7Lb5ZyWewSDjkSu4OzF50TAUBEdaCH0cKf1d4U5vnUXbtVaYsn26x9uYIVtUKr5LykEAwhtYYkT35LL8/yVVyMFKmkb0WyWhqBLUEUh7c9ORhDmTGQThshFP/apJlal+AnrkmxIOZrcC6KVuL8BINh3j6nrVHGaYMJAEV0U6I6kebxVMjGSqWfG6GHZycOIcL+rUY1fye7dULtDqBHIIemHMOItagR1yCeaVspkp+nCzZxD56uPyu5DZ+5R35Aa21pAOGIhil+MvwVdm0hUWBsN+yAqkl7u3ZtOyeD8Sg4FybnPDjJNtFaTViyEP4aA0/rbr0WAA0qtp0X70OCOLl6Pd68wmKd5MO6dotKR/RTv0L6UFr0+sDrA1yo7vnp7pbJ+Fzd5B7hOENlxUb2xsFUwWTKWhrAm09fgRnn1qP5cV+c8Xkx2pAi1hbawRijmbhE3Xh37yJTF6MB/QZB4exsAquapXSYV76ThGkCnrXPe9MN+ZSINsnl3Yr+5ojXHxmJmigNaOwln43EXIVPAZP6Rynd8S3qNoU6Zpv1V3dFD6+Woia4Sz7z15QDgRMR01tJDRPpsW/W7oO9rVgD2U66t6gH4WdrnQ589P/r/43kuvXLdyn0V64Fk=","authorEmailMD5":"981e6f0be2bcad7e6de0867420d6c855","authorUri":"http://sychem.wordpress.com/","authorUserId":"disqus:tomaszmodelski","authorFallbackAvatar":"https://disqus.com/api/users/avatars/tomaszmodelski.jpg","message":"Question : Do you advice to do .ConfigureAwait(false) also on Task.FromResult<int>(0) situations ?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-03-17T13:30:10Z","timestamp":1489757410},{"_id":"f5f701f9-02d8-3d89-8c46-2231757055ce","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Actually, you can't use ConfigureAwait there. The compiler will not let you. :)\r\n\r\nIt's because ConfigureAwait is used to configure the *await*, not the *task*. Since there's no await, it won't work.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c05991cf-e2ef-343d-bd6f-e96e2da56f2e","date":"2017-03-17T19:24:46Z","timestamp":1489778686},{"_id":"4a3e4bb7-1235-3039-bc58-641d62c4fbd7","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Right. You can't return ConfigureAwait(false), and calling it without using the return value doesn't do anything.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"87cc8d30-89df-3d8e-9f69-1952675b4f50","date":"2017-03-18T22:30:40Z","timestamp":1489876240},{"_id":"b17b1f67-9252-3964-a142-4fc0ce44cf41","authorName":"Binish","authorEmailEncrypted":"LDlN4jDDzAaSSswdCEBatjnSeeNKdtiQjE3rDgSE+uE8wM1XU5CTkrOZ8FejaoNCrrROvZYAj/HilyZd8adZguUgR1JMv63QvHoN71px3pib5qfhyBRXey2aqLGBQPeJRrjPNzTXIb7VRsiZ7eKKjB4aqU+OkszuGA8/riAk5vzLF/k/OJCHqq8FrpceROGQYBlacOnhzCLzGUdgtlIGTd/XDXnwwQI5zfs1OR/02c/v5bZmTdP7yPPwKiwopnmHpkoDgpNPTI6eJAPH2QGG0uNG4C/KBW5UVK6AbiY7IEpoUHeUKmzy+uSXV8uLh53NhOTz3hBNiWC04S87ve6i/gNhwT4ZbxaRJZu7opp/bUnFAFs8NncI0f9PNRP/TTlTtzbDfB1rF2yg0e5EAlmDXRW21QJ1df+fWPPmzlF2jhUx7+2RgbROG5kMRm2iz4tbdKzThydJ98V98u0EPMT1q6n6uutb2X1xxqhow0A8eftnGlIHQJUEfdumiYcKJtOqcF57Qu+g4p7tr73l5d5J4Ib4I/fEJQYS7auP+QnRv7LuP4uX2NQMWNwaGzqn2bJOXNrf6at/TwbkbWuQn+ZSpaMND9sLs+uWfJlxH3EUI/rJto/Sa3juhxr1i/8NMgFw3dgKOFvq0Y+tWkH2RS7Ll77TM10EjR3CEg0PeM3rQL4=","authorEmailMD5":"920fa8e2e9892f8f99c3d814c8091e13","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thank you. May God always bless you. Thankyou for sharing this post and explaining it very wonderfully","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-03-29T10:57:24Z","timestamp":1490785044},{"_id":"1304fa46-3f80-35a0-bfb9-0b5342a70b99","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Sorry, I haven't dealt with that particular scenario.\r\n\r\nI took a quick look, and it appears you are correct: IEnlistmentNotification forces its handlers to be synchronous. There isn't much you can do here. I would certainly raise an issue with Microsoft, but in the meantime you'd just have to use blocking calls.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"fa0441c3-b394-3e08-bc51-97ef74c485d4","date":"2017-04-25T20:32:39Z","timestamp":1493152359},{"_id":"84d03638-a1f2-37b7-a8b6-b73ea2c25093","authorName":"Hai Le","authorEmailEncrypted":"DjGgzowljZar3Qjwu+sv+RW3P96cOtAK6U6fybzqk1lKZ49SyOnTMl4gWAkI9mOPnCVe4JMVpEdY3QW3Th3eto/8X6pP3Xe68zkd9AzzxPoNqhF19+P5aNOY1t/a7197obSJr3ZeK1i9lV4CseCWCLNrlkOYXo2Jkg1dPiW5hn1g5FRkz7G1fONW4Fi+/PUEcB9tfHft2RvHjJbgWYt3gGHA0+RIUOnB29OWlJaRXh8rhWwkPlSlN+ELIl4dGTPJn/giyWaX7rk6XyYeqZezb7SL4o75fgI4M9Sf4apjkbwITUPt/DsrKeKe/s7Kqf5pepQMjmHt0y4QbjZ1TPIzgERZdzQ3HcxTmuqilKCttZPnz3bDkKKhTPt0/8a89GxOBxwg60SdjRflXxz152ovRWEqvGBceMJP36Tpa3vHjxbpniBf32yeSRrGC6lcghA6tRwIcvgQX9XVXkR7Dai/FvjWLodOUoBsGgCQGwskMcrZO8qo9xJRYP1SIGhfdVytVwQJK9ZWPtoTBYoOI9gC1Uwq4lRrmfGj9wv8Ch9HKwoOArYvxe0ekYA5vDXZ8iINqPbQFRzj907WqQjbS1j0+XSsf/lvFVsrb4dSdUxgCGN0ziTWer6eswFpfVOblvkSovmM2oVmcAzkwEyW5KHK5LRNJLuLLvYlzRUmfm3RWtk=","authorEmailMD5":"fa153687318c55d55df5e5ba8f32ac97","authorUri":"","authorUserId":"disqus:disqus_OaaNMkV00R","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_OaaNMkV00R.jpg","message":"I had the same issue today and found this little gem!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"646b261f-a3b9-3e2c-a9ca-b8a6a78466ae","date":"2017-04-25T00:15:04Z","timestamp":1493079304},{"_id":"fa0441c3-b394-3e08-bc51-97ef74c485d4","authorName":"Christopher Carrer","authorEmailEncrypted":"vACm/jOmzc4w2ywnRagfxPLarVEQA2hAwy0VOsys0gvQ4J1m3L7zBwozVgCVg+ntwFD0tsDrHF8I9qC7VTNhyN46ZJM//fVgcDaqHb6Zd2sXPjpXqpFoDUr8rlSBkz0P4OzcR2HBjHFh4MnVSXbgOSlhPAkEOPYaB8n99l0wJLeo/4f58xsh14oUI1RaIds1yOPofgwRk0LKR9cKpG4v5pgLLFkjN90v5+TtkL4YdzwBiAyac+SI3rzzs+LwKUINVIn9Km6Sy44EjYEzDVfK9nFflJOKHyvOUejCQvF8teWMoh6BctkzWRa1sooD6XQf81NIyM9U3MAn9TpzPKLHaBiDeDJMAnLoG3qfx2GPjAiHISlrsYi0aqzc5FiFxln92MNL40wA6mCHKsOHz5u2/D1cDGg1RrlFwiFnwGWJw6zAZ+C90LbmidtAYNJEL9u1tlmzpprqj5sKU4l1XqEkEa1apG0xAjxUTwUXjgaamHsBDqWda2s9n25yEM7PVOuZH8yviqbLvsdB917s621AfItXWZF/tn56mfr/5QTlIcePtoxvDoWcRIwzPWUa6TWHNh0u3oVcl6yasEMi1wpQPxi3xoHx89XfbNKdjzgNeRxWZ5QjmO5DcP7OOZ3n2vPk9pl6utkp39Qi72jJgCEV8/Bjv7MS846tozT5voJ1OBE=","authorEmailMD5":"8f879e3f8c211a45166d50f0b72fe363","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Great post, Stephen, thanks!\r\n\r\nI'm running into an interesting problem with Transactions/TransactionScope (side note: I'm using the async flow enabled option) that I'm not sure how to solve. I'm trying to implement IEnlistmentNotification for a custom Azure provider but I'm a bit stumped on how to properly handle async calls. In essence, I want to make calls to azure storage using the async library calls but that means I have to 'await' somewhere and that is the issue.\r\n\r\nThe IEnlistmentNotification interface defines 'void' methods so I can't 'await' any of the calls I need to make to azure. Sure, I can switch everything to be synchronous, but boy that really stinks that I will lose the power of async in this scenario.\r\n\r\nI have tried googling/SO'ing, but save a few articles I saw that didn't really help, there is shockingly little information on IEnlistmentNotification with async/await.\r\n\r\nGot any ideas for me to research?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-04-25T15:29:06Z","timestamp":1493134146},{"_id":"45607648-bb68-30cd-9985-520d1dead670","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm not following the logic here. There isn't any code formatting in these blog comments, either. Can you post a question on Stack Overflow instead?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"4ca8b46b-3605-343b-954f-6d67bf854b91","date":"2017-05-11T15:23:10Z","timestamp":1494516190},{"_id":"4ca8b46b-3605-343b-954f-6d67bf854b91","authorName":"Srinivas","authorEmailEncrypted":"UTxrCkyBcGX4u5TN5p6pui7qn6MEyJ+590ijzu10FjqZRGtfjhpW8fJKCcQII+vF4m8nnTokt1fULS2qPhY5m0qDY3IIgSVq28lj8TfQlBbMGKzcuLMLGTuMswEYoiVLE1aFF19zjry/p48xN0q0KZD9twcKxcXH1G5Ui3U0zFQtcNKAP0y7prCJux2I8q5oaTWfjmrnViEh1vHm8FeCRZ80+j5jrAGUUw4DzXzdz/LHVzrCzvaHEB43e+k0CMEypuLjvmD5BCcisYskod2+7ULPcdn3rAhF1K6ylAR+Y2mdvVDrClXwbnSed8cvA9f07eEMHJSirSdtL4mP1T71x9yOw4oAF0EyQoymsXFqY7l5Wq1ltv7LXw1/6e8lL/FO7SaJdTK7egdoYPaptBAwL6pZ5uooebrvEBCQOWgr/UI66M6sA0Iq2z7sO5Yj4mGYLlJ55NUzFLOnjRZ5hlSodtzvVWX7Y5OKwUMBQSwbhtdNrTQI/eeTEhdPs0HB3bvZt/p7SmARO9LO6ClkQx6rT8/eyvbXpFVUQYH26kAvQ28BfneiGmxkpS2saJ4pnqWor5Gpg/6sptX2J10wj51d0m1rSWY2BB8xWxAhdZXI3Vdx+mVl4lUxpslR3xRYyZ/lyvvEmXXXv/mVY80SkbFjr2znL2TgVMzEAo7QfU+RlWc=","authorEmailMD5":"7bb5418ca571b2532390238b16455697","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"im also using this await but my problem is that if i call another method then it is hangiing  \r\ncan anybody help  \r\nhere is the code snippet:  \r\n private async void GetCardDetails()//Main Method  \r\n {  \r\n WinSCard scard = new WinSCard();\r\n\r\n while (scard.IsCardPresent == false)  \r\n {  \r\n // System.Threading.Thread.Sleep(TimeSpan.FromSeconds(sleepTime));  \r\n await Task.Delay(1000);  \r\n try  \r\n {  \r\n scard.EstablishContext();  \r\n scard.ListReaders();  \r\n string readerName = scard.ReaderNames[0];  \r\n lbReaderDetails.Items.Add(\"Reader Device: \" + readerName);  \r\n scard.WaitForCardPresent(readerName);  \r\n scard.Connect(readerName);//Waiting for card  \r\n lbReaderDetails.Items.Add(\"Card ATR: \" + scard.AtrString);  \r\n lbReaderDetails.Items.Add(\"Card Inserted\");  \r\n // scard.IsCardContextEstablished  \r\n lbReaderDetails.Refresh();  \r\n byte[] cmdApdu = { 0xFF, 0xCA, 0x00, 0x00, 00 };  \r\n byte[] respApdu = new byte[256];  \r\n int respLength = respApdu.Length;  \r\n List<string> lst = scard.Transmit(cmdApdu, cmdApdu.Length, respApdu, ref respLength);  \r\n foreach (var item in lst)  \r\n {  \r\n lbReaderDetails.Items.Add(item);  \r\n }  \r\n lbReaderDetails.Items.Add(\"Please Remove Card\");  \r\n lbReaderDetails.Refresh();  \r\n //CallProcess();  \r\n scard.WaitForCardRemoval();  \r\n lbReaderDetails.Items.Add(\"Card Removed\");   \r\n//here after this process i am making it wait but during i cannot continue the loop   \r\n await Task.Delay(10000);  \r\n lbReaderDetails.Refresh();   \r\n scard.Disconnect();  \r\n continue;  \r\n }  \r\n catch (Exception ex)  \r\n {  \r\n System.Threading.Thread.Sleep(TimeSpan.FromSeconds(2));  \r\n continue;  \r\n }  \r\n finally  \r\n {  \r\n // continue;  \r\n }  \r\n }  \r\n }\r\n\r\ncan any body help how to continue the loop before the completion of the event","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-05-11T09:39:50Z","timestamp":1494495590},{"_id":"032a9459-203c-37e6-8d46-9f17ae56eacf","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"AsyncEx v4 supports every PCL that it's possible to support. What PCL are you using?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"daa4657a-69e2-32ca-a723-6677add12336","date":"2017-05-19T12:53:33Z","timestamp":1495198413},{"_id":"3476573a-ec2f-3caf-baee-a388a45468ac","authorName":"Shimmy","authorEmailEncrypted":"vyH0fVT1N8gkeRJbryIQ963Z29ma8nIuha6SgEnOESxwhGng3kwwWBashiobY7BWk5hPhsu+gJsVSkI11ISgnwOCiVkNvl539hi4SiJ5N4IcE1cTnl6cmQGUhmn/ZHShrC/16tHjk8gsDoWNNyDecQXeVsy3OIIUI+JCZwa/7PljgVXd5rlDsQY2bN7PW8Tuh6bj9NBr0If4XLeaF7sQdB72FNiYt5eS/FWgb+APTMNSWkufoYizW+HWd/dQxlFSVrWOaZvFm7GyVJYlPjYPBRg3G8A8VIqU/FFTVP9n6TOTmBKZ7Y9zMzzKD9oXNd4jLoeSxMlvK1/GwaacpSS+uj7an3y6cWCVslcyPtVh6CztHtMQJL2zFUBrwI/4gJy+x9rgYLmS39Zt5TmrmsT2mkalm69YOH8sKvWWL91sdmzY7OJmlB6u5cbRXkN3BHYcCZvMDuiUbFwwXrv22uGLHK8vBu6EiEHoHLYQcmf7A4Rud7zltW57lwt+myxJbq48PRi8cQXQZR6TujA0nkYg+PCrh2Yxl8uxpGrBLQeSls6HOJnRi7yFV0hs0BJEVmUWPsEsaXErW3EBW8QFQjgZZQ+1mRyNPnIXXxqRubHtT4so084S82BUQddMonAVjzNjD2lzumJYTtah+2iL/AmKfBzEJWzw0DSy/YpqKR45vDM=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"Xamarin. Profile44. Cannot upgrade to netstandard because I'm using Prism.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"032a9459-203c-37e6-8d46-9f17ae56eacf","date":"2017-05-19T13:50:31Z","timestamp":1495201831},{"_id":"3823cc34-d05d-3981-a3d3-88fa0e319c78","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You can, e.g., clear the current SyncCtx and resume it before returning.\r\n\r\nFor sync-or-async code, I recommend a boolean parameter: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"57982cf0-801f-3940-b082-4534baf9a7e2","date":"2017-05-19T10:02:55Z","timestamp":1495188175},{"_id":"57982cf0-801f-3940-b082-4534baf9a7e2","authorName":"Shimmy","authorEmailEncrypted":"CydJTGOgw1kbopK00hIMzeoqKS3yJoz1CYvldseoAkMP6nNEIVEi2jL1t+EXbF9RiDEQthI8IdvesED5RD+qZ+uQx0ijbTQnpIqKTeM0J8ZXfLi2eKCWonbz6JfTt0kQNlEGLIPZq1115SuZB3vaEXGDKXAJlwTFxRxnqtipOkrNqWW/wrD/hKxxI8lOmbB9uO+eexQkxEDZEoOocAcrbpDJHft0Zvq4HzD3qtCmZvpRRCQzCWD9Y2oSSuAwno2LNCp5sOMTDsXu+XSFFGpkX8ZIQNQ/hJ6yVVCCJd71iV1JHRvmw95n3CU5sBxo4PvlQaI/mXvMsZ9zUqY2WBNttP37FigKkxlalD69lta1K5Io/rlM0iiiB03qdbIIb3ce2+sCuJNYiUANqrPosyTq6GyBs3Gxio9Gh23TV2BT4BcMy0liS+hN+HOp3Vtos+XEjgiPUm0wth8gZsq9+zvqU5OOOvbrQx0Eff9Kh67nubQFg3G/XrhMZWHMUjyJgt3aT4bK1wXfEWTtOtbqdn7IXCjiNDTiQVsP3m8OhOm/FbBhzYu3JyjPB1t7ju1jBLT6TRnyfn0TZ5uM5Zz1XJtZ2jyUijk7MzwE5J6qlQ7vUZ/vrc9TN68HgEs6R7TCCmiJDoJwryp/6arFi5ZLoMIoK4OYUfYZ4VH2L7AAK7d3kKU=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"It would indeed be nice if there would be a way to control the `ConfigureAwait` in the inner tasks by the calling method, without having to set them all explicitly. Moreover, I sometimes call the same method from two contexts, one a strict-synced the other an async one.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"6065c7ad-a888-3901-8f15-f1d75b106821","date":"2017-05-19T04:36:22Z","timestamp":1495168582},{"_id":"b5caf573-2a02-3dc1-8374-94f26f41275d","authorName":"Shimmy","authorEmailEncrypted":"L9g2/B6Tz4fK5T04r86pa5mkEiHIKiOYF485vFhAEvZasYXV0kt5ZQ278R4pOWC3VNGYw2uA1X8IPHh3c4kBH3k0kDs+rG7gvKhNQRgvmp2xzHzPM3IUIcOlhv2fr5dSOGz67PUA5CLceCisMoktFkqzyIw4JlUUQsdA6SC4gxih6xVkpBZ2FPMaEUuF5hMEc2EDdsxkgzwXrZrCXialLEYr+q7fSvZvA8tED7PoskhoCdc6Hox5/q/x04igecB+OTdxp2wOcanDJaHrdJpX/ymUPsqxUgJ5S1Gts10rjqlI3JdX84f48aDYUliAEmKuI2xfTGDjuVfRwq13SE2jlwGfDZuIkmnwpL4+Y/cLTvAR54jL23XDy/lwyAWq6KnayKy6YdMXGUpPDXp3E6/6GToNOzqyqOiQ8gR6h+Pb4KMlPj27JNf06K0yjjR8I2Rhg2OQ2ydyClKBCdELLCUnXMz6s1HO8BIMich9VQt5AL/eL160gX9bZt5n0j/ahOTJALRgl+NcjJen8zctJGGWJ0cPLQRvS/FvSyINg85DERv5Fx5gbAYlfyeMH58wltylIYu+XHJMTsNzDOyGY7483xH7HLtabzLX5xj6mLaofP8bXQG75HrLr6Uclk5levKJHrNO0xEII4jpWVQmEwxevorbnuvNI47USkE4fBJMr8I=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"Same here, exactly!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"7010add2-83b4-39b3-a48a-142098fdfd6f","date":"2017-05-19T04:36:49Z","timestamp":1495168609},{"_id":"daa4657a-69e2-32ca-a723-6677add12336","authorName":"Shimmy","authorEmailEncrypted":"M2VuN/Oy+662imCHFTv9C5sJwNW5r2CGf67LY5uq8aW0/yDHwnpUJ66B40K2UsNnfFbRBH1oNtfM6V4Nlp/vxK7GfAFQMSw1H6vrT2r0EPWm6jOhne1veYDiCPIMDEMfjUMp7cAW1uO3eghe85xewV1sEpSeEqMkOKMQ5RaAta6XxBnWomh3HMWKnQLkvXJ8FzwnkIyA4Ov1aRx52BcX/7c3n/q5w3m73YA6DpBoNjejxcUmQq5apMC1R4JNKVyLwU9LvXhRpASu041c13wVkUK/PsfwS86npjo0+H1gtzPjMxeKs9jjTnLx3i5/cshUwRfszUxsmvAEYuAcRRv57yVsHd7olPhiS1s0SHcHDNiIRFJljjmsbLUFUelrCeFvoUbWjDmKFObZLYtqGknUexliwMwFEvP2G2PggGk8gFfZzI2XBSW30uRuWzeniu2bo14mCI0Dt5PhtwziAv4lRnWR34T0sx5cUiZj2vQbIKj206djaV/D9R+11OjYGRSPmMwqqwyDibpddDr07eRNlrW16z79t0BOn9dp8vF9WDryUu99BSc4OZDpecnZx2TkPJo4ZilnVfIVJWUIxSDjUDd/N4Tr6gwj4pyeycfvE6Vae8vRghbgXjiLNW4sQskNCenQjW0wBimLOCri6q1YwCj1J/UkZmOWAOAX4fLnoB8=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"Wow that was a great pile of important info. Looks like AsyncContext was what I was looking for, but unfortunately since it appears to be unsupported in my PCL, I'll use \r\n\r\nGetAwaiter().GetResult()\r\n\r\n. That actually does a good job eliminating the deadlock. Thank you!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"3823cc34-d05d-3981-a3d3-88fa0e319c78","date":"2017-05-19T10:46:09Z","timestamp":1495190769},{"_id":"e4541037-96ee-3715-bd49-2ceb80f114d4","authorName":"Shimmy","authorEmailEncrypted":"QtqphqEat+V/0UKaQkQbspStNWv+ZnfRKudrLl0MWbUpk9xgV2umrZlx0o3oebQDpmFc+KzyZfd8EKRVgP0IzV6ozelrGdx9RRlU0X1wHcr3mmCBqT+e7lnrdIcb3Mp0diouoa/mlMf/9SUNQW5P1+jpuhC0If6hIDSL8a/VlszHFPkZp/SNhpGXd+u+rGVCDBCRxEW3n829gWsFTsVw5mk06MKJi5CzKvn8wkODjMw0C0LG52Zx6HPnfO1ZAJvEYV1HLcXGqeF3lTlVulQ62T3EdiT9Q/kEDWkL7JrD7oXbg7U5rbfw5El+9zK9SSu2+bUw8eOwQsFJmDDnF02Lxt76mPRmYCsu20M9qR2LPrUfN2eY/ti/O+CHgBdrkgWTMghMLWmry1nJAEWWs6D8yxtQU9N+vSRT2P0+m+/+vRN+WjGiIi+OR/+u+BO74jjI8WPRZAugTg2ZZETZoEbu4NhMtkTOczsxrkkMrV5iPClN0/usBbGZ45m6blkq3TTPFKpv5PipECWv0jIhr8zx03/Ib8F3H4Ryn3xKdTDM2RF/PBfsJiMitAXU/cnqlKELynOI747wNNmRq2h1EJhqdwiXGepF6WasSZTPsCJ45QFM8MJWLGEov/ugkoTrjXMghftM6U5nQwhp7/5eTNyGvEG5lmbhkcRPJpySA0ZDxBU=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"Saved me a bunch of trouble, Thanks for sharing!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-05-19T04:33:04Z","timestamp":1495168384},{"_id":"ec05a6e2-ce9f-3222-813f-9edfb2c02ede","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That should work just fine with AsyncEx v4. If you're seeing an install error, please open an issue: [https://github.com/StephenCleary/AsyncEx/issues](https://github.com/StephenCleary/AsyncEx/issues)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"3476573a-ec2f-3caf-baee-a388a45468ac","date":"2017-05-19T16:36:01Z","timestamp":1495211761},{"_id":"42e48f6c-0238-32cc-95af-9f3312264c36","authorName":"Shimmy","authorEmailEncrypted":"pArWK3ToQCh2Aax/ct6Kz+bEhPb4rQf4N6isUNrRIpc76C76EBrTX+yes4ycqBzBPAxTOVaw058XItRKl3hp2U76nLgzjBeQkPp5nqtxKDCXPltiZ8JtwnKwg48kG6c2puH2yald+s/3leOP2YVdRQOrwxuxwq5XS4/1hOxa//x8GJOCgmIh8p4n0PhTtZISV46um+Er3L+eWjMwLEUVoUXBcbq4AipyY/rs4YZKd6/RWvWyPB8PLxmOsGdKgxhCcRyJ9yDzDXptwfpQ2mFgSWj3fw3daRcZ2mGapQFNePoZ76jNoKzLS3vbJjVPeg3AQ01/VnEpfTJOtGp/VKU1aYi6H44qTHDm2vgY6jnivf+fMvz3cyOa3oonzHl26TwCy5fcivc0YgSOyXaACeZ2AjSXRsVsdl32y7WUZuGikBkh17OFcZQb45by9Vj6FYkQvneXQgo1GiL4S39609CpAIvYnXXbqoiw+xk3IVK1Z9vdLgw0a4uMe+VJGd5lb1l7LSOQLgcTZwiRz5d2uTTFB1uPVjipEAI80/jlK518inZYdP+o8yMcNxLtlNXCIkDJah39wvBvebmS4Eb288sNahmlxb1rP81U5SDngioZSUID/+kbxWiuHcivhZPRUOgqwhe0m++U5wfbRNV4/z/MxpFqbkTTXkd9AVv435Rn6Ro=","authorEmailMD5":"8ac32db29e5bc37f2baef574334d79c8","authorUri":"http://blogs.microsoft.co.il/blogs/shimmy/","authorUserId":"disqus:weitzhandler","authorFallbackAvatar":"https://disqus.com/api/users/avatars/weitzhandler.jpg","message":"Oh, I didn't know about AsyncEx, I thought you was referring to AsyncContext, I now realize it's part of AsyncEx...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ec05a6e2-ce9f-3222-813f-9edfb2c02ede","date":"2017-05-20T18:28:36Z","timestamp":1495304916},{"_id":"a2d2af39-3b11-3f4d-b0c9-e873510cb9bc","authorName":"Justin","authorEmailEncrypted":"Oi78neYjEX86uBLWlK7NALCsgJAc73DZi+KJjW+URa/icit4HW5NNjMArva7z7795MNBt788JXtrnicmVCiTK4hJ+P/EAiOvEFtdLaW4OLIJDp5gtoiwZKeT0KLcxGyEtP6Tjsw+eA8pNxTm2HoP1VZa/nFJjupES5I1yPzxB5H2oWBnLHz3SGVnIphRbA0YDqdnrcMpvc09qZMK8LjOGrWj2I7uLR4/nBdG2B29AnYYci8l2RYlrKVtd9jbJu4b9uoFKjobFG37M0ssMmIWbyA6/+a9GG9jEtwK4lXwFlCpfwVvPuMz8miSPQhlQB41V9lrQLZg7XGEQErOeKs0JBY4rsfOSXVG78+y3zKEkg7jPqIRnUlvUCL614pStWgFjxCMA/Xk+SwDSym5MZaMx86Ro7+m8rfEZvKSOTZz9szPNywnjmHpZZNJJPMEeO/C1xcJH1DFMszsfLJuotnIk7Gj6h9gEuU8XnH/B4X1h2J4gF6GC8KNIJ42RXZvWdjQ2fmeV0jZK1M0N9fd/Rk2rsn6TyjFXBe0WjrLchQrzDNiLAsnBcijscSVhf8eqz7lVxDr6/8FRsgNc69K5CJUxydsoHku8WxgmOuj2iz2NJRfbxK1hGaQ+h8EVLX6I5+8Npg/QHSnudGZ1WFs4wnisgJFGqawXt9m8sTIaIQ2QSA=","authorEmailMD5":"a5af054d8ec73d474af5ee43bf6ec90d","authorUri":"","authorUserId":"disqus:disqus_FCsGcY62na","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_FCsGcY62na.jpg","message":"@stephen_cleary:disqus Quick question - will the above example *always* deadlock? I'm doing an audit of some code and I've come across a similar situation that I'm suspecting is blocking our UI thread but I'm wondering why it's not *always* blocking the UI thread, it's an issue that crops up occasionaly and seemingly randomly.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-05-24T21:40:40Z","timestamp":1495662040},{"_id":"d0db2357-bc22-3ef9-b60c-7c2946656704","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"This example will deadlock *unless* the task is already completed by the time it is awaited. E.g., Windows Phone heavily caches HTTP requests, so those can complete synchronously even if you don't expect them to. And if the task is already completed by the time it's awaited, then no asynchrony occurs, and no context is captured and used to resume.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"a2d2af39-3b11-3f4d-b0c9-e873510cb9bc","date":"2017-05-25T03:28:52Z","timestamp":1495682932},{"_id":"243878ad-aea0-3efa-b8cb-acdebeebe5a9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No; the deadlock is still a problem today, and always will be.\r\n\r\nIf you have a one-thread-at-a-time SynchronizationContext and you block on async code that needs to resume on that context, then you will deadlock.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"a74f5f64-14e8-3f15-a7bf-44fd47e6f382","date":"2017-06-29T17:24:17Z","timestamp":1498757057},{"_id":"8ad994bc-2357-32ee-b0a8-5f82407a4260","authorName":"Ravi D","authorEmailEncrypted":"Jl9geamWClMipS2SM2oE7qaEnKgns0iDKo5HAkIN+SQA7DOUM9qUkWxVHjYHM2lntgOjUfYsjSV2rmSAP/oJidbvd9PgRhdMdN8gb4cuYe8Ls9sqI1YrBYYtp0EKEiHNqBcqNAYvBGL4kyeYjgdyOlqRr4Nu0nXt9A7ebTr+k10tTON6Zy4WWdz4ufUi6u0UoyNB6RFgGxai8OChRe52CTuwuY6w0XOOrMsxXv2f9bqx6GeDh+lDajd03xZdi8N7pFwvvJU1RJc2zA/XPeha2IbHMoYMw519cmwX04aYqpzsVWHtaO/bUFl1m527OsCciRXlABxh1xDu+9G2ZKCLl2FTz9/mHs78CI3K5SicZS6YvFv03op7FEIW4ldeNqJGQsSuWxd24aM7TJG+N1gZWPC1yfHTZwDLb9IN1AEikuIcUREnOi5jkuvx5qhhnaCAKZji14XiMhXEI0DYY2m+OTtESr9HF0DVfQNitV4w6b/exsq62fYc0cTjy9XeA3ZVD6ffoLiAJLjtDEaK968ZR3Oh+ZxmG6bkGyIS1brm3uugZ+jCYQwnu21iGGMU2HOaXaZduAODRYMsqpjkn0yVC07/c2xteLwNweyTrha9EkiTN5hwh3qiPu8gQht1HZ5OfQlOlQW+VXn1vvSb0sFjXyIbvodCB8QX4sBJDrRwK3s=","authorEmailMD5":"cfbc29faa21359b82704f8b7b26398ab","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"As of the 2016 / 2017 versions of .NET this is not correct, is it? Per .NET documentation. jsonTask.Result.ToString() will block but only until the async task completes, so the runtil will wake up the calling thread and step 8 (Deadlock) does not occur.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-06-29T16:49:52Z","timestamp":1498754992},{"_id":"a74f5f64-14e8-3f15-a7bf-44fd47e6f382","authorName":"Ravi D","authorEmailEncrypted":"sNojmmJXURd+56sf806IcPgMDWHaEaXS1YOXVq0K9Q9AfNlA077ruLttVnOCGnR3qB4uZcgXynhpb7Vy7zmTSnQ9anD1oePri9Dr/pgH9G+bcAj5dSoQfMYeZZq7qOXd9fVSokL3uMcSReapIRKj/C9f2qozbBk5Mx4nGMRBlXtVkzTws4p3QeCaAnp1lQmCW5sZhVYnZjCYzzXfLzNqKuYlpwDMD4HP4tpm9jSmmAlNrL2hbsz0fUOIAyqrBWYTxu9DNqI7vQtm2oKzpWvK4jV+1/WMuPUFTbjdLuT0rXkClM5Xh05W08teX2JkN9ZGBVZ0qXhuTPQaPQ079eW+mRnFURavsBAFHkeXrUOTa28+1jirKmmgNzkvnfwdaIEnQyw0XWb4/3ntqqZ8uwU1iVu2xf4OmAc8gB2h1iURrdcRUp9xEkez+Ct1W44dZ5LxJdjnL5DgrD903E5ba3CfnG1Y1est6kFOMUbG8YDWs9dqNdc9IvxbiHNCozxW+1+lIJvRByZcdvz97UW8Kb9tAJQ2KntPT1UaCQkpxbkmPGq4KToWHAxjmaTkRpM8Ze+P3clFGWZfUDoqncHSOhmFVJ/MYsj0XpVjwu12KT+oOfmavHYkY8skDAxGnCEqOIYZl5uzEIGMfcs3X3JonabJh2+rxq7kBe8pwCfunOzsCoQ=","authorEmailMD5":"cfbc29faa21359b82704f8b7b26398ab","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"meant to say, ... the .net runtime will wake up the ...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"8ad994bc-2357-32ee-b0a8-5f82407a4260","date":"2017-06-29T16:51:34Z","timestamp":1498755094},{"_id":"54dd6a93-7218-3968-953a-7419190a8272","authorName":"Ravi D","authorEmailEncrypted":"DTjqNQaPsjqASP9+Z1g4Q6VwPGTVCP6zZDlqmVAAJX6ldiufK7JmUimuK6AvFsilxkAcVhn1L5HsOD65QgFz5nOy90bEbWjwlaYE3S/Z39v2ohkCLzRrhUN4k+nr3TxJ6gctpAluDMtBvxgR0b1hRlefYtW3v0pvIMTPo+PEbo4lrCLo1PEE89R/MicHv3S+hxOn6iyxVaQFI5eaiIYpESi3LNlECvYW0s9+VduG2L/++6xvizrlB15oWPSXbK5eI7hdfNRtY6BNEGEQV3xS2wy5UCT5LWfJvArC6j7Qzee63lMC1s7tb97OrRgIp4axfH0D0q3/Huo6FZzdTSfak7wj6UPuUwMh/+BB4JlGRYKQOGdcx9QKCQJJSCrXirf3+fSgs7fUQ8WwD/8yxGjuWGmWmZasR1RdnsY+tGfMpK1omzPi1K3fm9aCfikE3dnb1H9wySFCep2qpVVNY902Pi82W89QXzwb4XqmmzuJBfEcCC4V2eoOCkq/GdyESG8er8mn9IxNYHcWroXuZo0bKEjSOnFwJvZT13kdJDdY5MM9k17N+X70pW15mQi5b9pkr8ztyL//ZCuu8y3cLAPhiBpZq+qWFhMbdVp+/QdcwTr3jcHu6Ne24SFPPnXIKnf5CujT+7N/JO9i3ipemq/7093WNYHcrj4iBqUivz4bd3Y=","authorEmailMD5":"cfbc29faa21359b82704f8b7b26398ab","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks and much appreciated!  \r\n(Should have read [https://msdn.microsoft.com/en-us/magazine/gg598924.aspx](https://msdn.microsoft.com/en-us/magazine/gg598924.aspx) which you have referenced, which clarified what's going on.)   \r\nTime to get your book and read it.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ffe94b36-dfb4-3f46-958f-c4cfaa6dcd30","date":"2017-06-30T20:07:56Z","timestamp":1498853276},{"_id":"f3a14062-f084-3880-9004-aa1aca73b003","authorName":"Ravi D","authorEmailEncrypted":"K8BReYSiV3/98slSDFU8WSr6Tneco9FvDdM8br/28Zqx4xJTDJ0EGExGrGr2ezAAb149oFrURb7meQBCLiRaXX5iFEoHjMNoFcEUJhjPQozVVrq8iZF3yYgEXiPBwJkO0bTXK7MFM6DR4hhivHzuTTe27/dlZlHsqXVRWJaxhsIdq2rcdVHq6Wdmog4ef2WzHLZ57dob1JctR9cdhsPoqo8RkFD0mumxpaZZ6e8x8Qv+5mXz9nPRz58NKW57cyYfgiGEvDF1HXIP+CwDfUWS8/ofAcTu8BfIuzFVXWSWK6nf+GNC8imfrXHPlErTFPVG+PS6eBDPiGX1iJAwAzzjMd1oDm7FCHwTtd+EM/8elXkHIHqwHgZcelSf6i+hxi4jbwYG/lUdMInmudAJKpNSBVq9/s8cIM8eA5MBs3rzlowqE1ZBwLHNKh0hJnmvd1atRSfQWnVLg76F/n9LZUU5+aRECql4/SnA1PdQcjgiP7lLVwelPi/GtV9PFP7B/IUkgN3EqFmB2rt5m6V6d8kaWdU0rHrehk4BEsEVQx254ILmCTs9ZdtjPEfhcath+Xn+bRqa7gHxxSjXCJew+JFcUfy9c1Gshhkdfz/IUxid+DufavZCjcc66UUE6K/9zFSU2fb14QE3Kczh7si94DPvcpScCp4zuiy3w1Q1JGEDdW8=","authorEmailMD5":"cfbc29faa21359b82704f8b7b26398ab","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"I tried the example with a simple console app, using a single class that mirrors the example. but could not get it to deadlock. Tried different async scenarios to make sure the static async method actually yielded control.   \r\nThe console app does not create any threads so it should be a one-thread-at-a-time SynchronizationContext.   \r\n(I can post the code example on stackexchange).  \r\nBTW, thanks for taking the time to answer all these questions. And thanks for posting detailed articles which are very helpful!","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"243878ad-aea0-3efa-b8cb-acdebeebe5a9","date":"2017-06-30T17:07:34Z","timestamp":1498842454},{"_id":"ffe94b36-dfb4-3f46-958f-c4cfaa6dcd30","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"A console app does not have a one-thread-at-a-time SynchronizationContext. It doesn't have any SyncCtx at all (SynchronizationContext.Current is null).\r\n\r\nIf you try to reproduce this on the UI thread in a UI app (which does have a one-thread-at-a-time SynchronizationContext), then you'll see the deadlock.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"f3a14062-f084-3880-9004-aa1aca73b003","date":"2017-06-30T17:50:37Z","timestamp":1498845037},{"_id":"d5903678-78ab-38ae-8f0f-ee7dd0ea4082","authorName":"Cameron Averill","authorEmailEncrypted":"XNdmtzSI+so7SeygmKV5Md+HTs743Ga4MUot/bVLQzFRwJSOpi+L25X5+PZgUVZs7lKkrWwe53H+M4n+jyYSzqn8o+RqmCk597eOPvCEHumKk5cTmFQdM0B1JtVdAk6hpgzQhc5S3mUApK/q4GIvgXPhHK3QT21EOkYQcGQPVXi48cOx6cqL4vVLgc9uMyGFCthG8MHbH76qakBZR68N1tnFmcGNwqff64br+Xfvhhh1wSWCaTKisu3MQYqR+sMiXRNMtcizp2f+W4QkEqy/goZoJclEw4qF4UIkawoMNnVkw1jTafEvcgd3Bq2cb6wUyfVhGGfkrj2k+rpu7aCKpVpoSf/dN+C46whhqfFozecOxFJmvAd6UWxf00bBr0gEqbpiwpsZaVjL95GXJJ0+S2hWKj4K8Q4mcO82qxDVYy4yFmwchc0o9+K0FQdST/XhypFVlyKpFn8Z8vynJGjCXg4zW39XPBOpfY75yVapCRGTp8TazvNE32qjhGG6vXJdlnit3WipwABsEKAwF4eBe1ao5G6gMFiJUR3Y8B1F5jSfotI/Meq89A1gx6RpXUF2daVYjwbbwC7ab63orOKZjEVmBjilrgRY1fM/gAffRhYxgLVNgfG7uzxL5g1HHjanrjfjLVUIV4TBUsf5BB5+ZFLcC120ZoEQjSplb5Kwm6s=","authorEmailMD5":"f40eb2d98a486d6d0a90dd43b3531d60","authorUri":"","authorUserId":"disqus:cameronaverill","authorFallbackAvatar":"https://disqus.com/api/users/avatars/cameronaverill.jpg","message":"Love it, thanks","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-07-26T18:56:29Z","timestamp":1501095389},{"_id":"9ff182c0-f911-3913-a685-ec07600bd5fb","authorName":"Doron Grinzaig","authorEmailEncrypted":"wpp/Ts9yVS4DIdBkCOnrY3xSFARZNWtnJb61bTc7pKs6crfzrAG9XZn0gFBzhbjVhfIPENbDDSTARWylCW7nK5Hyyxz/fXv37dricEnm67xaqZ3x6023SGzsfmntTciDH4S/nvh8QX6d8PANvoHB6WWLCl3MxRUzOQHm3PazfZ9k8NTXefa1IhVG1qjlXloB5upnqi2WSAvAkTcRlrVDTJZL1BQi1nS8mJpNVHRECS0WCAcOsxHGksMzAY0BHlF9d3UmcqNLiDPSABsngwEyKOhrZGCCJre3W6fL72M/YKOW4uC1z9NxtZYxNMz0HK8mqDO5hnMY6+JiCBc02ndWNAlbrRuj2cP9Q8VDuPmE8c07mWVLfYL3uDrpG3W7r/WLiIfXNUmDH5K/iDyGIP5s9L6Dg6MhWt5Q+BhoJPTj9G9syA8KIk17U+Y+Q6ztq9dJgAWXrB0guMIpqkXHRps4dD9QkiXZtbSmkGwqzFLdSxZvgttAHjXHSRzovTmA+vXOp6LeqN2AxodvPw5ziDwXz3IhvjdpyUVbBrZHR003LV6OWW8YzqA8ZWYmrbOh7kXtzpGi6uZQE0CsgCJYTwNvCRRzKCIXdapLxwhbePNR3pHxU5hUhSqyD02MIn91KmQShZK/DLZKcPHfqVBL8o8BcrezWGNqd1PZBol4EC7Oiaw=","authorEmailMD5":"02b2b843388c866cab51a735f817b291","authorUri":"","authorUserId":"disqus:dorongrinzaig","authorFallbackAvatar":"","message":"Hi Stephen,  \r\nFrom reading your post I understand that unless you use `ConfigureAwait(false)` you will get the same thread.  \r\nCan you please explain how it aligns with what [ Nick Craver wrote](https://github.com/StackExchange/StackExchange.Redis/issues/597#issuecomment-301280474)\r\n\r\n> I'd like to clarify for this and others: that's not what .ConfigureAwait(false) does. It doesn't affect which thread it continues on, that's your continuation options (which are often just suggestions). When calling .ConfigureAwait(false), what you're saying is don't capture the synchronization context (to be more lightweight, having less to restore upon continuation as well).\r\n\r\n ?  \r\nThanks,  \r\nDoron","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-08-21T08:27:53Z","timestamp":1503304073},{"_id":"864f7182-0020-3f04-b548-f8d700cd8d1f","authorName":"greggwon","authorEmailEncrypted":"HdqKvXMJbJZDHPpMeC4siR2I2o1oed20jVsTbDcUthGbic45iVBp0wl0IgGlxKZNhX7kXzPJvZXgA/1cBX326gBCpiwusFoEZK4GEquqy/I18FSLmtsVadnJFccpp4D64UOUuC9QfrwKYyEfJtrA5SmTEYS9/tKC4XDZ0kLNQo5RpUGTlSWVouDT51uXoGplan7xKmo9+/6x56Ci2mUPhHi3AW0We7ewdbP2ZHksKCbFYPx5JXCcHEx6UUoTMTEUyyMBjSLMiFmGkagy7ooC63cdjRgAJKd1sXjkycK3hdiG4PnVALhbGAtv4tnzsbsFO+zOOxLcMig/15TyY2q9iIzJyTWoWUeOYL/c3vngPogjuPc6bR377KpaoPaqvprJZxedG007IbIlX8C5zyPAMN0etPCaTWDfLiGnUOb1WtHnsNH+DCGClycjmYB03CKuiPUzJ+6bMjiinPUenyAclPWp2QliHgAw0R68uyT15uLJIbTsifkpBPMvhPIePigjs16aq9bgFvu6AaW7FPqM6SrADpOGetEnhyGIS+fsLPzduJga45sYQAGJhOT6tSDyxGmt2V4qpbj12CEJSub8RMUOvV0IB2DFspQgjXOzn9KIAhTZUzCwHhu5GCCTcT6QCogqg5Nrl+WWgAhkfEmI0f858TRVaQiWuXlmvNduor0=","authorEmailMD5":"142c71b27a71ba2448701da921b0d14e","authorUri":"","authorUserId":"disqus:greggwon","authorFallbackAvatar":"","message":"The problem is that getting the result and using the result are mixed in together. The better design is to clearly manage the three phases of async data gathering and use, into an API which includes managing state so that \"dispatching\" windows actions happens in the right context.\r\n\r\npublic interface DispatchManagement<t> {  \r\n void SetupUI();  \r\n T PerformAsync();  \r\n HandleResult( T value );  \r\n HandleError( Exception ex );  \r\n}\r\n\r\nNow, implement some classes around this interface, and have the base class use the correct Dispatcher, for your context, in SetupUI() and the Handle* methods and dispatch PerformAsync with a Task/Thread that comes from a pool.\r\n\r\nNow, you have something that will actually work. You could use delegates for these methods instead, so that lambdas could be used instead of whole classes. However you package it, then, there is no \"context\" different from the code, and there is no thread lock nonsense involved in creating linear code flow between two threads.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-09-15T19:13:52Z","timestamp":1505502832},{"_id":"1c978b71-601c-3295-9736-e482ad3a1ae7","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"What you're describing is essentially the Event-Based Asynchronous Pattern (EAP), which is still used by several components today.\r\n\r\nEAP brings its own problems - in particular, when composing multiple asynchronous operations. I go into more detail in these videos:  \r\n[https://vimeo.com/ondemand/asynctime/229418352](https://vimeo.com/ondemand/asynctime/229418352)  \r\n[https://vimeo.com/ondemand/asynctime/231644901](https://vimeo.com/ondemand/asynctime/231644901)\r\n\r\nAlso, EAP doesn't solve the core problem anyway: when developers choose to block on an asynchronous operation, the delegates still need to run on the UI thread, and blocking the UI thread will prevent that.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"864f7182-0020-3f04-b548-f8d700cd8d1f","date":"2017-09-17T01:11:56Z","timestamp":1505610716},{"_id":"c01bfbc0-c2c2-3e8b-b08f-4a141a886b64","authorName":"greggwon","authorEmailEncrypted":"X4MkR6rAo96sdOPZg2Ua6LkyRtzHCp3bcz0/ouPBXdcPJbQXUQB3RnObdz45bq3y/ZC0XiSwhBdDsylZID1yX/o7xktqQ6iZ3pqEEE0drlhlodhrELhyh196NxBQELJKokWJj6lwTjHein27lUzaJ5jDf+FhZkgs90KBB1eTJfUG0eLrBoL/Pp+U/FQHb57Edtrr8aLmDZKv6ZK2eWr58OcdP5zWw//Oq5izkfw/YbZxQ6EfiW0NIiiYW6uhlEKYYHN+i6QfuRkys4REPw8BJiu6plB56/KBHyHKKmdyWnNLi4b3Ef71CaJTJVcwpbVVLjQ75ViQWOO/PO62HLuWjbqAaJPP75vPnP0SQaayNwhdkj/1Orhc/6q6rI1c4nMKxD8W2kua7aI6/ItxwUfIxnUVRiw8D6S3pxPObDspR/mLyDYz7QZTT2iY31J+2j39+GlPET+rW6Snp66sOZHKldNniDROxDeavTTttARXioIV93IoFGrS8Mjemg8/PWofH7OjMfmATgB2B8vpRF5LucviebAjTxpwDXXB78LtjQ6A1c/VmOQTNtkQ+XYK2Cdtq5dx5C9GzDNyddrqA8BQ2BUXpTSO6xlouEUbuwwga6OfAM5KYUnjfb/L+XL7Hk1+8VqyRia8dse1jz1HeFdt26snk0gh0WNEu5oE6jUe3p4=","authorEmailMD5":"142c71b27a71ba2448701da921b0d14e","authorUri":"","authorUserId":"disqus:greggwon","authorFallbackAvatar":"","message":"This is the structure of all UI work that needs data, and then updates components. It doesn't matter whether we call it a pattern, an API or give it a name like \"solution\". The point is that developers, 20 years later, are still completely put off by all of these nonsensical software design required to interact with a UI and data. I mean look at the disaster of XAML and how much of that is just not quite enough, and then when you need code, you have to peel away huge amounts of XAML, translate that into code, just so that you can do a little bit of something that XAML or declarative programming doesn't support.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"1c978b71-601c-3295-9736-e482ad3a1ae7","date":"2017-09-17T01:18:14Z","timestamp":1505611094},{"_id":"990c72cd-19bb-3655-9eb3-7f3d9d5b94f0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Oh, I agree. Windows still requires a \"special STA UI thread\" and probably always will, and that's a pain.\r\n\r\nIn the early days of WPF, they tried hard to separate this out. There's still holdovers of this attempt in the \"visual tree\" vs \"logical tree\" - the original idea was to have devs access the logical tree from any thread, and those updates would be \"reflected\" to the visual tree that is owned by the STA thread. They were hoping to move all of that \"special STA UI thread\" stuff to be behind the scenes.\r\n\r\nUnfortunately, they didn't make it, possibly due to time constraints. To my knowledge, no one else has tried since.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"a7a5560f-9ee9-375f-ade5-a9d45da44c94","date":"2017-09-18T21:25:09Z","timestamp":1505769909},{"_id":"a7a5560f-9ee9-375f-ade5-a9d45da44c94","authorName":"greggwon","authorEmailEncrypted":"XgkXr4iTlHb2l3aNfAqo+E+pPzicvwD1U6rYwbNxpQgtbHEs07D9ozxmoq9bhq3+CRcIm/0ZOGX0/7B0c6OGuyE2VYhjmWgNE7dNOuYDOiP9DHY/TkVyN/OgtqD9zvpb8G3tNA4fsHOb/cTtyl9FbP38hyFi5KjKFROhRnmG6g7VSZ2Bg6h3EoAo8EdD3akcokT1c85SNpoR+kOaQQ/snOa2E/43T8MZDf/Fc3k39iOWeVxtYAEycc5l/Ix/j8LqK7kN0qucPDxQYsjUIGzlvQFN8MrySTFgRMp6a56XpO3Z7bbj/GAjA12uR4AAaUe+ukoJBCFwKFemchTnGcy2dh7ocewTXl9yBsJMVTO5qXAtjrRrrMX2oh/3sRKszuUhqbXL2NYtrmrpZk0ELBYbul86EgzSqiIK2xnQKa+CiiBMJnd+ApuXhoqDB+ae5ONxHrfOgazqb2gbqSuibyJ2r8f8jbAB/SzS4Lu6Nxx5CElGdwbCdPj5xbENbyMzjeEpHTToqagpTqyrfBywlhwhQMWQZCSpfyXPJuWqUAVnaaUO6pjzf/Wi69L6b93866AD8fPJfC7n/QLU0ld8H6sXw/VAbxIbkaDKpjADsTVLZXRQakDfV4rEMlO3+MYQ94Us6RJY/4wvgbnPQFvyAVScFugzGYi7mCnitslJZ4w3xks=","authorEmailMD5":"142c71b27a71ba2448701da921b0d14e","authorUri":"","authorUserId":"disqus:greggwon","authorFallbackAvatar":"","message":"It really is the windowing software system design that is the issue here. Why is there ever a need for a user to purposefully choose a thread. In this day and age, that should be part of the \"system\" that they develop against. It should provide explicit APIs that manage all of that. It the neglect of the designers to do hours of work that are causing millions of people to experience problems and waste millions of hours of time developing, debugging and using a piece of software that does it wrong.\r\n\r\nI regularly have to ask, why is it that I can click one of the three buttons to close, tile or maximize a window, yet windows can't allow me to grab the title bar and move the window while my machine is accessing the disk during application startup. Even Microsoft is creating a horrible user experience by not managing anything about this \"must use the window thread\" business effectively.\r\n\r\nIt's not hard to devise some different paradigms to fix the problem and even create an automatic dispatch mechanism without burdening the user for doing that. We need to move past all of this context sensitive execution modeling.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"1c978b71-601c-3295-9736-e482ad3a1ae7","date":"2017-09-18T18:17:41Z","timestamp":1505758661},{"_id":"37b75eff-273e-3e81-b8bf-95c1edc5fc06","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"ASP.NET Core does not have a SynchronizationContext: [https://blog.stephencleary.com/2017/03/aspnetcore-synchronization-context.html](https://blog.stephencleary.com/2017/03/aspnetcore-synchronization-context.html)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"2490bea3-46b3-32ac-b94a-befeada7ffd2","date":"2017-10-04T16:03:03Z","timestamp":1507132983},{"_id":"38db96ed-8d0d-3883-b5a2-29a51bf43f39","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I don't see anything obviously wrong with that code sample.\r\n\r\nI recommend that you reduce it to the minimal code that causes the problem and post it in a question on Stack Overflow.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"58fdcd04-b518-3b44-bd61-6bc5bbcb89f1","date":"2017-10-04T16:04:49Z","timestamp":1507133089},{"_id":"a5bb857d-c4a2-380e-8549-c05c4bbbd561","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, every method makes its own decision. I agree completely with that.\r\n\r\nHowever, consider this: in the same A -> B -> C -> D scenario, then if A *blocks* on B, B uses ConfigureAwait(false), C uses ConfigureAwait(false), and D uses the default (ConfigureAwait(true)), then you'll still deadlock.\r\n\r\nA lot of people think they can just use ConfigureAwait(false) in B and that \"transitively\" applies across their call tree, and they can block with impunity. But D has already captured its context by the time the ConfigureAwait(false) is run in B, so they still end up with a deadlock.\r\n\r\nThat's what I was trying to say.\r\n\r\n(Sorry about the delayed reply; Disqus has been sending a lot of comments to spam and I just noticed today)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"4dbaaae2-a781-39c3-b6d1-5cb244da1a3b","date":"2017-10-04T16:15:14Z","timestamp":1507133714},{"_id":"d25a40ca-14d3-3404-be10-1a516e5f505e","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Hi Doron,\r\n\r\nWe're saying the same thing. Take a look through this article again as well as the linked intro article: [http://blog.stephencleary.com/2012/02/async-and-await.html](http://blog.stephencleary.com/2012/02/async-and-await.html)\r\n\r\nawait by default captures a context (which is the current SynchronizationContext *or* the current TaskScheduler). In the UI situation, it's a UI SyncCtx, which is tied to the UI thread. In the ASP.NET Classic situation, it's a request SyncCtx, which is not tied to a particular thread but only allows in one thread at a time.\r\n\r\nConfigureAwait(false) tells await not to capture the context (which means it will resume on a thread pool thread).\r\n\r\n(Sorry about the delayed reply; Disqus has been marking lots of comments as spam and I just noticed today)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"9ff182c0-f911-3913-a685-ec07600bd5fb","date":"2017-10-04T16:29:03Z","timestamp":1507134543},{"_id":"dd318ee9-89cd-310a-bdf9-83836217e409","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If you cannot use asynchronous methods, then (by definition) you need to block the thread. So, blocking via GetAwaiter().GetResult() is the best you can do.\r\n\r\nNote that no other thread is created; it's just blocking the current thread. However, since you *have* to block a thread anyway (because you can't use async), then that solution is the best you can do.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"317e0731-4504-325c-b71e-f4650a74f0f5","date":"2017-10-04T15:43:28Z","timestamp":1507131808},{"_id":"2ec2bd25-6238-35df-9e9f-dcfda1b58f6a","authorName":"x Disruptor","authorEmailEncrypted":"eT9J/HgtugRC2FtfQIFcO4P+zI/T3882Uo+xpWkOnlqm0VkpdRNKxMlS7zo0+MXRO8F3hJ679gsbOfoCEyb3ONYKIaHCjh9VutDIjBgT9KYpDF9DF0f32UyfLdHcrCz4TFU08flb0wu012XHnCMBSRWZVOxKuUEpopTI3eGlVAYFXxGIura6VATUBTAHWNpLxakz3x89fO99fFOO3somGb9vkrkhjR868OBbkNmQZxOjrPtGBnOpQXtFOorMARspCA/v1Wgx8CqaB4gEo6iqv/pHolY7d12II4DJ3DWPkf/3xjOjYLXvQmvx3oUJg4phyMa2lhTw5WG0DLoX+u5pMQhhof52+MvxxfErE2uoYiUMKFvlSs6b8spoMAkvvLhL+jGiqAi/AXdcXfks8BuPEZGXb3t2FOd5bAwqunSEwC8hYQpPzvjFw8edeeGLI5zKKdegSB2kR8rDxiu4xxMc5FFfNXejaGL3f4O7PTcb87/EtN9Be06D9cQWv9dImi2GU1tmhJGR1SrKNuPI+Dj5FmYBnVnunWUJbUZ3mcatBFrCguKI/M3oNQCt/oO6ndG9YtZFVJlEuO0rxJ7PZNRNOxwRfYYjIYnxBpZg2JaehG77clwkfliNgjzxCiJer03lG7pmq0t92CBwtJqQhwNTL81wP4SuFHL1EI2lzb+2tSE=","authorEmailMD5":"ad46e1336e43614ea24e0f42b9a383af","authorUri":"","authorUserId":"disqus:xdisruptor","authorFallbackAvatar":"","message":"Thank you so much for the prompt response. I apologize in advance in case I have misinterpreted anything regarding your answer. But first some background on why I'm probing into all this:\r\n\r\nAccording to the repository pattern there shouldn't be leaks of references of any kind (IQueryable, db-related-exceptions) to the upper-level layers (mvc-controllers in my case). I thus tried to find a way to \"materialize\" the result of the queries inside my services so that the \"materialization\" won't happen inside my mvc-controllers. At least that was the only approach I could come up with -given my limited knowledge in all things async- to force db-related exceptions to be thrown->intercepted->wrapped-into-my-own-exceptions and propagated in a sanitized fashion to the upper-layers (mvc-controllers).\r\n\r\nIn a nutshell I'm trying to sync-call async-repository-methods so that I can intercept any db-exceptions in the lower rather than the upper layers. The above snippet was one of the techniques I tested. If you are aware of a better approach to achieve the desired effect with an alternative technique -one that is clean and performs well- please feel free to link resources that point to it for me to study.\r\n\r\nBecause, even though things worked in my dev-machine there was a lingering suspicion in my mind that the approach shown in the snippet might lead to obscure deadlocks in production environments:\r\n\r\nBased on your answer I surmise -and I'ld be happy to stand corrected if I've interpreted your answer the wrong way- that whether a deadlock does occur in [asp.net](http://asp.net), depends on how the Async methods involved are implemented internally. In other words 'FirstOrDefaultAsync()' might not be plagued with the shortcomings of 'GetStringAsync()'.\r\n\r\nin practice how can a dev tell when he's dealing with a \"plagued\" async method like \"GetStringAsync()\" that can cause the dreaded deadlocks?\r\n\r\nAs a sidenote: I studied the linked material\r\n\r\n[https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/](https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/)\r\n\r\nAnd the author gives the following example:\r\n\r\n public TResult Foo(…) => FooAsync(…).Result;\r\n\r\nwhich -at least to my novice eyes- looks very similar to the code I'm field-testing. The author then proceeds to explain that this can deadlock. The author speaks generically as if it doesn't matter whether FooAsync() is an EF method or whether it is being invoked from an ASP.NET controller-action or not. I guess I'm missing something here. This particular aspect makes me feel so conflicted about all this deadlock issue.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"fac220eb-d9c7-32a0-84b1-73be101ad75d","date":"2017-10-16T23:32:01Z","timestamp":1508196721},{"_id":"42368e06-b678-3294-afc0-b4eaf064b425","authorName":"x Disruptor","authorEmailEncrypted":"V8HkIbQiRs8AxCf7XAT2qXAwSYKl7rocHT5uVSjuTtDJUkLNB5pwzHu4v5tpBfnI3x0M4FXBL4wqIXj4Y1glwteUegWBhY0uFEx1Eg5/9VS2ZynGNHjx7aBy0109tPFWS9v/fg3wA4FN1W6AYhgN6lueKag4SjQ73McgQmzoNa5CzJJ04T7x2Ja3UqOXpZB0+A621uCC43lzh/fsVnVHKTk1BGazmHG4LtV5T6AQcPL5nz8951FhcI9Htgk3gbRjzQ6X+60n00MemihxMVd9BSlPzTvLbQ/w/zbyns9LMSbUQCioo2jl6beMDIZefJleeGUUCMB9TuZ2dZOO7lBi5ATtNQ/GJGuiwNiTMnaK9VPc6liNYPCnK4+veGd9j/IyGFHWePkUV/CmlB0fbU8puslUUbvBsJXeSGFtiz/BdlGM8v6/Ok9eRQM6EThUc5VD+FfD4WUlkWn46ek8w554eHYTwGyQDIVe3ngxZDx36LcTb16H/8DXlV4EnPcR0A5zO8H91+OhAvNWuSkbFSjOYy41+b8EQtFznL7qDVcOUnAOf6z+t3keQUMHZ7llGFwG54BqQetMLy2zpxFWANp+iBCkEmymj18rF56W8LMxc/gbl7AQl5/nsnZOp1+uhBmcVpJT/F8OWriGrtYixKc6EzXu+BbsVkhAMOTZfgfWA1s=","authorEmailMD5":"ad46e1336e43614ea24e0f42b9a383af","authorUri":"","authorUserId":"disqus:xdisruptor","authorFallbackAvatar":"","message":"Thank you for the wonderful insight on the subtleties of using async/await. Quick question about async/await and entity framework methods like ToListAsync(), FirstOrDefaultAsync() and so on when they are used in the context of ASP.NET:\r\n\r\npublic class FooController: Controller  \r\n{  \r\n [HttpGet]  \r\n public ActionResult SomeAction() => View(\"SomeView\", new SomeViewModel  \r\n {  \r\n PingPong = new SomeRepository().GetSomething() //sync  \r\n });  \r\n}\r\n\r\npublic class SomeRepository  \r\n{  \r\n public int GetSomething()  \r\n {  \r\n return _context.SomeTable.FirstOrDefaultAsync(x => ...).Result;  \r\n }  \r\n}\r\n\r\nWill the above piece of code deadlock due to the direct use .Result?\r\n\r\nPlease accept my apologies if I'm missing something obvious here and thank you again for your insights.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-10-16T15:48:30Z","timestamp":1508168910},{"_id":"fac220eb-d9c7-32a0-84b1-73be101ad75d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's possible that it may deadlock, depending on the implementation of FirstOrDefaultAsync (and the DbProvider implementation used by your EF connection).\r\n\r\nEven if it doesn't deadlock, though, it's just not a good idea. Why should your ASP.NET app go through the trouble of sending an asynchronous request to the database if it's just going to synchronously block on it? There's no benefit there.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"42368e06-b678-3294-afc0-b4eaf064b425","date":"2017-10-16T21:44:46Z","timestamp":1508190286},{"_id":"7e29ca66-56a7-3648-a1f1-8d09a9d4cc17","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I disagree with your interpretation of the repository pattern; I think exposing IQueryable is both acceptable and preferable.\r\n\r\nRegarding exceptions, there is no need to make the code sync to translate exceptions. You can just as easily keep it async and use await. Just use try/catch exactly like you normally would and use await to call your asynchronous APIs, and it will all work fine.\r\n\r\n> in practice how can a dev tell when he's dealing with a \"plagued\" async method like \"GetStringAsync()\" that can cause the dreaded deadlocks?\r\n\r\nThere is no way to know, short of inspecting the actual source code. This is one reason why I do not recommend depending on code not to deadlock. OK, it works today, but what about in the next version? Or on a different platform (HttpClient is an interesting use case where it never deadlocks on desktop but it can on Windows Phone)? Or in a different scenario (e.g., cached responses returned synchronously can cause the code to take a different execution path)?\r\n\r\nIt's far better to avoid doing sync-over-async in the first place. That way you have code that will always work.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"2ec2bd25-6238-35df-9e9f-dcfda1b58f6a","date":"2017-10-18T01:29:32Z","timestamp":1508290172},{"_id":"dddb43ef-29c5-3993-83c1-37d6981913c7","authorName":"Nyagaka Enock","authorEmailEncrypted":"THLeEy04p8LxYDCSLiOOHHjgmx5vO5YY0j4Uej7V9alufeC23iHB7itmEZ3zQDH6mdK1swN8VMwoeFGY0dsqD++yqvfZ7bbGL7dobtMwPvtLd0olTYeTwoACAPgyKMxvwK5ob++zN5DEHJSedVyYz35/GqqZPAruPvATh7EQO+ntOXgnJ96uaCY3/V/8XxxW9prGugaMou4xWmPNDZPE/ltU0EAReR/QdHgBcCmO0kF05GWSVn4uLMlLn5C/u8fv96EX+MfP6KLPwER5skDYQZj+K+oxPHDt3Qlfw9hubgxcrQeplpwTVHAZqExDi6K7pmli72MHWlhR4qC2aIz9wtFVZZIeXtQR2bWVLVA/YuDe0QLBOs0BoeDJReES36UkVM8MdUIJVZo2jF5cCnTumplKlqcpXAPVAYmFUMIM9ziqMxSw8Rl454ShJq1BUzepL8cA1Alb/wvYfb1zsPTWwGh1PBQDwpvGmUdemUKL4gN3ynp1aWV5gMex1No45SFmtbFURhtU0wuEkPsV1h0441sExViKEC6L71iZNyx0xgQcTSvnZpdPgMTg+bTGLsVHX5/6omfMmNLnIxYdRUnFisNp39X5JzwEAqorCgq9+PXxkDTfXZiVSbNRPM+ZqSslOoNI0dJJ69hOzinJLXk8MyzLETpXmpDcCR1mJO2zxkw=","authorEmailMD5":"ad9f519f042836409f10b63fdcc7200d","authorUri":"","authorUserId":"disqus:nyagakaenock","authorFallbackAvatar":"https://disqus.com/api/users/avatars/nyagakaenock.jpg","message":"Thank you Stephen for such a nice post. it's really helpful. But i have this one scenario, am not sure if the cause is mixing Async and Sync codes, or running on different threads. This is my problem.\r\n\r\nI have a callback function which runs very ok while on the UI. This callback calls methods which are implemented Asynchronously. I decided to migrate the callback to different class, i made a dll of the class and used the dll in my project.\r\n\r\nMy Problem.\r\n\r\nI have several methods which are in the same class as the callback and which depends on the variables from the callback function, when i call the first method i get the expected results. Calling the rest of the methods gives me wrong results. Will you please explain this scenario and advice me further. Kindly use my Email nyagenox@gmail.com\r\n\r\nThank you. @stephen_cleary:disqus","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2017-10-31T13:28:51Z","timestamp":1509456531},{"_id":"20523826-5672-36b9-b130-b82224682bcb","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's possible that what you're seeing is the result of multithreading; e.g., if you do concurrent asynchronous operations on a background thread, they can run their code in parallel. But it's really hard to say for sure without a code sample that illustrates the problem.\r\n\r\nPlease reduce the code to the minimum necessary to reproduce the problem and post it on Stack Overflow. There's a lot of smart people there and someone will probably be able to find it very quickly.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"dddb43ef-29c5-3993-83c1-37d6981913c7","date":"2017-11-02T21:38:58Z","timestamp":1509658738},{"_id":"0dc2c3e2-c6f7-38cf-b197-c5bd56dcf3b2","authorName":"bh","authorEmailEncrypted":"ZbUQ9yEYwSEiCQX71q6XzeDW1sQM//OC62g0+C2zM88DJ0i6BNdE/mzwdMJBUbMorikLE0131ewCPOAPchInGjJh5vf7hp/qmjRB1z2KDVhHmXny1r9iPzBvQF4pji8I13BJZtSHT0b2urTnVpTa9WS5IWBo1cDz1p1fkCa6TihIeC784bef7EnhwWGzC1PWoslLqcof9FkXTqRcYDigiQ5Rgq2C1XOziOIofmpK7CcctY8lYBjS+tNMFHlM+hOVXsQSvksdgYyH/A0/Ky7SvipWhwSU5gwVXmfY0Ct1GcPVBabn4AChTkZ7NXQh6iBaLESKp1ktjGsFCf2Fb5rB56UiIMHykRfImNaIj9wfzIKECgXKjrmK7MrrCviSYZkQXRxVjP0rJslKRrDJ8b0YfRIWErmdqFmVH1gxy1yt0fki9bTlE18LvNwAdglAobCHQJUB8GhEyrcnhq3KHRPRu3PbIFV/EAI2OC9CoT+l0tLn25KxTHSQZcej8Q67Q36pxFlovNn2vVDxS7rZWQcIHlgoSxxkYrdXbCRR2kul42YlE/8+grt+JQlKFI+nXMHW5xLOLcJ6IgOZyGO7Zg4XJuxKcGN9FTwXpLuhupKQoTrrvBtbwKX86UFCRIrDo/Qkb+uHixmTA5QnuNcU71ybSfngkZhaLCRd08Wes/Cv0kw=","authorEmailMD5":"c7a652c603935e6b6fc8eec2e8591b57","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"> The top-level method synchronously blocks on the Task returned by GetJsonAsync. This blocks the context thread.  \r\nI found this misleading, as it's accessing the `Result` property of the Task that blocks the thread, not calling `GetJsonAsync` without await.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-01-10T15:19:34Z","timestamp":1515597574},{"_id":"4535205d-8e6b-3643-ba6d-a61c35da63b3","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes; that's what I meant. The top-level method synchronously blocks on the Task [by reading `Result`].","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"0dc2c3e2-c6f7-38cf-b197-c5bd56dcf3b2","date":"2018-01-10T18:49:05Z","timestamp":1515610145},{"_id":"80602b6f-3bd4-3070-a0bc-591ab42e6ae8","authorName":"Bowen Zhu","authorEmailEncrypted":"jgmwA93ZSVWTYFt7RxtKm6lcLHkx9fhbdP5UWpWaJOsRvNgNpdQwwDQ8mgNcjLtcUg3+OGfF/z89KfqzjtJ2N1smFGuZ9uPFtUquvdUwFNAr2BE6m3RBmn/4FcFnyqUIOvWpoXTgC6OeCZWcUZNXpMM99lY3jgBRR2yXOp9+hBxkNLSTWy8WWwA72CuLSlLfg9g17jMlijskGy/TLg0vMuMDaxDsdAauO5cCYYgvWqyENDQp0dBnMULbcwY7hmP5FFRn+NJ75Attu5viJGWc2xz6tqyJHgwWbckXeqCpY0Qr7Xq5nEjkfbYftJb98LOn8yntnzmLuEQjBNB2GpdM2kFAOB2tTqN6LzY/0OgXoBX+Hq+EmOPElswMeyQBG+7i/Xi4h+gv8iqH1vwtALkg/mgntHeJ4J7LY+Uko8YnADPFd11kJaYurd4MSLOXWLrZATPcR5chhD+cbXBraMHM9VvpdSiv/uiTyFMxHbvrY1YA6z3cx/aDYR8Mk7z9Y5H596EgQBAV4wvEH2+5ZmP+ahFhtKhWDtL0RH4A+Y9TCGiEELxa6KgAjtMRZTMFEb3kU3+6b7Y1KnCyGyn9Yp6WM+NKCgdjZvpVlkSSdcDirwczMdpCbWNkzPLzTY6lX7gXzQ2XKOU6mm18EuHId0DPEdg3MUu0WqAeSdmq4fA7uBs=","authorEmailMD5":"b6420a5dd5fb035ae3c24e4081b3604d","authorUri":"","authorUserId":"disqus:bowen_zhu","authorFallbackAvatar":"","message":"Hi Stephen, so under async model, on what circumstances should .Result and .Wait() be used?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-01-19T01:02:31Z","timestamp":1516323751},{"_id":"aaad59d2-a97a-3e69-a557-5dd693d32ad5","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"They shouldn't be used.\r\n\r\nThe Task type was not originally created with asynchrony in mind. While it was one possible use case, it was considered a minor and obscure usage. Task at that time (.NET 4.0) was mainly intended for use with the Task Parallel Library, and it almost always represented a small amount of CPU-bound work. When async/await were introduced, they decided to flesh out the existing Task type and use it instead of creating a new Promise type.\r\n\r\nFor this reason, Task has a bunch of members that should never be used when writing asynchronous code.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"80602b6f-3bd4-3070-a0bc-591ab42e6ae8","date":"2018-01-19T01:14:54Z","timestamp":1516324494},{"_id":"0db0e19e-8ae0-311d-9594-f82de41bc7b6","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"> I want to pass an singleton(context) down to another http message handler which would execute later.\r\n\r\nMy first suggestion would be to use dependency injection, rather than an implicit context.\r\n\r\n> use HttpContext.Current, and any code before it in the function should use await without ConfigureAwait(false)\r\n\r\nYes.\r\n\r\n> CallContext.LogicalData is not reliable... It's possible that CallContext.LogicalData will be lost under heavy load, together with async programming.\r\n\r\nNo, this is not correct. If you're having problems with LogicalData, verify that you have httpRuntime.targetFramework set correctly in your web.config. If you continue to see problems, open a support case with Microsoft.\r\n\r\n> neither does thread local storage and thread static data\r\n\r\nThis is correct; since await may resume on another thread, thread-specific storage will not suffice for your needs.\r\n\r\n> And I remember you mentioned somewhere, we should create a context boundary in the codebase, for context-dependent/without ConfigureAwait(false), context-free/with ConfigureAwait(false), respectively, correct ?\r\n\r\nYes. In your case I would separate the code that uses the singleton context from the code that gets the singleton context from HttpContext.Current.. That way, your actual logic (that uses the singleton context) does not have a dependency on ASP.NET and is more easily testable.\r\n\r\n> this.EditControl1.Disabled = false; should fail in some way, correct? because the resumed thread didn't load back the SynchronizationContext, but in my test, it actually works, any part I missed?\r\n\r\nYes and no. The runtime behavior depends on the UI framework. Some of the more advanced/heavyweight frameworks will do the thread marshaling for you; while some of the lighter-weight frameworks will throw. And even the heavyweights do not always marshal; automatic marshaling is sometimes done for single properties (e.g., Disabled), but data-bound properties are another thing, and data-bound collections are yet another thing. Different frameworks have different automatic marshaling. Since I've written a lot of cross-platform code, I follow a strict rule in my code about never touching the UI from a background thread, even if some frameworks support it. That way my code always works.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"fb685f31-1d3c-3ac8-9936-c4301457db0f","date":"2018-01-20T14:49:37Z","timestamp":1516459777},{"_id":"fb685f31-1d3c-3ac8-9936-c4301457db0f","authorName":"Bowen Zhu","authorEmailEncrypted":"TDChLklTdNLMjsvYG+XDOXz2C3SiXjVKIdo7eyFqyeta5ePhrtxXfm/BgvLVvTDmxGhXYyw3wR+KGnYzGklLAsaf6s0QHfvZ3BPEamDjHh9STM+BqjbatglsfCnBRZ+AQCLMrgtlfGloox40FjpWL/HR1ejzOBmBE0Qz7Kg7dp1oOCnbCejdwajvMVOH+oANzkN04LfCI5jHiE0JW3M06R/JgmBoyYHtU//sM0kij5dyCMc7YImZ0KAwyyJ5QINY2spGd77owjcEx2l35fdvQS1U4ca9PGgo2dmdetzFPmlUgQYxjUSCgxE8A3S3g4kmgwXJ6Db9W4cqAgd/4O0AUuwe3uA69+DXnLa3RdE7FEk2CnlUwGO0F0fHMFM3vTnHSCAWhvVc8AnS0q/EQaeJ6T/Ow7EAn3Jek/SSKamf8Nf6Dvz6Gob7i/pVWLnAvb4PvXvVMVhnQIhcHsNDUzsCvrAABnH6MXVeua2dtyaZN2u8ugHs+iPdtBgqVRf3//ub6qGRS1fgHRwNuwUQzh0/TbcQoDnPSfZo2Afd1+a05F+jPHLExpAygHx/s+bygxa0NSC+DQ0Xd06BIJzICe/XT3A7nR0l+v1HIeI+1vOW/eH5PEWK//f+XZj84pjXqTz4FZsarmKMIrTiH6BcBrZyShE2HWvmUF7W6yaD0529t78=","authorEmailMD5":"b6420a5dd5fb035ae3c24e4081b3604d","authorUri":"","authorUserId":"disqus:bowen_zhu","authorFallbackAvatar":"","message":"Thanks for your insight. I have been trying to figure out one thing all day, but still not very sure of my finding. Could you help take a look at it?  \r\nIn an Asp.Net async api controller, I want to pass an singleton(context) down to another http message handler which would execute later. The only correct way is to use HttpContext.Current, and any code before it in the function should use await without ConfigureAwait(false), if any, which means to use back the SynchronizationContext.   \r\nCallContext.LogicalData is not reliable, neither does thread local storage and thread static data. It's possible that CallContext.LogicalData will be lost under heavy load, together with async programming.  \r\nAre above statements all true?  \r\nAnd I remember you mentioned somewhere, we should create a context boundary in the codebase, for context-dependent/without ConfigureAwait(false), context-free/with ConfigureAwait(false), respectively, correct ?\r\n\r\nAnd another question, so in a WinForm UI program, consider below code  \r\npublic async void button1_eventhandler()  \r\n{  \r\n await InvokeFuncAsync().ConfigureAwait(false);  \r\n this.EditControl1.Disabled = false;  \r\n}\r\n\r\nthis.EditControl1.Disabled = false; should fail in some way, correct? because the resumed thread didn't load back the SynchronizationContext, but in my test, it actually works, any part I missed?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"aaad59d2-a97a-3e69-a557-5dd693d32ad5","date":"2018-01-20T02:17:17Z","timestamp":1516414637},{"_id":"d18a366e-61b6-32de-9121-a7dcd0441e88","authorName":"Bowen Zhu","authorEmailEncrypted":"jaKgJfEAPkSDFo27JKG1MIcE7HzHKBRH4SK/qlvoUIQ+fXHc8uPIgDtCLVjnsq3VT68jQgf9rHsSRX9LFuDgL9aUt3aOOBa3AjMvwqDFgS1iFMwd6XgLpEE0CKPq76t+rI4bTczhCWIWalYDEZct2oi3HtoZa4eAELcO37lFCBte39Qy035dsS7InViwXRFgVK1Vogibvyy3Ci+mE/qW6Ibj+Jef0/Iv49o7URyRWyr1CeuIQgHCDBFLRf612BWOxpqH9Z9L7q2uw0QUKEnnoRZ79sDop75gpz7t2ghP/Fvkst4dFnboPMkZfdtmBd1dUj0VbqSa2OdEqkML1qhgMF40GvHRwJhjAKuOfZ66dP6irje7+VvF6mqROeNS4P2BiJAc3lAcQTkzXtB/spsQvxoGpaOCQsxrd0/wm77cvDV/M8ODoLu3AwKBIM/Dcbbu6+tLZAooibjhHRjzemqnhxrgbRVBlDRuXpIBjc1p2FBSHfPNGvoaenI37/3vHhl9wivzpPWdEJPUlIca/bQnYR41tzY+I1m/fMn0NtESvaEx59LyijtfuceYW8Stn9xJzrlpEsVUJ/A63xtBadD49vQJeOMOVAIztmWmUho8PXswt7Ukwiv5A1U7fLuhwJbZy9hrVQCxzuft7OwTr1rq2fjPMbkR3G4cnzGPpA+TZdQ=","authorEmailMD5":"b6420a5dd5fb035ae3c24e4081b3604d","authorUri":"","authorUserId":"disqus:bowen_zhu","authorFallbackAvatar":"","message":"Still the same [asp.net](http://asp.net) example, to pass the Singleton to different handler of the same request.  \r\nUsing callcontext can reliable pass data, even I use configAwait(false) directly before access to CallContext.LogicalData, correct?  \r\nIf that's true, what advantage does HttpContext.Current hold? HttpContext.Current requires SyncContext, while CallCotext.LogicalData doesn't, yet they can do the same thing, why would one use HttpContext.Current?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"0db0e19e-8ae0-311d-9594-f82de41bc7b6","date":"2018-01-21T03:55:27Z","timestamp":1516506927},{"_id":"08021eca-9448-36b8-8db2-082e9c3c1320","authorName":"Vincent Gravel","authorEmailEncrypted":"QKYByYZO7XkzuEpcHDeqZXITDw3zs59I7LjiKfdKU1eRHk+J7RIIzB9UYhew56cKKQKVSCyd8pcaVWSi5WzoHfik//Xx+r9qIYDKivtRM1ic6WfML7GFT0MCT8Q43IyyG6SFHRSXYKKhjDjaJlwyZ9o+exZz3cIB8tzKYSSwNAJV6VJG7EqD/PT2hD/EvyBq5BKCeQ/wx+id0Ozci2GicszuNGSYezQssumdEC0an6ycksrH34pzSGdIhHifJ9I2VXipkeE7bUlQVjgjY3bxeVRGnPC4Ub399XTSm+A34X2bHayYtjS532wIq72XWdQLFj24itVGpOCQZ0v2NM8NoteIclN0K+XDSTIzQyyz3Dc6TczFZbkYuNeFqlfNgRTEvkyMCmTKB1SYZWJ2yg+WDYdD6DoUNkWXbnWMZjMv/+7U+JMUfmUp+R1MmFTkC8INOvxRujNAJCv8dz/37zpM0aOsQFLytoUdrps5/rIs3/V5aH+u7LjgubuE9QGUrZ7DsvTNvr0xo5yFwiD/6vxX3N1pxAxe3jLtHxjJLCLvMoFDmkaIw4aqXmu75VVXLlZGAogiChjomDcfzSOGSU1U5TEKkzhXbL7QENprOtrtVQP/6OaUb94HcganMe4ghZrEnQM2S3u1WoDb+NDkQKtNdObL3qU83BourHJHXnHfQ9o=","authorEmailMD5":"4e9d619f1a01bbb4f1c209dbbcad2498","authorUri":"","authorUserId":"disqus:vincent_gravel","authorFallbackAvatar":"https://disqus.com/api/users/avatars/vincent_gravel.jpg","message":"Hi, is it still possible to have a deadlock assuming ConfigureAwait(false) is used for \"every await in the transitive closure of all methods called by the blocking code\" in ASP.NET? I'm not looking for doing this, just curious...","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-01-22T19:37:09Z","timestamp":1516649829},{"_id":"09d03838-48af-3b43-91d6-71b0c5183d4f","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"HttpContext.Current was introduced more than a decade before CallContext.LogicalData started working with asynchronous code (in .NET 4.5). The books and articles that talk about HttpContext.Current still extremely outnumber CallContext.LogicalData.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"d18a366e-61b6-32de-9121-a7dcd0441e88","date":"2018-01-22T14:16:54Z","timestamp":1516630614},{"_id":"28d35fd7-3f39-3d0e-a465-c23156520801","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If you block on asynchronous code, and every await in that code uses ConfigureAwait(false), then that will prevent the deadlock caused by capturing and resuming context.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"08021eca-9448-36b8-8db2-082e9c3c1320","date":"2018-01-23T14:10:50Z","timestamp":1516716650},{"_id":"4cc4b183-629a-304e-8bcf-98bc5ab484af","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes; updating UI elements (like textBox1.Text) can throw an exception.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"ccf79d95-be5a-315b-95ba-45112e5a3718","date":"2018-02-01T22:31:57Z","timestamp":1517524317},{"_id":"6904029f-ba0d-3000-bc97-b0806a34ca47","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"What I mean is that this demo code:\r\n\r\npublic async void Button1_Click(...)  \r\n{  \r\n textBox1.Text = await GetJsonAsync(...);  \r\n}\r\n\r\nhas a much better appeal than this demo code:\r\n\r\npublic async void Button1_Click(...)  \r\n{  \r\n textBox1.Text = await GetJsonAsync(...).ConfigureAwait(true);  \r\n}\r\n\r\nBear in mind that in this context, no one has ever seen or heard of async/await before. It's a brand-new programming language innovation that is just being introduced. Having the simple \"async\" and \"await\" code allows the presenter to focus on the keywords and how they work, without getting bogged down in the details of contexts.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"d41991e6-4b98-3f6a-9bc5-2b02afeed964","date":"2018-02-01T03:29:04Z","timestamp":1517455744},{"_id":"ccf79d95-be5a-315b-95ba-45112e5a3718","authorName":"Ray Luo","authorEmailEncrypted":"WvsG86qSGd3SqM2pa5/8YAkRRUk13I6XKjabwPLnZzdHu1/6oj9hVJFec31C7C5BgYf8JgMGv/Y+rAupPRS3+Hd5osb5AT/+9keax3j8gpleyF2WXrgF/TqZjuq3OlMMWL3HqxQJbBEshkPTEsRVo7WsrI3KRY8CRQmb6HqzfoiRWbnjzArdEixq9YYBv0xtXsMuKKlPJ3imjLjELDp3bnyn8rTI2odiTF54kK7X35RRy65em0DURgKNzpw/udI3HvesLk0Z11lXqjamcwtIrOIXPox4hoMvwpRlV0POyhtN2lklUWl49SO90s/D8leuQuFMP4RJqnz0PZ/NxLqTAPkgSfIq/JEDdf8RFfN59uv71F7fYaNETx+BdqrtuN1M4h8wUZrdforcbOokvr7PYPiiWQZ6ajK82fEBNWiZgezRwenlVldW+ADJMHzSm3+l+GhnGxPqVoiXCkJMxSLAbTtz177uNALsuDoQ5HmPRyKOp+7AD0KcVdSOczbxnzA6rOui7JDIFtOS8N+wSaHjVnclfWZud4AYxz0ef7yzmjfFzu5jNQeYAs1R3QH0xyt+OHwJjP/F/M0/NUU9ILwHlb7U2puipE0wePI637+v7qk6sNPME0lXwhRoGyZna80NZO9ipAjz9MyQMpmj6//UvE4tRGc1W0hYgidS5V/7ZBs=","authorEmailMD5":"d64d93e535ddc76d636ec27ad114eca9","authorUri":"","authorUserId":"disqus:ray_luo","authorFallbackAvatar":"","message":"Thanks but what you just described is exactly what you have already said in the earlier statement \"Practically, I think the benefit is that it made for better async demos\". What I am trying to ask is, what would happen IF the ConfigureAwait(...) default value happened to be false, or IF the app developer happen to write the demo as \"await GetJsonAsync(...).ConfigureAwait(FALSE)\"? Will there be something functionally wrong when the top-level demo code does NOT resume in the same context?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"6904029f-ba0d-3000-bc97-b0806a34ca47","date":"2018-02-01T04:19:21Z","timestamp":1517458761},{"_id":"d41991e6-4b98-3f6a-9bc5-2b02afeed964","authorName":"Ray Luo","authorEmailEncrypted":"kZAlUW9HLBIfypGhZN9Fc5Ql7vgLXEszT3jAvp/GpFtF6PvYGURtEn7lAclwtIg8f7vI1cUg/nwYGA3fNX7iVNSzXK37ln16HlQxMCK9eiOqhIRCzSCV5PfaPEVSoOL8YIAQ8/bHaAXP8TzqduMSzrilh28gCDWSY4DFGrqzpvT6IGYHMrhFeGItSY0tsqXppHtwVUAcOAPmHZqaXiNCL5Vl6+mDnUrn/pJMMCMfFedeQactBTgqlgvpFTs4xuRgHg+2PjabsskKrNKwNKO4mKMafn3I9xx9++4ekja8zV+URdZihuv0/SB1edo3uK5Oddk9QOBAr4brjOGaRBL16bvaPBp1AAiaw+J9bLpg/M7rsBMWG83IyPxbxvex3QZxrBbqGeQaJKGuYDN29n8yJrAFozsU+jpTWmBffnvr4yw6/E03DSdjkKgpK9mlF/rf1NUZV4Gx+hAR+pfBJFi3YHWdoUh3uMb/IQlFzLdsnxG/mTSnj6+Qg88EVRcmeTZlGp8Y/eRA17LPVPpEbXZYfEh7To9s558YEm9oLlxrdo4HFtkxtV6yz93F+0rWHqd3N/fzD+aY4K3ufdXPVPw3x42H5beDrRz0znoHXjPGcd4q5SED5H726QBM7gR0Olvs46ABbIQoAIsAWPwsg8X0n5bDMGBypptqUjEu3Hg33mo=","authorEmailMD5":"d64d93e535ddc76d636ec27ad114eca9","authorUri":"","authorUserId":"disqus:ray_luo","authorFallbackAvatar":"","message":"Excuse me for chiming in at this \"default behavior is to return on the same synchronization context which it originated from\" conversation. I think I understand Stephen's arguments on both the conceptual and practical perspective but, for the sake of completeness, Stephen can you also share/point me to a detail example showing what specific things that a \"top-level\" demo can NOT do if it does not have such a context? For example, in the \"top-level methods\" of this very blog post, what functionality would be lost if the calling pattern was \"await GetJsonAsync(...).ConfigureAwait(false)\"?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"3794c8a2-9cec-3671-8aac-608579641831","date":"2018-02-01T01:05:13Z","timestamp":1517447113},{"_id":"07f232c1-8e9a-3db3-a183-2f9a82bcf702","authorName":"Varun Bhargava","authorEmailEncrypted":"YGBJSrIbp3LTHJl9KlE+8+yL0I7PyKyfa7WkL2O5pUlQfZ05AXSbnNQdVQ1c0jlzKKWhCVDBYwRLRv7Gj+jKwk1glDS5DRy5rwqxW1HmhdOdbfVeqZeKHuegYEBL1a5Bm8TwY0f9vJnWTQTqOfhEh/5XflPBsOJBiDoVpqHQcLb7B8or6ZTYMaA1lKGMVyFr6S+msdlTfB33H7sfKVFDiPm09tAZJApWcGZXQ/DGnt+uDkf+pWRarQJvyu0m7kNRB6r0RDpaDxIqaDs04FZG8k+V4ac+HSlU01bDBfqKfPUo98G5OVoVifXUfl8wvGQSaLcz748Xsi7m7LMBzgk6STrRYXtHtXNEjhgKW3Nhlzwqwq7XKBX2GcrdE/UNrXCJxeGMT8Saqw8qZ8Jguwu6h6+YtS8YkPx7RDPchVrdwxoBF3msME/D+NISOgZRUqsKNW0MrTjJKXFP95jieYrN1rU+pyfqckBdkdcun3n29yEiXWEYPkC1i+9YLsMHj+DxI0P/hQKJVhGBhVuIomdB9mP4GlL8/Lbjds7VrmQZmjC61X2J2RW06kvHKzA0wN49ym+Zoda3N7eNzpXdlJH7LM7WL9g6CQYWZkIttzknbdboanCwvNU6DWXhLVrJCfN9cgNwZgFcSL4R1onFeukZDcu864qwK8LpF76+DW0seQU=","authorEmailMD5":"4126b5c5e664cb207ef3cdb64858fda8","authorUri":"","authorUserId":"disqus:disqus_ZZpGv0gXZl","authorFallbackAvatar":"","message":"Thanks Stephen. This is what we're trying to do\r\n\r\npublic string MethodSyncVersion(string secretName)  \r\n{  \r\n return this.MethodAsync(secretName).GetAwaiter().GetResult();  \r\n}  \r\npublic async Task<string> MethodAsync(string key)  \r\n{  \r\n return (await ANetworkCall.GetSomething(key).ConfigureAwait(false)).Value;  \r\n}\r\n\r\nDue to some reason we have to have an synchronous version of our method which under the covers is just calling the async method and blocking on it.\r\n\r\nThe consuming code calls  \r\nvar result = MethodSyncVersion(key);\r\n\r\nThis is the line that intermittently gets deadlocks. Another thing worth mentioning is that these calls happen inside an IOC container during instantiation of an object bound in singleton scope (which will have locks of its own).\r\n\r\nJust so I can understand better, what could be the exact reason that this sometimes works and sometimes doesn't?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"febe2270-e37c-3014-aa10-9c4b959cb219","date":"2018-02-27T22:54:25Z","timestamp":1519772065},{"_id":"b9ae5e84-0bcc-32e3-9a8d-4167cb953a7e","authorName":"Varun Bhargava","authorEmailEncrypted":"HWbDq4SLdblder+cssdDGfNLIDMf+lmziYjPUkVjgQOsiRkNXD9lA3yuDfTHSVDkL4jNIM91QXOAzCiVDlLGWvtP1vpEa+S0tTArhSq+PW/iPxL9muQgy/jRd67pkznr0gXO6E/yuPdq5XcJqzy+wHsm3NqHE+fWoxL67hXL4+D2yw7my9uzAUqUlE4+/arln+ITzYHEvH5LE+kqQ8cL0tOlvItBaHtSQ2YTg05gyOpE2fc9YdgG+aADRGeKb+7yy5XcLlRN+I/0dukZxEQ1pH9ooJw9modAVDMyK4kvMRUkaEKxg69wb6NuD5vF4S9ctGwF/v171RjTq9ks0IgY+tvuE8mgxNkM+Wm0AloXKnNCgk5AryftNKMzuszbHzjUTRdTBG4fq+EdOje4S2VctGemoh0YOGPui0B78tnMcGnLTOa9iqmibQ/r9BsAXTzJtXvvzDHMJuatUEbIUP800Mbp8Xr4UMNhWtDweIsIikh7EI1AX/+k93nucBEWE9aV51Bkc2foLfP1u+UMhJAtzktgVYsKht8Ac1zQA5luElprENbUF+kw7dXExK7W50D+Hh7aXC+F3+ayA/GSfuM6PfSRdu4SrrmRjZ9OLc1n6/kaKiJegqfRwwApL7u+Kf1PMXWGkEVSdmebY7r6rh8ucdRBwBbY0PNjpr85qzrjZWU=","authorEmailMD5":"4126b5c5e664cb207ef3cdb64858fda8","authorUri":"","authorUserId":"disqus:disqus_ZZpGv0gXZl","authorFallbackAvatar":"","message":"Hi Stephen\r\n\r\nI ran into this problem and your post was very helpful. Just one question. The deadlock was not always happening, but rather intermittently. This is in ASP.Net WebAPI.\r\n\r\nGiven we were not using ConfigureAwait(false), does it mean that the context that the task after completion re-enters into is sometimes a different [ASP.net](http://ASP.net) thread (which is when we do not get a deadlock) and sometimes is the same ASP.Net thread (in which case we do get a deadlock)?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-02-27T13:02:07Z","timestamp":1519736527},{"_id":"febe2270-e37c-3014-aa10-9c4b959cb219","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No. If a thread blocks on a task, then it can never be chosen to resume the async code.\r\n\r\nIf you see intermittent deadlocks, the most likely reason is that the async code completed quickly enough that it returned a completed task, in which case blocking on the task wouldn't cause a deadlock. This can happen, e.g., if you're stepping in a debugger or if you have caching.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"b9ae5e84-0bcc-32e3-9a8d-4167cb953a7e","date":"2018-02-27T19:06:16Z","timestamp":1519758376},{"_id":"75c73ff1-d42e-375a-b146-1a00dd6a6e4b","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"ConfigureAwait configures the await, not the task. So adding a ConfigureAwait to GetAwaiter().GetResult() won't do anything (since there's no await).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"fd690460-ba68-3a67-abb4-701aeb4e734b","date":"2018-02-28T18:29:32Z","timestamp":1519842572},{"_id":"c6711b9c-b80d-30ec-8d7a-93499189df30","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It would not deadlock if ANetworkCall.GetSomething(key) returned a task that was complete by the time MethodSyncVersion called GetAwaiter().GetResult(). This can happen if you have a caching network provider (e.g., mobile platforms will cache more aggressively than desktop).\r\n\r\nSync-over-async is an antipattern, as described here: [https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/](https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/)\r\n\r\nIf you need to support both APIs, I recommend using the boolean argument hack: [https://msdn.microsoft.com/en-us/magazine/mt238404.aspx](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"07f232c1-8e9a-3db3-a183-2f9a82bcf702","date":"2018-02-28T00:26:27Z","timestamp":1519777587},{"_id":"fd690460-ba68-3a67-abb4-701aeb4e734b","authorName":"Varun Bhargava","authorEmailEncrypted":"appltJXYcXWYsUi6nJnb1PSKuceTSVJn+b+oIZSpmmjpksfUhSDwbCj3Ui+gKGRIoX8A6heebocF0QXcfV2hPyrIZFiaCddRasOTjlffg70xM+GQj6ZkjPwYDqQa5mZjTVEYVNMaKydONet0xa8lWoV3LKo0grKVqd6TmODyIvWeuZt9yJd05zf2v3O30V2ydHgYV7Gq7jg6Ap5h220CoAB/lejVYrbObHnxMcBmpzzuoGIS+pRMIP6QjGsqTK38xh5JXtLQzrYjFZ3Dn7E0+IaNT3gG6Le/cFHyM+6ikhV+OHUXH3GHKeyETLwbEFbu4LLQg+/7lV1RbZ8GsMmQOCJn2mCeDOkRFiBKjUqdDWFgu10IEEkPn7wTQsssoW2xSYHjgPZIm1Jagc9BgY0Bos0nDvTwIWf8w4H2/mphHhhUiuAIvOTqf/9dtj9ag0+WRhQAhy5onZIyFNHAwx2fjPhlPP8e1viSnzZBP9/cl6QoBHod5Wj0G/In1P+OyAFN2itcLEva7KBKoC+v7jEYFmXqKWQQTRzS5L+udu04V2dYPDUNM5YTWHe2dHdZEF51XEsujvhoS+4dYw3MbgKumc9Y/KLrGcyU6LAAn5skW08JM6NsNh2W2+jktR+Nmu9gxn9u1W1waB1O6Ak/Xew4+xL58hf/aT4PpL6/+L58ghU=","authorEmailMD5":"4126b5c5e664cb207ef3cdb64858fda8","authorUri":"","authorUserId":"disqus:disqus_ZZpGv0gXZl","authorFallbackAvatar":"","message":"Thanks. Do you think it is necessary to have a ConfigureAwait in the MethodSyncVersion, or what i am doing below is redendant because the aync version already sets up teh ConfigureAwait(false)?  \r\npublic string MethodSyncVersion(string secretName)  \r\n{  \r\nreturn this.MethodAsync(secretName).ConfigureAwait(false).GetAwaiter().GetResult();  \r\n}","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"c6711b9c-b80d-30ec-8d7a-93499189df30","date":"2018-02-28T03:44:55Z","timestamp":1519789495},{"_id":"c2ba8952-294c-3f68-84b8-75dcec8c1de1","authorName":"Sachith Wickramaarachchi","authorEmailEncrypted":"fEO7VUKfxkotY8dt/htYwmIPcoWotPH6fOG/ViPhKYKJhss058MCSlZtoBegQgAbmT6si+1ST04/GMF/89sHOst/44sgY4L0maouIoaSxwMRSNvE6PZTcWJYFNvUzlvqNtvOwzeqNCytc8HS9cXu/GXo8kVhIIoMimFBlGptBpeQYZ28mdneSQVR2anFgSOhRti2/G/Gb1MX+E7VL5rX1QlUSC1zf+r9rDMjA8f0nr7dMqA2OVHcUrdgpFUikiVd8FoSUuLKbxdpQ0IPy1RIITR7sUn155Di+GeVVx+jQcBNpm/IcEDGlxcpsqba3gSvTOyEjDHDn698cbkR6dBeJQs2FofJAOUFV3LUNeKD46a4D5VqG+LqChg87lVuAT7b911PTeAnAvxJMTtrksETroxmy7BLCxRs3HerRh11eOBA+KDMEhFqqJE1HGMUMrtOuMjjiUgjDpTawtDndb5jNFbGC3A/XcxPT88MnONulhgTXsChMBqFS8RJYQ71qrnMeAFZ4XkfDrCCmmFAd4qFR9f6KdQ01t8FkNB6+ksr4LR0mnphfdTy6dAVNpQ0OM6WbPmriBVXHJZuTQ2DmXpia/XebdXPgaoYibXFA+Z+Jfp8GXP0YU5triC+VzZOopaiQZkc/OJBHRYPxFfVic+vxszxJmWRLsAvM1hXc0RHiMk=","authorEmailMD5":"33aa7fc4e7e06f6567b5a6d329cb551d","authorUri":"","authorUserId":"disqus:sachithwickramaarachchi","authorFallbackAvatar":"https://disqus.com/api/users/avatars/sachithwickramaarachchi.jpg","message":"Good post, Thanks for share :)","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-03-14T14:43:01Z","timestamp":1521038581},{"_id":"45b30985-88c9-34f9-8458-4fc5a71a1bb5","authorName":"Admirador de Damas","authorEmailEncrypted":"PajjIPoPe6WpjSj6HMK3fw/CwJOEZ5aRt9NtHALP2pqtcXhF38UdTg/AuxardSufi5520DPXd5pLhTeZY7qSLEhinH3my6QtybuFADAioesa/AlaUsXgFx1KG3uGusxbro8nGVvfVOgjxJUUNNfqIgj1zyq4IjV/H4RADMqHQUg4ZEf6bt0lhA4Lz65LD6RkCeU3rF6/lsk/xp4NgrZ2B7Hb04qkMFAG6JKJf/MCoJRRxsJW68JtJPSdZXsljL6jyziSXjc+4IHi/GsejwlAttznK7w+u95ZvtTJc0BetfGEn17RIeZ8HCwNoYf8C+cSwjNSXBVZE7ep3SGWnUHoggx78qbf58dqIMo4EJexiZUY0kw7lIfAFmzNphJCk88+lqSCfnE1yHWjZo3XflFI5oCvbThuPQi7ExhuGZVmjg6swDzQ5bxLO9KrtMr0UlsCOdaV80o2I4TIHU8r8iQpiMQGDzU0aF6vyfITQshdVlj5xtmQ8yftTIgeKea8tGsGjK4DGfxLiMhsVXP/HrIO6zwz9tRM1bJyYU1qxe/ZuV6oIULR+Y5Oe7DuUl58aEQ4fBCtUNyBxw5V9kzjHlEJ7UuDy5Fi3NojgU6crsw16okyXVw0uL7QKMZQuTSdbqoXjh8S9a5bZz73vLSIIi7VFpnvEhruFhHrIJ7E/e5CPHU=","authorEmailMD5":"873dbd5fe8982d6380307a3d52e59b5d","authorUri":"","authorUserId":"disqus:admiradordedamas","authorFallbackAvatar":"https://disqus.com/api/users/avatars/admiradordedamas.jpg","message":"did you get solution?","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"58fdcd04-b518-3b44-bd61-6bc5bbcb89f1","date":"2018-03-19T21:25:23Z","timestamp":1521494723},{"_id":"3bca749b-2343-3caf-b6bb-b90d414788fc","authorName":"Nikos Sideris","authorEmailEncrypted":"Qw0d21T23MjBNO1beY8tyB1C30RXO3JKoxCwwCE099G+s3Lv2CX+ciIeK1LkhXZuCZmsnwDzqOzFpUVYZfDA2VAmPNrb0FKMaJbdFB0KsQ08I0P+5f3MI37sSwxCi0YKdwATotN1s65wX6R/WZH7H2Hl0Z/71pzhRGaGv2MhroedesXh/cN10R8KTtv1NCo2njXKqHYFflAdxZsg/VM8V+XpiT1xw6ihcTxqW0HANex87mPXBo028Am3gOtOkoT0VnvBYGlfBQT3HiR5blGcwWwDhGDo89Ut0apu3PMJDJMSvALYpShh8syr2kA5nDCX6LaZlAAGMIPxoIA5MJbnBV4JCCFU602l1359vZNktp2BtYIB+NrurA8iD3eibEXj+zPRlq1odINTsc4szNLhBAarSm5DTzC24Yt+ecnlX6uXpyXYFHRFkR63xpXTT2ZzOxLvhXTfYtlXEa7LBt3uezrMbJ7CnaSi4KZ2QvQgo2WHFCls/zNq3Mg9Jp2TGjT+6hT90C5CbWH8/uTJUQIv+FfrNsLtDdKqOnLZpsLsrzY1ELboQYscFdPYeX/MuyK9uHZXgSY9CAk+Zq3sB8ifMAmQPNsf4coyP45Bpui+8/4jw542OSkRUvzCaaRoUQ9UVJ4UFprm/cEMyt2OWZrSaCtgajwfO/YQQ15rj/gNjqo=","authorEmailMD5":"2cb0e53f5c57d64f749a46884c8ef829","authorUri":"","authorUserId":"disqus:disqus_FlUbdZq63t","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_FlUbdZq63t.jpg","message":"Hello Stephen,\r\n\r\nI would like to ask you why you mention that statement :\r\n\r\n \"Using ConfigureAwait(false) to avoid deadlocks is a dangerous practice. You would have to use ConfigureAwait(false) for every await in the transitive closure of all methods called by the blocking code, including all third- and second-party code. Using ConfigureAwait(false) to avoid deadlock is at best just a hack).\"\r\n\r\nOn your msdn article ([https://msdn.microsoft.com/en-us/magazine/jj991977.aspx](https://msdn.microsoft.com/en-us/magazine/jj991977.aspx)) you strongly suggest using ConfigureAwait(false) whenever possible. Its good for performance and prevents deadlocks.\r\n\r\nMoreover from Stephan Taub ([https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/](https://blogs.msdn.microsoft.com/pfxteam/2012/04/13/should-i-expose-synchronous-wrappers-for-asynchronous-methods/)) is always suggested to use ConfigureAwait(false).\r\n\r\n\"As a library implementer, it’s a best practice to always use ConfigureAwait(false) on all of your awaits, unless you have a specific reason not to; this is good not only to help avoid these kinds of deadlock problems, but also for performance, as it avoids unnecessary marshaling costs.\"\r\n\r\nAlso its quite difficult to ensure that all third- and second-party code will go async all the way. So using ConfigureAwait(false) on the caller might prevent from deadlocks.\r\n\r\nRegards  \r\nSideris Nikos","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-04-06T09:51:48Z","timestamp":1523008308},{"_id":"94d3553a-6c27-39ce-90b1-d8b4ad328750","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Allow me to clarify:\r\n\r\nI recommend using ConfigureAwait(false) for library code. In fact, I recommend that you use ConfigureAwait(false) whenever possible.\r\n\r\nHowever, I do *not* recommend blocking on asynchronous code, and thinking you can just \"make the deadlock go away\" by abusing ConfigureAwait(false). This is due to two reasons:  \r\n1) All of your \"asynchronous\" code that is blocked on must be aware that it is blocked on, and ensure that it uses ConfigureAwait(false) everywhere. \"All\" means the full transitive closure of all methods. It's extremely easy to miss one, and then you've got a deadlock - or even a deadlock that only sometimes happens. This is a maintenance nightmare.  \r\n2) Third-party code may or may not use ConfigureAwait(false). Or it may work in one version and then stop working in the next. Or it may work on one platform and not another (this actually happened with HttpClient).\r\n\r\nIt's far better to go async all the way. You end up with better design and more maintainable code.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"3bca749b-2343-3caf-b6bb-b90d414788fc","date":"2018-04-07T00:21:59Z","timestamp":1523060519},{"_id":"8730635a-4c89-37e8-a5b8-665784384033","authorName":"Rick O'Shea","authorEmailEncrypted":"YndHjxnYiyx0o6R2LQcFIYD7/NRjR+6xfeWpEDzHfRLbwOzP2qN4njQknlsqpdctkqCk2PzosBK987HevNyVWZnkd1j0c76hBwa2RcXXVDcCAkwq9RiVDCRn8+ZeomiCMX0gBdtjt/BiZkK/IpenqAKbGBr5mTAEHe6zPoWcDW89uzSgyhVFDlXuIxQ3r3dApuuXc8Kg3Afag7Bw2BbuGWC7g2KLvXQLMYg8Yn6psA/EyKwOvkWBz3I9UO3NxfOSzQwrcuBy+kdJswKpMtBnRMxTVscE1j4XnzMmq8k5OVxx7dgfPHU7+5xs/L4aTiEckhigFbPsmIjHm/9MiMteZ6zkoQdExkyNP87jUy8heLeI9VLB768TqbGiNbMdTmEm+IYi198EO6tPir0Q5/ryp87C7C0814WLRMQyn859ZZ7oNEPWVYKPkPt2wKugVtQ/6hSOQm4/1Ot38ftLE3n3XnvtSYpfUeFvV9ZrnmkHRQFQYzXFjaSNft0KnwgDKGybght33Y2G28VFno/zhEFSaokUkDL9Iw0KHUpvy6QPWHzZzyCVLaxhD8YlSl1bOMa7QZoT2/PpYVGsExp+p316q65JcOtDXRUGCzOzE4jQEu78J0fwPlFIXCq/XSUqcxEM/VFFx6UX5xt9NK70NP80MfzLKw+z7c/oS3mYLYrdtp8=","authorEmailMD5":"048fc88f7ba67bbdfb0dc310aacdedfd","authorUri":"","authorUserId":"disqus:disqus_4XL2VvzyaB","authorFallbackAvatar":"","message":"It's not friendly at all. You're compensating for a platform designed for sequential code, and doing so in a very unreliable and intrusive manner. I'd venture to say 90% of this \"all the way down\" bandwagon riders are just blindly following a meme. Meanwhile, dozens of LibUV frameworks are out there that do not foist these ridiculous compensatory requirements on their users.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"e59b81ae-8886-31d0-941d-c85c6f819a4a","date":"2018-05-16T22:43:49Z","timestamp":1526510629},{"_id":"8e5d06a2-c669-3e5d-98dd-515c3bbf57ec","authorName":"Rick O'Shea","authorEmailEncrypted":"sexzCBtwngzHU8CPFkVKOYwSsqH266/LcjTM3RMosRE4sPc1g6nbd3mCTXrK6XFKih5ZmlBzOH29EIjNNrtAJLC/qEYQreDvezPtXh07m8c3YUShWnSyovYsqae5PMWX3Iq/seHBnvYw7JLX9OFUWX5JFqICOJVfBKkdxGL8tyevHoRvc5YclXanq6emtWruThkHrNFBrA9vPUGAPSsUPg4gLTvdJc5HiaBDaYZYQkxVzN/LwwkQ23O93h35GmQPFz/TlZJPZ1ZwK1vB1uS7ARdC8ugUGNfr2mYnZUTW8+ltcf29GfrFFRDWKo2EfLqGc1Ht7/opC4BtWOWj8DTZIN793aQ8gdjOLNaTMOzpAENtpKlAWKpKQy5td0zjSZujVoqZoImQpZE2oJitPA5uEWNGHU/5ln+EmpE62BJNO3F+MgI4/J4nWoa2no4W3yLLquyR3mrBu4ONubBFOAEGHAILnJ17DIiHPDeUk5AfUWlJuQMg1eEerK/Yj0QvuHC9KdPvrKtU6BAWdyxfnNCtMqCDEdBPOOZnpJog5ouLzpkhoZD7TCs8GXcSoXvCC9dP8MuBG7Tacmi5kSEY0aKMJFEF9NAmR+NO7B7x55fTcHhNZjKyOFPin5Pv7f+PSh3Iu6HDvb5YPlTaiXJguxZpfhPZvOlo7JjsDPZH5e3DfAA=","authorEmailMD5":"048fc88f7ba67bbdfb0dc310aacdedfd","authorUri":"","authorUserId":"disqus:disqus_4XL2VvzyaB","authorFallbackAvatar":"","message":"Funny, we have no such bleeding abstractions in other frameworks (NodeJS or Erlang) and no such deadlocks. We do build Windows services cheaply and effectively using sequential code and scaling horizontally. That's cheaper and more reliable than trying to fix the broken platform with reams of extra manual code additions. Why aren't you instead ditching the framework? Addicted to .NET and C#? There are good options there too.","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"","date":"2018-05-16T22:37:31Z","timestamp":1526510251},{"_id":"35f25ce3-4429-3abb-b658-19263dca7c92","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Last year, JavaScript officially adopted async and await. I'm not familiar with Erlang, but every real-world system has the possibility of race conditions and deadlocks. I have seen some truly horrifying asynchronous message passing abominations using pure functional actors.\r\n\r\nRegarding scalability, I do plenty of horizontal scaling. But why not do both? In the cloud world, horizontal scaling costs money, and async can reduce your scaling needs by 10-100x (common real-world results).","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","replyTo":"8e5d06a2-c669-3e5d-98dd-515c3bbf57ec","date":"2018-05-17T02:22:23Z","timestamp":1526523743},{"_id":"4bc91610-ac79-11e8-ad57-d942879398b5","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"U8vubGHfhSSfFnn7sNCzwoExYOUY9K8mFTeXc5Ox38WdRKGqxPgfqcz93INmZnYxTstIGjOd2p5+JD7bDM/NMmAF/RrG7Rx1IGKCZg6PXYWzJ78vC8nXTxRXL1VeVAiXPrHclzzqKnTFv8Ujlf3DUEQgvr6xqf7vX0UjW3RVDHeIPtHlePyYoL6hDtaQwE+7f/a4B0L1aZaS/A3aF8NTQjU5UNMbuLzpe/kVFUbtfPu69PY3Wue6Jf2E9KIUD0sPK92/dKJJTiAwqvDixDi3VCdRInyFv2SpgyypuVXFZ9wdM91TwTUGlsHE7o/ArB2FxZg7oucy2fkcXi6quiXfGeujpQN0ezeM3YCOXLjuZwA07ED4pXlcdRvlEgLJpfuQXGPfL6/ZbCmAOHpVWrLLQFq7hAcpXhTUlM/DStglZG8fl/qNwKOPIt8Y067fkX85jZqCcVuuAMji6v8j4SaCY1LcB1AUv+TEVz2Mv8WgfZqAvmlp+I3vd9JAgROXtH6A8f0uVFwIlC6YB6ic7AH73Lo71KYmeD5Hy3HSkfsW66uwewqB6EXyMTBCy6gWAfht+HYul+7+fBtxxPTPaQQ7MIbLFVnAfP8IruTYbkriWMYel34tGUyJ0euOz8oGvNXxSE7ObsMLaciTRaAb4BExJm1RLEsePhWwNFfQZ/oQD/o=","authorEmailMD5":"32cc4b0d840067a885b5bc481069b82c","authorName":"Shobhit","authorUri":"","message":"your blog content is so much insightful and with depth. Thanks for sharing","date":"2018-08-30T17:22:40.294Z"},{"_id":"419165d0-b502-11e8-a1b7-df997e15fc27","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"b19b0ad0-b4f7-11e8-a1b7-df997e15fc27","authorEmailEncrypted":"iqRvixLl2EATcKdm6TlVh3mS6BFY6J+MaFDxb38a3+kqxL2wU1MoWUSGCF2uIZ/19DMX/x7cMrQALWJJ1b2HckRpighkozB4c+Bf/veHp6UWH2kOwmf3BTBV0BxogJzE5FMmfIqGlunAQAewOTw4ehMseM48DyLuVCbALuM2vrEgADcPgtG+COgFG0HJMmBfgOw4f0TRZvAPk2T5yTW0mTWYReWTNIXg9KWKUf9RiXHUYQHEORmYF6ZtQQEDL7VG2HNnhTCHp1pQO9vIk9sjXOw92wuZeRs2QblRNICAsw3b6htmX6sswL+nHtbwvgHylEoN1bTeZTup145XzWpMeoMxrxBNTKC52vcKpuxG8fK358xfX4FSsxoHsFTylZRK1e4HxBXAiMzGLzBT5fcmGIo5T38CqwQSba2EEmhJ924nlMMvdDr//JONctS5rJOpq59APOUayIInhqtprPv88GLU9sgCJoH6vKpiNS+bTnOgd00yyuWwImnijdWHNRB059ntaBnKhbbGwfk6dwvV5/fFerNi7sUS+Lhj7+Tl8G3Phb5TvgjZCHTjEHYRYjJNRukkvkDv7Gb0wmHV9zteuJSq/aYreLB8s6HUs89dfcR9iU6zzWta6bg2jck5kifQfqMxG+N/LhOl2EBVGoxO/42z5OYKb1/2uO+5KdaXdQg=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks for your comment. I'll update the example code.","date":"2018-09-10T14:03:13.386Z"},{"_id":"b19b0ad0-b4f7-11e8-a1b7-df997e15fc27","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"ASPNet","authorUri":"","message":"NEVER EVER USE: using(var h = new HttpClient())\r\nsee https://docs.microsoft.com/en-us/aspnet/web-api/overview/advanced/calling-a-web-api-from-a-net-client#create-and-initialize-httpclient and https://aspnetmonsters.com/2016/08/2016-08-27-httpclientwrong .","date":"2018-09-10T12:47:36.873Z"},{"_id":"da765ca0-bd55-11e8-8d8b-834384c9d56e","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Bao Hau","authorUri":"","message":"The best explanation so far. You saved my day. Thank you.","date":"2018-09-21T04:21:47.513Z"},{"_id":"2b474880-c14b-11e8-9259-3970a6205b11","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Fan","authorUri":"","message":"I got one question: what if the main function needs to call async methods? Can we declare the main method as async? No, right?\r\n\r\nThen, how to avoid blocking async method?","date":"2018-09-26T05:15:23.346Z"},{"_id":"f4bae6d0-c228-11e8-94f7-ed09f2515ddf","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"2b474880-c14b-11e8-9259-3970a6205b11","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"With the more recent C# language versions, `Main` can be `async`. Or, you can just block. Since there's no`SynchronizationContext`, it won't deadlock. Blocking in `Main` is an exception to the general rule.","date":"2018-09-27T07:43:00.136Z"},{"_id":"12fefcf0-cd62-11e8-9467-8537e44b2659","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Massoud Safari","authorUri":"","message":"Hi. Thank you for the great article, i wondered if i want to read HttpRequestMessage.Content of a WebApi in OnActionExecuting() method of a FilterAttribute as a string, and actions are synchronous. If i call Content.CopyToAsync(ms), memory stream will not populated. Is there a right way to call the method in a synchronous action ?\r\nThanks","date":"2018-10-11T14:29:34.833Z"},{"_id":"86a3f530-d89c-11e8-9ea4-a996cd0c12ea","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"12fefcf0-cd62-11e8-9467-8537e44b2659","authorEmailEncrypted":"GsJGYZg7pvVy3mtTUe84RKm0luUuXEXy3qtP95GeOmDdH9O0JouD7OnLUc4OdNcWYXy+ks/n9gQ6/EsD53D+LPtkGW6I5x6MlZ++wG77hdaksVNfB67vP5C8io13VmqpD22+RcuUf0ZLwqHuGdkl0/i6ociX5T32C5+cugRDOayJuykI89FNndnjTrBaVCIr9EONIgXeraXvM9XoA51OJL4EAQ1cQnUlrjy0w0/3HF+RZcPrxBmWdmdflatGvrywoQ3wBTx/eOqaDOIB1Q2AR7uNydTSUEc40d0xG6yBYa3wThxfmD9b2ZcSQ+KTAlRYKHuD2f324oSYU5izaHRkaJq3UMtwio8oFEQRSTizWOyP2w90PkHf+1GTcGejaqQU4zzGAqe4xj4xLhLiB6JgQWHoyLJYJr3S3XPDG6hV17Bw45jdcVmEKJQ/rUkwr6UnKwKrgC1u+kxAKRR5ZaKhPpYcRZipvSh6K142JaL7GLqej8aoKGp5sZxmKrLhAyz7eViFCBIYgb+fw4/ZOHRd1+L2PcAwxlS6y6jHCm/jyfj60aDQElDWMNqWmNtNbe4LdQ7Qk7KRPa9GhcsUdrgAa/ID5LNCtOab5/oloBzJFCivksWXFpGh21kAZTYgkagm35Bxkx/9TgZg+h1y9NYhcZ84EvKHZYUuz9/1jEUo2ws=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Your scenario isn't clear to me. WebApi action filters can be asynchronous; legacy MVC action filters cannot. `FilterAttribute` is a legacy MVC action filter.\r\n\r\nIf you meant to say `System.Web.Http.Filters.ActionFilterAttribute`, then you can use `OnActionExecutingAsync` instead of `OnActionExecuting`.\r\n\r\nIf you mean to say you're using legacy MVC (not WebApi) action filters, then you'll have to use synchronous methods or block in some fashion: https://msdn.microsoft.com/en-us/magazine/mt238404.aspx - note that this is not an ideal situation and you're forced to use a blocking hack due to the limitations of legacy ASP.NET. I recommend upgrading ASAP to ASP.NET Core, which allows all action filters to be asynchronous.","date":"2018-10-25T21:25:42.442Z"},{"_id":"8e29a560-19c0-11e9-a165-97c27510dd3f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"b36bc100-19b1-11e9-a165-97c27510dd3f","authorEmailEncrypted":"ak5qhrf4HHKdmwNQkrqEac3OexW52z9SmzZW9+PzS0lTDrH2gkjn8I6x6WTzhk2IX/T4goqoI+3LUb/WGDgmnb2wVkT+M748YGl5wFD5ytVC5XY3tETfeh2eYD/Zn1jVzKcf5aCy03XYsWDHAkUFcNXYbDlL76tqYCIJsdtD7JxwDatkV4+i34uP2xyhu0XrHM2uHpCA6NMj0ing1fYycBeduuEeWIQLi+7JLr4y+zN/tg3f457KxUauaNEbE/6BZChgqBm0EF35cXQBUNz5TOEtNaW9j8JhkZpVrgeqVq6A1hem5qz26QoGWtTt/6CrYPsu7+AYTh+//7MpmuUglO2xGorwRtLGePVLxiFeQ81WLsVEhyjK3OqIhNddBsTorKZWO4AdjgZqoTnyg12AHpM3AOo4UdizD8uah13cvC5uzWOs3s32CA3wos2lZIMbwDc20zw60HIKpkicJRsBeoFixAIsQu14ku6sa2vfwVQI27AbhwwSBIT0AGGwEopXngzslxIIW5XRTNWx5iM5VtV7jum1HjHJub1/04vbSSfRJdoh5H20eSAL5mCzedSpfomA4nfUqfVfVquIobxNdrqEAvjJMPtZepF2JNcW3Iwod3D4inj9hUBSIrZrfM5K65akCrU2aPlKGzIhSnFgZG8aPq/6X9+xWBFnTsguNAQ=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Yes, you should either use `async` all the way or go synchronous all the way (e.g., `WebClient`).\r\n\r\nThere are a few exceptions to that rule, when you're *forced* to break it, but as a general rule it should be `async` all the way or sync all the way.","date":"2019-01-16T18:57:22.582Z"},{"_id":"92da1e40-1935-11e9-be33-6505fcaa6d19","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"confused","authorUri":"","message":"I read this article and many of the comments and I am still uncertain about something - specifically using HttpClient async methods in a webforms project.  Would calling the async methods of the HttpClient cause deadlocks if done improperly as in your example?","date":"2019-01-16T02:22:30.584Z"},{"_id":"b36bc100-19b1-11e9-a165-97c27510dd3f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"confused","authorUri":"","message":"Thank you for replying back.  We are on a legacy platform with webforms and asmx where `HttpClient` is being used, but based on what I read here we are not using it correctly.  e.g. `var response = httpClient.SendAsync(request).Result`.  So either we have to  use async all the way down or just use `WebClient`?","date":"2019-01-16T17:11:02.757Z"},{"_id":"f5c804f0-19a7-11e9-a165-97c27510dd3f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"92da1e40-1935-11e9-be33-6505fcaa6d19","authorEmailEncrypted":"Mk4wfoAOWKjgv+UNrx94RXWRPNPCfGTMV/A4XonNW70LRifGHcsH5E2BGuZMr/9ahh2hYm3FX06UgWQLnlZNvLsT2F55qVCgtBUSoRuF16lWtY2lDCJOe/YnkPnuRJW0D2GLs7BBvMhuPaN7ZnjM5Q2h2KXbuO6morT2+4Fuid1QfaVEg8skByQTHdn8ag1r8v9uCi3f72bl3FJ96plIwouqWXqGwoWfOo9KUCL8yoJRvqHn0kXNWESQacB3W/Y/H/bbmjhUmHuIrxRl+5WDj733IaFjci9ntKEJlRZFlso6X9dS/e3cCRQ1igz+0UC2+xY0CnQJdQ2mDAXfolpcV03QHs7inY01ESUopnS8Wpvm0DODteevBbs6hNfo4I0adX4RxWUINWwPoZ77LcpXGwRfn5sUixMLfiaH4KY0RN/hBFOGV4wUOkgyUz0EqNj8l+wsxbFrpbcB6ocykr7i4csWUp5OHKVW1LPwaW+mH/Jn7mxI9EjRIl7xCMFDgk6kzIt6w1AyRW8Zsy3nMoKzJTdZ4Z0pHXCdt6Yfl3CajJnp1vFgbIGcT3dCq//WfPAl+b8c54LI+Y+mKm4h+PKAxCll3L02jQ+O4q05ClkbSvHgCmEFYwq114Vi6We8Sa438usU9Svm0SsNgJ6fttVXm1rPF3xs1tE+JERe1Te7Tog=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"There's no way to say for sure, because if you block on `async` code, then you are depending on the implementation of that code to prevent deadlocks.\r\n\r\n`HttpClient` generally strives to allow blocking code. On most platforms - I have seen it deadlock on mobile platforms. And of course you're taking a dependency on the *implementation* of `HttpClient` - it is entirely possible that in the future a bug may be introduced. So even if it works today, it's not the kind of thing I'd want in my codebase.\r\n\r\nBut why are you asking about blocking on `HttpClient` methods? It's weird to call asynchronous methods and then block on them. Why not just use `WebClient` if you want to block?","date":"2019-01-16T16:01:19.237Z"},{"_id":"67837f90-3760-11e9-acc4-e918b93ed4b3","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"KSghkq7qtjBiTtuZGZuPCiSCX3sQDVh7yhfAGHyFfjb9ejC7ia7Jclv/KYDdRdknFzL/7fBSIWb0trYpS28oX0tforFKmxzRK5jroxFZd/EJy5iPhAxU3XRyMGByRnCqWA80tU9VWFZfTlY/gxBXNp6HdSSg5BEaFCHqtGJsjRj/nnEt7KrBo0Tz+RafszQTcWUXNGQlf5dkFlfuWYNeDVDQ4R7xQL31wrvs9+G3yf7HfhePin6yGZP3h6Vk8sg9XVQJFNidIS8NhVpRCoArRGqeRMHOd8ZwxKWQd2Ly81p6ZAw6gEL4m+lXrE3M0Slbzpgoo/DVMTxDeUTIKWx/ZX4/y+LQDWA4vo10kC6K+EauhqpkFuBDaR5tiC2hrpfSGzqAOkOIOO7tkDcnXw6PKiERU6HWKzMcvw6c1aloqZOvF7ETef+XsAxZWeqplkT2u2P0QfN1CJTt82jn9ZYY1Vkasv+du4cjBtsGqE0DK8e5ODsjSQn2QRv4Q9OxLzmis0ogKaGUSrbtWOWrdroXVk2c1JgfgqzKfSxwxeuv1+mKLxk/ifbKtqJMSNeIONBNAPq/E4DjOAvwgUQ4Gmve6SDHQ9aczWKcFmR0eCqdRbUCxHhRN086B3V1AN899EPowf6pUB7iMwq1I0atiVPpmodXDralOceyyW55WG29H8U=","authorEmailMD5":"e644d63e03f0404046566f9771691e6b","authorName":"Andreas Trütschel","authorUri":"","message":"I found another source of locking up the program that is actually not a deadlock but is even harder to find. This occurs if a task is awaited in more than one place and the continuation that is wired up first blocks. In this case the other continuations are not invoked. This seems to be true even if there is no synchronization context present.\r\n\r\nFor example (\"X2 end\" is never printed to the console):\r\n\r\n        private static void Main(string[] args)\r\n        {\r\n            var tcs = new TaskCompletionSource<object>();\r\n            var task = tcs.Task;\r\n\r\n            X1(task);\r\n            X2(task);\r\n\r\n            tcs.SetResult(null);\r\n\r\n            Console.ReadLine();\r\n        }\r\n\r\n        private static async void X1(Task task)\r\n        {\r\n            Console.WriteLine(\"X1 start\");\r\n            await task;\r\n            while (true)\r\n            {\r\n                Thread.Sleep(10000);\r\n            }\r\n        }\r\n\r\n        private static async void X2(Task task)\r\n        {\r\n            Console.WriteLine(\"X2 start\");\r\n            await task;\r\n            Console.WriteLine(\"X2 end\");\r\n        }\r\n\r\nStephen, can you confirm this is true and if you do have a solution other than \r\n- not blocking in a continuation \r\n- Spinning up a separate task for each continuation?","date":"2019-02-23T11:44:41.054Z"},{"_id":"82ab86c0-3763-11e9-acc4-e918b93ed4b3","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"67837f90-3760-11e9-acc4-e918b93ed4b3","authorEmailEncrypted":"jDDEEctFYaVCcW0oHURnxL9DTR2wCyuIAAqiPU8XbKVhjkRjYd6z7LJP4slIeiqerjeqB1zTin3IbxQyEhoUwqkKG8lk1BRR+ZxgKH/Ghu5yVbctmdTtz8GUt0ok8BfwvPcB+mHoDQ7MviM3O+VKK/XhbDppkz2i6IjMVGF04uamQSby5hhdJrZBIHIpxO7ocnS9WTfQ3UL9US3AieQ4bwVhOdyXX5zkvESKQUcaE+FXATYVPsajXW/EHQBWHo7TTQz7dudXZoYKV3n1Rnd+LpNWezn0EtwcfSh6PRZJsMhdbqsVxy6Li+FbPwNYIQTdmzqIy2yaLizTpHOqoUrMwLJ+Mu8ujsmUYBUcdsWQOO0TshQwTVsCc4QgWrOG4QR/DgEkGfKd2wTVp4Wu0dbvBKSmu+LSsFqAkVflMU3YE2eR4WeMg8GaX+8EsjHiT05GGGeKuIoZigITkONgZyI2dyd4NNtclA55tAnJVwKOIm4CNXOdnn/sGnyDT5ZjCt4DRxHyVU1Qx9Kuwn6UCiTOVgXJ8tUzfXZg74ZJmB3kCUuSpVE/9lScimv6TeApEnsha1fAj8GVkwEuGxBpEAb7K2rwf85bol9CKlhnk0h4WgDVEnjPx4C7OA7dUcBgL+ofXDkbLWvoe7cBMjs0szT7lL24a0aHHhArkQ4BkrCRVco=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"[I confirm this behavior](https://blog.stephencleary.com/2012/12/dont-block-in-asynchronous-code.html); the cause is an optimization in `await` where it schedules its continuations with the `ExecuteSynchronously` flag.\r\n\r\nThere isn't a great way around this; there's no way to tell `await` to not use that flag. The only real options are to not block in asynchronous code (which I do recommend!), and passing the `TaskCreationOptions.RunContinuationsAsynchronously` flag to the `TaskCompletionSource<T>`, which overrides the `ExecuteSynchronously` flag by forcing the continuation onto a new thread pool thread.","date":"2019-02-23T12:06:55.121Z"},{"_id":"5b752610-3ab0-11e9-b9e3-a34129e9fd77","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"mISi7TncLD9+HlDfZvu/sXw88I18VMmBogGDgNTboo1pFqLXMLX/ARDBjcrnicz9Vz4nfaTWk1U2AKaiMM5oekXxGpYzBqGJ8+99Gl6C0eXgrXCxWTzfYixOwNN1pL/drrz1Q41NhqNF6SwWwYfJdUyxx9OmHoyF/pBZLIR/5QDzksWZ5dCXv69hnSAw+8FdsMZd0bgCS6Ztz2MMA5T5JdezmPhe6DJrdLp4h+SV3Nt1wNHqtJC39Djowj6Dx3MoDNarus1y9eGXvkcylBE8uNxuV1qQMfsoURybtZt/K86evjA/duA0bmugRB+diXuKyguPpd43XSVCishv98bd/PHgXxWXN5eWMU1GHsjuyGJ9UWxBN+TKz/vh255Qmes6NMUWjeJe2FHr559mk+cKapaNUN0KxYN9y2ijMOEWRwlau/sDxjTXYZilgon7pB2/nyx0FgkcERVVnTLhk6pt0fIb5zjN7zc80uZa8noYUXHB04wlOPWbD6iuYmYHVfkxXJq1rJjLcKgxBDwQ0OtF73TbmZmEXZuIMLBT4VhmsYwevx+tn8PkKMbtukaYBsBGh+e6slr9DVuMNqsJwoOwOv+nrGAZZcJYjqVsV7VDvuYOu0i03WTDr3FhTU4OuZ/wTzOCuPwhj7ol2onx2pqRHw26E68iGsX7EBFxmUB+nyM=","authorEmailMD5":"7f46cfc3d895732165a80217ea5edcba","authorName":"dbnex14","authorUri":"","message":"Thanks Stephen.  One thing though.  I think in your 2nd best solution (or go async all the way), you are misnaming the top method and lib method. \r\n\r\nButton1_Click is calling GetJsonAsync, so the method Get inside MyController should be renamed to GetJsonAsync.  That method then calls GetStringAsync inside a using block like you did in the original example under UI Example at the top of the article.  \r\n\r\nI have read this post 2-3 times so far and every time this part confuses me and I am not sure if it is correct.  Would it be possible to improve and correct this?  Or I am again missunderstanding your last point?  \r\n\r\nI am just trying to match your solution to the problem at the top and they do not match in terms of method names and the missing using block.  Thanks again","date":"2019-02-27T16:54:34.038Z"},{"_id":"cd96a020-3bb9-11e9-97f7-73cce500929f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"5b752610-3ab0-11e9-b9e3-a34129e9fd77","authorEmailEncrypted":"TNYQw1BQ2uaTFFRGcsUrddymMj3sHWSMKs/qPW3M8ZPt31aKxzMTasCwgTfqG71TxYo+UtPNHknRCBVjHXgd+1I1aCgOYIf57anUYza0I0YSAF8Wk0qHRPwFcNZepX/n7+MsV2iozAZ9vNZke4RWyz5GHdtJijbs33Ro0+Zn0qLjPja+jxxwEiupC8+0uUzTicTozeUNycoRjxLMmSrVz7/ZHtqXMZTEa7SLaDLihkRSh7iLDEWVzHL460Wttj1MFNLRwMQF+nV7uts2Wr6mbADmVndXrW3umlYucfCJD//IYeTevYR9DdOjt+EZSAgP33G4Igv2v269bHbWBQ5+C7QO6Y97oKL9YTrpotar1vaKuEtD6puCaB/4hCn9ZXGar7k0CIMkYb2L1jZYWhgPEU8xvJhN3HUhr8cE82GZHLhOrcRZXrlEIl5d1qXjhtvh8IxR+jBwI5P6SV8XGXeP1lE3PATG4WtBTEVCmt9a7bwy2aP+wf+kHJODQy71GMC0KkKRuomB87A2xEbS0GuyL3rZE2Lhu61puSCGeo+Wqsp3uch3B8OJfs/axGhUIZCmoI4hAMRlzC4beBFENyKAHngkIMK9h/4T0ZqzB7ufAOeP0F6LeSDmH5XRImWWGDTRmxIr14+T+I8yTnwArO3CA0Tq3AgaZAcnvbV83ClB2X8=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Ah, I do see how that's confusing. What I did was combine the two *completely different* top-level methods into a single code block, which is certainly confusing. I will break those out.\r\n\r\nThe `Button1_Click` and the `MyController.Get` are in completely different applications - one is a UI app and the other is an ASP.NET app. They share the library that contains `GetJsonAsync`.","date":"2019-03-01T00:34:42.115Z"},{"_id":"d3a00160-4054-11e9-9eb3-87ca3d7efc34","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Milana","authorUri":"","message":"Really helpful post. Thanks.","date":"2019-03-06T21:14:28.782Z"},{"_id":"2155ffd0-43d5-11e9-ab1b-b1484e5f4180","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Saeed","authorUri":"","message":"I can't reproduce the dead lock in Asp.Net using your sample. Is it always hang? How should i test it to see the problem? I have defined a helper GetJsonAsync(string uri) method as:\r\n\r\nreturn await client.GetStringAsync(uri); \r\n\r\nand call it inside my controller as:\r\n\r\n  var jsonTask = MyHelper.GetJsonAsync(\"https://reqres.in/api/users/3\");\r\n  return jsonTask.Result.ToString();\r\n\r\nBut no dead lock happens. it simply return the desired sample data from the api without any problem. Whats wrong here?","date":"2019-03-11T08:10:28.366Z"},{"_id":"8d8069d0-4401-11e9-ab1b-b1484e5f4180","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"2155ffd0-43d5-11e9-ab1b-b1484e5f4180","authorEmailEncrypted":"qEQS786WCpzWgzgyEv20RZaKhR64U1bhEa8RzbvYmDiFOtuEO09Xz+baFQx/E09ZDkjHHgeXYbz6AvTDFLuB7lRgTM9Pa3IzVbPVed43O9rbO92Rw+PmdjgrHniuH8qKKcc6yzneG4teE6AN93ofa+wUNbkBFqyZYGCl9yIGjJzPT/tEc5cHrLSjaaQdNpDv7U2j2K1DTtW9bbqrtE0E82MiwE91c91OyNmaMPX+Cw9UPKs6MLrvXPOMWcel2G8lyCUa202c4YoBGc9HuhWNx1878+Mj9qoyMjxrSRlxB5sigh/gjypvEn7gyfAQGCes/fadYITRoLafGO0hWSujU1nKxgOEMotOeIyLGyVlSj6adKFCjyilS/oyvL9YDMClZNbmywn+6S0G7vp/nrbuUBe0zXcB/TiD+GtFMRivcEUMZAcOJGbmnkvD8DiWMZklKblN2J4vJpbKlu0OJa1dqUBbkJ6EvQONrelfPNMzRc75hUQ20WF8Vek5vxMHNz2zvKb3bXB8E06Ql8ACWoR1hqnLqsZpdHIFmUPdT52Qrm4VdxzS9AMZhvEwDNRyullC4IhOFgMZuz37n6YpIwnnRXvGULjqfgYIoAMNn1KWas6cng/9PE7YGbKsaMk3TEQntdlC1DSjOKsGGnLWqHpEdytCAJGEY5vDm2AxsezlzRI=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"It won't hang on ASP.NET *Core*, because [ASP.NET Core doesn't have a `SynchronizationContext`](https://blog.stephencleary.com/2017/03/aspnetcore-synchronization-context.html).","date":"2019-03-11T13:28:27.747Z"},{"_id":"68004690-6066-11e9-9e33-d3dad0996aa4","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"http://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Amin","authorUri":"","message":"Thank you! that helped a lot!","date":"2019-04-16T16:40:56.623Z"},{"_id":"59827c90-626a-11e9-90dd-2bb86faa0019","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"William","authorUri":"","message":"I think you need to explicitly specify on your writing above that ConfigureAwait(false) must not be called in the top level methods.  For example, the new Button1_Click method, ConfigureAwait(false) must not be called. \r\n\r\nBy adding this note to your writing above, the readers don't need to skim through the comment section to find your reply pertaining to it.\r\n\r\nThank you! An excellent post !","date":"2019-04-19T06:14:12.526Z"},{"_id":"9a86c2c0-83ab-11e9-8f9e-75cbd2e1542a","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"d28644c0-8383-11e9-8f9e-75cbd2e1542a","authorEmailEncrypted":"qG42kG/6bp4ukR3JX5S+9DlXcgYVGPXotWCKmSzYMbz0lnAI38LC6i5XJ5TlJlh1TEGfHRmyZvkLs8EI3Hp/yqMdK2jRbGF8sNchvyU1Mo0eSOULWSmLIIp2uSZXIELGbWxOO5vGRFiGW3A3l5WqAKtVTeS9PfozyuoGECTB2UiVvhgqZyT8qHwWO0Rmnu0VNKLwuKFnDOQAkqUdmuCJJmGSFfhGNLTGtYVOggJKjMCM8k9lcJeEO297w+nrnERvxhBqjhjnOnlAVCv06agf2RE5Vsm2q2DCMnEilGaVR8wTYSflk1jfspPxPOayvxciSZLyeLwLrHsgawdkXG1VUJB5ZfUMmUWvrYNXDOCbYdO4qf6RZCxs1YtOS13i4zGIbQymEJ9HWXq7XjZ0aXetYMxXKGSrpj1rYrFp07lTvaEeVnWPOfaAhAl0Asz6iBKnOqqGWwcpX0+NDg2wB7ic7lpkoKPGgJWkPqSVgJj3qFQWJaY4KMfNutkIAlDmD2z891aWE/ub/AtGWJrCHJWC6YGu4hLywizHHDxVNyNcr+RmEgW6i177sTD2POYLhhZtelV8+/gK0JaSSeQOLk6jarwVfi2eDa2nRhTLlutwSm6GRDrvl3UbMxSihJ/N0/68ldOacpcsVNhJchbEfazIHqQyFrLthlZ3P8SUdMtg+p8=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Ah, yes. The `async` method resumes executing on the UI thread no matter what it does next. Whether that's assigning to a text box or converting to a string doesn't matter.","date":"2019-05-31T13:54:27.237Z"},{"_id":"d28644c0-8383-11e9-8f9e-75cbd2e1542a","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Good article.\r\n\r\nBut I think the UI Example is a little  confuse.\r\n\r\ntextBox1.Text = jsonTask.Result;\r\n\r\nPreviously I thought when the async task done, it will wait for the UI thread to update the textBox1.Text, and then dead lock.\r\nActually code like this will also end with dead lock:\r\n\r\njsonTask.Result.ToString()","date":"2019-05-31T09:09:41.432Z"},{"_id":"709a20b0-b795-11e9-8b2d-439f5113ecff","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Adam L. S.","authorUri":"","message":"I was about ask a question regarding this post but after reading\r\n[Should I expose synchronous wrappers for asynchronous methods?](https://devblogs.microsoft.com/pfxteam/should-i-expose-synchronous-wrappers-for-asynchronous-methods/).\r\nIt shed some more light on the pit fall you are trying to guide your readers from providing the last pieces I needed to fully understand. Still I find *never* to be a bit strong; I'd rather say *use it wisely and sparingly, and keep in mind why it is dangerous in the first place*—but that just my opinion.\r\n\r\nI still would like to see you providing an all async/await solution for every and all case you face.","date":"2019-08-05T15:26:48.199Z"},{"_id":"14d6e430-b915-11e9-8d43-a9affe6acf06","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"709a20b0-b795-11e9-8b2d-439f5113ecff","authorEmailEncrypted":"nY9sF0/gXwtzdWlBOSkX/kzD7Rn9THkVsvjR4GGZ27J8US/+owgACx2+5fqA13oJ2PF5pSo6SGw+CEEf5MaegbQKBUYx8cINPQ7wH+rguLYx6dwBs8vFcwcYv4iU12K+Wjilt88HA/+xU2mqxNMkyD4SGowsOV+mkaGKIbigbgOzQRCGWLoRIb74wkEyHFhZtwXgidRIvQpGAHcfa4dIVybBsxvvCioFcyKCf7oOhdUC/cwkE92zejQw/CveNi9k0Zm5sKUVBZpUKsW1R5Gl2AULuT3ehIdGBN6FLIrScYYFZBhfNxty7n1zJEscCgYmrJTAn5pfw5BcUalx1+zwnPWkkXlawUHxutEeEps0smsWpBJO5kCxDyQ9qvAEqpuuRvWiEcP/6qkBJZ196w6w23Qx8lQdG4RfQQQg60BfwHdf9xVx+3zFJPgFtvjdc5QnO5vLJP4KPYRBsK1jlB0wm8LuJSknYGNVWZZ/ZBx1Wm8vwsQWPyV6yCLxOzfsoUNNhzH/j3tFiwerEvwMBlnDHtg2sigLhRSKD9+AM8GVZJqgzR7t4LYM+kSqjqT3ul057UoErFGDoJbkowf+nyRFcvBPQEfxIGaMsdpTwJNxEoNQGyWMNyYDe/q7iR/3OhElZqtnWOk3YjxVws/XoLfr8UUd7XyNFA3gZUSGINcGOac=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't actually say \"never\" in this post. There are some things I do say \"never\" about (like using the `Task` constructor), but \"don't block on async code\" isn't an absolute \"never\". It is stronger than just an \"avoid\", though, so I settled on \"don't\", as in \"try really hard not to\". Or to use your well-put wording \"use it wisely and sparingly\".","date":"2019-08-07T13:13:01.298Z"},{"_id":"ab9442b0-d6f6-11e9-861d-8db674c2d163","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"HxVRr0OR8AQiewBRvr33HmvD39xreXo6FrkNq5cncVj32CYhT1uZ8ANqj0fEDAjuLK6981ylCJAhdOpBzOi7a4nVM5pxQtlH9VgQPQXFrD2zOuAfcVgU7bDToZGv1gK6LdG0KZYz6tFwyxyKWO5MmlL6TebKUiIQiSc9JYm5Y3cULSwMXuh5lSoPOrLFlNj2DlkPYFey4OrAaS9o1z6q2tUHxynEicTAl5SSKmZ77FfhT/o7Q3j96ZIcFd7pcWwf5KqRCFEzD495F0wHfPWw6rnMsUJA4Gz1OYTPStOMgRBmzU/3RZvJFh21IP4qKtDg+cflcgPMCZ/zD5ejKZ2XNGUizwPciOsWFc6l9IrCfKDbAvTyNnKSIILsnzSA1PxLsdz9E9fxr6TeaE6D8c6P/IQ840Kmiobq50EQrDMcgH5L5v2cAv4UeSKcyPBUvCR+pScdFFAC95rkPTOU2hTwBEiw04Bg924gYXAKuDskiooioIhjXIag21MtLXi8eP/3+Cwbmwtn5MAHu0azoDoRILGb7NQns/zBTCh1qXSGYg13EgXix47zV9GN/HooSgVOTlmpKvTUWF8aTPdsHHBxAUWfp5SpbBLlzmMLlLqRiiVQxOEd2mo99W19RXMclurQR8nQK9HodRxF4ImOpS4O/h8+iVXp+J8kwU4WSJxLvRg=","authorEmailMD5":"d2f0c4d108d3231caabc4848641e264d","authorName":"Chris Kuliukas","authorUri":"","message":"So..\r\n\r\n- Once async is in a branch you have to use it above and below to avoid these deadlocks. Async can call sync and sync async, but it's not recommended and can cause unpredictable issues.\r\n\r\n-  If at the highest level (Main, UI Events, MVC routes, unit tests) async is not supported you need to break on async code.\r\n\r\n- If at the lowest level async is not supported you won't get any benefit and will have to break.\r\n\r\n- So if you are writing an API or framework you now need to write async and sync, or half of developers can't really use your code properly.\r\n\r\n- If you think a synchronous model is a better fit or have to support a synchronous legacy API; tough! The async / sync boundary will always have problems, and it seems we have set them up in a fight to the death..","date":"2019-09-14T13:50:54.368Z"},{"_id":"2421e890-da58-11e9-9aee-c13410c6607c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"ab9442b0-d6f6-11e9-861d-8db674c2d163","authorEmailEncrypted":"RZV01V0hT7RijCCE5Nseme96LRPXYKfJBldYToyZmI8RQ3GYanFLkh+JhgdQ+XbMyferRliwQdGYETCmRIQL4st87g1p0Rls/6JoeIX5Atz8Jk5gVrWR+8LJPkQ7T3BuAbdMUk6lYb2Wh+0QGhGNhhmzkU218QkqXfslG479X1gXTAGTpdNlaYozbjgX1pDLDnkUDdRSnuhjm44En7B4PG6p91jbSR4qvv+tLb3gLfP7SAfKCcwlsg0icN+YyMXalqal7dkqbGjT8CDaG934N1WgDTu5JWF8NGDfqo6xQB64hx5950k19s/vOeEtwpGnL8akPY4TZ6ej/fejaWQoYiB7LvkoMSgvfzl05QRMCUMZMgsjXSAQpjILfcr2Byecrq9PW55SIKg30/rp5fUT4VtjFHhvad7g93soD8tmPVuprvqASDSym/A4LD4DKRLJp1H0snqlUqZRrqrkuTdqfDQA2IfGpY/WDQEkbMwRyynthwCmnoxVN99/s+KUrkTB1K0ORguwNnoaiB5q7J3Qv+62mwj2QguL2Qu2EWreBUB1qYibJ7IR/grV2OirF+lmDlz/+cmCGzezwA30lfX4Qpp4DcscONLlSKUJ/cPzn1QpTO3iGuDIxwRRWuQ4s+JCMOSwdt2isWU5ZNXHMUrIbKy5oGG+DWbi5VluYQu4vH4=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"> Once async is in a branch you have to use it above and below to avoid these deadlocks.\r\n\r\nFor true asynchronous behavior, `async` only has to be used by the caller (all the way). It doesn't have to be used by everything \"below\".\r\n\r\n> If at the highest level (Main, UI Events, MVC routes, unit tests) async is not supported you need to break on async code.\r\n\r\nMVC routes have been supported since ASP.NET 4.5 in 2012. Every unit test framework also supported `async` in 2012. UI events have been supported out of the box with `async` since the first prerelease in 2010. `async Main` is relatively new, but it's also not necessary since you *can* block without issues in the `Main` method.\r\n\r\n> If at the lowest level async is not supported you won't get any benefit and will have to break.\r\n\r\nYes and no. If you want a fully asynchronous system, then yes, the lowest level APIs used by your code need to support asynchrony. But if your app is a GUI app and you don't have asynchronous-supporting APIs, you can use `await Task.Run` to work around that, at the cost of a thread pool thread.\r\n\r\n> So if you are writing an API or framework you now need to write async and sync, or half of developers can't really use your code properly.\r\n\r\nMost API calls are either naturally asynchronous or naturally synchronous. I recommend only exposing an asynchronous API for methods that are naturally asynchronous (e.g., using I/O).\r\n\r\n> If you think a synchronous model is a better fit or have to support a synchronous legacy API; tough! The async / sync boundary will always have problems, and it seems we have set them up in a fight to the death..\r\n\r\nThis has always been the case. Asynchronous code has caused this kind of bifurcation since before .NET existed.","date":"2019-09-18T21:06:11.298Z"},{"_id":"a7833950-da4e-11e9-9aee-c13410c6607c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Roman","authorUri":"","message":"Hi Stephen,\r\nWhat do you think about this article: https://blogs.msdn.microsoft.com/jpsanders/2017/08/28/asp-net-do-not-use-task-result-in-main-context/\r\nDoes it really fix the deadlocks?\r\nHere's the code from the article:\r\n\r\n    public string Get(int id) {\r\n           string ret = \"\";\r\n\r\n           // Start a task - calling an async function in this example\r\n           Task<string> callTask = Task.Run(() => Utilities.CallHttp());\r\n           // Wait for it to finish\r\n           callTask.Wait();\r\n           // Get the result\r\n           ret = callTask.Result;\r\n\r\n           return ret;\r\n       }\r\n\r\nIn my case, I'm calling external API with client.PostAsync() from sync controller method.\r\nThanks","date":"2019-09-18T19:58:16.715Z"},{"_id":"09126190-1b73-11ea-91f4-bd5a4438eddf","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a7833950-da4e-11e9-9aee-c13410c6607c","authorEmailEncrypted":"G6UpZ54Iwj1cpDqwit/UVx8jidnL5a0T9OUNLgvEg1cSHVyRcRPEuWvX4WdAaqUnoOQTfw/EFjEi513e/qpGuo5wuUgjOhGNQV2kbEdX5V7vN1AbFdtjhz2idsSHPEHeC4pNPhUvV3ApthPgV+jLhjhnOvWCvGjn+NwAhk/lvZDIb8+w+LrMMEuSyMb1chmcPk5hrReFp/0/ma5RCdccoORRTGitbz54hpXTxpkj30wE/+o08Fedn5y5l2dqBrevYDPDWeXPzTEbHPRG/dzpkjj36WzXWyVi4tXr845C8VmIKCX7ZKEwq/EOuSFdWWpXgsMfSSXcRYcXmJA85IPAuEflphmP5yHejtrrExCbUxCUcdgR2PjVVw6cvaMW8z6imkZ0oXj43nmsC3LJL87pashefIFhV7vALqCG0hhVsGpPiZ2P6aktkUt8gEOwg92bz2xMHI8h5iccM3UGF5aUoyeJMSv09rhnKHiXzKE+n4kbARtOzq/m1PtfDhXOEOsxVmN6DBRUzKZ8iFmzdDeB1J0mzOw/+MtJoLj0u/otAwk0asL2hTdL18l9q2+Xpo1NDBCTEIoPAw+RyKO4enTw1v9lWhctyVKzxQFYIlyPJWTHEcohmc9K9uMyMw4+wssUyJ+h+qKfeOXS51lUdoolNmWUVtAseu2mRuKAz6SWuWY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Yes, that does prevent deadlocks. It still blocks a thread, though, since it uses `Wait`/`Result`. Also - as a side note - exception handling is different when using `Wait`/`Result`; use `GetAwaiter().GetResult()` if you want to avoid `AggregateException` wrappers.\r\n\r\nThe reason this avoids the deadlock is that there's no context captured. `Task.Run` runs its delegate without a context, so any `await`s in `CallHttp` will not capture a context. But it does block a thread, so it's better to convert `Get` to use `async` and `await` if possible.\r\n\r\nIf that's not possible and you *need* to mix synchronous and asynchronous code, see my article on [Brownfield Async](https://docs.microsoft.com/en-us/archive/msdn-magazine/2015/july/async-programming-brownfield-async-development).","date":"2019-12-10T17:32:28.218Z"},{"_id":"2f0d43f0-63f4-11ea-acab-ef1ea9e56022","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"84cf9ce0-637a-11ea-acab-ef1ea9e56022","authorEmailEncrypted":"mv3ynY1ENCE9WoXMfZV+dQbzISdSpOfL1fARTUpNcjfXjh2JY82PfOPTy2v2fMJl/ouRXSC+Fe8TF21ur5WGG6hjmLql8AZNS91FPx5mUWfuxbOKJTIjjJeDtW+qG7ZbC4q869K6Lam2MmcrkDOPqcV+VvV4B/1AhuEu/AhnxxVo79oq7Jgx6sI2udIavK6jmSs4yM7yjAUo/R0uWS7u2M33ZWdeyKyDQmykuIQTkL4zKgtSwCaw2IuZYxZmBPIX0uuaG/hDn2eoCOj8WOkoqW1MK89z4KsQ29457orcZFyyt+jvDZH9WmEGfPLSUh6J9bOZUXkdUlGTdNfsVkquMbsYvj078XUUSvsjRMQNus7mupYmDUNzGhJ4QkBGovbIx2VKjll2+ao/C6Mgy+k1Mlu6wK8QhQLqDASn9My26P8RncFYTbdZK9cVEo2tG/hYxoHoU4fdnUqK5ty0BMmbDknRj0v8trlDs9NgTnNErhyyqp1xFRRNtAt7ebZPnoaThDdkW4HeI4eSE0Yt6bmeV9s9r2MgTTuq0m8ChY8C2KEmRWoCyH4Htcn5iUwpmPPobSdEi85Nt/7Ls+9RoLT/ecMEtTSGpn8r4qJz/cPyDvLzI7NWV5lNiUCVlr3tnZ6PYW2BvWj7xfMoLGPDU/aSyAEcQcuF+kvwX7iIGoJzegk=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"It looks like Microsoft broke all the links this week. :/\r\n\r\nI'd like to fix them all, but there are a lot of them on my blog, and Microsoft chose to break them, and I'm not prioritizing that work at this time.","date":"2020-03-11T23:58:20.500Z"},{"_id":"84cf9ce0-637a-11ea-acab-ef1ea9e56022","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"FMYXlTgAzOI+AJRAUAmB7miSd8hAqd/3COBbtB3ke2AxHX5Aa4mkGonCGc0ahMzr/eFacSQbb3goQNfJ9VGuwnI5gULPcdo9RsG9kmIwd5wv7Wtp98T3rScyJbCeFNe33FoWWaaNMEDx40YPsVP+cmNd7IMXP5o351TPPrMb9WUQFc06HTI9CIlXEN4K2X715fVoK6oY7stpVIwDfrH7JmyXcNsrY0SwMSIv0jZROEQWKfG16XT+V5571fFsx/HoVNeQrvmYFaP3wugTxueQZCI9pW3GpOFYlc4fgE5raP+086kcorStXv7XyF53Zi8AfdUI57m9f/qxYGR75n1u1joTpmBdAJ/T5zouIokFVu9/xH+ZFOgxoAbAwg0Ol+I41hgc7F0KJ48r8CDcC+QpDPTbLQqPIkUYpTutYG7Q7DHvjasocnj5Kumc1N+5BTK1VkysnsodJX4ft6eJi8KlPnhprteGgxVok0UsQwXSPIpEbkFFsl8FuqCWN+Z4d6lmKaRvUZm2FOTXoHss3pN1OMbq8+kNeD1aJ0UVzcxL04dGbd2TMFV8RM1QR3Crna15kY7m90VajRwADCW9gC+8tEGr20cFp53BAYdyZ6C9BHGHv6d0daXQL7xJ8dk0qXO/5uBeZ0O8kc/6i5c/PQibT3LCE0snt+Hk+yUKHjCuZLU=","authorEmailMD5":"28336e3488267ade4160025a325b42dc","authorName":"Deantwo","authorUri":"https://stackoverflow.com/users/5815327/deantwo","message":"The links to Stephen Toub’s blog posts seem to be dead. Any chance you can fix them?","date":"2020-03-11T09:27:25.680Z"},{"_id":"0c77b820-7682-11ea-b2f8-43d2e3ef4778","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"333018b0-7676-11ea-8042-d90d58266173","authorEmailEncrypted":"ktujjhBfMEgQfod68lpHie/Wx9fn3jZrSmRxYHcxPcpDfuHJuakSj8KB8g7bjN9VGgsvH7VcWP68naUe1rfkfp8/ryL6gRwqfzgsjC3O3QNkDMWdWM1cxvjHb3bvKXD/doQ12reokj3AKOBpV/VkIlBjdmO0Z82BClIZqi3rc73tYvQDW1bavGYfpzG6w76+8zeeD7udQkFPrNMLr3iS68u97cEln61a6QhXi9t5aNgZIXvZE/3tTuMcUe0NmYqprjeK3Z6V6Wr4XR0ZsXjqpSwp7G3i+eUQ6gQ3AXWUbrmDCDKBRIiSbmPf0Paeo9N3k0XD6HuYqriFNfBt7Lc8t7PfzfBlxLYjeHFgUP5NP9rfwcmGTLH+t7/2CXV9IjGmdrSQ2eZvNPY3XcZA7Y7mXbXk7UAPSgrOS712Pp2w8uidLK6OkFiQmIyPsrwICwEgMpminLDyG9dSjESLutoO57EKhmB7iI0osmdi9ETRxTkLIz67q0tGk6fx8jm4sJOQeZFz8kTQVcIAG88+MWcgK4qCfLwYA2D1WWDdFEKEtOl008x4JQmjxkZJLOAraE73M9MIJ9SHZaZk5uhPo2qraboAqqRybMx61uP8FCmnOInaiEVt7L9ycoSCya7RiMzeixV3JqvWixI64+GX4LmOiqHuSx1ow6RDod9ZjteR3+o=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"There are two conditions necessary for this kind of deadlock:\r\n\r\n1. Code that blocks on asynchronous code.\r\n1. A context that only allows one thread in at a time.\r\n\r\nThe deadlock happens because the code blocks in the context. If either one of these conditions is *not* present, then there is no deadlock. This blog post focuses on removing (1) - i.e., not blocking on asynchronous code.\r\n\r\nASP.NET Core is quite different than ASP.NET pre-Core. ASP.NET Core [does not have a context](https://blog.stephencleary.com/2017/03/aspnetcore-synchronization-context.html). So it removes condition (2) and this kind of deadlock can no longer happen on ASP.NET Core.","date":"2020-04-04T14:39:11.766Z"},{"_id":"333018b0-7676-11ea-8042-d90d58266173","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"r0w41TqS6ZdOHq4FSPdxRuGRF/8l/HxQoSseZp+Buqvz0nITuqJETAcRdG0sMzqEwXWlFMK8lx7ct1P6uH96ji9ccblQ57JlkzWJy1mqU+vsKE20QnHew0RlLBbTu993LOw/Wx+QGPk5Oh52rGguDAW1m86mB+ouGDL9FrH2I3pWY6ZrGnF1vkVog2Mxm8G9FxwPtV1lGxcVnpf4j/wESPga50D0eGEYeyDAy7VnAM81xB24W+9UUzpf/IghHywmIBsQqUr8rCtUsr4ovo5XB2/ST4BN7gtIxqcWzSWidWfHcLV+HILfTm8RDjgcGh7pPzpGYWC2yMFMTRPgnxbqWG4ZzFroGH7uoC5Ln0p4ZqvaUd3485KG+V86azDZa0M3sV2+GoKqNkvq44yY03WKAL7fzApHlp2/ubVT9T9O3qWs7ytroZas5ZvIBilnwT1e4JMShSnivk1MY7K76OX/UCCjXRiJAYcSgJMxczrgMgqt8fVBeWlmqzlHlwhHgizKfT8HPIYY2ZiPF5B5ef1LZhILz4mhP6XhTTAsDGnxLl/OOfV48OBB8newLrKAv/J+pZgXtnMmqZCHjVvNneJYyfU0F0HW+jh2VeHFf1FXCRxglYFfeAv2L4NYIwI+MgPj4+8qJ+qvLD7ggIZt4dJgR+bF8sKo2qdBkabQDKccGcE=","authorEmailMD5":"051a4fa50f43de11c1e9b83782434db2","authorName":"Amjad","authorUri":"","message":"Hi Stephen,\r\nThank you very much for your post. After investing a lot of time finally I am here on something that helped me to understand why ConfigureAwait(false). Thanks again for this post. But I am having some issues with the above web API code you provided above. I am using .net core 3.1. After running your code I am unable to detect any deadlock. the code just works fine.\r\n\r\n        [HttpGet]\r\n        public string Get()\r\n        {\r\n            var jsonTask = GetJsonAsync(new Uri(\"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html\"));\r\n            return jsonTask.Result.ToString();\r\n        }\r\n\r\n        public static async Task<string> GetJsonAsync(Uri uri)\r\n        {\r\n            // (real-world code shouldn't use HttpClient in a using block; this is just example code)\r\n            using (var client = new HttpClient())\r\n            {\r\n                var jsonString = await client.GetStringAsync(uri);\r\n                return \"xyz\" + jsonString;\r\n            }\r\n        }\r\n\r\nin WPF and Win32 forms, I successfully produced the deadlock. Any help, pls???","date":"2020-04-04T13:14:22.813Z"},{"_id":"231ab970-8649-11ea-b597-f3b7e1123625","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"f2hMFETbJW4J+lOkYH+ZzJhg93GPVgC29AmLtaK84F1ejIew7F6u65ZKd8qtEzqTMSd/yn/ruzGIjmi2GoAQkjVCAnb708sEz69JSx89GyLj+qh2f6JaRxsWoJgtjTH+N7TZ1PQzlAIkfKc1O0cszDJPDtJYe0uBbQ4J6mtB0Av+4p2D5CKcWz2yMzeQEgSS9VWqsyNCo9L9ukgYdiMydt7fF9m41KiWbruPX4CwLlhdvbhw2Ioj2AmsfpUpbhAarD5Mosc7gDCG3VhoQCGKjE/dyJNDTw6oVODl0sxBWntIiqJZsdZIi+QYjJFHDFoJV+ESiI/TplNuk2kCJ/+FavgcXtCXHD/mWOjc1RdE7iSbWCT71w4gAZPsPQDoF6I+Fw3auK3TuAjkxrptbf4lx7rKFdbXxonceHXEBQcXQK0rWHs2Qc+BtARA5091BAjW5+ooDOrISrS53Sq/9RBVNQraoc2yKfaBGPWhEwIi+PiDzLOM+OblShH47tQg60SKgSSmTxmE0LGHGy/JWuo+oWSg2nyjPZQNiE5FTa+bhwNCVp7O0UiK1gcOEoU3uqWcmeuLWdQ+pBdAV9CE8T7PoPhYJArcSg5CGJjZ3aIe96gskXrUxXNMPcSHKnPqOqOFbYygbAthRtMc3hjTQBM8YkI07lyL86Dig61k4cQjGaA=","authorEmailMD5":"522c028945b5860f6e7f8480866db96b","authorName":"Dan","authorUri":"","message":"This saved me from a massive headache.  This is the second time one of your blogs has opened my eyes to something new regarding C#'s async/await.  Last time, it was the fundamental difference between being truly asynchronous and simply blocking a different thread.  Anyway, thank you very much!\r\n\r\nRegarding this post, you recommend never blocking on async code.  I have an API where I must pass in a delegate which can't be asynchronous.  At the same time, I can derive some benefit from asynchronous code *within* the method the delegate refers to, because it makes several I/O calls for which Async methods exist.  That's what led to the deadlock which led me here.  I was easily able to solve the problem with ConfigureAwait(false) as all my code is written as if execution resumes on the thread pool, but if I shouldn't block on async code at all, period, how *should* I handle situations like this?  Avoid using async at all?","date":"2020-04-24T16:32:07.147Z"},{"_id":"f3c21760-865f-11ea-82ac-ef5ca24d2a3f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"231ab970-8649-11ea-b597-f3b7e1123625","authorEmailEncrypted":"oPtXcYv09pWXSPGQGNYJTt+PcWODsMrXZQcW3OxcgfKY+yN7cNMRemmEeJysLScchJjBiS2gidijFt/OcTmjUG3/cl5rUR4mmUzNI4xlcXaMZ/OvdnwP7/d1SnEJOB9uDdalTtdsYeZs2E+PvFlC7fcX2FFwNTp3WHBdHGn0oPlOfknS0ez8VyIZChBoxB7gkAwOByoY5R7vlAaVuPst9OhfeFU/5JMIAZVvGD5EGCLuY8Hn8+GStOnWvx1HsomaNna+h/29RFua+/3KWK9zVGbd6MrK7YyTqBxD2xEjuo00hYxSvXZkHQ6y/NRkGYvWrGDdX8DEeeEp0xpeAbNoAh9R/tEj44KzF1i3kEpDK0nxujp1SMFnvc5r+pThNZaDIlJWH+MCVdZfR48CYRKBHC++zSEoxRUgL6LBLyLntYGHI7aRa2nQP3GLs88gyI/rZcFoubebjjsJl/h68s4d2Z6lTgE0JlbODRV4mstOA/VDTeLgX3Iq26aIfnxTGATtngxz0HvuqG0cybJWW5YUgKh2adkt831Uv66YI/1oRf60fF5fGfEqzVMy4c+2KlmbyHJ9mJe1l+D49UZPP1hfPGDR3KOuL54RVEuNEPrl0mfaK/FXoYB/ZBv8FhCA4no683adk8MYcGNGAZEXxv1BpXXnPsbvmUJ79jPZpPnuzqg=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I do recommend never blocking on async code. However, that's not always possible; sometimes you just have to block. See https://docs.microsoft.com/en-us/archive/msdn-magazine/2015/july/async-programming-brownfield-async-development for techniques when going purely `async` isn't possible.\r\n\r\nOne important thing to realize is that there's no benefit for asynchronous code for your situation. The thread is not actually yielded unless you use `async` all the way up. Looking at it from the other direction: since the delegate is synchronous, a thread *must* be blocked; there is no other possibility.\r\n\r\nDepending on your code base, it may make more sense to block on asynchronous code or it may make more sense to be synchronous all the way. In terms of benefits both are equivalent; since a thread is blocked, you won't get any of the asynchronous benefits either way.","date":"2020-04-24T19:15:26.128Z"},{"_id":"acea9500-9ce5-11ea-b38d-917110971e1b","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"oO/QissWC+W1TtbDXSP0H7D4QnMOkqOp9iw5KzkW4zB/1TFCTKQnBxaRTIBUyHSvp8+m432NIyjuGH6vjN6eA4+nFcLtyEZRkG40P9TCJBGRwEk3K4bQd3X2RCmkuyWwOH56h3Aqs9t4sK98CmAN+anNlBw0I4ery5+cRNPY+KohNIifUBIzYvs/CEAj0PaR2dUlPf2teZUMemn2b+XcTtJwXuWTJ42e1kAQ9kEzzVtZEmW3PzrHAPChtXHJV8RVpn9TPnoA4TAY8MTlCIowSaq6hdtFhd8DLklJzwBtGlkDkKC9ek94MUfcz+xzFCgpTa17U758v8ArDsqQXzpoSQLKLfAkl8hQryBhxAzUl3D0eH3nEv45zpOIXErRWqDMw9fANQ435GV3HMkedl7nGlwpjvEIFoRGHwMin0HQzTLVxGYmq3Q5yNdp0t2sxtMnWFoJ7JTi+HniXnZ/p2+LgjjXLQxxtQauUKW0+ZEyk7H2papjgI0ayqJ4ee76OJVwRelyvhKXiwtIjUxzC9qOpM4oboNsE84tPmQwGGnhkt/c961i3hc13/DhWx/3VVcA+xs9BICJimuDTuqXeiK0a63n9k0H5K8+zRFmzJopyf0kt+VarEtT2rCzPF5ooehyeaFLA3MBcEVXWO+FPozyDH6BfSeRwnOQdSF6mKEmAyw=","authorEmailMD5":"d8fcd1039401bf7a75c2f9fe2b91418d","authorName":"Dinesh","authorUri":"","message":"Hi Stephen,\r\nThanks for this blog and other insighful articles on Async and await.\r\n\r\nCurrently facing one Sync over Async situation for which i have posted the same question in Stack overflow. See\r\nhttps://stackoverflow.com/questions/61970718/using-async-graph-api-in-sync-methods\r\n\r\nCould you please look at that and suggest me the best approach to use when we do not have a choice on Sync over Async and Async over Sync.\r\n\r\nThanks in advance\r\n\r\nDinesh","date":"2020-05-23T11:08:05.337Z"},{"_id":"b346c500-9cfd-11ea-89d5-c945cb0b3322","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"acea9500-9ce5-11ea-b38d-917110971e1b","authorEmailEncrypted":"thMQzXXMlZNdp/e2s+ZZXdb0+5IvBLIdvVcjKO1pvqNxGyPIQGTFSzHACUt5yrfUuIyuXRlKiaqhRUW9nAj43ao60qyzqR8sVBNSy6KSCoxVlOIvbBgTCpsobg4JIVOcmPiGF18L75fiC52KAdN71inZPZFpJ0ovxdal/vYbQrqZMyAvsyaYftMkBW1CEQaTIlvkmj8zLzp6e+JXSzglMxEw8LzIVqLcLwat8GyET31ZqZ9b/jqepsGlJiB5X0XtjQ09BB2VxrEHmDi087oG5aMvRvNG4ExFKJvHdzwIbNq/pZZYdAKK/B5+SU5Z4XtDawtjpR3XWErZuaMDK58wNB1duuCBYAEM6XbtBXtUHJtwabAjRJkmoeF17hkUoHrH3H8/yVjJWgMky9ooPoIEycKdaF8+VjM3s2v5edptwLtw0Y3QPklSuYOEplFhiSg+4m6MOBgB6nijnQue4m5u0DsbmZHbA4v2aFdwy7DXDqrRs0uDAANS9ZdtjaM2Q+o7Pkda43CSEIaqgNS7pPs4LBZjR/3bdh/0sfEKzR7kbKz1/dFjLEOqUZDBU6e/lfNG+28hVkv6j+llXkShPGWtpCClBtbYSomUqaJ7qQ4YjWOguRHdlN3FTOBatFw90NGMC4R0FPGjAm9usZCG5uZhkHOF4I9Cfcdb9Jya6lkqRsI=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Answered here: https://stackoverflow.com/a/61973150/263693","date":"2020-05-23T14:00:03.941Z"},{"_id":"e90512b0-bf89-11ea-956b-7560b1773dcd","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"ayluh8RXsdvDPGGxu2mEy7xmoly9RcTtvtMsEl9NgH6XqzuvGtsOu0ZZJg0ZWnq0MEJu4mZDUDmQRplsGcbiJbHwTTgp7XF1t6frrjEiODYaNJZWacceTQ3JMKcQCWM5OxF5D03MaTrnKRrFaH43fhljE25P6nk2Q3ybVJyvOkbLuoVC4YEEf5VZMlfkg0GiJS+XB6Mp9l76DcSCY+pRAdxjncvuwF6OZ9/g83q9UTC21CgI4I9x6n4Jbdqd2XaKy2yd0Zy1PxDILITPrXYURkrf+NObcVHhzs2Vw8R404jH4qpeGn2YqtnjTVkDfYLNIsGlXbDcG2LIAvDLj+K5bY0RQbNNmGnpr1PXtmsie4D7ZCGBIL+GdL01/AFIUSNT1v8Sab9+4K21K5xZJCkr1D8m+MWJyNDoxoIK8VYiSUbmCwckYsUWL8Ba16T/z0u9GbK2CU+ifuJPr0FeFZ0EMZCSdNCpj4bajvnO2DwAgGdVvRdd9Xv6ueLSrc0eez+MzRO1WwZi8fNFHmrTx56jCwUge1fv089o9Glb0DvIibsOr43m6UdY96fw4KVChvbqkWbbXdXZfy5XbstocGgQLjNSfsyn6YYB9OD38QINjLLfGYVjIfVrEiMASX5IC+VJHyYwSS/GMph9TDdRVAgn/Lt88y1KYlOjlKB+kbSJAow=","authorEmailMD5":"8a753470a0a4fb787d8b7d5efdb03578","authorName":"Hayk","authorUri":"","message":"Hi,  how i can make this method below  async (non blocking UI) ? \r\n\r\n    public static double GetRsi(string symbol1, string interval1, string period1)\r\n        {\r\n            string API_KEY = \"XXXXXXXXXX\";\r\n            \r\n            StringBuilder urlBuilder = new StringBuilder();\r\n            urlBuilder.Append($\"https://www.alphavantage.co/\");\r\n            urlBuilder.Append($\"query?function=RSI&symbol={symbol1}&interval={interval1}&time_period={period1}&series_type=open&apikey={API_KEY}\");\r\n            string jsonData = new WebClient().DownloadString(urlBuilder.ToString());\r\n\r\n\r\n            var machine = JsonConvert.DeserializeObject<AlphavantageData>(jsonData);\r\n            var _RSI = machine.TechnicalAnalysisRsi.Last().Value.Rsi;\r\n            return _RSI; \r\n        }","date":"2020-07-06T13:09:23.199Z"},{"_id":"fad05870-bf92-11ea-8248-75e050bf65d9","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"e90512b0-bf89-11ea-956b-7560b1773dcd","authorEmailEncrypted":"PK/9WMkM8FhHV9RMZTDKJeQSpEjzfui5OLnMX1ZGaOhLwpCUTyhfPx5Uq3x+zojOXzTE/kaF6JQQSD9aC9fPFKo45ZQSwWN0bA7QjWXdJdqzrVESUDftnDhO/A8NWHe9gNGgzPznhEFXK3ltP6PfJGZkStimhlGrHRJX5xldvIeweRlC5u//t7gk4aOrL2kszxHzN02wdYCM3D4its9cmQURVIbpzLwzcjNusTbvgb2fLUTngFZGfimPPiHR71iuh3TD0hWyHeb6K4sb3DU/01egMlNt+jLXtZwxxjwtHWH/ePQy425GlVHABI0FzuSJdrvoWRwqY8DO2lwdB3eYwx3KHXfufWWh1djmwrwnTBzLRmgddSUPx1C5g1Xl2drtP/VOJwd/kAgRv0jWdMWi2zI3yFrzuP4Bl6ulKxC8mpzQzy9ldIDadFuJg59bA52CDD1UxA8YPaQj7ge4dUbJElaNb9AP/p+SHvbZpps46irv1vDWvGH5MbbnUvNqQIZMQ44oIJvUDYEErvOMOmIku7VWVcVzcu0drmKHVW0TvjXRhPmOWrNP1/XmqNs7lZMRD+S6LSy+AZaQNPOa51D/Q6QblMluiisGMxJofqQlnnXr8TyscGhgNZ2LtzDBxT98etGX3+r6V/vSZjC1mVCMNy/WlADMuT0qhQIzg7MbV0g=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"The most natural way to convert a synchronous I/O-based method to an asynchronous method is to start at the lowest level I/O API that you are calling - in this case, `DownloadString`. So convert that call to asynchronous first; in this case, I'd consider changing from `WebClient` to `HttpClient` since `HttpClient` was designed with asynchrony in mind. Then let the `async`/`await` grow from there.\r\n\r\nIf you want a more detailed answer, post this question on Stack Overflow, and you'll get some good answers.","date":"2020-07-06T14:14:18.476Z"},{"_id":"238683c0-c056-11ea-93cd-bb90bdfc4d47","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"EmKsbCeBkErsCBL5WC3GRZ/QRl8ufou+B6q5cyHkbuqptbNdtbnDgNI+yd7SCYjysVKytoON21RqJElcKwGTzleYUunRxxZoPZGrV2b4TW9JvVboM2UmQfpMdPEdRl10J39ruLgqPRI3s2lvmUYLSY8BcgFp101zuWWI/t3gFBI/ZISrpeRbVz4SbwdyAB2umCfDn7wavZkR4jAEhVNfEFonZKGxa3/Eo6EPpcxlqE2f+WQ6jXRQpNldRhGm3z2eq/h4yF8vPfG764x1uDWOPd5jyHVQ3oZZ3P0h58JagAqQYfN+EIMz/4JBIYB8I5mlnxOcH0O421rGjpg3+e6rM6cOhxK/O3xXo/FhvyKCDIyof3UNdkO4tNwk76TjVp1SOeSvq8kvUpiSD/i/oosQh/RnfcT8dL519KV26gnZT1ImMLLen6+I1O2TdtfnH26SVlhadRSIEGQSx4o8c0G6s0ig/jSWbLmzwiUpEPVuN3tRGIvptn4frv7ElkksczI3gBa9g3ezrfFBvn2vCLBrLMf+HviA5/FW4GaZA2yVhdM8r5Nq/K27+MsrSjYLbrC08MKP57ZQD8nIjxoGOsvWWUmAUTxWBeWs8noZ8Ty3sZuBuJTM0bwu7RiWRjDI8MVVNYXUb0RRpjn+Rx1NUDRfWTt8xs39YwgTdbczvpAdwp4=","authorEmailMD5":"9b2caf902c0048618bdd94ce6d73dc59","authorName":"tqk","authorUri":"","message":"ConfigureAwait(true/false) still fail\r\n\r\nvoid button_click(...)  \r\n{  \r\n..  \r\nvar result = dosomething().ConfigureAwait(false).GetAwaiter().GetResult();  \r\n}  \r\n\r\nasync Task<bool> dosomething()  \r\n{  \r\n....  \r\nreturn await CallToLib();  \r\n}","date":"2020-07-07T13:31:18.644Z"},{"_id":"b191cd10-c05f-11ea-99bc-c31ae05e4208","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"238683c0-c056-11ea-93cd-bb90bdfc4d47","authorEmailEncrypted":"DD9xnzqgSa2VZEOIG/ZBAGW5JwAS2uE/LSi+RMNez6qH2ZN1GphjRKxO34cLf6r80fO2rb+idiW/4fo+NHkTon/6VtQz6L9gH6554G4UNU8tlQCZcDjvNsHmK/NvXMmb2QHXPHjPVSLGG8urLYagdjJSk0kVt2SykvE01rBFFboLBz/Fhv+fHkz5qG46qzS1XB82srgStFSP5O9bL/E9HFu0mulLoVU2uttsCMZ4XTmecEmLnUYb9d9SgqnDoeSox88smTO50GpeOPCuYIdNB2lFEGBCPKqPimjs9/zDDUJgL0zIjEKSaZN9BxofvOhGuiblpDDo+t6rjxMIubht6YJmt5mqQ8bE9eAjn4dRWRbCAcucsErcgi1poeDlnaz+NIdf+N1FP7xWvA8bbo4S+rk/aHIkDc7g1UNSg0y4je4FSRVb2dFBRYcZy/hrF/IFi9hAqiV9Zrzrv2uyOgqEdHseIQVmSWUez6mRrs4zF3xHEno5aTg5JBCbhPTZjjxT/pPt2jWaF3f+HOtQ570zyCQDtetyZqztXIMmcth6DuHLOgAYWrzscDB9whX6cnvMxM61WcNBYgTWtADkG2keMGksdNcdXmAKT+LhtQcnYPf2vFCNwGPIjY4/JVKzTViKozh5zXG/rTh2Dgb0BEz+n48TN/nwmENIQx6XvgPN8Lc=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"`ConfigureAwait(false)` does nothing in that code snippet, because there is no `await`. `ConfigureAwait` configures the `await`, not the `Task`.\r\n\r\nIf you are trying to avoid a deadlock by using `ConfigureAwait(false)`, then `ConfigureAwait(false)` must be applied to every `await` inside `dosomething` and every method that `dosomething` calls, and every method that those methods call, etc. `ConfigureAwait(false)` must be applied to the full transitive closure of methods. This is difficult to maintain, which is why I do not recommend using `ConfigureAwait(false)` to avoid deadlocks.","date":"2020-07-07T14:39:42.400Z"},{"_id":"1cb24910-cd2d-11ea-9d7c-898f3ecdcbd7","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Oleg","authorUri":"","message":"Hi Stephen!\r\nThanks for the great article!\r\n\r\nBut I still have one question related to fixed UI example above. \r\nWhen we're adding `.ConfigureAwait(false)` to `GetJsonAsync(Uri uri)` - why we'll still able to change text in `textBox1.Text = json`? \r\nAs far as I understand we will go without any context (and not even in UI thread) after `.ConfigureAwait(false)` in library method. \r\nOr `.ConfigureAwait(false)` will affect only continuation part of the method after `await`?","date":"2020-07-23T21:40:22.918Z"},{"_id":"a99dc750-cd32-11ea-8707-27d8758bee26","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"1cb24910-cd2d-11ea-9d7c-898f3ecdcbd7","authorEmailEncrypted":"ooKlD6z+wHHq+1VLCmv1/ilhR0HlMdC3w++Vjd6SM2IN7mwWRrq7CPud2N6Q7Zs0zikyy6fR0NAl01dadHTG7aCAF7l5KILJD2I3/f68KGEI8pCNtOxJax0s6heBYjv90o9QxB+qB/bv9i3dh+CbVYZvYOdSJ7OcVqgln91vrNoTIuoonqzb2fzy4XVTCPjmi5fO0nYC/QANrSf0/ReqkIwqhixarjv3pL5SiDFQtA4Jd2yAyqGopLQTEv2YchLpVbP7c8Me0vQwtIFSvp5wGQKJw5UodIb+bvwHavQ04dFSEQmhDl6WS0I7b08OzrLqWXgq3uEfVdutBYtlgHqVjoR+tY6GukozF0ZctUSl8RW68it0Lnu3QzksGODfHgL0LuLWJn8+jR+i0grYH5xG/0lMIMqkEe5iHOCpj/thkS9xzy6TvqV8E7B6gIfacPvB4MpqPgjrJFO17VWg2s7M2AxYb3GK5CbEWzulMNkD0QE6v27kMjlpgkp4u1DVJQYvUxXNwHKm1qs213OQXlJYoe0nFavT1Mo6YeeBUsizhfL05RRgh0Liz8B//qP7bEDPXNaydv9+/m//GlYY4ODpNBzLQEcFolfhwDYeoQoSXlEbJFkDrm1whpSKA4HjLEHeCxAvpukEueDcL0IN707FZRebqz+xSXiNnH0nm6l5iFY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"`ConfigureAwait(false)` only affects that one `await`; it only determines where that specific continuation runs.\r\n\r\nSo, `textBox1.Text` works because there is no `ConfigureAwait(false)` in `Button1_Click`.","date":"2020-07-23T22:20:06.804Z"},{"_id":"1b8d8c60-da58-11ea-b4dd-855355a9b8d1","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"202dd400-da4e-11ea-ae8b-e1e78429c9bc","authorEmailEncrypted":"DRJAhIYGl4f6/IHc2ysPb5cVvIQrcdAQZgJwPH5qPot/ZqpfSEmhaedNRGXl+NSh/WlnAspq33nSGAC3VZQxiUkUmzO7Qv7uqoOd596oAtQneHnCAxaiATx2CtUcJFoyG22eb3ukFrJDCQvhj2420XcIiDcMdcrT5zgDXX/D+dWPCqMVaERuswecoRk1mDAILletulK6vFxuwk0WKusatt/4vMjDoEGtYGI0r5GNXRY4i34Wmbd8IOm18MG+1nusDk47ThPfAqjSUtdsgqd8TwrIj3+mYQZZ/USpxzg6VdcJRCBw2H9d6pdeHYX9YoFIVO2rHTOIZdllAAN8H7oH+pVYsnIK4daXuKmAS0t+XDoBLAMUjJG9GwGeB6jbKcZo1Oi9zCJj7WJPCW61jlxr6ucK6BB6o19aSJJDXmJRjR+BNXWrv901RCU8wyHGOFLgaI0FrAnhNpwXMOTJceYae35182esM++mvPznfIbrOhr3VUNr5zmcv6jjjZQyrrpIP5VUuZcM7YMmP8RzxVtePS5vjzKSdF6kEimGVxUGDNS378sWYqbtHE9bYGEe7ewY+YVs/EusMqg75/1giefTbcGaB9m5kpIiqVJI5O+dtc7K2W85mjz6hSgnH6okmIPV2hkYQfGcmnsxYK2FHYmkhQlJsVnSkBviu3NeUExckz4=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't see anything in [the docs](https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient.getstringasync) that would suggest that. You might want to read my [intro to async](https://blog.stephencleary.com/2012/02/async-and-await.html).\r\n\r\nSpecifically, the task isn't \"running\" at all because [there is no thread](https://blog.stephencleary.com/2013/11/there-is-no-thread.html). If the code used `ConfigureAwait(false)` and if the task completed asynchronously, then the code will not resume on the UI thread.","date":"2020-08-09T15:50:54.489Z"},{"_id":"202dd400-da4e-11ea-ae8b-e1e78429c9bc","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"sjb","authorUri":"","message":"What I think is a little bit funny about this example is that (if I read the doc for HttpClient.GetStringAsync correctly) the task being awaited in GetJsonAsync is already running on the UI context. So the switch back to the UI context at the end of the await (i.e. when you omit .ConfigureAwait(false)) wasn't not really accomplishing much in the first place. You could have ConfigureAwait(false) and still update the UI from within GetJsonAsync, for example. Agree?","date":"2020-08-09T14:39:27.286Z"},{"_id":"647c85a0-e617-11ea-8183-3ba4056c27af","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"ubOj2GX6PTDXMMCL82dq8gvLIggse5qwv7v4l/XPUyAQDgpXrWNi3PXIHlcaCAXxTbkjV0BCizrveFo580IOFm/i40YeY72Jt6EVr2RCswylKgmLRzrRO+ZXzW0qW6D6UGicH3VpGP0wuB4RjBxbCqbhEOBtxMKiCVUUILU0IbW1wWS/dN0ZVqTQ4d4O0qsWeAGYTH7dBIZGrkHsuucNz9kpKTvMVjaX2PV+yRRkLcM82aSbb/Duo7h/IqqSAU9VictecFDBRKAeBW7/9NzEsCGV9wWepJI767nosXr6F1mOf9dj97Jjio1TLc5qGFMnu4ihwRb6tsrb9tjua+Ygc/RZ2jR2pfaucp6VxpWYVhojsWaoILTeydtlohM9yToUPDuwrC08IrFt8NTnu1TSCd3Yz7xfH9SwjPN1Vuft/T/wDsBrJpyEDSFKi5McIEiQ0bLNo1AzZxuZ5wLA4adVRmt6N6RggmuCn/RlI22IN1z3eY4Lhb6nn8bOSipzYa4W0ZFPm55n8StCkVo8gnjgezUYTR84D0XqKVNoOCQ5xgzNEBiCCJz5Ui2nR5y+dFmJGA7Ivpv4rwcfBhe1/dpGhIM7mXrIM22Dze03gAAy/j2vtjyMwau6NdYQ9h7MNrvhFzEDI6YuPVDoRchN78rdUeowqdMunz1qrd2uD6bTpGg=","authorEmailMD5":"0cd51b32e4c37570e39fa1be38ebd2bf","authorName":"Christopher","authorUri":"","message":"Works for me. But...\r\nRegarding this comment, what would be the best way to do it? // (real-world code shouldn't use HttpClient in a using block; this is just example code)","date":"2020-08-24T14:37:53.537Z"},{"_id":"b4d409a0-e618-11ea-8183-3ba4056c27af","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"647c85a0-e617-11ea-8183-3ba4056c27af","authorEmailEncrypted":"sm0aERItdkJBRedahcNANLUtqopU6h7xgrndsJE+LjpYuBhEe/C76o+2imPRmm/2m1MppNezp0ig1zImt2OMdW7AMEexBPHJ+1XbOTmNqZIwkSQIKcea8dDZLiG78h3ATnHudiTCCoyCT+HpohLYWVDXUQq+EAw6ueFuU0OjY+Hx2IdoLkAzVBNOk9eNKIeUmqJ05PPnxyyT7OoqtrKGQSSPbSHasZHO8MC9ppzghujZElhdGxMnppVMcQoI8VMLJyguR1amiLAPNG2wEZVKz2PArgkIAwuAhQcUzXBqlinPL+2k8cKAHsxut1BCKTBxR2d9mKsesE3I+s5By19/+LGpuocwhdScGTkUoIsKitIN1GaT6fys6gJanfKcoLkdj6WK+04MpKhTxls91gCgmUtB9UI77+9wtmtkCHArtnSyIRZ+esqftKSfQAoLvPABsnoo+v78vDA//mJPfpSW+kO7fDFKetcUjdcsciTFU/rKdf+hHV5tWM7blhT9BCvHtX5uAhaBZpWIsppoTvX0EMRxwVqGx8yx43/AiCNuJ7i7u/fb+296ZIHNUVLjEQl2BQx0lKE9e9G0DatFZiLVJ9EvEVc5Cds7aX8mIqL4J8qa/8S424HQw6fgNUOWat74lVWtpm+LrpokLe7L/KLprJpACjI/HMe+qI23qvWtucY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Using `HttpClient` in a `using` block is now acceptable if you're on .NET Core 2.1 or newer.\r\n\r\nIf you're on an older platform, I'd recommend [`HttpClientFactory`](https://docs.microsoft.com/en-us/dotnet/architecture/microservices/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests).","date":"2020-08-24T14:47:17.911Z"},{"_id":"ecc301f0-f477-11ea-8c64-ad8ca240b701","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"b4d409a0-e618-11ea-8183-3ba4056c27af","authorEmailEncrypted":"RT3rVqL1Wgy7y/lGSbeqy4mO4UVxa/y+WQiYm1cjLawLj2lZZag7MVLO0TL5o1ewU7fnTk4YwVKVKQCaca9ftwOSDT+MCnZ6ukFae2NKsZkIRo07hEnZL3ZBC1NGHNybAAYFYDdwhe4hBLe9A3Ch1StbqTMI3+7qgCWKVValX2fZp2lVFTSJLTSUfaR9/TqaXJYurb7lweBJFap9tZehUMu7vCE2fBm9d6L8rzpwrW3ji9Mdb9ROVJNaQ3Bu7W+KB0/hqbasiFE1RuxOFZYHdGWpo24GPlkruVql41e+w1/+RH60l9qUbwBVkhjFjsnZILzkby+qyxiNY+2qflHnp3jDe0rwUWUUvo4j7wUvjhTLqcEfHK1wM+3E6NqzfAF4CodNQ69NYrGyLT5+r6MeSODJslWhC938qrhk6b9hNxlu5Z9AF+08USoNAcY37RnQn8xXe+lQzZZSDxEKrxW6WkB9+OReOXqCezaEnQbI1BaBeZZUSGICCOO/BfU6vHGmapq60oAJdG5FSLZ4KXNaoUAmnO1QBKxib7/zzYmZPoVboVhFySWZl11SHWvZ/xWfHnpO2FiX/T0twS7+mESNyFM0foBTUytxgf72RDbGExo7CIoNVXKB6J4iSnDa1UIimb85l80ChOnCJXHHH8N0SWltpKtL7KDJLA8xvKFWF4I=","authorEmailMD5":"52c1ee2fa281a382362618009ecbc6d7","authorName":"Marc Lewandowski","authorUri":"","message":"For those dead Stephen Toub links above: [should-i-expose-asynchronous-wrappers-for-synchronous-methods](https://devblogs.microsoft.com/pfxteam/should-i-expose-asynchronous-wrappers-for-synchronous-methods/) and \r\n[should-i-expose-synchronous-wrappers-for-asynchronous-methods](https://devblogs.microsoft.com/pfxteam/should-i-expose-synchronous-wrappers-for-asynchronous-methods/)","date":"2020-09-11T21:44:10.238Z"},{"_id":"00c39390-f608-11ea-a11b-979985d7b4f2","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"ecc301f0-f477-11ea-8c64-ad8ca240b701","authorEmailEncrypted":"hMc4w1aYeV41T4c4lJFT6Qz4JNC6EZL0ez7B57UT81JaNepU6JnVCe/JTbPzA4W49Z28HXyKYvYSJ8CASsGzOy2MAb42jbPsrmQjn+lHzyyE68afDcfJd+1M8hE8/1wszNFV8IUoUyRRzRcQJKbBd9gm4H9fwGhFHJT4fxjme7jfMB9Z5ibrSSnpToGtk9Z1jbqBBCNIEJdh0frknRbDWQqJbQr7GltYiaTQNmcSYoh2chuoNJ9p8hKEZBJLlZRNgzJuGe9ZA8D6Mi6/FqwzynVoZqmMH6RwIoFVufg2JqMokOpIbqrZXpHz99WeEONS70oUFqcPtvuq8baQMaKUwQCYFnIm0n0LljEuiD6xZlFUkriBCI7aTVuNBUawummqkP1xwcURv6GYBQ5ZcGJb0/9gLQobdYaXvEL0weHCcm0K0LcHteoOHWF/2adp8ZJ6TDKlCWdNNmysuP06LLbumRYNVjIzhI47582EbDp96INZ9fDPkPAEnfIMKqXruJmL2VH7R0GB2ZlBnyxPljqohqWMWEjc9h9bWuHJ7dFlfhtiTB1nAPcWZUAoRdXivDWhk9GLJyt19LoZVSNB3pLQAy04GnFFYnhU4h8Q9gbw6HJUOc06fn/Xp2Ez+CX9m5P7COKNkfDP6VwCFgUe+98u4Io2cbD57787pJ6ugkxww7U=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks, fixed!","date":"2020-09-13T21:28:02.357Z"},{"_id":"51a1cde0-fc16-11ea-9423-c9d5459c4183","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"ra/lonnFRFDPQJtjAh13s78bi1Nzo1CQL7TIdT23g2crzv7k0Tya6Mp3FEbL6nbqFiihX0OALqqrC0nLrrTmSqOGgInZ7Eom64BUcQ0y9gCk3vrJqhN+d3omdxcJDIxi+FF7FFuQ6T76gOrc1GuUD800MFn812o9X+wH7tGZw3ufUMq+Jqz8bQHDDSRjsokqMPt8HjekY2V00zvZ/eh08u+ZBRm49KYmun5xik4DRnkVW6ER0RQGwNTwd3PRFrWw5KMNZ2Va12L4V/dl39ZJvmG/plBsAvj3valA7l+zH9eLDOQckE7TG8sySsqBmHALJilnP7JlKByLrGPlRk+qTFaXagjxmo4DaOfmtUb+Txxu8AbusWyVnwZz3GGarb9OLpUReqWF0wmIzW0JHyHYqGbeuTocEnTe/Ad7cZs6c4fnMHWEQ2fbUx0RTa5rB+mtHhLuoYAMIxYf75FFMzeLDKdPcnbzF7ePjOWCESkqj0UcnfgeDKmEgaDgbEkCKOOtDS6PiTNBNyNkOfltFeD/CjEfDh4PGSmxw5jFUMVy2Vp+ySqHWXCE7o7gYv1+mDnsUZJ5HhfRsNktWpxPkDRrRZTfeD9VMdnh/pH5+rynKrW9n5nvXnVf98In5Bsu+U2RaX1pXzy6BhjvVTIEhSHM1csS6e3UIHXh//4H+ziIgbQ=","authorEmailMD5":"1053fa82d1771d8a17f3e1737528fe7a","authorName":"Yan","authorUri":"","message":"Hi Stephen,  \r\n\r\nIn your example code:\r\npublic async void Button1_Click(...)\r\n{\r\n  var json = await GetJsonAsync(...);\r\n  textBox1.Text = json;\r\n}\r\nWould the second statement be failing because it tries to update UI in another thread? I have a similar case and it does not work.\r\n\r\nThanks,\r\nYan","date":"2020-09-21T14:25:37.967Z"},{"_id":"634e1520-fc7b-11ea-bd1b-0bfa4c095bfa","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"51a1cde0-fc16-11ea-9423-c9d5459c4183","authorEmailEncrypted":"ItVzXuFENXMCcVbLvJjt0q+GMpk6vxP6cH2yPIMscAU8qFfcpSMU8AkQ6AOjsHu/DQiBz1gafsUSFwPQnoY97ZlL0yUJy6hW6Her1RRjnQpXlO3kbkGFER9h8iER7YwfIjU1R7HSocoVS6Z+lf3Bc9IVEKA7ZjXnmoBjaJiW+gPurumFSUwoDG+X1kixn4rvUC/4aMFiW44hiLdnRyaBTK/oX8eJNx9imfoWAY6/2DDF4xiejc0w57xdUoB/NtNvqm16BHXLR5UhP8WnQraDEJhoSBQKgWLzPJHjxnUlAaLEdW2mN575pfntLxttxVX/qvT/qhrnGpI1NZgP/cTwJ6lPL/rKIMl3lcyPWujlqertyhEEXy5S3QftkYeJPWUPTVZLyED3bJgg+oIOGVJMjAG/2oHJvkG1Neirn4vLo9E/Ue1uVjvLHMijUzTiXQz+UaZb9/4LwU6QGDR+xiSjakoP4CTBZrTuO+B8oBHs4siGMOA9UirWIssHeG7x4RNf55oZcoz0MZOsf+8qKuqVNgIbIzA1sobKjviXmBLL2KWXV1dsfWsSuoZgtd8wcmeTeyqs/MHf1wc3Qa88NYTnXEzToQXF8wlDSy+dJBo6N1DB7TyjenjBRm0IfR0n48KwuiOds9Ate4pQukACFsALIjWtwpTQiN5c6Q8LZVoygtY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"[`await` by default will capture its context and resume on that context](https://blog.stephencleary.com/2012/02/async-and-await.html). Since this is a UI event handler, the UI framework should supply a context that will cause the `textBox1.Text` line to run on the UI thread.\r\n\r\nThere are a few obscure scenarios where the UI framework fails to provide that context, e.g., .NET plugins for Microsoft Office. If you're not seeing `await` resume on the UI thread, then I recommend developing a minimal, reproducible example and posting it to Stack Overflow.","date":"2020-09-22T02:29:06.724Z"},{"_id":"a9bd9260-03fb-11eb-bd98-7daa58489660","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Istvan","authorUri":"","message":"Hi Stephen, I have read your blogs about async awaits, they helped a lot, but I still struggling. I have a wpf application which works on sync manner.  It has a DataGrid which displays rows from a db view. There is pagination, so there are next, prev buttons, or you can provide the page number. Some db view takes several seconds to calculate so I thought to add async methods, so a loading sign can be displayed while waiting for the db. (Your blog convinced me that BackgroundWorker is not the answer)\r\n\r\nHere are my problems, I start from sync code at page change and call async method which is not a good practice as I understand; ActualPageNumber is a data-bound property which setter should start an async operation (I read this is again a big no, no). \r\n\r\nDo you may have some small example async application, which can help to understand better how to add async parts to a sync program.","date":"2020-10-01T15:34:58.756Z"},{"_id":"ac843b10-057d-11eb-a2e6-2905133aa567","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a9bd9260-03fb-11eb-bd98-7daa58489660","authorEmailEncrypted":"S5Pl6QYLEEdvc/gBgxuP2WUWM5nhU4Dh7Hb+s4gNaH/aigLXR2OLYS3SDxArKsrEJ8363Fl+ByUybYwR2grih3Xg+A9M1NbDzPwECwpNQf11Wi3ZyQGfRCjTAivbMTJ1TdLgOp0BLsPSeXya//Aj6WoDsVW365aC+55/9MH5R9gVs/LgX/qH7a4dotje6CZUwc7z2nl1IiOGv+h+jiqs7DjAYGcfwIZPwlG+yUdo6g49/0lyL0sqpZAZs453vFj8nDQrVCpPjBxWzXW0+9omssdyHsg5lfY+kvKEb6sEgL0TZcUH52tH7lB3ewpkG8YHycV3N4ku7yqo/v2j0TSNlBLlTo4WMxtFxuh9Kh8K9etza24yOx+IO3Bdz8oSWDmTDJi8se27HhxJWI2ueQZtnA/E63SY8+P/5RHUvU/ZEEFztclr8fUWoxPJmli+RXpyUu8szXZ5i1fx24B8UtqkVIzyP1Qt4CQQgxGsq/rUdfIkDxwdQYnVS4rIo2tEWPNLivwdI5gh5669VmVaQwopoXu4bHDhx0gqMCjz4ykQyEb0wWpIfDI76gpHtbIRNRc1qsmmGYGaA9pZz2f4/TIsfJFQvKI3MomurxNiTVUnMELKTX28+7WXZO1KQWfDX7hxH2vS99qErffA2SBIw3DMIMHHoR0Or1GWW+0ZpyydYtc=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"DataGrids are problematic, because they just don't work well with async. The same is true for DataTable and friends.\r\n\r\nYou can start an asynchronous operation from a synchronous data-bound property by using a NotifyTask kind of trick: https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/march/async-programming-patterns-for-asynchronous-mvvm-applications-data-binding is an article about MVVM, but the same kind of trick can also be used with WinForms.\r\n\r\nHope this helps!","date":"2020-10-03T13:38:09.185Z"},{"_id":"c8f0fa50-097d-11eb-a788-5943ba6534e2","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"e78d2f60-092d-11eb-b8b2-03eb9bd9947c","authorEmailEncrypted":"SfCNW7Z+R6fZUZz6w6j+LrNACXGe9P1s+iIKf4c27u0dG/NKx0MbwS4n2JMK+Krmo0YkC47ryuE5gjnWRk00aGcmQl1m35GXVsfzdpW+mEKslpOb5gR3y1C8IaYMkZlJ1Hn0rexOMFIHHn7xYE4ECRgFO/d/SRzTR2jh1N5hRxSJTp3KQnh3RdkqOnouplfCtR0rJsD4AU8ntEQ1WQ3c1O363OKUYv2nqAPQVJJC0u4YOny8LwTC3AA2w/uEDB5Eq47Gb8Pl9P5SQ9hD+owPw71MvX1WAkrhs0botIRK+sI/vEj7Jc3Fdg5qsgBihuYErlhXR5jJCrdXVTuU9N4z65LUCZWPSIpUNj1VUO0/9JqsBDTl8MG9x+edKSZNDVepJEvwa9VnLd3XtfzCuMPVnSX6bXitMjoSTNa+VtG14MeK3cXQaVYzNWMjDBLFv0UWhfR+T45wet5b6q79Ad7aNNI+xyWc6buTIbV8/yMIUgyM7YQ9TwsdorJIBHKDEbT6N00sKjdfsj9svDv0j2gqsawTk148bqO7axXO2UWDHY22EDNkjR83E8VoG0MXHmn6cs34sIqdlgTP0dEP91E7M5b8Js+LEg2AVgH2ufMlun9xa3rke745HtWrFub3NEjH9a75EbuRpwW1KJuZTUxWejTJvhL5JnV+Sf+soRF8cWM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"The reason I don't recommend that solution is that it's less easy to understand and maintain. For example, what happens when someone refactors the method to call `C` before `B`? That said, this pattern will work, but only under these conditions:\r\n\r\n1) The *transitive closure* of all methods being `await`ed first must use `ConfigureAwait(false)`. In your example, `D` would also have to be sure to follow this pattern.\r\n2) If the any of the first methods complete synchronously, then this pattern no longer works. As I describe in my [async intro](https://blog.stephencleary.com/2012/02/async-and-await.html), every `await` may continue synchronously if its task is already complete. E.g., this may happen if someone changes `D` to return a cached result if possible - in the case of a cache hit, `D` completes synchronously and the `ConfigureAwait(false)` on `D` has no effect. This can also happen in some surprising scenarios that you don't have control over; e.g., `HttpClient` will cache HTTP responses on mobile devices.\r\n\r\nAs a reminder, `ConfigureAwait(false)` is not a workaround to avoid a deadlock. The best way to avoid that deadlock is to *not block on async code in the first place*. If you absolutely cannot avoid it, then consider one of the hacks in my [brownfield async article](https://docs.microsoft.com/en-us/archive/msdn-magazine/2015/july/async-programming-brownfield-async-development). For example, just wrapping the top-level call in `Task.Run` (i.e., the \"thread pool hack\") removes the context from the very beginning of `A`:\r\n\r\n```\r\nvoid CustomerCall()\r\n{\r\n  Task.Run(() => A()).GetAwaiter().GetResult();\r\n}\r\n```","date":"2020-10-08T15:49:01.880Z"},{"_id":"e78d2f60-092d-11eb-b8b2-03eb9bd9947c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a5bb857d-c4a2-380e-8549-c05c4bbbd561","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"handlespeed","authorUri":"","message":"Hi Stephen, thanks for great article, just want to confirm the knowledge. \r\nBased on understanding of continuation of await, can following code avoid deadlock in a ctx environment? Briefly what I want to confirm is can we avoid deadlock by adding .ConfigureAwait(false) just to \"Every\" \"First\" async sub methods inside every method, because second sub async method in \"same\" method is in continuation of the first await, so that although second sub method \"want to\" capture ctx, but it cannot achieve that as there is no ctx thanks for first await ConfigureAwait(false). For example, B and C.  \r\n(I know we should add ConfigureAwait(false) to D() as shown)\r\n\r\nIf what I said is incorrect, only thing I can guess is the scenario of \"fast Completed Task\" I remember I heard somewhere. And in that case, that continuation will still in same \"thread\" even if we add .ConfigureAwait(false) so that the second sub method still run in old thread ? Could you please give some clarification on that ?\r\n\r\nPlease help clarify those, thanks Stephen !\r\n\r\n       void CustomerCall()\r\n        {\r\n            A().GetAwaiter().GetResult();\r\n        }\r\n\r\n        async Task A()\r\n        {\r\n            await B().ConfigureAwait(false);\r\n            await C();\r\n        }\r\n\r\n        private async Task B()\r\n        {\r\n            await D().ConfigureAwait(false);\r\n            await E();\r\n        }","date":"2020-10-08T06:17:13.057Z"},{"_id":"8f3062f0-140f-11eb-8861-419d2b33d64f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"c8f0fa50-097d-11eb-a788-5943ba6534e2","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"handlespeed","authorUri":"","message":"Hi Stephen, I think I get all the points and what I wanted to know, thanks very much :)","date":"2020-10-22T02:37:42.744Z"},{"_id":"216130e0-38f6-11eb-ac97-ad207232592f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"G3hL9JK2OYlJrl4919IBmez8WZwAo+0O3kPad4uGm2/R8orUH34sbjqc2lpmsnbS1osDIJoKRCjqS//o4535AAa7T2GYJ6xEawJ7wtKW9H++U1X13+VXcoReNOXj1M7YMdkzcNefGmIMn2t751sKk+/o1wPWIAiAdtWOJ4EJYR8Hbv4P7k9K2AMKPnKzWEOQLlG1gA9vudxy3p/GPvKnT3By0ytOHFNiwOaU/MmDr9piZkrJ2WYM8VZ0jIFz4ppLcuF7aH1H4sUIBunaeXuv9b0eOrBYUBkxeTbaZnd8qcv2a1lU/Di6/Gh9hfSVNl6sO0RMiSXdCtyOyXmODKh2Rn6MJXbYjREj/jLd96PVnXRG+kb/owpBauOyQ+BTbBUIlckAX+Waj4fGjfSpySfxisPswVwWeIXMx+o15XztGNI7Bf1Me3hXe5ciIcDH+duaOd37IP9cC6q6owR68latK3CthDDbp6L+5iKBhpT/Xnm6ghRamhL9+VAwBagv4KqIdMEHelLOOAtRBq3zjyvJBYdZ1qtsNoi89P6p+J7g0KEOBE06ZgIi5XTeFT+cIybcppcviyx7d1k8J1zSCptsWrV5ortY6wFFmhOjvqxttakK0CKAzJ6VHAfg/vSprg6RU8WnVkeQoUTK7EZhI3nZZAoVrdLl8qKfi8tRjm/JPk4=","authorEmailMD5":"093afa43df198b07acca5921490e90cc","authorName":"Martín","authorUri":"","message":"I have an extremely naive question regarding this:\r\n\"8. Deadlock. The top-level method is blocking the context thread, waiting for GetJsonAsync to complete, and GetJsonAsync is waiting for the context to be free so it can complete.\"\r\nIn that case, isn't there a way to detect that the top-level method is waiting for GetJsonAsync, so that it can unblock and process the completed task? I assume it's a lot more complex than that, but I'm still curious.","date":"2020-12-08T01:38:54.118Z"},{"_id":"d67c61e0-38f9-11eb-ac97-ad207232592f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"216130e0-38f6-11eb-ac97-ad207232592f","authorEmailEncrypted":"QM5cCD0wX12NoO4VsEVEDxR60ah+/eu615yPr75KY6CiGFeC2aJ/r0Lp3bwqBfS88MYVawsECzUJyIHXCC/BriLybnZaFfL2u7i9GOlx3pJxPDnoJ9R2dkHj46m+zjpmqFCL0jaw4yMlNjwiVzh0dsIn8ZP8XWokT0ckRYcwSCPSaE2YJeLcrGkRgGtcrFz2yKsmJ73dNKns8S3JG+hTXDVeHH1OwS2t/GSsWH2h5n29QGcAxBDU9KZjGSEmEIr+kLEFehEAukYTjmAV1O8FYXCHIgmMcHI6CQp/vmzPdLuScY/MSqyvuxMdslhT+AohDxELodKSQjX23YeUWzVJ5wzEk3t9G92y4E4oA7C5BZiK/Iewh0xqXkULxTfGJ/jjyjrPkhRUg+7n8PUzk5LyBGR7z1IAhpuG9sGjQw1FmEOBqoB0v07Wv3ifD7dSPjojqZW4o/IvkKLY6c7r6acFVDpX03lg3CLuBSR+5iDnW+kH8Vj1rWPvjGwe0TPwMR8YdGQCoEay75U+3BW5oGI4GGs6PKqI8gBXoMXoP30sKWAQDkFRIzFTHSqDg06FjIlWy1LELN+FDrZOUCbaq5iIszm9PqynkRiDBcaMO2rZL5GVPHr0hejDUEmZMiQWe4FS2v3iRuy0ks1LMSLlCQE+I3wELiUISUtupy5xLcds/58=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"That is sort of possible, and there's been some work done in that area (automatic deadlock detection). The example here is quite simple; what you usually end up with is one method awaiting another method awaiting another method... so the `async` method that is attempting to continue is different than the one being blocked on. It's possible to generate a kind of \"asynchronous causality chain\", including hooking some APIs like `Task.WhenAll` and `Task.WhenAny`. It's pretty complex, but there has been some work done in that area.\r\n\r\nBut it's a *lot* easier to add a static code analyzer that just says \"don't block on tasks\". So more people do that.","date":"2020-12-08T02:05:26.341Z"},{"_id":"f5b1be50-7d34-11eb-b8ab-9b2430b00b46","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Levi","authorUri":"","message":"Hello Stephen, great article explaining essential stuff. \r\n\r\nI have a question that might not be directly related to this article, however \r\nthe underlying problem may have its root there. If not, it would be great if \r\nyou could point me to article/example addressing this kind of issue, since I haven't \r\nfound explicit one so far. \r\n\r\nI created two tasks that run the same method, Get() (method in two different objects of the same class). \r\nThat method consists of creating and running a list of tasks all of which run the same method, GetJsonAsync().\r\nThe goal is to measure not only time performance for each \"inner\" task, i.e. how  long it takes for each GetJsonAsync to complete, but also the overall performance of the \"outer\" task.\r\n\r\nThe problem is that, each of the two tasks takes about 4s to complete. When only one task is ran instead of two, it takes below 2s. \r\nNow, it might not be a big difference at first glance, but this way of running tasks is pulled out of a project of mine\r\nwhich deals with ~200 \"inner\" tasks and gives even bigger difference in the similar situation, almost double the time needed for one.\r\nAnother issue is that sometimes there's a significant difference between time performance\r\nof those two tasks, like there is some kind of blocking.\r\n\r\nHere is a link to the github repo I created with this example, using your code from this article: \r\nhttps://github.com/levi177/TaskPerformance\r\n\r\nDid I miss some point here? I put await everywhere it should be put, but still it looks like there is some sort of blocking or waiting. I'm aware that time performance depends on multiple factors, but I would like to realize the software-side impact with this tasks approach. \r\nIt might be something with ThreadPool or TaskScheduler, but all I have are loose assumptions. Is it reasonable to expect two essentially same tasks to execute with similar time performance?","date":"2021-03-04T21:59:58.204Z"},{"_id":"5886e0e0-87ef-11eb-a855-5582c59c7d03","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"f5b1be50-7d34-11eb-b8ab-9b2430b00b46","authorEmailEncrypted":"q27Cr+oN+vEvJgt7JuwAeZ5yGZOzrCUzmfegBmoSZXBtV1OOfXF+POUI96BeMRgWJ11BombCVudTiPaiqCbgPAT0fZXATw0at+ZHxnHat++lLdplsr99CegMoVKbnqR4/O/zuM4j3f2jeoR4GAatjfjwTtgUf1Z56wM9znalxTg2vsE//U7T8l6A/DCTjlhEaZWZov3Ub6mlu8f227IXWX2kAvvEXjm+TIJSeT7hMGtxuYcdVoVI2TjRgGcYn1JMXEEz4AvaI7kX3nAMi8WT0tF6q2YSD4DWeDbkUx6YujE7DzPjdgsMozChydw2BrRYCtLEmA7XKDxl1Q/pFRc7Y26T5VXyUTbIwYNtZs7B/Y7s00Vm9POe/+o3LVN/vZXF6aPchG0oYZFgb/8X5qe2NOp1mnqeSTnzy7kkIcv/AuL64RPZjQ2bxuE1RR7R9P3B0ubJgGJp3T+63ZVBZ9fzAd61sv4WEVYwkcny+L/FkYj1qU3kXXBXjSxibVcmaWi0fp06S9Hznm2EpB2sQqdVcyIkp6v2GmgAdC0qmNZQE3YxAAfKCrCgVCPmhBr2x1PD0wcAufLz7OpNGr+hlVxdrEK1rIVb8Wcbk2cCD/8y7KPktTpVzz5mia0EB1QIlyq1W+jDADIahkJHiJezFohPzpruafLB8DND8ddpkiMGZ34=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"> Another issue is that sometimes there's a significant difference between time performance of those two tasks, like there is some kind of blocking.\r\n\r\nI believe this is the case. It's not actually the async code at all but the networking stack that is throttling you. When running on .NET Framework (not .NET Core), [`ServicePointManager.DefaultConnectionLimit`](https://docs.microsoft.com/en-us/dotnet/api/system.net.servicepointmanager.defaultconnectionlimit) will limit you by default to 2 connections per host (for clients in non-ASP.NET apps) or 10 connections per host (for clients in ASP.NET apps). With many urls pointing to the same host, they'll end up waiting for each other.","date":"2021-03-18T13:39:21.947Z"},{"_id":"5ddaaf20-968d-11eb-b228-6d317f6abb24","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"K3fbYtxDfsDhshXpEaxNG75yQwTpg6JDYV/ZZeCUpt8iLw23QpfqFv3yaObN3XeQ2FRvisWW1r+XPbZyJW7Z+Lof41SGP7fIwE6KeS5Ssdx8pJcabQKDWfieF0fBLUgSqyhj1/Zca+tej3YkpEHdxMg8gQAcwu5qfnHRny4JOSuodV0e3Myp5NPLeteiOAfo0Bu4RAHvopcfE/MTbmmtDJBAdjbuF/4RTCUjAiGS1ttog6tu5xAv0FVnnQv4KMUktpN6YMPvn5Ux/wOovE5FumhSr5Ql0cn+ihunZvnFf3u77R0OPAYqcltE1rLjV4ZPP/o0lRZqoNUkZ/OOqsaPpv7jSYcqslwwuvkjWQZSX9tgZjoGNmRpdmKCbJ581Rg+4gwUL/tgmL0altwI+ytu3GPheWJpUemKm48jIaTOSAxRAPXTQivWH4zWNE6BbPzZmfd1hcZI9+wIafPOQqcKqf05ABRhAkOkwuQ+SpHn0INUarHKf3WDCLfsIxVqt2isTQnA872Iq2P+Lg7IYpd9t+MzVVtNInZKOu6Jj3gvldJTxN1UUq8/PaN4UFjG+iEuu0+3WhC9wY2iPUgq0K9o42t+RhRqblKGJs4qE+8/JQxe58tTd9Pg1U0yBURYZL64CWRmq0/cb9jPzpVZd1IAcsf86TYtyzYd/Nsth52AC1s=","authorEmailMD5":"3b58e85cb64665c2ad504a19d6f7a36c","authorName":"Sam","authorUri":"","message":"You are a god.","date":"2021-04-06T04:05:47.671Z"},{"_id":"e7cffd60-96ca-11eb-a108-1343930ad30f","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"5886e0e0-87ef-11eb-a855-5582c59c7d03","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Levi","authorUri":"","message":"Thanks a lot for your answer!","date":"2021-04-06T11:26:18.675Z"},{"_id":"4e237480-9be3-11eb-9718-5d2d37558c1d","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"uw/o/JV1/DWaEhY7sNhe5vhGA4ux+n+K+LI3QMbUCAffIhYbgYsAbptIXyTf9PW2jHsaCdkT3rT7ExeQJlSwhK79z8piLAo5wJpMNue8v9FxEVF9qanGCgQug+mXc2kXk3XkJgzDQg45ABJkMTjmsfcjZxKvvj1XEgtjw923LjehYXTkSERBEXamTGHbTKSs9Ay419wTDqNomswlFTQRrf6WBhBh/ceRLNXOmj0dijJqOcdy3n/8nn8iGmXfz47Wveo3FoHe/DqbYT/qk5uRcKw6JdMoJV/kb4OWIn0V4UMX3dQ+MFuwooHhIUQltMTZKNoV3RUFfBmMl99GZn6qM5wSMiJ3kXtymjEcCYD45wu2v8MVn41wRdB6nUOrfKj7X7cexmQi9mpSVSs2HjV9CQJ6FwX9K9AYpaN+fPfxAzcUGT1qbF/VygecSLJbUosgffjC6VGFl7ISUeNHH1+sTSoyqDxriKBqxX/BUTTcUCgNoKfGTcR/BjOrP0eYvRvj3uO8vFirJsOrYIGIIboHpi50l7JIIE8gQ5Mt/lDuP67z40pTVLccOC9HAJoboh0wbL14GtpN12c9TG8n+tsIJ190yuzUOQ8lEdOdSFry9f1MMmFNO5BFLmwXMpd/p+8qmVETClZoisuw+FqgcaBqodjfwJhvoSH12a32gOh6JLw=","authorEmailMD5":"5f62caf1ace78e90b6720dc9758c04c1","authorName":"","authorUri":"","message":"i try the example asp.net, dead lock not happend. why?","date":"2021-04-12T23:03:33.817Z"},{"_id":"81e2ad90-9be3-11eb-9718-5d2d37558c1d","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"KQ4iyOHhsS43WebzvhV4omQ7vJ20V4vFRA3APcJX5rbme9XaIIPSWBP3DkmmwprjsJnAO1BEbLzBaKQfog3W1U4ZStHHRtNTtVSTkHvVG/RnYggbT+YIloZH2BmxHDfbi+HsC1wQDGQxv76RPqdJWgR9ciFNOhx0mb8S4U3nnchgABsvxwxPO5BpmXA4wEoivEwIG3NrTs4V7Gd4viUe1Axo69fk5qEo3XzdJNmbsEPRHlEPFshu3U8Sa6kEW5ujcQ4QmKSO7JR+0AnZK2vJti5Mp1b9yfLb26Rhv/A+EhEloPz5vpDKpcaBeUa/1+dQXzeA3IgnJDHh275qsNFD4FkCITY7eyEyeLY7/L/uvDaHOPYH54dsaGL6OWQDbBZwXftWg2VUA7KpCfZuzVsatOMqJ1LuqQzLuflwvv1Gpj/8FwBMzQPaSU1mRmk7Yaj0mhrHQYtHhiJNDQqDZ5STD/tT7rNN7uhzU0E/hIJaDTLvKIK+KyrbExoK5mddo2v34uQ/cAZ896DZfc3rMkD6NUJxt8lb0+ji+tgDeaNkpp+YMpPI6HIEM3rJEgqPYmYaEkS8GvRo3SUrH0lx31Bs5zzOuGeucUDRBcK6pya1JogmxWwM4Ttu93K6lrT+RdpfC1Q7jXz/ofWXQz+iVgckm/zsWrI5hGsgRCRZ6gXo1Hk=","authorEmailMD5":"5f62caf1ace78e90b6720dc9758c04c1","authorName":"sun liusi","authorUri":"","message":"i try the example asp.net, dead lock not happen. why?","date":"2021-04-12T23:05:00.610Z"},{"_id":"bb20d700-9bf0-11eb-9f84-8788f12d20dc","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"81e2ad90-9be3-11eb-9718-5d2d37558c1d","authorEmailEncrypted":"qk3Z16MMsb3m5EaZIuETjAsfRi7Uxvlloq+rs50mlmy+gYio1oF2fnGnkyhej1bouHiLN57qPFuBYyb9BqC94llJUtT05shlYEOahKiSBGCA78u40R1/TvBy4fhvaJSEXf72VMYaU6mobcPAvHtEspzrWgImoCDQHyciFvIwSNyDSB0p1GFInuijrYxiFbpSEUdG3wrgrf9h2R+90aVUjXbcEJOZMJEYfGTDXOO4I+YHb7NRdSY+hT3axpmujLv4QRIFWwUcugyZzQNo2FSPafWOt8dQYwqddjFZ1HQE8Nxg8Eia5G782XUp2yFvf7Pz7g1ULIjHHaseVJXmx7wuituOrlClZ9M6xtxHh5VF2uX2gAQXa96UabFHgWP3/191JJNMQAmJG0u6nqOVdXTDfxaXU0wZyNtJoXTYK/goEXzwCwKqxEz7Od0cOktWG46Sg0TFgymRsRn8wVAN54eB6f07u+Upgi21i1BXdaqlwySbgE5JFYz3fLeUW0k5uQc9cJaq7MZ+Idcd7foia9JkZ6G3h7LQHNlA8h6zkkCQ8nL6rb4zmYuVTBJKu40mTO0JP4EeWjwE2zCRflmMGtPHPaZwTwAuh0xK3WX3/tqPBjBxcXMu75SNYrSQxNZ0mAeAL6nYQwv1okdkc7azhnwwHx5R6gezTu48OT+yVqxZF1c=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"If you used ASP.NET Core, then this deadlock will not happen because [ASP.NET Core does not have a `SynchronizationContext`](https://blog.stephencleary.com/2017/03/aspnetcore-synchronization-context.html).","date":"2021-04-13T00:39:40.203Z"},{"_id":"8de72f60-9cee-11eb-b4d1-bb6e5d4ba7a6","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"bb20d700-9bf0-11eb-9f84-8788f12d20dc","authorEmailEncrypted":"I7RpRh8YGGTdyaEZ1jz4QAvuELsXR9HuK2yUxqJFDcK41eW2KSfL13OLKS5UzXtqGo32GmiF+NaOZ9UsbYK79xxJGwv9/PiFv1wZ1rDGmJmCNVI5vFWdtYR8973PMxpxULPlZKTThm1qir5vITvzttFlHu6aHdCqv/04jdtOLzDTD9Ep9YGLjPLh8F9wIQCaYFE+wMW1WZHkIU46qPp/OgQoKkNy97Nk9A0ogx8VM20Ct+14LE110JkNoUl4i1jef/vqHcva6HKmXV3VUKZYxb8KOGplbBynH0JXMRDLfKcrqnHg/8ihaK9UYdyGdXFOVrbks81fMV0PYHClfTOZYdXSP3jVtBL8xCN1tFffmzNR7e4xOLeuTOlCQMZKySZbf1pumzBrdcm5Q/PKd40w7FLo8AHUQdlpFD2FStEwUoSIPRn3DRNhsf9VcZ8nC2x5rgobjMVJOBSzq0xxoPmyGB9DymXzEBQfuoPexsf28IVjrJ3jG7XJ+06wdaA/EiFKvdTlPJhQg4HZff0J2Ms82TKQDLqhJJD6PMNR4FEvCJkcajtC2pejvWXwH7IlK/q1P5rLPOeLTNcWskqscqKninc3fCzmwqaxIXS9GoY1O8DHF3FMkYVGO+lUNoqDpq4YpBgDPptzM8yX06WFB2lFqje30oTLTJ9+t663RZ5mZpc=","authorEmailMD5":"5f62caf1ace78e90b6720dc9758c04c1","authorName":"sun liusi","authorUri":"","message":"Thanks a lot.","date":"2021-04-14T06:56:36.708Z"},{"_id":"048a03d0-2819-11ec-9551-c31db1c90da4","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"X2dbaYltcIp5QNNpLmX1K/2UZQ72yC3mHxmNAIM0Go9SS1M2kzgArA6k9e0oCWxjdXFhmGYx4V3GNJUrsa5Z9owd49O+pO6hT7YVp7voEx+TwWHswhJG8K1/lCGyZLOrAW/lJRw87gd4yfZY3AYCNzxHpMch+OKQHwNnUbiDyE5vC9W8o2vFxzh89n/hYZFjHqukAOnWzB7764klC1Kc2i9twm8kedOaC0oe5hQRM10dDMXWcamyerzFDrPtX08eYFV7Kmjp3r8DTmtKxW0QwWwnNqEx9SGNRR0STXGwf9P6nN0F4LWjrVqC/702R2TuJr2fxkH8hBV0xzkocjHg6Yyb/miBGzFzFY1CMesgG4FkUwQdzQdPFPVQTLxIG1c5cSFMrm9OP0EoUXLlEf2hfylp6KtlsUHz66AMHB0QuItNZJxKOyMdfx+/thDINIohDCwwCM3Khj1y8hlx7QovGIDprNK1j+W1Qfir9DFFbQEpJUafhBvOpfMhq8LrHCrrr9EP1/hYybZxoJKuy7Ix6iAhULBjVg0Qdj+aTNfdhE1YJtU5vj7z56FxIlkErmlhcmBjmSFf+6/PAVs+su4iFaIl5HHrc6bZZPc7ACgOPP0zvLfH3qsZzWoZob5qHwJJy5oaET/KZOYiIrZPGn7w15jdbXQGHfgofXOMyWVkVI0=","authorEmailMD5":"3b58e85cb64665c2ad504a19d6f7a36c","authorName":"Samuel Otero","authorUri":"","message":"You are a god.","date":"2021-10-08T09:20:45.906Z"},{"_id":"0d8ae060-32d9-11ec-b706-b99e246a21e5","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Chandra","authorUri":"","message":"Stephen, thanks! Your post makes a complex topic crystal clear. I am noticing usage of .Result in my codebase at work in ASP.NET controllers that are not marked async. Yet the logs don't reveal widespread ASP.NET timeouts - there are a handful, but according to your post, every request should be deadlocking. Are there circumstances under which using .Result in an MVC controller action would not result in a deadlock (ConfigureAwait is not used in these cases).","date":"2021-10-22T01:40:35.997Z"},{"_id":"605d28f0-3349-11ec-9c51-f1fa6761291d","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"0d8ae060-32d9-11ec-b706-b99e246a21e5","authorEmailEncrypted":"H0snK+Z9qS9MPtaN1b4IGr/p9kJIoNyeRsnWZq7akTG9FVE6PL5M6WiLI9WblyXwDWV3R2fRoyWpej6Y39AlniCaTJWQ35N7icCKMpZ71BAm/QnTRqMRMwbD4Phuv2COP3Nbqev9CCO4C8zhNFIyxJHiluh8xC+TuB1GWs4J/cCTOFJUbtnowy5g3LO9NlzgruGuf4NU8T1IP6MAX47Y1I3MPPse8RUH1+EWViu2tQvL6KVYwqFLNlaROLgi6FnmBO8Va1xEgQdhkRiuDayOplrU02ofOYYmUx+oKLEO0ZaRxsegvaSTHqgv0sfDK3R2Ym9StUO56GEMwJsR+pmm5MEITiHkxUIJJQled7SVX2K5CHF9FA0/0rXPQw/nTrZAwBkmG8/685Bm+TRsdok1iWA6zdxrffziB2cIFUkLD38GLVlgRETh3tDJb20PsAdC6avPITLZ2EtVrvGeH065hcTj8ghCwL2POo6rV/+wzs9Ia167y24bLS5Try/OeEUqJG6UJ/9LNd2RmPaG95pD+UG/gQflRsVFvkc6mCS5FwW66HHOYJ3UhB9nleCCuS6RPNYG6mSkET2iocZiqUOv+WVmqNoPKRV2Y3SSjvTIUf1zPdCck2Q2//NHZvTsPmJI6jdS71bQuNEYenPNcFDTJiF6dlVONv414AbZAbGcOck=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Sure; `Result` doesn't *always* result in a deadlock. Here's some cases where `Result` will not deadlock:\r\n1. If there's no context. E.g., ASP.NET Core, or the code is inside a `Task.Run` or something else that runs code outside of a request context.\r\n1. If the asynchronous work is already complete by the time `.Result` is called on the task. E.g., if it's cached, or just really fast.\r\n\r\nBut even in these cases, you don't want to use `.Result`, because that ties up a thread just waiting for that task to complete, and using `await` instead of `Result` will allow that thread to handle other requests instead of just waiting.","date":"2021-10-22T15:04:38.622Z"},{"_id":"f4e8fb80-335c-11ec-ae25-c380a52eaedc","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"605d28f0-3349-11ec-9c51-f1fa6761291d","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Chandra","authorUri":"","message":"Thanks a lot, Stephen.","date":"2021-10-22T17:24:48.259Z"},{"_id":"be4d2560-5387-11ec-a435-43dfe4a290c5","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Markus","authorUri":"","message":"Thanks a lot for your post! Saved me today :D","date":"2021-12-02T15:51:42.278Z"},{"_id":"c3286f40-66ba-11ec-8be4-49f74e847e2e","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"be4d2560-5387-11ec-a435-43dfe4a290c5","authorEmailEncrypted":"kEasRte+KLvro8XY87QqNQIpqFw4aTpuwyYlYF4guBFFec8Fil73rMQsqq+7wo67lPUepiLfUWrvqjoaG2p73HgWndz9LOB1zHhIJBrptovYJi+QWT0PHsvT4KCs5JeCu/1m03Vss5kfNHKB5xfxoGB/8kW/0cbZcowCyV4TENvbheum3Dpq9d8vC90axWkJvIRDYtSB+iiuZQTXvJV43ln4chQuJ1QRBsmEAqA4B3+9ECXCg4CHJDg2fHsTz0lFYxpKES3LqaL+gI3hliAYP2q0qKsRmVO07PM3rJfOuonkPaGsXlnPryWVO+bUqBV5zuwIyrT0NxiFxR9D0r+XCp+yoMC/PA18F7Dp8AMbNYYFKPxalqBdSphumHR5yBHzUxa0maL+60e289tOI9Xfs7wbNLDHDDQxs4OSPS7c76VCGl27KAg/jMNlv7TNgIGYQd1TW5wJRsjTK+TAx4dhbLmOKrcw6yxWc5qcjMJFrTNeiKJqJWLl8bZge2dZ6og1Ev1PPZZRafEyhhF8P3q5o2mxOg7Kf150pOi3oxpbm8kqrJTFyi07z+43EpHCjTCPJwq3ezjYSphYPd6u/R4zyLghZTUPTiz8jybnc+XKk0q8S+BnWYv45Rvo/7ykTmZqWQfn8K4qqCQljWblhM+4WKg431PLNGmSs524h/cbL7w=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Glad it was helpful!","date":"2021-12-27T02:14:46.706Z"},{"_id":"5c167340-d165-11ec-a689-c3ba71b18844","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"8730635a-4c89-37e8-a5b8-665784384033","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Andy California","authorUri":"","message":"Totally agreed. A console application, for example, has no reason to be async. Async helps with thread exhaustion in web applications, I'll give it that -- does Console application have this problem? No. A console application doesn't need to be async, EVER. And now just because some 3rd party library has an async-only method, the recommendation is to rework my whole console application? And lose the ability to use Spans and \"out\" params and other goodies that don't play with async?\r\nSynchronous code is easy to understand and doesn't have any hidden problems unlike this async nonsense. I've been using this whole async/await for a few years now doing occasional reading on it, and honest to God, I have no certainty because of hidden UNDOCUMENTED problems like these that stem from things being done implicitly. At this point, the only way to be sure about how things work, is to know the whole implementation (which I don't think would be a walk in the park, would it?).","date":"2022-05-11T20:03:01.051Z"},{"_id":"9aa52e50-e1cb-11ec-b378-7ba8c2f8f234","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"DmmaomguPrs79wbA0bB9EH0t6BiZ32jBuqLMuYFaxdJ8TcWopSszjD1U300VYpJkRLwNNZ8E00/9cZpMWFTF2hfT8gnpYp/+CSMqhPhh6E5T+okcTNL4irlwnIeo/ZarJrl0c9SBM0bHPSs2Ncf9vEHTJ+SalfkvVpqGlKFOMutyzzCi8PvrX+OjbkEfdW7iv8clItR1XIkH+WwVq3qeNP3iXuAvI3IkJf6yII3wm5Ca/vwPhUqBE/S30sDqhyvsrc/rZMz4oPEPDizzQXLMvk56H79WoFAzk/QUF40mpKdY2SprRcLtKEyctQ7fSI9Ao+mWQpoCd4P01WDb9Ezi2BDs5nYvEuB+IjcGl3rZ+VS6VDLv6ODf6D5VbUTQE7i+cKLczNEgcC6e2mMXwh1E7CjMYXWHkYoNL6+8QVYcjMssE4nmzHbZtbJZSNzziabHQigbHZcZfRhAYI4T7lYiu+DOxoakXp+LDpGgT7lk9tNcTZjIuI9zQharvcX2tcUmw5ZxJY1d45Mi85PAbsQ79JQJy8WIY2aZU+35BttJkklPDa9i9zYUbGtT+bym/a3rZw+EhWIII1Bwbxz1xRe1le0Xf84SBsoG/+ibKBEZoW+69m0pUz/ccZSNMMxbMfnmZp9JkdipuSP3OuMYiQP5sq+7/Ongqm3VTIXLiLsxaOU=","authorEmailMD5":"a440ac3ffed94d2935bc82fa4221bd73","authorName":"Luis Alan Trejo Cota","authorUri":"","message":"Thank you so much!!! Saved my day too..","date":"2022-06-01T16:55:13.285Z"},{"_id":"a2d70ab0-e1cd-11ec-b378-7ba8c2f8f234","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"9aa52e50-e1cb-11ec-b378-7ba8c2f8f234","authorEmailEncrypted":"lAa+AxcV9xy3wFdEt4s7XwKhVfuDFjL3Np+JpTiTjHO0IYJMzC5g6ypdPnWviSAtnGK1gk8bIKi2vp5Iu9NNATnz27rXvXEe6SCR73dQyDYpv+C2sHYFPqBF9w+iOEAAzyvBv09kvScKtkz3EGhFjnNb1upCjEnMexXtAdC6EK+Ma15D8WiWRhxqNSsy8FfIBgl7ZA3P8Pstwb/t7Uh3OAGl/TNguZMm0tBW6blMmuns4R9eJKZftYVXt447/+1DSpmvQXApIWzD1DH1lV13h6NW+GJ6uTDjjqycDwfvxWHSVvdIMEPFvSRa/4yoEhGiGi8swibYT+lLe2TaZ4cWYcxuiGes8A9oXkzlApaQp9hrh5NOJ9LVrC/dqkjYTjhGQJ4E7QWoCwqAczBCIJ1E+aNgyxIBv28SA1Ci0FQtQEfd42e+7XZp0Atv4ONFYsWkd9svhrnL66EH8087m732tHi9BLKB5cGLmyK6Q7rE0KYN1AQkbo11Tb/bZ8MqY7UhW3597ZmfyTU19AR5qq/7dzpSbA+9buRPvcxovr+ACQhmmg8eFTE2YDSrZMoqs3g3W8UNW4TnfPwiWMCIYgcOE7IM7Uxu22uScGBbnDKH2Wf7cPXlI5Ggo2oFh5ljz6nHb7efdmld6fq13G51a1DslG81FyzRwxTg2li6snkRdQM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Glad to hear it!","date":"2022-06-01T17:09:46.029Z"},{"_id":"09d752f0-e63e-11ec-9bbd-93dbe8ab833c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"wNZEiCfR4L8oUJdlBk9BCxrayLrmKjneUZ7onv6hbN/MsBwW3LU7iYwBvtwvxGUO6583fDL77PmoQmi3GCu20yBn/N/W6UQHfcPSFSR1kCh31PqnDj2VnwhME6HhUJNotgTEcbJGDmKujlkPNNBKl2xidLDodizhjBiNrQM6x7XPB1++v8HXrcX+Kz2zVVo8FjdMnYXaE+up09Omcvb/8KAfJDoIUxP7vI4APb+9nyI6Hzey+aGlDmEEk8imx+kJqtC4fNysJFOWn4492RPzZbNOsc7dh1C/d7DJongYkvvYamblOM5doZf65WKlmXkEzvn1rPKfKTDtnopHZXmFNQQPc5V97KGqm0sAUrJxR5SqJdLWWMkD6Oo8/mB76TuQK/HnYFUXHOc5y1tlgmSGfyvlAxL1QMy+nGiv991RQfnQTb2gV5epFb+lIMMXS0udZc+dyHMb94q8yJFIfXiqReLG3WiLzj8t0GATZB9adMpmNs54mqGa8ycMOQ7/ID24xwCmYdPTkLkmZ1PAN2WamH9t+DqvBCR3GDtuOGvJ2QEBpq0KDK6/IP340X2+JXeV4o2ZoRxv1dmzBnF/qiFn2Tn5c1OvbQ9FldNN2q1G0jUWqVIaz97xccoV4jCq9IBodtmn9fKxuDvuFSL09MSKccD6nrCAJnBKCvpMft9LSso=","authorEmailMD5":"f1f7efd6d4b8f71f49c582e0918bfe45","authorName":"Peter","authorUri":"","message":"to avoid deadlock all we need to do to make sure the httpcontext is not locked? how about \r\npublic async Task mycontrolermethod ()\r\n{\r\nawait methodA();\r\n}\r\npublic async Task methodA()\r\n{\r\n    var result = methodB().Result;\r\n}\r\n\r\npublic async Task<int> methodB()\r\n{\r\n     Task.Factory.startnewtask(() = > return 100;);\r\n     \r\n}  \r\nthe thread inside methodA block the thread returned in methodB. i dont know if we have deadlock here. please explain. i am still confused.\r\n\r\nThanks\r\nPeter","date":"2022-06-07T08:44:27.093Z"},{"_id":"246b0d40-e79d-11ec-b47d-6b1c18c4de64","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"AIvZVIshjll3mEOaWLGxbrJ3wMfSD8X/C4FhzGznrSxf8l1MvKhlYUAXoduqKQrQdL0Tcw11yyaqhgiKj2KOh8yOR0U9U+hRKt+tf3sH7cGJr1WKQ4824M+kgho28YMYdFrhDA5EUqGvcuku8q1TPV5n++xLYfC/jnrH7fqVpBYEmschrrzLtC8xwIsc4M2SCG7HACdxz6TogrkCy7btpgq9b/NZDmI1eu9/UxY529mObY1/0AWJ3KpEzMq0Tol+gGv8/oam8Ekwdp3tm91GTvRjVgkmj9NHe9LVlmKe3fi3EcsYaGeaDPAMDTwH43P5pR3COC5kbEFLmn/2WuzNBhQb/Qb/sviZk5fbLVcu3l40l5wUcphdpMf/HyFLK9jSdtxDrs6WaVkXvB6xuJQEUARgPpXIYiXYd/9MFevU8M9FOHhGxXFOhh4EmLv99c6WAbPr0SBx6EmrLd9DiWknlKWColmzXjtFxck7gWkaCiJ/I0F0wKcd2EzI2FOIG++Nhr2FImsSRBRNzqw1QRMTy6FAoG3D1lQhJcPPvOhM89GLiixxFutWwUT2r7O4ysq9OZjhn/AJ/BswK2Bhpwe8zn8txfmbhOH0pKYUjePm4tDOA5Y0kaJJfwaVuzXyXkHUS+8fgZpwbEwfKnsRCfL8Af+hOej5wlJ+JcBdC4Bpt2w=","authorEmailMD5":"ce56592b045dcd19e62fbf03e61d0eee","authorName":"Simon","authorUri":"","message":"Hi Stephen,\r\n\r\nThanks for this great article - I'm not sure how many times I've read it!\r\n\r\nJust some feedback about the content, I find the phrase \"second best practice\" confusing, as I always read it as meaning that the second option is \"second-best\", not just the second part of applying the best practice! Could it perhaps be changed to say \"first step\" and \"second step\" or similar?\r\n\r\nCheers,\r\nSimon","date":"2022-06-09T02:37:45.045Z"},{"_id":"e3deb9e0-ffb9-11ec-8278-c132177ae00a","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"09d752f0-e63e-11ec-9bbd-93dbe8ab833c","authorEmailEncrypted":"QBy42L7oAkqNbUjoElwyNTPN9PkIDD3xf6Ec/5xEZm4+aRzMwKbhI9ip13wQSyEfM3DtMAPNF3iheMoqX1Oe2tja9rHpiai4jH+kgsQRq/NkUE0wrgXAnB1GVvhnJCJqxnC0OIiDceJkLezp596aduZvDK7htLYLNfD9a7+5kZ0ZUB2yGNl8Qf7mn7vI5rb3W8pk3XB+nPg0a0cvfxOE9BEam1iQW74cordl/1LWODZTqc9Xw5wqgdZ/K5h7Hr9fgOWKcYkvXxob4sZ6L9DGfZ7awKc2iwswCe7OuUnOTdLbB5StqeLEWmwkh2STRUI3NB9VijQjWVDKOmeLS/GErx/Tc4g0wLK9zQAHsQRYoUsDzBSGvqTle5c2ti2tLaVQlzRpnUQf2A0sH4r4ndlijLKgzZE9nizOzQv0qtXfd2VtznKEXgdgk0IhYO8HMHU0+irX18Jg4P745sxfBAJN1v/qFv6Ari+rZF9/r2N7gfG0dP4CHd88rptihxf2whwa7T9KhJejXjMFnzRkKIlAgziFrkdb6ezQgEOUcAid7IAy+z1a9qz2r3pGp24FbfdU9pyEHy/WQexgEuwNSbW8mZTR9Vp6Rujd3pHY3weT78P5ZkhKPNnwERehST2pHBZh8UQcmVwi+/k7O8FyEGjKmcimHACsx+qtNyYAswsbDkk=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Well, technically there's no deadlock there. But it's not code you would want to implement. Instead of having each request handled by one thread (synchronous) or zero-one threads (asynchronous), you now have each request handled by two threads. Using `Task.Run` (or even worse `StartNew`) on ASP.NET is almost never a good idea.","date":"2022-07-09T19:03:59.994Z"},{"_id":"f2ba96f0-ffb9-11ec-8278-c132177ae00a","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"246b0d40-e79d-11ec-b47d-6b1c18c4de64","authorEmailEncrypted":"ZIpMZN3QRGHs8Ym7RXMUNc9B+RtO1sifmXY86JPFlxp6XNbpwbo6+gzJfsLYlhqR4rn7MrcDWBneqlj4rsi6jBjhoaEJMSDSnjwZFOxVBjMJCyaIp2FxPFRolPGC3SU6NB0rU5+BHZsSflR+cD5PuHgqKPW/p+LMNR1NiYc3oShytp4sVfSaZgd6rWGF6wg5+Hck0VfcSOznAWo7HbIbEPZ0Pibyi7cZ92zUEU/TGoLJrj3dv5ZTTb+kQmNKi8ax0rJmgeC3AiPDoO5wBxMm9JrHerSuMVlyksvuaqm6WOIE56pMdr/LktMdjTMSv/tKZHo56nsGblisnAG4KLBphAQ9M3Dgm+CSQf7WcEm4T9XAbZLMVsQ9CEHj0Vl2tSo0dmuOu8ZycFzIdAOLsmJRDNU6FVyqcY+e/W8SWAK5UyAK77enah5UhWtTJ0mkFieliJhOo/mAZ6NGs2YClEnN+TaYr0VjAhaLMwC+dxnY0dm1kb6vKHU2ceEMBrRLy5rg+FA3K4BbxnKSEYSWJWusRXL8eelKOoOIFlHRannuCoOIABKE4OaSbINGtOHJcqpej0gA/C8OlLaN8OAQugorhrAnGZqzm2BjxbdeS2zpd1j4E0oyWFkKscQvVO0HXQtA5BWYGse0aoBwRbaZJGV1iPcHILpmqG61kqDTFCemd0o=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Good suggestion; thanks!","date":"2022-07-09T19:04:24.941Z"},{"_id":"a7d1c9b0-3fce-11ed-bfbd-3b002f8d57dc","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"thEUPgvu5jV7RhPO4gvSn+CqWnKElzobUBcfd2DRXXJG8HGY/3K53oiYYjeS4l06Svpm3jUOUHtIreLsD+ts1l4cI/WvV2wRwH/OY5EOAiRpBxHswJWOUSYRasWItXN0xBnfORP4C45hXri/8lpGkPvE8mr1Rb+w1VxMel91Nz/kmD4wz3LSexL53HurqFOryqy7woveo6EpTRhbD4Eai4CxBjORTkPZm/lMpZOIJCOhOEsRVbVWKpSg3hgA+aS2CLPUG8Owm1dBsQO0SqO7vOjRNfmEtRCVnD3JL0moI8DGIKanEpc96PhSpL+avC1gkhCm9tL2ivp/vnZN0upiANNdXP8aYFkIPgLy6KHGB86e8jp5fuax4vmsodZrU2i5MfGVdPUWXkDuqcAKYSnXIOQwilleGCCpnShA4pRX729BgQ92Mvuf+04qspkQQVJ5WGYuo4Xnv+RKBed+U6AB6O9acgJtMOxxSwYyjwoYUXDX8bVTXrgZXNGuzfaHZ3xfW6a+OacFd6qmpa/A0OpMlaHs4+raH+HKFp+RgbuvzXR+hevwaXnY9sG9ugSBgHQ+1AcvEz+wSS998Zv2GYUQtMOJSH3tR9t3F/B10GQ4UYQoN9iYaIrrzP85DhZqj/f2pVfTuJhA2LE7X30nEhxofDamZdJsLAhpPXyM1bz/2iA=","authorEmailMD5":"35637252207c92af308a7d170b8432b3","authorName":"jRivers","authorUri":"","message":"And how would one run an Async method where the application and Async method provided by a third party requires that the result be used in the calling context? I agree with the basic notion but in the real world there are situations where neither guideline is even remotely up for discussion, me whining to a billion dollar corporation will have zero possibility of changing an existing API.","date":"2022-09-29T08:13:53.186Z"},{"_id":"f80b3d60-3fda-11ed-bfbd-3b002f8d57dc","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a7d1c9b0-3fce-11ed-bfbd-3b002f8d57dc","authorEmailEncrypted":"NuBeWf9kxGpTvpSu6tysmY/yrw7L+AQGCuRO2yLqemXqV2u2I+oY33cbpxJT4bHIZOrGHpXF9d/8EF1d0ukKj03YJSCmWGRDLV+w24PwBgMYl0FOUxlJJcHDmJ9aK0ppouO/4geGah88o1jYcyMTOWusK41+r3Io0tkCZ7DQpCv2Xe/HY7fpe+eQVSlOfQjT4YPO2F8a6fIRmiF9m9/nHzRLLL0HqWAiUbYs3etKYX5ofxvco/VsJXPnXNFPkT/l2l3EqfNyzs4GcT5uO6bNidWN/N2JQwzDZQ37BIZzLX9fsBXto/ik/sOu+rD8RDNrMZytt7/Q6N8297LiXz3E7hmDJdR+zurdLmUSQlmDb38JUch0wp4NcYqPZQob+Y1R8fC6Ev2jVW7XFh5zMWdBbH8aIcXiWcNLa2y9gR+PK8hb3xsqv9oBv6Uz9NcEJ8hIlWfiMouTsmVOyw0faIWazKuIX2PNKSKOwEo0WmJU0xEIzSdtO5NpKNrun6mGWTS0S7OQCxO3hUFH40vwfmvr/poJJhj86+9u/vV5vvOgmyKhmjevyUjP2jCs64qKU/AOT996vaNDydTdQ7Str3RP0V1ZeY3xmk2JBQjfLI8F3PnIBP3Y06nym/4mX+zZaIRNw+lPcbkx5MsXSKUhh/xPWHU3BKS5nKqBIBIQWy4Kgek=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"The ideal way to call an asynchronous method is to use `await`.\r\n\r\nUsually, blocking is an attempt to *avoid* asynchronous code, but it's best not to avoid it at all. Sometimes it's not practical to adopt asynchrony *yet*, in which case you can use one of the [brownfield async hacks](https://learn.microsoft.com/en-us/archive/msdn-magazine/2015/july/async-programming-brownfield-async-development?WT.mc_id=DT-MVP-5000058).","date":"2022-09-29T09:42:01.684Z"},{"_id":"045dc870-4626-11ed-95ad-3dcbd27ae4f0","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Thank you, great article.\r\n10 years laters still saves lives","date":"2022-10-07T09:54:21.652Z"},{"_id":"a5a80c82-e2e1-49fb-b8b0-8be7000f5dc6","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Nicolas","authorUri":"","message":"Hi Stephen, \n\nIm currently working on a legacy proyect on net framework 4.6.1 \nI've read your post a few times when i started working with asynchronous code, and now here i am seeking for some guidance on an error i can not find my way arround.\n\nIn my code, i have to consume multiple rest services from a third party.\nIn this specific functionality i have to call three services, wich the first two are some authentication services to generate a bearer token.\nIn the third service im consuming, i have to post a json, sending a bearer token, and expect a json as a response.\nI had no problem with the first two services, and i had no problem consumin other services that post and recieve jsons.\n\nThe error im encountering is the following: \nMessage: \"A task was cancelled\"\nTask   :  id=67 , Status = Canceled, Method = \"{null}\", Result = \"{Not yet computed}\"\n\n\nAs far as i can detect, im reaching a timeout on my client waiting for the response.\nBut, i checked for the network traffic and the third party api responded in less than 15 seconds.\n\nIf i change the default timeout of 100 seconds to 30 seconds, the error pops up in 30 seconds, if i change it to 10 minutes, then it shows at 10 minutes.\n\nMy code is: \nHttpClient client = new HttpClient(); \nclient.BaseAddress = new Uri(\"https://exampleurl.com/\");\nclient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", token.access_token);\nvar response = await client.PostAsJsonAsync(\"person/EvaluateDetails\", reqClass).ConfigureAwait(false);\n\n\nIm exposing a rest service to simulate the call on my real code, i had severall layers of code, but i tried moving the call to the third party service to my controller layer and remove all the code in between to see if that would help, but it didnt.\n\n\n\n\nThanks in advance\nNicolas\n","date":"2023-02-15T02:54:12.9867457Z"},{"_id":"45c6c603-fbd0-42b2-b10b-f561cf7a00f8","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a5a80c82-e2e1-49fb-b8b0-8be7000f5dc6","authorEmailEncrypted":"RbS2e1U11cO2plwKoDpqvtYage3KQwBXf8+83Sx4NIbfPebecCYErjABnDsyRLQp2Q+bgkY2ExicXXHeJF0XWYwSCOsxcslvSYFDkx8BEDexIexvoAyZT0Dzp/WjJswuRNd2DoKK+Bvg/wJxd2f0VKWJmHNwOutSxjQlv8frsPHrFIr4Ik2ltbMDBtZA9hJO+NnTlr1+TRcxBM6UCoVH6x6f5Y4CLZbuFZEvQHMsoxsxBd0c6MFIklZefbx0FtHJFbyGC6C2hSpUx/lNafZ3agw3bQq7QfACy6RviKsG2mPbqJYAiMzXFwQcmPrVdhv5AoKtGM04HcSo1wxC7ZE3j6Wl3g8y4Z/7204RnqEjU+yA+jPKw9CmyV/1Qdiox4N8vMpM0d3ft9p46xGFpD0qgDdsAhJONY++TfazX4IerZRyrHE/DuPJPWASL0hXi6VqUNlXSaWG0Tj/m4QvHnEO5+JU+9tQNcy+MkiYD/YtDAsuNPy0m9OCrxWRQbwQOJ6nfZRl4p5nX1MuDL/NpHDrNjjr3REu6OEwPNkSa31wBZgace8Iq2TaARCDVdlz9RFsZoxVlku3ny4bG4I3FChmfeFKIAvcNTaVTrveXuZH9wGr7tYbHYr6XaKGKArkKIpNUp9tRhCJjNkrCtjNxu0YORpquRHcMmeuUHkQZOim0Ac=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Hi Nicolas,\n\nSorry, but I'm not sure what would cause that. From what you're describing, the server is sending the response but the `HttpClient` isn't receiving it. I'm not sure what the problem could be, sorry.","date":"2023-03-07T23:37:43.9363190Z"},{"_id":"e8a696f3-2fc1-4dfd-ae21-4cb0c0d4f982","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Brad Prothero","authorUri":"","message":"Thank you. After leaving IT to pursue ministry in 2011, I am back as a developer and am a bit rusty. In my app, I was \"blocking\" without knowing it. It is now working thanks to your post.","date":"2023-05-09T18:00:55.4336453Z"},{"_id":"221ecefe-79e5-4189-9479-7628b1f6c1d9","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Thank you so much. This blog was a life saver.","date":"2023-05-15T12:00:55.7305032Z"},{"_id":"320d8e2a-75ec-4d29-9bf3-283bd0bc5113","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Confused","authorUri":"","message":"I saw this recently and wanted your thought. Is this another hack or does it work without issues? \nhttps://learn.microsoft.com/en-us/archive/blogs/jpsanders/asp-net-do-not-use-task-result-in-main-context","date":"2023-07-23T22:44:05.4696800Z"},{"_id":"9433c942-f284-4036-abae-2b6c3eede15c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"320d8e2a-75ec-4d29-9bf3-283bd0bc5113","authorEmailEncrypted":"Uuel+bCCLA7/aYcFn7azV5q1Iqyn6oZ7mW2RTo3HHfO4V/d/uUeG5zZruTvg7Z0eKgq8o6u1Hz91G8DOOY0VjP4yricbGJAnGEJWgVBJkIttKnaaADJSHeOW6nzeDMdrF6Pu13SmtCUgyyjAdRN2O0IWKrvqXnETL3lHCCWM44WnFWkUQ1Y4O8ltCqpT33OlzA9fxXrfcfLvMrcav3Kl28gCdCDggNRmcf7YJt6t1ueGhppNpu5keQKOQNzHpc/ay3lfMdAx1tb+9mWqgGE6EwJSt7Vji3+CflKVFOfuIuYq7ammORf6CEMiq5wgQJIPKmfakF21pbwd8jz9fYtBkKEY0G1gUo9sR+FVuUaL3sVbsMHyC2/l2THCuin9D3/UYJSWH2mPNScM2KSZ5W4l4gfbxQqQuj4BiPQdKxH6vn+KMDLAKDsz5Ftq59Ot0+xt0thmC/5QrlyVoNT/OlKoXn/yX2nnMbO0bLkCHZwGsCmlyDFaQ0Mqxtp7vB5Fq2/q5kgeXJOrnoIvkWvy25p2zqOo/NmZ/N/2jYt1JCldKa7/SlzkVYHbuHKsF327EebVd8MZJrI0W0FOnU3fx9VHXtUsytzpBmzsEvutUbXutMFf7sEV3+ySAeXKX7iMVr8t2jUNFHcOWFLEM8AJZljSy07qVWhSKEK/o60RkBPQiaY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"That blog post recommends `await` first, which is also what I recommend. It also suggests you can use `Task.Run`, what I call the Thread Pool Hack. That usually works but not always; if the code needs `HttpContext.Current`, then it won't work. And if it does work, it's still inefficient compared to just using `await`.","date":"2023-07-23T23:09:15.4453180Z"},{"_id":"8a4ef8e8-1141-4613-84ef-82a2af3f36c4","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Thanks so much. We used the \"Add ConfigureAwait(false) everywhere\" hack to get our site back up and running, after Microsoft forced us to use targetFramework=\"4.7.2\" which changed the async behaviour.","date":"2023-09-08T06:30:24.4685269Z"},{"_id":"a2902d5b-8a8f-4ac3-9218-4bdb7e263c28","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"nnDF42fn8Yqb6RMa7v+oXdJ5epEljPOOsYhR1WwXnoPSAMP5nYNsN0nLN/LyY94TlnAq0PWgODJnyf4E+YlQXTW+En5dp4a841yjMIqpSoemAsj6SWEAEi2lQfKUTXx1QSbRZbjVfGAvNPyp+BBzSQsGopzE4W8xD/Uk/NnbroyrXAApNArizRmBrkgTZ/2Koq7udI2f4Wz5oOeoLJTi9iI8PZQIAJgwznlh/42uykMkEInbN7ixCQauitNK47ND3yDT/S4Q7vZR4aG7n0WntD4v/cdVobeoF5J8p2GpVALzbp90HT2PqTwNmAsp4n59lM4f7AKlj5iaElFASceZaCNeRktcR0pgKUM1d/JZfEE7HV6Yr0urfgpjFrWhfbcMmcAdUj1411mvgfRVb0l7zvBnou4qa47+Eau/8IWYUAjxXd6DymaZnrJe6xFuitx9oMYsnQ3FbUlxxg9/VGK/2m2Lm2ZiIYLDeXEU4fxoCnhSEUmdiMnEH73U8LmsqzAbbCjqvS9ZzXvO9ibLBJbDlZeHp1PM2AoQ5d2MRjBQuH6bnL6HQTh4sBcT34DAiBjb/PiFD3kGHoLsnx41sylQ41XTtofvfhuv7erU864W8W+gGAbnpv+GzmHE1EJlvfF0Ea7uLs4nwvrXss0uxw741imfYhcMFx5afGHOQ5T5rpo=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"ShG","authorUri":"","message":"Hi, Stephen. Thanks for material! Based on this, can we claim that in case we don't use await and just use .Result in pre-Core ASP.NET, code before .Result and code after .Result will be executed in same thread, unlike await ? ","date":"2023-11-02T07:15:53.1086283Z"},{"_id":"e9f1f0ef-d838-47fe-be1f-6d486a7802ee","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a2902d5b-8a8f-4ac3-9218-4bdb7e263c28","authorEmailEncrypted":"Lmb7RfJnk+W/iyjNYHCpInpUkcbGXm4QgA0hCUxqsXN9dkgfZC8Lmiriz7q36uhg0gK4AKpritueP/pMfXYWT0Fm9Ft3Ps/dt8xi7RsM6Z5cQVg4iQF5LjXO9EWVlpbSJ3xupMgNJdh2bBXFPm5NrDXK9GL1YqRA93N4eEIDzCXVtiNOcIMkmbijDzANlUTalGRuXqZtk3vuKidlymvGsq5xZmwW0pZRci7U/iUWli/nF+MkTWXjBgAuSgmC11IoEANIh530nb9rmYDxIrpH6cXCspyBQzC8Oa1pwhEHcsDKSY3Ni5CzpK7gHJ5Nq/2M3CzK4siH9vRxe62DOgMC0kG3SGDbXeTgzEj/QFWfCabCxQjKx5MLXEy9hj1EU+lVsywImDWTJBdm0TQunqg1+IHc7gM2eUUacI8dThh4OV7hMCn5y7gQgnX/iLXGpyjGgNS5wxetHrrCMBma6td5hXrEakkocfDI0yVsMgpV0RUCc2iHPrR8V5Ioz5GBUyCMQqqrokdYAoBShipPgCiSQ34lTJ9LGjG5NMaWTLrP5eBmp22LQb4fHDaYIhD98NLTOCfURcuDW/8vuhbxgtSkM25Rg5yp1NeaDmzot1x9GKAP3UXuzU6oqpRyQxkLcU7ByFpBg9GlIS4NzOMnBgWb3Qvi+Gf4IbaUN/fLBaPnh3c=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"ShG","authorUri":"","message":"Asking this because I am little bit surprised because you said in pre-Core ASP.NET even if we set ConfigureAwait(true) another thread can continue after await. So I am confused why is there deadlock happening ? Can't it just take another available thread after await block in GetJson even if block original thread ?","date":"2023-11-02T07:22:40.0675330Z"},{"_id":"a456c20c-451e-46b6-aa24-f54f814ec562","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"e9f1f0ef-d838-47fe-be1f-6d486a7802ee","authorEmailEncrypted":"jpUDQcMFpMdnZoTK0MGmczHyAIK2kLhuAEWIdYMaLPAVNjDaQM7yHaSjhTpinSCHDNoggmo6wqTX+FkFCad1TUQyyVrbtLHmdI5v09VW/5Dt3986Eav8hlY09P10/8W8KtfYVVVCKwebmpPTef/NeBJ8ZB1dLTSihV0s9AieSgFXcwRv0NNqAOQJWKanP7V4ovLuQFwhbivkgVakUHrgHNlACv4dN/Wn/nQn049ujZMWY4Gg4w0Ku/28ut2KHBAwXq/TUoZXFiZjMfm7BUVYGxZACiwDqJYsM/EKT1v+gBcGL8Fnye8r500XPObAUeVcJLf4PMCyVaH2tTDD9s665rkcVitdXjWAK8ylc9jdYMoV8m48Fx1KyiRCKZyc29P87FefcvR5NzkuNf+sWv69qawCPIcAKy5X6JqFdenIDfQPHtNUTYUfGd5g3Q+tLH5HN1YuLYBYn6AKjUbRrlcpYgtgUNLj6i9ft0JFZy49F9PNmJwCkcyn2KY6qs2Ai56tYgSUBfcYLGkzTzQ4z/yfKJCdSGgbACT5sP8JFppSuUxfOrgCfb2y/eyu2UwMPKZ7k5et7+l+LTKHZCbNI1njFkYRMbq4oNdY+pP3kicV5TfijMYlSglVszGsrGpcGp1F4+12uvc/NE51L5xgds6piPCOnwNzbSM1ypP2tYusk+c=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"> can we claim that in case we don't use await and just use .Result in pre-Core ASP.NET, code before .Result and code after .Result will be executed in same thread, unlike await ?\n\nThat's true regardless of platform. `.Result` blocks the current thread until the task completes. It never yields, so it can never switch threads.\n\n> even if we set ConfigureAwait(true) another thread can continue after await.\n\nThat's still true. `task.Result` is very different than `await task.ConfigureAwait(true)` - one is synchronous and the other is asynchronous. In ASP.NET, any asynchronous code can resume on a different thread.\n\n> So I am confused why is there deadlock happening ? Can't it just take another available thread after await block in GetJson even if block original thread?\n\nYes, it will take another available thread. The problem is that before this thread starts resuming the `async` method, it first enters the ASP.NET context. And this context is a one-thread-at-a-time context. Any thread can run in that context, but only one at a time. You can think of like this: any code executing in that context must hold a lock while it's in the context. So the other thread is available but it's blocked from entering the context by the thread already in that context. That's what causes the deadlock.","date":"2023-11-05T13:55:34.5972669Z"},{"_id":"65076211-2f21-4106-975d-5a32ca6b9bea","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"a456c20c-451e-46b6-aa24-f54f814ec562","authorEmailEncrypted":"s5cpEGW308ttPnTeRbTXKeV1naFmIhXo0gpy6Y7bJa9gUUaQZYcv3PrXmLzmixycqaFuNHEM4eIeFeR9vTUChqLJbeIjG4Z5B2s/1Opk+9Iec/n4NNmIEjJ7noMTzjSlhqz0e67BqRyyZ3zT9NsZcW7TAT0/kjH9tOnJ95nYw8B+LaJwL5y/hjZPXdqfIcCsAuThR7046dkrSatJECMmnnUX+pPEYdhrm+NKhoPYbPZiVv6uC2xI8mBxZ58cKXaG7WseBEgK0+qIyK0I+oDjITqDM6+x4yrBPl5Mo17T/P51r81x3nfgPEb+JLEU3R8cnT98oOT1egoJdLb8NKYIjuF25mamdnCqY3J5TkxNnAV+7lBPjFC+jZ5IzohqTNI7C8XzS+RfchpUXK8gZzei0WKMDSXMJdwiFpXB4YFl8U5FegBHCIqDXkRBLbMv69rdI3fTo4+pnetq1CcU2EXAjSzJeA50SsKqY6EKUYmMj1oZ53WH1/LXUDKXNWTuv7QRWfbUUNdv/ewtc0lX3VbzvXLdypV6Oe7SZxy3GidMfP4n3M3O78ZqQ3V2OSoTI9YpQJjaF1tS3c0qb8yYs/Lvr8PR8liRtUIYRG7hna34vNiegzn4wt4FCpWVBKAiP+ypXig9zzeJGCRaeN/FSAw42uoMbMhYMf3eGWXQLsAOp8I=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"ShG","authorUri":"","message":"Many thanks for your effort, Stephen!","date":"2023-11-08T19:18:57.9899875Z"},{"_id":"c0d622a0-fd2b-495b-848e-2f36e066c555","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Very helpful article. Clarified so many questions that I had. The article is written in a way where it is very easy to understand. Thanks Stephen!","date":"2024-04-09T23:00:39.9935416Z"},{"_id":"8249af92-8e71-42a3-8037-481a8fdb652b","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"cd3n4SZQFVJBCu3ILKQiy1sC7nAT4tK/1Ct1YjfxuJ8g8tAwlogsyNxPI7szra0O1WWrpGTXuB6t+VqWm8p9aXWSYxYNVodxdfpVhWKjqq0Zcqfm+rCb16QL+aJB+7eWT8X8/bPcz1CtdxkRrD8Oyvb9EcDm4fEnhw8P5LAI9fIdBgcim9yYJ77XYjAoRsLp5HUtxU0vueeUZ0YENOXhNF8u9xCZMNLIU5Q8IhuHw7zd0j9dShNOo3Bl8unS29FsCB8bDy/gAr0Xi0QbT5GifhRj9hyLtaVk4VpMIkgRWWqXvgtW8CBczFPTS7BVh1zhLqXS6cDEHvqPFis8RBWAspJLYVexeLi8JkJzy2xwugkvCdSzOg7NYgW2KUQ+UW3fSFEBKn+0agh7EYohT3rg+LtQBbGfqrMTnCRPaxrJ3jL60/O+jftp9f7XsG19kHiY5eGpavmPB4x6rq6YdtztPZOuFSy9FBzADIQ8O916x13mAxMWHS8VvFOwmC3E+zAFMa9QFsBXfeF0zRt2e40j6cjJS/9cNASwFR1KPFtw6UMYLvl3Mxov6LJpWpnhJ4vna4YMKzsGCCjbMe75p7n5CvAT31ToqeTdV6cnWkFm2QmZI/xv/YG/I5Vi4eCW7z6FK7TP2B9cqKgnLAziqFktOgIHQciohMg4spnap2FM47M=","authorEmailMD5":"6588cd6c2fc97b3ec7c3f25415143190","authorName":"Pascal Keller","authorUri":"","message":"Thank you very much Stephen! It's the first time I reply to an article of yours but I read your stuff for years and it helped me a lot to understand the behaviour of async/await. I have one feedback regarding the section \"Preventing the Deadlock\" in this article:\n\nIn the end you've written the note: \"It is best to apply both best practices. Either one will prevent the deadlock, but both must be applied to achieve maximum performance and responsiveness.\" But in the blue box above you've written that applying ConfigureAwait(false) is a dangerous thing to do.\n\nConsider to rewrite the note at the end regarding the first best practice to make it clear that it is dangerous and therefore maybe meanwhile a \"not so best practice anymore\".\n","date":"2024-05-17T08:44:45.8193565Z"},{"_id":"433a90c0-6227-4bb6-9cbf-b5d0d1ce7252","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"qJoxcRRRkNejg/bhWP0qCvR+oHf8NQ6mwzZhs3suoGBZbu7WFJ0zZr2QnGvZMOqhpzm3QS+MKHI+8VvlA2YY6vjvPIl2RvRCBesa/Eia/jxejl4r9H0YSgYzo8YWgJ5OUBZ10kKqBZS0OacJ+XZaPScR8pilHLV8MpMvy3IKOR59K5eWvfZ36jsxgsTgqabwwXMYNDkvbyfLDbEv6LQJsMB8p+0lzknrganPqrk9gZY0CPZaXMVacXcSJLuTyijVADv2q5WEGTAc4bdXQONxlqNnQeVMAtHjddsZ4UKyxWbUSc34tcHhenhnWVINgpwH/04Ok6GIDF4MTSfD9UkH2eX4MoT+3M7+oNeQbgWIeWaRvkixfUdc5BJfgpAE8zfGJcQbMom/d/rMEzqf/xLeyecW3PoWxa/hanF2S9kc5WAPhEUC30ymdeNh9JRCxQkyez8ZlMCat0YUnUkLVoLVhDIt7pCOyA6gpvW+Bvw80y8gEmyasMxrbSeyurJ+D2vph5SQHGNRnwuj34dIDllt7yC8YYy+4KYyHnIZfvxHH3k48QV3pFPIEnEgiG4JK6JvoHwqtOSZ92Pm2Vw5V14ambBJyPk8MW540NJoVNeipm/MIt10XVhEvKFtZEorC/UhO283Oir+3GYaRHxthz+Tbn00Rvp8fBefg3PngFjXHC0=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"","authorUri":"","message":"Thank you for this article! You say it is better to use ConfigureAwait(false) with libraries since it doesn’t need Synchronization Context. Could you please clarify why user of library should care about this if he doesn’t use Task.Result ? Is it about performance because entering to context takes some time ? Is it the main reason ?","date":"2024-07-24T16:32:27.6545858Z"},{"_id":"0b70716d-4c1b-4ddc-b8b5-07442a6ae347","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"c0d622a0-fd2b-495b-848e-2f36e066c555","authorEmailEncrypted":"KpJwXj4e+ognPJuP+JNXaL+9Jo1KhirTzUmDLDfAfNdPn5CXWMYOGOwrQxnrXh5QV17J5lQMJD2kSuZnPbK08ALxyCopWewqSb59GKWLRd3xzbyEsNZY73sMkwcEHd5NmvBzJVLodt5zIh4pkVQY576My0JRPROc6Fh+YTz5886LL3T2H8FkoCE48DdWwfbvjeBuEz3Q0qAlRMYnX87HXmDD+E6Wrh+t6Rp/DnHXfO/bZEH12SqKYA0yAEOlqPITH8U7CkbR4Ed3m5dhNApTqwFiAU8dPd1ji9Gaoy+6a2owvz1BP0cGVnFa4NT1llA4RqvqZtw8+kB2ZJ0ynqIHSt23W4PVhcA9470TKQJc3hbjubz8wAWtbZ2kSTwlI7xX4KR0Mtr8Q5QDzTMFXTVprdSSg9r4Rmgm3KjyD3u5MF7k15KJqlC566qyfb7y5OQLKrJtvMQPKONjzPLQ3n5aszQhdVRBuLdqkBd7VCNIc7S6oeNER26Ei9dQLFq6DcO/G7ZxoSOkLLxJSiRoH9rRofnMH5P75J1mAFvhnlWUtR6FVMwRBW2XYRN6oT8s/LFqy6qLa2Jk/gbkY4fTnm7v13wXd3PFTtcLd6c0yhc0+4lbq9QWnfptEujCDNl7BXff7NH252xJLEpOdCuQxGbXJzz1283gAtQuj0mDkkU8eDY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks for the kind words!","date":"2024-07-25T00:39:11.4272773Z"},{"_id":"203944aa-44d3-4317-8c94-c9176a6dbd9a","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"e378cf52-861a-4ce1-9b54-d591ed22e41c","authorEmailEncrypted":"LzRBqbXCNHEnQqiuhuxHIRiDqEqsZrVcMnSbexYq7NyXkR64sbTn/lE5542l8+LVOazAXADtdQeFBPCQUz4aOz7X6hnbfMzZZLQ/Bit4b8V2OX4Oxv5JJQ2+uAxvFqdALj7fk7UiS1v2QH+iDNr5M425TVw0PajCQiXOM7G5Nsf1IuvaaPMp8v/zdfCoSrL74CTpwh/wc8Kw9GRsYiQqAxXKcLWTnetkG6iEfFHCARV7XYNfGQyDpwKDsubsRiKjACF59CjpOhmv+/mkch4gQlUTP2aoCKv2fmPbTDdYnE6lDwWffiBvKo9p9FEsXbYiLGCTu4r/HOOJj1pOnltBXamXct4qUvprCbF2EaVq/o23F3bpbNvUgg5nstV3xO+s9xevMb68qwAFcPH3UtrP59SLVS91f2qTX5JJkZkI9jlNGFZqgSlsZd514rOJYIOugqJhgoqoQnlZJ29lozkGwJMg/GToxhNPkZZ8gn2JY/s3SwLOuXSL3rrKxRDv+IfOvaV59z1rPHHXYSh9/Rtpz1dOZRUwabO8TsE51pU3betb1mjvwLFDh+QP6iiYQg0vSqanHKGGMeM7aoqjEg1Pfh4koJOIwQF272g2rtFspxHDSvsTh2rahom/9ACJP3QpLbPIXt2HLF5RFU2F1+8xt6XI8ukhzeWX890YFxmFED8=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"","authorUri":"","message":"However, I don't understand why then to use await method().ConfigureAwait(false). Because when we await we make thread to go to back to thread pool. So it means we release its Synchronization Context as well so library will easily enter to its context and continue to execute after its await. So what is the profit of using ConfigureAwait(false) if we await it ?","date":"2024-07-25T11:03:38.9980304Z"},{"_id":"af1a4b63-410c-4eb1-9834-8d786f1e256c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"433a90c0-6227-4bb6-9cbf-b5d0d1ce7252","authorEmailEncrypted":"mQ5gleo6qshVtWJIG0+zG4uAbn6qQhCfMB7rAYJBd8vaWDWav/664+3QVCIqkZMholD96YZpIAZwT5/qcjA37aT8iHmWQH2t//do4HzkagB3Iuz4T7+i3gilSGDD/yd3APwYyiTKgKu7Dg0X3R8TkRi8Jq+8J9xwYXQQWXOPt6NMwN5zgh2Q6KX4DxWfOL4A9WivyUz8bC6Vy40mwPvrWKTCO1JOuyeVs2g8e3bhkBQgsTN65T1q+nV77OXwyWSiRMpHnaFLwGux7d9TRaKzUlq6knZ/3w2GIFt2/1hjizIm3Ou62GEf11SewoMmhFJJKsLPwM3LK60pmNfgLgyerg0CEEmUXTb2o39QsK9UJOm0/VHUI9inwnp4mGZ2lnHNxaadVqwuoFL3CeL4i0Qy9vQJj7OK/GyhG5Hi19snYRPn8kG9w5qOat75H7AwBqufI2nw4ONhi1bimpp/RMfhPA52LfcZIuEpSdBO0061VWUNNqAZsPT9zeNv7jf775HDdQLfdkMgmmLGz6WeGRyyM8ak45dSvWJmV7x7TLnxWVPhVy1lFEqrHQdTZEexaW/9f9p0U0Hrwyvo45kJBmIFZK58DuA5wFvidTpFVDp5UcrPlEG3lDSyCu3Rrhcfl7/4gVoWjRycgQovSXKoZGnvAGpJu8tMA9E9cUECv4B6EZc=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"It's not for performance reasons. The primary reason is to allow library _consumers_ to block safely. Sometimes there are situations where code has to be run synchronously. Does that make sense?","date":"2024-07-25T00:41:25.7775194Z"},{"_id":"e378cf52-861a-4ce1-9b54-d591ed22e41c","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"af1a4b63-410c-4eb1-9834-8d786f1e256c","authorEmailEncrypted":"ikNGII84ltWWaGg8giPIshGuALmNBgM4oreL5C7BBkdBlO1ujdiDlRUshEH/lLRh9AGsdkXws/k4qPiJsRYdiZhGavHvLBwDgwurL95BTsFw99qbHiIuH7Hi61YyCFS2eHg2oFH0gnrbjwi25GxwpqD8UZBJuErWB4vFmGcQlTM0a4FXFYdpowqlsHMaPQ3bWOrafhmF9+XhSiHLzWjDdjvz/sJ6Vsxo3xY3dxxT6cRcdEzFwNOEk5jFcdvPSxkuj3dCU8QKNP6RoB4RNBHT6WrnqEg67zRzDw4HdgvRBpw0fKBeDWmkpW+59bHjzVVFM6Kxnk5lt7cP//PFTOHOnMOwabJyViLFmeFu37szXjhG1vN/v0TM1WD1b0snqS1Gd02SyRAMndY4thtg4jKtaddqHs0cuWB7bHYBULimfFMxTbNIHXfGjASxpceYxVAhwKN9jLtDEYDGByC0n5Eatkwwq6AuHkwXYSAieSMTTCs0zTj0c9nwryt7WBATzK0puJgz5tF6FBEkTju4pHDsDCN10bfGwpm+1X+gB1MlL6IoUAkfB9fxNM0M2v2samUEub2a8xEksKX/nZBeGyKnvwo30Geimsh+oo/X3wnzddRgvyDF1cDH7+0pP5ZlwPcKIhvy/M3lDZ24NbkVGnxdSZgqeeCybBFrUueC3qicU6k=","authorEmailMD5":"963fc986ba391ec7a3b1330baa46b249","authorName":"","authorUri":"","message":"Thank you, Stephen. It makes sense.","date":"2024-07-25T10:50:02.7209160Z"},{"_id":"a9f9e331-72e4-45b4-b8e3-c6d030cc14b3","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"203944aa-44d3-4317-8c94-c9176a6dbd9a","authorEmailEncrypted":"QSQc1KNS6aFdQjAa1IYA22QghPVxW1U9Q54udO01HYdsE+2nVYFwOSE1HlLUWVdM3yczTtO5xD5x62cT5uQntju3nvezlsLbVQCOJ2p30BrAyQpgflFI4IFWGw7FQxfFfWY/0ADvK7Mrzp073EX040qrL1MiFwrDJ90rvDmXDkc55egiMPvZD/VgolsPTYaXhp99NDkJya8Kt7HSI4OciDSkuwhiuDwHtTttfVi0qYpaqUKwCEjavubsoumG2AxJrsphoBQjwVw3I/uSOSd3MP6UP2trgu34I3f9ckNFNcOYXLNavMmk0pNLX7zPp5ZueN62zGW68QuC5RPJa290x2wL+haGJgjewy8+b8cGWa5WL8BflmRiCryAyqbA42qxjXE4DGz3UXK7PhO/YaWXS78Lo0SpmG+eMjjSGbL+NYrJBkBA8s2YySWDIzhy8+hfm9rLXhd2MB5upKW6JtORpr7KRPp6NHjAUOHo/jCtpEGUw0tnIoBejy2KoSLanYetNE+VQDnlknIwvjNWSau3VIzxy7jpfUc1TCIIcprDE/b1CGz6KqE5rXwcosyAKwn1i4qZWcrWkXbHzqLo5fz81AFpglGg5dZkxjh1oWmARHvGcEwQ++jtRJHAVb71ZYvB4iD4QAOL2Qc2DQMcdGtsbYpb1nuNA1vRk4OrQQ0+E2A=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"`await` does not immediately release the thread. `await` just [returns to the calling code](https://blog.stephencleary.com/2012/02/async-and-await.html).\n\nThreads are only _released_ if _there is no blocking code_. If the calling method blocks (`.Wait()` or whatever), then the thread is _not_ released.","date":"2024-08-15T08:28:03.1933328Z"},{"_id":"8d61bd93-f7e0-4f27-aa1d-6d02416eeda5","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"vPtp2W1bYG9MONZg35oB5bhjXToSvu1sFQLtJmkk9GC0OzFeVQOkPdmBPr0PuVEQuJ/LZFes247uQszRfdiWK4PcmC/M17si8/2j1mvgQfJBfn2cD3+SM7/KtXPkMuoysrfKLQ+ocGcpxFq2KbBAJe+HoYiA5xUuLOiu109Q/WsuZWOy89wlDeV5nMC3RN/FKu6Z2YOZdip9/onLVzq6Y5Ulkbg7fEb3HX2nxKmn4GrUV7xOAM7P2slAd32odT1WDul+RRrum6bFnR6xkN7utMM+8HkGKrCVzbCDAzhsQupmSJubwwEC3weIRaOipXsUN81EN10BiyJSoQTMib5rOqykeYSHEVZv7F7GhzWj4OC0GVeJlYlqrMnxtV5RCx1A+XWNCHoA0vzVTjgf2uTOk2abkZULbk9lDT7LkGleNHCPElXa60aGoihEsqSDA+wmC5V6F+4vYnw/o26vpDzAP8fH2K+i7fjqBbX52Xr7tYq4xK9RZ7zrdw/QHheoxAObUnWPhtMNTxvWhtrLMNANYV2y8jPlSToj1jznPj1hzoy7ktdTdVYulqt0obahbM600HnXrmyu8WLmzBvEYzrReV1EvOM5S/Th/VwS+lBue0D7VA8Em0ttieaPtZVlr7MJOWHLKGDDHwuv7j5z+WJ+KelXUGFvn89A8V1lohy382A=","authorEmailMD5":"50e79216978774f82d1a589a76892ab3","authorName":"Isa Paine","authorUri":"","message":"Thank you for this post. It solved my problem.","date":"2024-08-20T14:00:05.8937017Z"},{"_id":"8e9dd191-409a-4aac-8a31-3fe8a1f44405","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"8d61bd93-f7e0-4f27-aa1d-6d02416eeda5","authorEmailEncrypted":"DblqJfAumsB+OBEl6Re/3vYVTVL9Wawno5CAU05+8Td+7TOaNneF9xC1InKVo1+0ADwHGJJGpZEmCqjEV96Y80oO/iwOQD6fUZ5jq2A1algOenR3dHz7oXN/YKksSZIeEUZ+L48Xre4jzZesPN8XsdKSUgmXR3lnihYKjleS+Pp5dCxpV7ZFND5fqw2ZRYGvrQkWUZD07vBHb+OWUhvcsbiNKqTnfnh5StS6O9AV8kb0mBfDrnL5D0pHyRz9Xgg3W3tLHLJL5sD3MAMM+4EhSrNlf1tN/VFLgvuq1X2RXGB9Lv25xJR4q3kAcYP1TUh3ywEc3rb/OL7kS83U6R3Zcj80nqaUN/1Ax1X0dRc3z3hzyQ/oyDmBQYu2MhOUedVicXh9d1jWi62kY8fRg34/ZIdgad69IXwfoW76HZfOzF53rj5q2PjVa4mwm1h4RWp5bsz6GH04ZdSWJ92lmmc8WKRkiYVvQS6A8znW3ofeFNdMG8Gi5RWN7tCu0UnxZod8wkI4MZnR8Q/GopYH65KZcmXoW1iKNYplwj3850SRQbAnM1Q/347ITTqZ2my+Ch+oiDHDZfnRB6eQ7wrMYCdusrkQQCbUmV2kKjRp4WKkRC7AnyAnpYMS/6Urr5fInHc8gqv+rcpOwVjd+76utjlVXLGcmnbAT6u4OunAQUtEL4w=","authorEmailMD5":"cddbd76c67a005a9da318fa50c2cad25","authorName":"Mark","authorUri":"","message":"After more than 5 years of reading your async/await posts, I went right back and did this when I returned to Winforms! Thanks for pulling me out of the hole again.","date":"2024-09-17T21:42:21.0192138Z"},{"_id":"7091b9dc-68ac-4718-912e-88f7db1b9f90","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"8e9dd191-409a-4aac-8a31-3fe8a1f44405","authorEmailEncrypted":"JNU3bfVEFQYa2Qx0tIHB6E7Ii3ZAj41xX6cxJWltv1ApG8q0YI20GjxjE8uYFiOGu7yB59qT1JBjc8yuqh+MdQr1vusfZtkurfZtsO3FbZ7afe9UfTFUoxwDKoKtc4lpVmfoiencnta9fF1Xl8i0fBUgm0XBYmMei4tQKALASkMYWMzkje21if9UyqZaVdpVJaEuN9eAUsmp8S5ty8oYZswi+zuuMC4PlcT4ArNUQRNhuhXroxPEnsvA3SXd4V1aImmDBBs0WobIsZzhSPv/EwzBtMvmf2TC91lt0INuuBhkx15VPhWZVkq8ZSbhmunhhdbaSPFCRPzQHdvPXXtJoz5HQkHN8hl5DbSEe9pE5larqafYUR1MV2Prt1iItNdcHTPT0b7iMF5rm3rj+BALke2w97lvO7xSbV4U2FbZKHNnB2xozOMXZxVvpSo6LJn3XTvHQB8QxJKsjMIysQjR0GeIernNkJmrgj5w2f+84xpTBq+r91A1UVGqQ/J93kkJKLJIYzHN/IyocR5HvSCEr3dSS/v4N9UPegyJDs+oA0gSJgZSbrSBR96Ua++mnk06fhyHSoqTZ584ZkbJOm0KdR9JAEnWk67RcYnFDvLUEChGZhBPHFe1gGTmxk5Xi3mr/51G1jG95eIWZW+8DWKvHwUMnbiJvuRUifcaE7jrdyU=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I'm glad it was helpful!","date":"2024-09-19T01:16:01.0025294Z"},{"_id":"8bf72094-7e88-440a-856b-b89c8d1a5955","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"woo","authorUri":"","message":"But there is another less hacky way -- much better to invoke the awaitable method in a synchronous way which does not block the UI thread.\n\nCompare this to your original situation:\n\n```\n// My \"library\" method.\npublic static async Task<JObject> GetJsonAsync(Uri uri)\n{\n  // (real-world code shouldn't use HttpClient in a using block; this is just example code)\n  using (var client = new HttpClient())\n  {\n    var jsonString = await client.GetStringAsync(uri);\n    return JObject.Parse(jsonString);\n  }\n}\n\n// My \"top-level\" method.\npublic void Button1_Click(...)\n{\n  // CHANGE IS HERE  var json = Task.Run(async () => await GetJsonAsync(...)).GetAwaiter().GetResult();\n  textBox1.Text = json;\n}\n```","date":"2024-11-13T18:39:20.7023603Z"},{"_id":"b662ff50-a9d0-4c0e-b494-962f5e78b18d","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"8bf72094-7e88-440a-856b-b89c8d1a5955","authorEmailEncrypted":"DJmnwHee0RnI+qx5dMBXVJbwAaM0i4nHXJnxwNJl2rQv0Duf8kyyjeKOweJa6C2J9ImUvlU9QhIciDXQ1MZtMySg3+Xi+HIHhYAtJPKfPDgrxAaU+8x62zuC4MEI/eI9lLjzX0tIQELH3m+BvN6MpTmsrMuFwX2or+wibQ9v1UNTZQpA/F/a7GKuZGaa4cr64m1Hh4djLL4O0uJ3XyTgoEd/4wwWKWo1Yj6F5U4vkP8Fgfba+WOq6UoWoCUjV6hM5Qgjm3R7HLf0ZIOxzM6R1bBADm5HbrSYk1AcAm0o7yyTBI1fDtf4zC4sBCxDEfskYPdLm+bxlvRrAdVNR4y8hEdNfgG0ye4cYbvzRjQTZ2+2l/sLqwaEGf+V2lGf1y76vnJRtKZfqoR3DRpvhohm7guBmzVIHbRsqLnnYdjOzQKhXtKlOVwU2hURVBL6Avs7rsSjO5qi3HkK1+lTyz876JatkRS6+uofdRigiqsMBR6yzGQGD/qKEtMIHOlGXp+WTMtLN/rz2oNMuy8UPObq67S8pmMJCsuVwhStJcW6LzcLHXHb5gKJxr8qB5Kj1yKBYVmzRuQGm2OS004oRQ/2EdA0yreICJHLIp37MflMGB105YsKdGRUoyqjCvm+VVsehCmbGWpdv8tVcUTJYTGyg3PX/PEGZzTZD9GBUFu2nOM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"That's the \"thread pool hack\" that I mention in [my article on the subject](https://learn.microsoft.com/en-us/archive/msdn-magazine/2015/july/async-programming-brownfield-async-development#the-thread-pool-hack).\n\nThe thread pool hack:\n- Works in the most situations, including the example code in this post. It does not, however, work in _all_ situations: specifically, if there is code in the asynchronous method that requires the original context. E.g., if `GetJsonAsync` updated a UI element with the results. Then running that code on the thread pool clearly wouldn't work.\n- Is a very maintainable hack compared to the other hack options.\n- Does consume an extra thread. In desktop apps, this is no big deal, but I have been called in to consult for companies that use this hack on web servers and end up exhausting the thread pool when under load.\n\nIn summary, I'm fine using the thread pool hack if necessary; it is easy to implement, widely applicable, and more maintainable than other hacks. However, it doesn't work for _all_ code and implementing it on the server side is risky. Making the code properly asynchronous is still the ideal solution IMO.","date":"2024-11-13T19:00:31.2165943Z"},{"_id":"42d19239-b4cb-4238-8f53-3daeff94fd41","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Great post, seems like ChatGPT is using this has it's primary source for questions about async behaviour in .net ","date":"2025-06-16T09:40:33.5399377Z"},{"_id":"72e7a9d4-b451-460d-b882-32e388565a66","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"42d19239-b4cb-4238-8f53-3daeff94fd41","authorEmailEncrypted":"nXHFzJA3PAQrwXl27shNU1ibS35UChD3B2K4seNt/fA6EADXzmSC6AFPw+9tDv2qU7W73m1cq4LeNEJ+KxylJplsP4hdTrhFe6poIw4UoKdlR+6e5T+8lDdYMWe4neCWxMzSd86xrDbHOO4OH0x0AVIE0Taa+ljIkKbuD7Dbs8MUinKcqDNcEfLLcLd02kdY2pKcZN4mtPyjvDNxwei6QV98gDuvKNiTLu4fJOMozYOILSQ46agnQcrl03DKi49+0QkRpKLauzd33tgO7Xs51ULtQCEJi7fYbV3j/SimzKv/Al0XiHPsFIyywwwwWPNXtJR8xin4z0RPb6sUOdVK3/NjRxkBpX81PrhGlSosMPzkHKT3ibM55E8VnFTY6E6xeFCVIv30XI08LbHCgn5I/6OxAAoJgoF9BWGKtRZcv/aGwRLEOwTvkCufVxVoo8jQabHtE3gkd4FrafiZwydryQILqptTLjqIJH/cqrExR644whadxXotSVnAy8I598gDp0VI5HeipiDES9jyRw6ywGcp46dxJb1GAJbewSJd0YsR8ojM6u4hp7s82o6LzNviT9GTWuuL59L0+/N5mdwnMwJpj2KeOFgbXjXZa7o0c1lss6ac1Imgkkv708LcIq3ZTSM8d1z1NTM1AkfMZBPV3WWZHZZmveNemp66m+0AdZM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Yeah, I'm not surprised. This is one of my more famous posts, so it's linked to from a lot of other blogs and articles and things.","date":"2025-07-18T15:18:10.2836625Z"},{"_id":"fa109158-10d0-4361-b37a-523e04aefe6b","postId":"2012_07_dont-block-on-async-code-abe2d9c7-c3e9-3ed8-827c-021686fa2310","postUri":"https://blog.stephencleary.com/2012/07/dont-block-on-async-code.html","replyTo":"8249af92-8e71-42a3-8037-481a8fdb652b","authorEmailEncrypted":"J6cadIljtoqK/8SUIiL0sbUjIfThpdG5bii4eoJwBmvfJ7CFkxhMkZ3lLXFNDzRMU8EF36IFxNaWcKeAm4PYM7jXUyLst6LYxzx5+D0z1XyWIdCJCyqFyJ8y/+hZCdQoLMavntIgQ67aF2LlAuut7TtgTuMElvuZxndmZcS1hqBtzhhhRY4vE3s14Cu5k9V4zfK6njppoVr4TLiXv32lDszjK/tfqvCJf2V1I9H1ki4wRIvbJ1J2QYL58u5oVM0mrZaaDsHlFqhyKEgE13ULsXkaYrDu1zS4+AzWnmxosa9LlAdp4IXV5NFLf/mc6NAFYbx4QuNidY6Hvp7kz2o1pup6FqfPxRNx/ZNUbGrt/67HI7dI2J14NrXNwAPxuxKfRLODQQ0EgJWBBcq39a20igfvceogg/rvirSzpX0r0lYRcnmiykRYSBEsyb3wTt9DXHwxVEzYL4XSHeEb1HovU+DX0RvVvjMyoDwVDaNueO6dY0GL5tYBGW7WLyCsrlVHRLz/i5XMkRVRmx6ag5xVej4BXn5U++r3J/nkQxl+88UxagnCQ1vzvM0xLAzEBHH5S+fcnsHNsom1e6F9FBS/Jc62mnWEN15Y7Vdya91FaY0BsD//xBUyNPsMlRwRe1YhQdX6R4VaYCcF8+ul2OWU12Q3bw7z2lPM7/nDMpNwp08=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Using `ConfigureAwait(false)` is still a best practice.\n\nThe danger comes in using `ConfigureAwait(false)` to avoid deadlocks. That's not what it's for.","date":"2025-07-19T00:14:05.1128640Z"}]