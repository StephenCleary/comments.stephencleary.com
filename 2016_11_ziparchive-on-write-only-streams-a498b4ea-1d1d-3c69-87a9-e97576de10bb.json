[{"_id":"aaf9b400-7db7-37a4-b53b-adb9779c146b","authorName":"abatishchev","authorEmailEncrypted":"H/P2WbaRvEKTwAJXpvhcBcrHJzsHrdFMLmFHwE7dmHC34d0dt6o3Y/Zs7Yy5xSKrPKBg+rj2djPAP1ar3wLGm3yx6c0ooVatfa/TDQg9q1Ry7Jr3z2YIl2deOusTFDZVQJzZSlRjFAC7njGcb4wNntgTY/w1mXyoESRLP8OmgLZ9JgII94/g27z26tqFYbeS2iumkhgIkxTx7urgZm2lBAurrXWRzKKVSUu9x4SgRVmiU32gMoBbaLx4kUNpQPJXOmLlsnWezVf+tslcAV/FZXy53es8ZmiTG63KHUpawR2RptmEyfMeYcXRanVZVGYBaC/WFHv6afsiJ6FCYV5PTCoopKEvigL7nSfut+vwwMdkc8+2kQUMxSLr7q6g4tu+xR2LgtD56eHEaM+aYFiZPOalKyWv/2evrCwZlwSvh+IYX/XGzPVAVO6DM4M2fvNDTS1DTsegMEy6/WlW5TnrrnhK2kAW6rHkAgGXIi1kTfhs4rt2SFFCwNxqwG8TnyaOGpjmb3B7kNkevIY1W+fe7jAM5aU/6Z8SL2QPRyFobux8V6GtcEyiVix0qQGJ8X6NLq4gQKlV8Xr5oddrlnSNKr84OQWcwqObZHenI3N2VKDxWzYvG6sgL4ey4GUygA+XSwJMI0MuZXpeTrwL2bqH1YOvoCU3mIpLRwnc9SLTPGY=","authorEmailMD5":"b9da2ca6abf3a1e28fb470f2b3ae2c34","authorUri":"http://abatishchev.ru","authorUserId":"disqus:abatishchev","authorFallbackAvatar":"https://disqus.com/api/users/avatars/abatishchev.jpg","message":"Do you know is there a place to resubmit this bug to be fixed at least in Core?","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"","date":"2016-11-04T23:19:14Z","timestamp":1478301554},{"_id":"848d4384-ef66-3f83-8cc8-fa8ad47fbf57","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"This post is regarding the full framework, where the bug was reported and closed as \"won't fix\".\r\n\r\nFor netcore, the bug was reported and marked as \"up for grabs\", so I submitted a pull request.","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"aaf9b400-7db7-37a4-b53b-adb9779c146b","date":"2016-11-05T00:38:09Z","timestamp":1478306289},{"_id":"0d495355-4db0-3ad0-9bc3-3e50a399a6e2","authorName":"Assil AR","authorEmailEncrypted":"n1geUHCzKV7ZY0NLEque6nFazqmdS4uMyjAwrJPRZP1oISSJusmNjoD4ZKakscqhVu7NrVjdclFSfqI/Hd+nM7JfVczT+XQ9EIGI2L8Ph/dPn0WzK0n3P/RYeI+nqsAv7pTNMOHW9+UAc4HZXIkzdh8p1HId+Ox1MsHw5AMR1FheMBRvkOumgQRDWWlX9YkC6T8ijr0ZQn4KGztRSxCd3S3YZp9Va92vPQQ4CMpFRmMuDLzCwdh5ZKtZPzQo4CgQx41B+sUPWT/NASrSGGYKCgf20hLUgPtQz9tQ8f/0Lbr2Db4rPREwoEkR5tu5vM+SZ4RqICMD80+Yvqfokn9N3te47FHmrXcePXaTaqHegaDMuuCr5DKefbhmA6uCZBYI7N7z0ZC68rfHxkseZk31C/+jDLFPZKQbcYFcsLkwJwQ6jOwW1HOmEIE3JIOQ68YvY21q5cb1qDNL6UZ6IwPpy8TCLODiy4hkl2Z6nN7f10iLEqWtNbsOSaJ+SSRG/eMD9BrBls2OAj4iW4Vm3A2IqsxuDeRRy6jDf55Q/u+gfyd4z7XXE6eoEvQnU/2zHJC0zDzWwlsneyXPLPOYUbxkVmn97VKTz0HD0Re2Omu2kkvXhfU+egvWDC6D6e9JuJ6x6A60Z5rMp0zt4isJWQVbPzN4yLhDy/PZYGNBUIzBYx8=","authorEmailMD5":"3e9c5cee36041dd7a396aaa5fdcd01b2","authorUri":"","authorUserId":"disqus:assilar","authorFallbackAvatar":"https://disqus.com/api/users/avatars/assilar.jpg","message":"Is this an acceptable implementation:\r\n\r\n using System;  \r\n using System.IO;  \r\n using System.Threading;  \r\n using System.Threading.Tasks;\r\n\r\n public class WriteOnlyStreamWrapper : Stream  \r\n {  \r\n private readonly Stream _stream;  \r\n private long _position;\r\n\r\n public WriteOnlyStreamWrapper(Stream stream)  \r\n {  \r\n _stream = stream;  \r\n }\r\n\r\n public override long Position  \r\n {  \r\n get { return _position; }  \r\n set { throw new NotSupportedException(); }  \r\n }\r\n\r\n public override bool CanRead  \r\n {  \r\n get  \r\n {  \r\n throw new NotSupportedException();  \r\n }  \r\n }\r\n\r\n public override bool CanSeek  \r\n {  \r\n get  \r\n {  \r\n throw new NotSupportedException();  \r\n }  \r\n }\r\n\r\n public override bool CanWrite  \r\n {  \r\n get  \r\n {  \r\n return true;  \r\n }  \r\n }\r\n\r\n public override long Length  \r\n {  \r\n get  \r\n {  \r\n return _stream.Length;  \r\n }  \r\n }\r\n\r\n public override void Write(byte[] buffer, int offset, int count)  \r\n {  \r\n _position += count;  \r\n _stream.Write(buffer, offset, count);  \r\n }\r\n\r\n public override void WriteByte(byte value)  \r\n {  \r\n _position += 1;  \r\n _stream.WriteByte(value);  \r\n }\r\n\r\n public override Task WriteAsync(byte[] buffer, int offset, int count, CancellationToken cancellationToken)  \r\n {  \r\n _position += count;  \r\n return _stream.WriteAsync(buffer, offset, count, cancellationToken);  \r\n }\r\n\r\n public override void Flush()  \r\n {  \r\n _stream.Flush();  \r\n }\r\n\r\n public override int Read(byte[] buffer, int offset, int count)  \r\n {  \r\n throw new NotSupportedException();  \r\n }\r\n\r\n public override long Seek(long offset, SeekOrigin origin)  \r\n {  \r\n throw new NotSupportedException();  \r\n }\r\n\r\n public override void SetLength(long value)  \r\n {  \r\n _stream.SetLength(value);  \r\n }  \r\n }","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"848d4384-ef66-3f83-8cc8-fa8ad47fbf57","date":"2017-08-25T11:40:58Z","timestamp":1503661258},{"_id":"b8656191-82d3-371d-a729-8d8ce737c22e","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's very difficult to review code in blog comments. What are the differences between this one and the one in my blog post?","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"0d495355-4db0-3ad0-9bc3-3e50a399a6e2","date":"2017-08-25T21:17:29Z","timestamp":1503695849},{"_id":"6cd59193-7202-31bd-9e99-b541bda59d35","authorName":"Assil AR","authorEmailEncrypted":"SKto2fD9ZDO3nKWVP23Z/QaLTXnyICEIepw7uJH1K+pRqK8pYpf4xrrGVtot8RSjCCRzRpB0ZUXHCjlytTTOYzoXhFlgCusDcLqL4PCMo2rsrK4ck/TVUk1qo5Mp7RRo7cezVax9/kqGUxgU98+Ph9v/WbB+1XU4O6b8lAkMJ3p2LNVkoYxfb33qoiPaZBiZqCPyODgfHRHAYb4nuuN87gg7lVsRxWqHCzMGzR/ra6r/NsZLlnflPhmaIoLNqqZvrPb9vsRuAYnFGWSwP+NfIhmUqqkgCucjq5e5A3p0IbY1mkSb9TRHd7iBnEqZRNqvrmA6+4a2HYwclxh3Dcef4/qIaaUMdg7A4cdJhBhOpYSt0xL6QN8ZlUHYtZsYfYtBpjk62RR0U0G7xG39vjU5eDw2dLiqnbMHcFful+CmbSSgxvDeZZi6ZdBCQpfxz99sMAnZEXLaKkVL5gP7xNS0DMI5RQVeAkmQp5YD1Z4V3GV9h5Gl9oZViPgyZS/sgOdNuHKuXpqbhbnGP4s3UvY1fB3++GiMXDwhzcyq0kHtLn2F9LwDwIcVs4QedrQ5dgdwXoB924qE18BW49tKeHaVjMpct08hjqaywhEuL1RNQ2lLl3pL5DkHMhbQOr/HzcgeV3+AebxU3DR8Cot1bVmQ3n+SJx1/yVUUjQ1vuqd5MZQ=","authorEmailMD5":"3e9c5cee36041dd7a396aaa5fdcd01b2","authorUri":"","authorUserId":"disqus:assilar","authorFallbackAvatar":"https://disqus.com/api/users/avatars/assilar.jpg","message":"It is your code, with some additions that were necessary to build using .NET Core.  \r\nAs a response to the previous comment.","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"b8656191-82d3-371d-a729-8d8ce737c22e","date":"2017-08-26T16:36:14Z","timestamp":1503765374},{"_id":"41ea9409-38f5-3ed5-8661-9c80de43b210","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It should already be fixed in .NET Core 2.0.0.\r\n\r\nHere's the pull request: [https://github.com/dotnet/corefx/pull/12682](https://github.com/dotnet/corefx/pull/12682)  \r\nHere's the final wrapper as it exists in .NET Core v2: [https://github.com/dotnet/corefx/blob/master/src/System.IO.Compression/tests/Utilities/WrappedStream.cs](https://github.com/dotnet/corefx/blob/master/src/System.IO.Compression/tests/Utilities/WrappedStream.cs)  \r\nHere's a blog post I wrote about zipping on the fly on .NET Core v1: [https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html](https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html)  \r\nAnd here's the code I used to get it working on v1: [https://github.com/StephenClearyExamples/AsyncDynamicZip/tree/core-ziparchive](https://github.com/StephenClearyExamples/AsyncDynamicZip/tree/core-ziparchive)\r\n\r\nI'd just recommend using one of those wrappers.","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","replyTo":"6cd59193-7202-31bd-9e99-b541bda59d35","date":"2017-08-28T14:25:59Z","timestamp":1503930359},{"_id":"886655e0-be96-11e8-83e7-13297d639546","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","postUri":"https://blog.stephencleary.com/2016/11/ziparchive-on-write-only-streams.html","replyTo":"","authorEmailEncrypted":"DsVJuI0gkhJCA+KtJzBXgHa/pUe8a5JKRIXN7mU1X2sDv+mhqXlTnhiw3BVkOJHJKfvVuPxDeRpsTbLhGjk+srIolgvzVKQyIC9J7HpnOqAovFGdadyg5AbADpa6/axOyn2kPpyiULtPhhVcpbI5p7TEH+KGzoEv/N0iRVD0HswadEHhVudUrHEBQZeGJRUsZUE7g2oAADb2YzVh7n2Zb1OhthEkUEZx9l3HnlcPbVHGEOH+o9bv3PySTHo13r00akNQwOQmCsVnRGv0BIkpZcxjfdm8D321Q1ao2uIzimw659KSBx5K9anjnwxFV9OKNnfnPD1LErHT0pNW8rYjfJWolzML+6wJ7HXTLu2T3f+ZbxWR2b4GpwELntF8LkCNM4WJ8Jyhr3i1FD1dg0A3rU2i0nfdF+IcxQ1Aaw/PM8uVY8aDy2O6I2wwF/nQwUSO1q3WZDKz6vnZUXtu1bXkLJJHjyqkpMlTbEhOWSH/0bQ3LKx19VCCOwjiq0Ehoq5hM1D1QuE9uxGwgqMaPP+nXReuGa0HiLTE92at7lYpxRainaa0a+B3a3IaM7ghrUX2sUAAVpJUrOKLKIe5PZwTh0d1ruwBm1htrAoVUVymtsrDVJQ+WZ0qUOiktvOIV114AdCNLDBPbjwKp5miDpxWkGUauLWO13d61DTj2OaZLeM=","authorEmailMD5":"0c178795cbf4a05bc0a72d35f23e9f26","authorName":"Paul","authorUri":"https://printslon.com","message":"Hi Stephen, I'm using a free Azure tier and when I try to download archive more than 130Mb I'm getting OutOfMemoryException\r\n\r\n(at my laptop, of course, everything is ok)\r\n\r\nHere is a stack trace\r\n\r\n2018-09-22T17:56:46.6166236+00:00 0HLH0MHOCHK0R:00000004 [ERR] An unhandled exception has occurred: Exception of type 'System.OutOfMemoryException' was thrown. (8be5a754)\r\nSystem.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.\r\n   at System.IO.MemoryStream.set_Capacity(Int32 value)\r\n   at System.IO.MemoryStream.EnsureCapacity(Int32 value)\r\n   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)\r\n   at Controllers.ViewModels.WriteOnlyStreamWrapper.Write(Byte[] buffer, Int32 offset, Int32 count) in D:\\a\\1\\s\\\\WriteOnlyStreamWrapper.cs:line 33\r\n   at System.IO.Compression.PositionPreservingWriteOnlyStreamWrapper.Write(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Compression.DeflateStream.WriteDeflaterOutput()\r\n   at System.IO.Compression.DeflateStream.Write(Byte[] array, Int32 offset, Int32 count)\r\n   at System.IO.Compression.CheckSumAndSizeWriteStream.Write(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Compression.ZipArchiveEntry.DirectToArchiveWriterStream.Write(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Compression.WrappedStream.Write(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Stream.<>c.<BeginWriteInternal>b__46_0(Object <p0>)\r\n   at System.Threading.Tasks.Task`1.InnerInvoke()\r\n   at System.Threading.Tasks.Task.<>c.<.cctor>b__276_1(Object obj)\r\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)\r\n\r\nDo you have any ideas how to resolve it for free Azure tier?","date":"2018-09-22T18:37:18.326Z"},{"_id":"d56b3980-c226-11e8-94f7-ed09f2515ddf","postId":"2016_11_ziparchive-on-write-only-streams-a498b4ea-1d1d-3c69-87a9-e97576de10bb","postUri":"https://blog.stephencleary.com/2016/11/ziparchive-on-write-only-streams.html","replyTo":"886655e0-be96-11e8-83e7-13297d639546","authorEmailEncrypted":"JXZuyZaaGQVLo11/NIwNJ7s9EozLpAfW8s+6ZWhx8zOAeg4w7UClMNi147ON90JQt/Qt/s1wQm8IdRUJjOlPBueLAYaTKfghy2URcZHtju7Y5gTP0hHsx0H23Pdj1XwcQpDmu8pkKdYg9Gk41Y/sAZfobp3gyqp7eDKGWpvvj3Qc5P2DJpHDUPyPPlc8FpTNHqnDg9r3xiInaN4eixDlnIAY3yW8Fqd4qnd7CgUcQNzkflgn5PLw4GVTnckX0/9fCs0XDX2Sf//Ydqu9pke7ruG0waGU4Ffkxqzc2dkjy6mBmyqnumgjI1N3YlJVIltSV/8j4zii3yWtP1WhzHY/02N7p8WRktU7y61vFj7HwdmYvrh5JsYNLTa46Vqp352LrJy+STJmncU9CLhatYp8AkbrrbXm8bS/95Di6BRPWbqhvTfnS0IIIiECV2PD/w/XwLuG6tpikFb3gj6kHeIHmyHCHq3bDYhgHTTBXAFXhXff0lCFCR6gviMBwwAYkUZCSG66c1S/2k5VHV8mon6PTFlXRpwaDHL3sCI34ktbcAys8KyZBVR9LnE5jw2FI9ztuoAfl4m6OnRSLJwKBVFevPdML6T3a0vHHb4tuWv8mznywwErV+jYRHepsnjs1dVEjM65h8GMDNHTZeK5LI/MJIoO1eoeDImsuFJIUvSdOBM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't think the free tier has anything to do with it. There is a `MemoryStream` in your stack trace, which indicates that it is all being stored in memory. If you are not using `MemoryStream` directly in your code, then check for any settings that may be disabling direct network stream writes.","date":"2018-09-27T07:27:48.401Z"}]