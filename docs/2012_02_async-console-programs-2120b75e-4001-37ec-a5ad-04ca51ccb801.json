[{"_id":"246ea2be-d1ab-3862-bc69-4cee8591ff35","authorName":"svick","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/17579249405158039163","authorUserId":"","authorFallbackAvatar":"","message":"How is this better than a simple  \r\n\r\nreturn MainAsync(args).Result;  \r\n\r\n? This would mean the ThreadPool would be used for running continuations, but I don't see any problems with that. Is the AsyncContext there really just to save one thread?","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2012-11-28T23:05:46Z","timestamp":1354143946},{"_id":"00dfbcc0-8809-3d57-8c79-df58eaf3e7e9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"AsyncContext.Run also unwraps exceptions, similar to await. In my Console apps, I do use this to distinguish usage exceptions (command line parsing errors) from runtime exceptions.  \r\n\r\nI think of it as a SynchronizationContext implementation for asynchronous Console apps (and a handful of other situations). Simple apps like demos or tests don't need it, but I find it useful for my \"serious\" Console apps.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2012-11-29T00:08:02Z","timestamp":1354147682},{"_id":"3708d8b1-4551-34c1-9b4b-daaf810ac324","authorName":"Mikey","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/01987096929709830570","authorUserId":"","authorFallbackAvatar":"","message":"Aha! It's not built-in. Also couldn't find it when searching package manager, finally found the page for it though, guess it's not listed because it's a pre-release? Anyway, after much link following I found the package page with the Powershell command and this did the trick:  \r\n\r\n PM> Install-Package Nito.AsyncEx -Pre   ","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2013-05-12T04:38:13Z","timestamp":1368333493},{"_id":"59b24f53-1b78-31b6-af1a-a507fa44881a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Mikey -  \r\n\r\nSorry for the confusion! Yes, AsyncContext is a class I wrote in the Nito.AsyncEx library. It came out of pre-release in a stable release late last night, so before then it was pretty hard to find!  \r\n\r\nRegarding async in console applications, you may find my intro to async/await post helpful here: [http://blog.stephencleary.com/2012/02/async-and-await.html](http://blog.stephencleary.com/2012/02/async-and-await.html)  \r\n\r\nOnce you read that intro post, this post will (hopefully) make more sense.  \r\n\r\n-Steve","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2013-05-12T15:53:03Z","timestamp":1368373983},{"_id":"c51d97ba-816e-37f9-b836-4547c8d41da7","authorName":"Mikey","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/01987096929709830570","authorUserId":"","authorFallbackAvatar":"","message":"Sorry if this is a dirt stupid question, I've been using .NET since 1.0, but I'm new to all this async stuff -- playing catch-up now and noticing that none of the examples seem to execute correctly in a console app (they work okay in WPF apps) -- I'm hoping your solution fixes this.  \r\n\r\nMy question is: Where does the \"AsyncContext\" object come from? I've been doing some searching and nobody seems to mention this part, also can't find it on MSDN. It's clearly more than just a using statement, as I have no \"Resolve->using ...\" option. What reference do I need to include?  \r\n\r\nUsing .NET 4.5 if that helps (pretty sure this stuff didn't exist in 4.0 -- so maybe it doesn't help). ;-)  \r\n\r\n(p.s. -- sorry about that deleted comment above -- it was this one, but it was in the wrong place -- as a reply to svick instead of as a stand-alone comment -- hopefully, this one goes in the right place.)","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2013-05-12T02:51:36Z","timestamp":1368327096},{"_id":"e1d067ad-1a51-36ef-9333-c4736ab2e144","authorName":"Mikey","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/01987096929709830570","authorUserId":"","authorFallbackAvatar":"","message":"This comment has been removed by the author.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2013-05-12T02:49:29Z","timestamp":1368326969},{"_id":"0741123d-8e68-383c-a34b-b23246a88942","authorName":"Prasanna V. Loganathar","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/05767806156414811301","authorUserId":"","authorFallbackAvatar":"","message":"Ah, makes sense now. Thanks.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2014-02-22T22:54:11Z","timestamp":1393109651},{"_id":"65e69bed-5c31-3387-9b1d-7fa9c8b999c0","authorName":"Prasanna V. Loganathar","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/05767806156414811301","authorUserId":"","authorFallbackAvatar":"","message":"Hi,   \r\n\r\nI was playing around with the AsyncContext, and suddenly, got into a situation which I couldn't explain. I've written a simple example below. All the tasks below seemed to execute as expected, until I put in the Console.ReadKey there. It seems the tasks complete, only when the AsyncContext ends. Am I missing something?  \r\n\r\n public class Program  \r\n {  \r\n private static ThreadLocal _localStr =  \r\n new ThreadLocal(() => String.Format(\"Hello from Thread: {0}!\", Thread.CurrentThread.ManagedThreadId));  \r\n\r\n private static void Main(string[] args)  \r\n {  \r\n Nito.AsyncEx.AsyncContext.Run(() =>  \r\n {  \r\n\r\n Console.WriteLine(_localStr);  \r\n\r\n Task.Factory.StartNew(() => Console.WriteLine(_localStr), CancellationToken.None,  \r\n TaskCreationOptions.None, TaskScheduler.FromCurrentSynchronizationContext());  \r\n\r\n Task.Factory.StartNew(() => Console.WriteLine(_localStr), CancellationToken.None,  \r\n TaskCreationOptions.None, TaskScheduler.FromCurrentSynchronizationContext());  \r\n\r\n Task.Delay(100).Wait();  \r\n\r\n Console.WriteLine(_localStr);  \r\n\r\n Console.ReadKey();  \r\n });  \r\n }  \r\n }","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2014-02-22T20:25:23Z","timestamp":1393100723},{"_id":"ff734681-4664-34c0-9ae4-8cac32d96940","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"AsyncContext only executes one task at a time. So if you block a task (e.g., ReadKey), then the tasks queued by StartNew cannot execute until that task completes.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2014-02-22T22:07:56Z","timestamp":1393106876},{"_id":"42a39c90-99ed-3f35-8b26-60b74ed0533c","authorName":"Prasanna V. Loganathar","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/05767806156414811301","authorUserId":"","authorFallbackAvatar":"","message":"Hi again,   \r\n\r\nI see the number of threads being increased after an awaiter, even though its supposed to just queue up, and execute on the same thread.  \r\n\r\nI posted a piece of code, on StackOverFlow, with a simpler synchronization context with no use of extra threads, to try to understand the same. But it seems to double the number of threads.  \r\n\r\n[http://stackoverflow.com/questions/23012279/no-of-thread-spikes-with-async-await-on-a-simple-custom-synchronization-contex](http://stackoverflow.com/questions/23012279/no-of-thread-spikes-with-async-await-on-a-simple-custom-synchronization-contex)  \r\n\r\nIt'd be great if you could take a look into it when time permits. Thanks.   \r\n\r\nRegards,   \r\nPrasanna V. Loganathar","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2014-04-11T16:21:49Z","timestamp":1397233309},{"_id":"8ff80408-4fd0-3b18-82a1-db884a806808","authorName":"Jason Bock","authorEmailEncrypted":"UZZLGQpKbG5tvSFiOuSMeOqHKegeY5PeRh2V4Orrd5g2a9l4p1yazL82CvUwxbujmmKSnX6pT7G35yMZ2OuPB/CKTppdhSrHmzi1jTcyiPgV50kFMqxHoFwuCLZsNiwqqLpL/twps0lhxJ6Mm5gAKUq7f7UT6owTFf+oSgi+ZU68/v7nZr0i47yKcj6vpXJvlDZcf6Nt8mbWUJF3B39/z2O6hb+tiPSi6WYJ1ML68HrQpdZ+VVaCmNeQzHGgxSmp/kuShl1Ag3ou1ednZKEgdWyA+O1ic5CuUPQw7nc0LbANcqoiUSzAHtkrzdky5LhwirTLRqnrNY6icVNORObJLyAILip+vbWmjh8f4/JcI/7DKH4qzl/eOQ5G7YdXRdIwokeLYumxbCbE/AWb8RwlYMZGSz3thuhZ/80Eglnsu5/5OlDOoquzpGx4ansHqYe2ccXzAYsh8gqiUZaH5CGFMSGz2U/JzJ3kKlnPNMi75f+35zzksDYIXD9craWwHD3Fa91JYt66ChN+5VwM6Tl0wo+4ri7TrP1P9ZCo8iWB8fkFVNFGHsWhCa/Yz0vY8pH7dTNH/T3v+fmF2F1dAH4W0u4tXAqgosXIzLbH41OhIABIgc6iGAr4naAsuYeXoL2qMWOB4/DDVxYdWjH+a0rcgwqTTgyDVWJ8CLjMwnodh1o=","authorEmailMD5":"078b61f4e6f93716b54bb5fb434c8a60","authorUri":"","authorUserId":"disqus:jason_bock","authorFallbackAvatar":"https://disqus.com/api/users/avatars/jason_bock.jpg","message":"Curious if a similar issue occurs with WinService code. Would one want to use AsyncContext there as well?","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2014-06-24T12:39:40Z","timestamp":1403613580},{"_id":"2eb53275-b95c-3eef-916c-a157ebc7a2cd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, though a Windows Service normally needs a separate thread. The entry thread for a Console app belongs to that console app, but the entry thread for a Win32 service actually belongs to the Service Control Manager.\r\n\r\nSo, I have an AsyncContextThread type in my AsyncEx library that is just a separate thread running an AsyncContext, and I usually use that for a Win32 service rather than just AsyncContext directly.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"8ff80408-4fd0-3b18-82a1-db884a806808","date":"2014-06-26T19:22:52Z","timestamp":1403810572},{"_id":"cde231f7-53e6-3786-9245-0cf4aea2dcc6","authorName":"jbattermann","authorEmailEncrypted":"rHOt3Hjm6jAu3CpsWgotRWECi3PmTz86XksgQLrOw6jc6lzNSR6r0cEIj1I1sYCAoG2/iXGhvDLTT0gFDbwMEZXx0F0mR4IuwcUotQIoc+ZGElsSXWtIPCzv9rXR2zOidFSW/w8HpcEmbNd61NSvbyCZCicT9YgRcFkeEDHTbC3PNA/CPYT4KoTmdRNUlRO8Cc2/90ST5icC9MS/LHwCsHDrbXB1bXDp54GyTC9cpomaJvOvtg09XeYs7T06AMZmU49GIftAWQvdmoPbhg7umY1/SqFa2Yh5Z7ucD2i43/ZWMTv6jwYBZec50sxixs15h8oGWbSYODGVelDKEPZeEPGszDI+CdJA94HdbO8agoRrKfbDFddly1+yRf4qrSYpuDuhuOYydOHe952lj/4ikFF5CVZI+S+SvTB9PhFbLFZPOv5rOYS5UXpoLSeo/s8xnBCUZm7nFBjZXyWYR+mk9Ut/VUpkmYa+nhjdz0C6EJhEwumGUfpM0vbfoEcNGYft84uILzeuS7zYysKCFoBw/WN4n5bO+QKM79EGNmeJFwPgdAUJtTzex2YUy+J8D0nEFxyAK6fxBI994HEbbftfl7uMqdr7ULFx7oTrBJBlflWz47vSjKyPNuDl2vMWUyk7peSCeSmhL/3laBbEwrQ8zBVjLS2dY3MGsulzO/qksy4=","authorEmailMD5":"854e9287641aae13c1045bc7df24bfbf","authorUri":"","authorUserId":"disqus:jbattermann","authorFallbackAvatar":"","message":"Stephen, is there any way to circumvent / enhance this behaviour.. so that more than one task can / will run at a time?","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"ff734681-4664-34c0-9ae4-8cac32d96940","date":"2014-08-28T19:35:50Z","timestamp":1409254550},{"_id":"a9a030b9-f914-3f0a-85d8-f7fc6b820abd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Answered at GitHub: [https://github.com/StephenCleary/AsyncEx/issues/1](https://github.com/StephenCleary/AsyncEx/issues/1)","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"cde231f7-53e6-3786-9245-0cf4aea2dcc6","date":"2014-08-30T23:35:04Z","timestamp":1409441704},{"_id":"0e0d29f1-29ab-3f03-834b-1aaf150a0ac1","authorName":"Madhusudhan G S","authorEmailEncrypted":"qfakOgo09+3EXWQAHord9QUE1+zKX+LLsFele+IqLF3W0LCOuaw4kazQ+r08SZdj0B6VEQa1rS2pse8zxOtPRDek4KedFwHckXxQ5YgsvJqEV+YQ0Jx5+ywdZmtQZ5SZS6BxBd8MrFCq5Xl9Ic5ZOLu8T73C9cBg91WIFoNV0foYVCLHX4t5WdywpZHtTvOSiEWziGFrXo5woL7CxUV/u5pJLgVtqSA2EV9q96d4iAhY8xqDac8bITl+S2jwQn5VVkW8ms629QT8xpve6M7oNsc/q6LkfBh2F59cg/SFab/jjSwEjIu+b2AAiULm/4HPcbraild+lzjG7KxgeCjuOz6tkf76u5BhvJaYWowMwXe65bkHfoGMIa03K1jPl3jAjepAL4ryIaWmGhMmIm6db6KfbWVdnkvpqfD1PrzydQEy06v3Yxng6thKJpLm4yWxfbV9ubaFYBsFq5BaDTnZ6PP5V443H+IDWMj3OniXIVKh2Uvi2yFvhDjjNPRK7jOP/JnawA4j4a98Xl3xhes2JyKs1HBLuABoOvE7+DhVEf/Fzcdh13FRiVNP2qFOzOMq0goSdIx4yDVrZPr/6rvEhEYSKH+UPCVIAoUtZYqjDMv4yIIt3ocPUah/L/5WZ/cQ/csNGJ0JsiqbW2t5MLZJA0EnitJGpLQgIi6HQFlOc70=","authorEmailMD5":"06acad583bfb83dc47cb3e94922474e6","authorUri":"","authorUserId":"disqus:madhusudhangs","authorFallbackAvatar":"","message":"Hi Stephan,\r\n\r\nI have found this article very helpful.\r\n\r\nIs there any nuget package which I can consume to utilize AsyncContext in my source code ? Cloud you please point me to a right nuget package link if there exist already one.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2015-01-06T16:55:49Z","timestamp":1420563349},{"_id":"162512c3-29d8-3416-9f92-83573d14b398","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The NuGet package [is here]([http://www.nuget.org/packages/Nito.AsyncEx](http://www.nuget.org/packages/Nito.AsyncEx)).","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"0e0d29f1-29ab-3f03-834b-1aaf150a0ac1","date":"2015-01-06T17:32:36Z","timestamp":1420565556},{"_id":"7cb57766-4688-3d38-844d-4cd709a248d4","authorName":"Agent Bond","authorEmailEncrypted":"swlZ/U6yY+ym4Ty4dQx7xMgQvAB7G/eT9W3xnkNXR45gkRPDgSqqF9K1XHQFw5oYy79ZEInFnU9GPqJc0uRwtbVLBKHmZwF69HC9zuiDUMYTBDfZIw6znzVFVgNaK5GdMHApfHRSYD7gGpOZpe2hISNNuioMTmEWk2WOdZi6Q3qdcSugBZJ9j3bloegLJiJ9PNmWn0XdW7v1pjYwg2oTZZRyZyFvoG1x1ZlHk3QZT8ustmmqWsvqbRbwIzp/R04z9cUoWsqi0yhWuP8WQwesbJbHyHiwcAciHfEOakSD8uJKJa0YRk1/p38m7IvCWsiShp3ps3r8XlrbQSmxVb5g2jvlqodKqZ/PFAMh6vV2bju64q9fBOY6KYr0OXsLf11H/Bs5Odr+0PBW3I7wk8y3FFeT3r5flTVHlmivkmy3odiKL6kTdBVQNh5y+HZ5V/+BsNdaBBLk6VYqfCL1z5DrR2rt2pzqT1gxGB9LhZi6xaKXGNP+ogEpmH53z5edwYgoxUBHd7DL273ZAys5fLGctk/eGD9LUEjFgVKr6EQdFEjD0VXDU5+ksqE8GAmVfCnGjQUtqmOdvRKZTjHVOHyALUIHe8RWthy9MzL5VjpEBNpkoTJuLLWL2+0YxGQSRYQsTYSOOjFUcZwBX6CdvAdl8XS5LVMKcB7Da0YbWNvdQh8=","authorEmailMD5":"12810a7e9cf2d0d2c6da069ade160ce7","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks for the post. Would you recommend using AsyncContext over using \".Wait()\" for awaiting an async method from a non-async Main() method?","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2015-05-07T05:47:08Z","timestamp":1430977628},{"_id":"d7c142d6-3cbc-333b-bb02-ce5f83b91626","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I use either AsyncContext or GetAwaiter().GetResult() in my Main methods. (GetAwaiter().GetResult() is essentially the same as Wait() but doesn't wrap exceptions in an AggregateException). It just depends on what I need.\r\n\r\nAsyncContext installs a true single-threaded context on the main Console thread. GetAwaiter().GetResult() keeps the free-threaded context that is default in a Console app. If I'm writing proof-of-concept code that will eventually end up in an ASP.NET or UI app (with a single-threaded context), I'll usually use AsyncContext; if I'm writing a real Console app, I can go either way.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"7cb57766-4688-3d38-844d-4cd709a248d4","date":"2015-05-07T10:51:51Z","timestamp":1430995911},{"_id":"aeb8bdc4-fe97-3356-9d73-eee63239d826","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Essentially, you create an `AsyncContextThread`:  \r\n var thread = new AsyncContextThread();  \r\nThis creates a new thread with its own AsyncContext and starts it running.  \r\nThen, you can queue work to it using its context's TaskFactory:  \r\n thread.Context.Factory.Run(...);  \r\nWhen you are done, use `Join` or `Dispose` to cause the thread to exit.\r\n\r\nIt looks like `Factory` won't show up in IntelliSense, but it is there. Sorry about that - I should have added `Run` methods to `AsyncContextThread` directly when I hid `Factory`. I've opened an issue for this here: [https://github.com/StephenCleary/AsyncEx.Context/issues/3](https://github.com/StephenCleary/AsyncEx.Context/issues/3)","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"cda06c30-3bf3-3106-bdf9-ed434a35b57d","date":"2016-10-04T17:08:27Z","timestamp":1475600907},{"_id":"cda06c30-3bf3-3106-bdf9-ed434a35b57d","authorName":"Binary Worrier","authorEmailEncrypted":"EGgNi9AActwzcmMIwnEjauaQ4YDocZ9C607OpBxAfM6gWKEtqr326XG4rBlf0Dot6/SYiSauNUwqkxMGudpBkPDjgovCifkiC+OonKdOhrH7RhRL1a3n/BVQ95pmlF+CKzz0/9GfZkMhWmdFjX1WjHk17tiKk7CJ2o2SGjwmeLJrg561zCXTAiVit5mFw2YJi4oE4YgsEW3XD9etMSd0laP0rtif3iaeAHPN/sICgzUnV2szezKXKcGxSC2ve9zYh99syo3RpAg4hvXs5eltuWz+xd11AvXLvy+WPj9zVpdZ/gyT8QR9xbDUE8hdSyvpWyh1mSzF9gVvauiePgcsqAKA9xMhanlaM+GtwNxTo5cXnVdKfrtnacn8GT6wMyDOXc2vERP+OOX2s+vLhqymlWzrNG+t9kMuIbMQj8k1i4lOlTogdanVTiBxdr4z7IgRdcv5/0f3lvd57+9zqJvYR8T5DkC3CwVrXzhrK7/J2JbbrrQijKEiBZMEjB0qWUWIQs4rgY/eVKQsovY1YRkWWRan0nqf/mrujcL+2r8USOlKL30kaVAAvKiK/dt7KfUsRpege7OpGUNFSqIrpdBHGF7W4xCCZ9J4xGdyzI20BUNJGMeI2Gsm+j9rhnW4YqLiLMFiHeBoXSyTGRJ0X1Zw3jbcNDX0oph00sd7Lxp0vwI=","authorEmailMD5":"46769b2f2b853cad9b21b11bffa3346b","authorUri":"","authorUserId":"disqus:binaryworrier","authorFallbackAvatar":"https://disqus.com/api/users/avatars/binaryworrier.jpg","message":"Stephen, have you an example of how to use AsyncContextThread?  \r\nI'm upgrading some Topshelf hosted Windows services, which have some async methods they - now - call on startup. They're working fine when run with AsyncContext as console apps, but aren't starting properly as Windows services.  \r\nI've looked at the AsyncContextThread class but can't figure out how I'm supposed to use it, sorry for being obtuse.  \r\nApologies if this is the wrong place to ask for clarification.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"2eb53275-b95c-3eef-916c-a157ebc7a2cd","date":"2016-10-04T11:50:58Z","timestamp":1475581858},{"_id":"68b832df-1187-3aa3-9585-4f0dfb9274ce","authorName":"Binary Worrier","authorEmailEncrypted":"lw8Jdfj5IVHKr+xLeAGGDRJvZxYMyRPeRMdfwIIQl0huyEnaF19diM5QgbswaCKivYpLENqTEdBioA7ZGdbxt4iqL0RjXCjRPRj3oZjwFu7UhG3LOqIFwsXq5nkoVQDF7asN2qdUJx2HuA8dRmwf6FW24YIWpXFbFidRCJ67AX893MVgev8UCvwuxiKsMgUG0ux2JQCpu0XqXgmM3w++PjoiVQSePKxwFaSTPNO70oOzje9NpA47oqRgf+T2InUedv8hXBmhHk8w/pBONV1FNSLR14T85J/EW6apD+xNXZbC2qXr5JMokVLxbd6ZQXCGTb0dTKvA91EEOHZO0om1IJEfL+oKHj6SIx167IT8eB2mBb+3MtrJzlG7xli3GfZX+TN+6xtTubQdxvgvWKxCxzuKhGaX5mnG6M9hCFkJGATsNt+ullqHcvOlFr/Qo0xjUSsJEN/wNhd+ykNni8xHULSQZBjj99KiGYURYbDmqB66ev0ehcFqNLr3M9jy8k9ocI4hY8Js39Jpmd49vosepbCcbg9jGrDHqTYkIgDalHB4BErNTycjapIzzWMcxxDk53BuvjX8DfflRm0IV9BVaLoTSsqg7gpgBMMP54LZNVvHZgK5tnKKTixw3YwJPHyWw3Hdv3bxXwGCp7E+1oJnQOD9iGPVv+wsgavvtBmzoMY=","authorEmailMD5":"46769b2f2b853cad9b21b11bffa3346b","authorUri":"","authorUserId":"disqus:binaryworrier","authorFallbackAvatar":"https://disqus.com/api/users/avatars/binaryworrier.jpg","message":"That's exactly what I needed to know, you're a scholar and a gentleman Stephen, and I'm very glad that you are both.  \r\nThanks for the library and the extra help :)","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"aeb8bdc4-fe97-3356-9d73-eee63239d826","date":"2016-10-05T11:17:36Z","timestamp":1475666256},{"_id":"204754c9-15bf-383a-b900-8fbd7ab26a45","authorName":"Daniel","authorEmailEncrypted":"qEFBoK878L24vW+3vzg/gweb0uwWchkBe3GceCBbUf9iHULiIr/BMppBLxm1jZqzped/gTU4ByItsfExcBxKMIJ+HFvlDcXU5t7dc9zaCmOzCGFrpz7eg8DMKbJ4vDStWcagcBOIIkizWAL89g8G8TfB+UEb4/TIg3wYIw1IViwegTbCk6J2zMMyx9rXGVFsX/DB5x2yshpEVLDavFIZ+Rwc6qbZL0kKWRhpB2Vi28ec/nc0NitvS223yap4e3WnazFc78GxIgpH7FBdnmCgRS+w3IzHbABd3MnxAtb6y2vsP8pG4bCdSIb9EfhqAJpKowtaKHidD6UvCviJlPpFqSalPz1YtSeeAWZc+Q9LjKAxIw79wH1oB++4UFbtaIrlFnXXpCK3ap287xO9aFOff4CGf32w4n8Y1nv38KfRn3JnVHWlI3oOA/1gWNZPwlm9FmA5y7hsFXDAsDFZIi1/t5f6BWw0mMW+O4SCguUK89Ns8NqZEHutSgLUADt3vkZnG+H2j67FBA05X5clYDAWnuLm/lQuCL7wkj9cMgn9wA8wUBCtzgRmAkiG42FW5R3D1egR4+KPay2B8MjIC88e2AIVIEYUqZA4khOM2LXdUyessFjR0BNxsp2zCHpKXVqgE2Kwzkx/xhFrzp68fHFhVi+4y4JXJfelSmciePD827A=","authorEmailMD5":"e56a86c48c91998d74f6a66e901eec0d","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Hi Stephen,\r\n\r\nI'm seeing something unexpected when debugging my Worker Role in Visual Studio when running multiple Tasks inside a single AsyncContext. When I step through the code, after each await statements that triggers I/O the thread id changes. I just found out the same behavior can be observed without debugging (by logging the Thread.CurrentThread.ManagedThreadId before and after the await line).\r\n\r\nWhen you say 'true single-threaded context', do you mean that the async code inside the AsyncContext will always be running on one single thread, but the exact thread (id) can change over time? Or am I seeing some odd behavior?\r\n\r\nRegards,  \r\nDaniel","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"","date":"2017-03-15T22:57:33Z","timestamp":1489618653},{"_id":"7c9fb4f0-80fc-38d8-a634-066caa1e2823","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"No, that's definitely unexpected.\r\n\r\nFirst, ensure you're not using ConfigureAwait(false). If you're not, then can you file an issue ([https://github.com/StephenCleary/AsyncEx/issues](https://github.com/StephenCleary/AsyncEx/issues)) and be sure to note what version of the library you're using?\r\n\r\nThanks!","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"204754c9-15bf-383a-b900-8fbd7ab26a45","date":"2017-03-16T12:44:03Z","timestamp":1489668243},{"_id":"15ce7aae-25c6-3849-90f4-d92dad38219e","authorName":"Daniel","authorEmailEncrypted":"l5tx66CRzzINHC+Md1+1x91xTiBoR9lrDFZTvRtbEQXB8Bo6lUmH/H4No7iXn8IonWyS/KYPqDhMZCGairX5eImespyYYSo2NUxdFNn2LLBQgNvo8gwAs76KdSQBdxQwqTVU/Tf1XKWzd4Z0RczCG0sq9WB7UW25VjDm7oHhmQdutU1d+RzwGGkrl17jK5392/kBiTzbrE+vS0w1QG3SQFU2clQPvU6op83/AYzbulDGtWFfiJbqQg7AAxe35+sJFAcy+k7lOauonR/kYs09hXLN+QZ3Am7aITun9ruiVgSe+QuaZJW2RlmbJ+ETuGKfznccwJOeUaBQKf9qetsTW+wUeFtZSXvwjQMfUuHcTwOLxNGJGA3+k+VhyvcCNvUU1weeC23a4I4fJtjdY9IE0DjDB0VHg3yjl086UAD5DR4dzFq8tLe5f6MpVMCMHKuoZ9B/vF83G5rGHiFq3l9BzuEeLGLCOQEdTF+kLHHzF7socas8636wEj/YSbhtNbMKpdGTBZcqsnZI5qH1QQpXW2FSdyFSvYdduzmxWJA5EJgzGhgd8w8MBiqbw3Hpu2eWDWAqkxdz3ATGK7Zpvs2AoVUsmE4ZJY9LcePBYsjNPEMclVsywx/y4YRplQ1QgSJLHTkE20JqIR0xdts26N25VZ0GSQoApXKYvDut2mNIIb8=","authorEmailMD5":"e56a86c48c91998d74f6a66e901eec0d","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Sorry for taking some time to respond. I created a simple solution to reproduce and created a new issue. Thanks!\r\n\r\n[https://github.com/StephenCleary/AsyncEx/issues/81](https://github.com/StephenCleary/AsyncEx/issues/81)","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"7c9fb4f0-80fc-38d8-a634-066caa1e2823","date":"2017-03-21T11:43:39Z","timestamp":1490096619},{"_id":"eed7fb29-0f16-385d-8ead-5650879a34f2","authorName":"Daniel","authorEmailEncrypted":"O2BE2grq4aCbO3kbyng6QaNF74LQhuoY6Wzb5ZGhfGZb9RWVzIZ7PtKudUmaIkZ+/sYFKJk0m/GsVdNHI2oYlnYeq9AZEh2iSlaHWEpN39sEEEqkw6G9PBTOISheG8AX6AcqNFMYBarbPPmZxZIm0WblUnFyqJom2NkD9t8yHk9LCZ/5fj8eIDbitq6nXaA100kSfc44MPP6a2p5VCaXd9eltEfNOvd1GR6BQOPzlXBLH/kk9IqRx4pKJ5S5kEz/feNwrBCg0zlSEbw+5xdGPl7JGsb2Zxq9VIvIeZGhxLB7OZJ7Xy2jqCOfyRnEOeyB9XndgWFbU4DSemMBC9JTCI1Yn3NMlVBtv4FQp2Majdb0x+ojBCu3rhqPqVzIsPmed7vO0sF7juxZGvBlfW3kTs+GYDYNWEF3BBgghTHrhBzpGhr7H3hWBYr6Pxepwp8DhCJLaUL0CUoQs3Mc0EgiYj2bnjD81HtbEhgJyrx8KgZGAWMoPYG5fjusuyaOEZ+eGXAhnSs89xx+qsP1snAaKgpNnlr/5UTC2YfHl59bz/Pcyldmn4x7M0x4x46vg1SvfKF3HNfiyE142f98DSD/OW3yPsJo2rkQWlGmTQiXjgkhRP1A2Q3d32HgWKxIVQbMdi55ZteqbKJzAol3xDazDuCIO0+7OdTNuJRY1Doxhq4=","authorEmailMD5":"e56a86c48c91998d74f6a66e901eec0d","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Turns out my problem was that I started my Tasks outside (before) AsyncContext.Run()! Thanks for the help!","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"15ce7aae-25c6-3849-90f4-d92dad38219e","date":"2017-03-21T13:10:48Z","timestamp":1490101848},{"_id":"1875d935-70b2-3bcf-84ff-2b91122361f4","authorName":"Tom Stonecypher","authorEmailEncrypted":"XOfFwut6b88jgIkWULE8hApAv5txlxx7Diclu00Lun8pf2QAzuJm154ACdpEsEcuHoBb3nfvo5ol0dk3YUkhdC10mbkXnVBuIvgbMJybmpEMjuWXzcgXROKk0+ABRY+7UNmDG7igLeuzFL3jnsR2HwLrTdb0RpqyaiFBP1C2KOtxEY+oZ19u5PhwhhWpi90kQK1PwKQh3yjoIQI9CXYw2srgXUJO14KcuirmzAG+JH+muknt58quYE+ypnGfjcgzLptbzZAr2hhceptYDmzLP3xbo56T+DLAS330tYXjabzhrsVCnrV4/GeEvMF23bD4Na6IJQ5t+5gwhdlbhesqLq91Z3JeXm3ZvXsgsnDAp699Ln0b+K5/q7j67fm0BkHMbVZ5AU69B79hEl8TrGpCKAuYwWXvl8HV48rfj23Pres+B+0a/OOlHycIslSGr8MupWIaRJMxzFMwdBLvZ3sVutukJ5HSnjlbd9BSyJMuAuNGTa0dZWxflSu/cllinckfsfu808WqpA9d66y8KU6YSlO1x+X2zMVNwRLTbMqfUYhWaj2ka9GS2RYq9lBj6OauJ1BavHhA9kX6UCt48LynJv13nxMv5OFveZheqFfPo2wMHw4wGZhgldwGUE7amsjI0dK81pJaay2t0z/1iedRVG2lVbumZTA5yx6q54FzBBY=","authorEmailMD5":"97ab77c9b3dd059e9f39d46cc302f25d","authorUri":"","authorUserId":"disqus:TomStonecypher","authorFallbackAvatar":"https://disqus.com/api/users/avatars/TomStonecypher.jpg","message":"Hi, Stephen,\r\n\r\nWill you please recommend best practices for avoiding / handling UnobservedTaskExceptions with the pattern you've outlined here? I have a TopShelf service; the start() method calls my near-forever-running async method on an AsyncContextThread, like myThread.Context.Factory.Run(() => myMethodAsync()); I don't wait on myThread except in the stop method, e.g.: myThread.JoinAsync().Wait();","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"aeb8bdc4-fe97-3356-9d73-eee63239d826","date":"2017-06-23T03:32:54Z","timestamp":1498188774},{"_id":"40bcbf7b-36d2-34e6-b58f-e0fcd0228183","authorName":"Tom Stonecypher","authorEmailEncrypted":"jEoEkZaUAedKH0HzpAjwyi1xgta25JN5lUeU0D88aaxEqRceEGqt/ijeHuNhqiaoHgSUoPCiLUJZi2T+kp179tvcUK9a1pg4O0Wg3SgCYDqJ61bP+9PaWAdu/aIEL3bXs9WanHm+oHcYVCNjVGC4h30y2f7FSYNXxl4mcaGFQGbPx9/2jfjsHjqDzG+ElX0r2kkFfxK2nHUrfZmjFRXr6NsA5xaJbNtYIYVPWzsyp6rse/+MVCx7Em9C6cEToAiDbHasS0hdXeNpoVQer+J6JlQiMsilBH3eXlon5U2WB8+B5OH+/v8sDxQXGtpe0Im3rklyfFhI1fMICgN1bhLFDsTtf5C1yc0vIpn5+MrNhbd8/aJauJxz8EPKxcnOefwHqcCWCLuIIUfL7Cp1+s5r7vnzzV+tESPflE6UNWI0hQVM86KUDng5YzPE8Guy/W6ossIi/8Xod9qY+15mnsJ4FqQFszc0l8CTECHdGwr3eBn56dDCKHmo2vEo87OyOQ4v7MxdjN/9os13U+vaFZcT+n2Vu7C/0fFOCcEmoim0n5l6k9vU7KRGSPpPpL5W3GSDNs0C4nwHdsSrHq5EFkgQiLn2HYv63qYbJYmiEJBnyJqleiIOJzm7qvA9ovWtVDOJYet/7dL5p8WB8led/lMFznQ5EB8LNzUFt63K6Mf1KqU=","authorEmailMD5":"97ab77c9b3dd059e9f39d46cc302f25d","authorUri":"","authorUserId":"disqus:TomStonecypher","authorFallbackAvatar":"https://disqus.com/api/users/avatars/TomStonecypher.jpg","message":"Yes, makes sense. I was throwing the exception from myMethodAsync as part of my service restart strategy. I need to have that method log & consume the exceptions and also handle unexpected termination of myThread.\r\n\r\nThanks, Stephen!","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"5efbd3e3-5fc1-31f6-a888-945ef66ca692","date":"2017-06-23T13:16:03Z","timestamp":1498223763},{"_id":"5efbd3e3-5fc1-31f6-a888-945ef66ca692","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I think the easiest way would be to have a top-level try/catch in your myMethodAsync, and log the exception there before returning.\r\n\r\nAnd stay tuned - I am planning a Win32 service example with AsyncContextThread as a future blog post.","postId":"2012_02_async-console-programs-2120b75e-4001-37ec-a5ad-04ca51ccb801","replyTo":"1875d935-70b2-3bcf-84ff-2b91122361f4","date":"2017-06-23T12:50:38Z","timestamp":1498222238}]