[{"_id":"06b5c0ff-eb9c-31d4-ba07-ced5bd2498a2","authorName":"Lukasz","authorEmailEncrypted":"BqYCowm+wmlEIo1URstJA8SKrytHPyDplbkomHmPlQSZ1B+sZ5TY5kYEAUOeRZLw+/t1HPu6U/rQ2DDtkFlzlETVDutgjyH+tlJhvH466pcFH11St4oPNn/TFNXAOuPpmcDY1THT0yzArypIOe4K1EaEysvUZY+BK6q5q/QQWs/DZGzcnr3nAoNMMgV4emEgHmicukQsDRmKVpF8n1n+p3uhZqCoPe0BOYBJrwYr6613tC93Be6EVXewBDYyDQnAizf/mgeBI4T235dRHrSS35EcEjZGBkMZTrhUO6LebHxfPDz1wdLK/4Cx+HqzczZHAmMn5noMJrwEcd55cmJ+rG+wx0Zq4cXDdDqcuvAVw1CiFJ9Qi2ZkGVTydSy2Hcn5KWQoX4N6HgCuxb6OjNEB5wGumfFgjidJtU3QpfRJIoYe8mSqppaiXz/ApWhgB6sJo8A95HpSly9I4KZkwbtSURwWNE0bWdZqpE2GhSSfg6QKcxzqzfFLP0utltIEjhEHGYBdyvlsvKPng6W2MwlqO3zqChcKc8USZC0ggg47HGfVo7v9UiMY2LEYUPVsqnlPljvSA2xDEWGC5URQQNwH73RCMea2ndcNhCWuuw5fJEjdbrEiK0bknZszy7uwusF1yUB9td1ZewkwLn4LqbtjAnEaVDyaagXtVQzr3l3zGFI=","authorEmailMD5":"95cf4b9626db3813c3f37b2d141b2513","message":"hi,\r\n\r\nI have following problem. I was testing two diffrent lines of code:\r\n\r\n1. return Task.WhenAll(queryTasks).Result.SelectMany(result => result);  \r\n2. return queryTasks.Select(t => t.Result).SelectMany(r => r);\r\n\r\nSurprisingly it looks like the second one has much better performance then the first one. I know that the first line is not recommended, because WhenAll is for await purposes, but anyway, why it has so much worse performance?\r\n\r\nBest regards!","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"","date":"2014-12-17T13:40:34Z","timestamp":1418823634,"authorUserId":""},{"_id":"fa8ab494-dd1a-343d-80f7-07ff024a6704","authorName":"Stephen Cleary","authorEmailEncrypted":"saIp2xnKl/1lfuvX9/eIKol29K7vDLZidQ/0IUsV76w9e07zBRHC7jwt82NLclKooWt685t0wwyS691o4BvQSLCfa1bH+NMr81FrDcfaBaKnlReLHJiNZatF8SQ4wds2W9kIuZUNG5MnIpM8QzZkZ1ObYmUnQPrtGTHv7n05qk1ZbQp7ln7D97uZ5JZiDJeCY6rpm1JwuHmfx3QqjTb1AWxk8cp3L0GTFzfsJRZNTYRFeEBpM5fWdXHCTSxcyHWy3Cz9xXaQccQ/IK9IQIuXXMgzQ4IEta2l0NaPLkfrupNhbAshdPWlGMb/dOIHKN92zhq/h8tky8893wBh8QtHSnhJLwXJydOXEamdFPyUY7UbitH8gEEqEhOOA7dhNiyugq68p+HtKI3+DIMpvB/T+xW9AUyQYAyRzaP3cUdjzlS45eL56avJP+wuKDk2sZ2Id0klQccFCcztRdgEcSzbMHe+bjMscFJzITuuUslAorJ2cM7+gx955zAGMa49G7rn3LhTz376wT+XSix9vzNqzqsiPE9frqqORAk8AT/5UzpTXVrQL1GAYrw3cLU+w5L6eJl2YBdpADrsVueb8gYi/Kw8VkJ5W21gDqPsPCvXz+Lvdhw/HTVtYKj/eR7tt4F18LlitLPwm9aO+sFBSgMlBR9Cw03EettO2FprNjOE/fo=","authorEmailMD5":"ad2250182ff26a84dda974e50cd94382","message":"Hello, I saw your question on Stack Overflow.\r\n\r\nPlease post a minimal but complete example that illustrates the problem. Disqus isn't great for code in comments, so I'd recommend creating a Gist.","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"06b5c0ff-eb9c-31d4-ba07-ced5bd2498a2","date":"2014-12-17T15:39:40Z","timestamp":1418830780,"authorUserId":"disqus:stephen_cleary"},{"_id":"6969626b-d5e2-3f30-9758-367ebac3fe1b","authorName":"Lukasz","authorEmailEncrypted":"LOPkSC0txCefAcSnfjMh9nML8jJb9qILmaNoX6RyNPfI+BC9/i8OST+oLFZNfkAGqvnNP4RnFNzssyN4bW+t642PE6rF/IrQ6PmeOww2yBJzkw0pjkjBrTymT+GdgI+PcukxPoaBT6g44cgu/Mtud3ORbiaqetWn7EI0ojWnDN4jC2LBzQ5rOv0Nx9V31fqnzBb/ybJeeEd0t/HKNOiM8+pC3x6YCqIYS2MrtzfABckcXP+FfgVAqymjGolWr0/GAL+mWHWUo4oqrTjaBsAQc/o8MeOP/6nIWoemJ0TWcPxit1olmGcCbhN/4KdAb5uR3HNOInhmcBj3eCRsgQQPrMUkX6OII8cFjCEEsREet/vkq+1AJyr4sRkM65/lSI9bdo/pPP1QPWFS8y6h55BTPLE2LUwPMFGqR2hn8lSuo8wOTEqPL8tZ1lfJmShMKZmed/Jjmdih3DAJnlnIx8SDW+y13LmqPYBmBjyljLG5bHKHl2bGQ4EpY7w7Of5BK5XZ+hb6ed6YmIz4wNpFTIZIdcbPfx25164Fe//eFozxeadQNNUzdB7Y4DWGV95OSqhCiUfIQQH3738U7yDkjOzvn/9DE/roqUq7P6qtOefi7G7SdO75c9Rsc8zFbbjEHvqTpPN2/t0DkaW66z17eaYpr5ieHhjrAMEG/FdqVAi7HuQ=","authorEmailMD5":"95cf4b9626db3813c3f37b2d141b2513","message":"As You suggested, I've added simple application that (I think) models the problem on Gist. The link is in my Stack Overflow question: [http://stackoverflow.com/qu...](http://stackoverflow.com/questions/27527253/whenall-result-property \"http://stackoverflow.com/questions/27527253/whenall-result-property\")","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"fa8ab494-dd1a-343d-80f7-07ff024a6704","date":"2014-12-18T08:27:06Z","timestamp":1418891226,"authorUserId":""},{"_id":"4686f886-d126-3873-802f-f72e366b2d4f","authorName":"vetiarvi","authorEmailEncrypted":"CbC7Dohxo0kv3l4DXiYHzyO+FPz8c+XeBGyWLzcjMmJKSzgd6EtV/eoyVzjG5mG3jXZ7tQdS7KqCC51oS4xqZ9r+vCU26BVIWtbngIDCgmW3u7cgIdEOIQGr231VpRzWdbmwuLDr7+gSiagxRPtp+Byo9+dP3U0RCUdbd7RAcxS9UCLo4T0CEdp1sJDqbHjk/LMtewurHkmpmIv5fCL8/a5XTaF4d0TVlOppqf4LShh1kXc1uJp6sODD9R1XnY+kvBYE1WeNUlNAisB+2jg6BIX8KM0oQrRb794zVdhVCOW3VLqhGvCl2Leh/VAWUBNedt0YdSGogLtz+3uSjzKOoNd4lnkifpif02YyDy4sjLxbfm7tkVBx65Cnd+uMQ10EtcQP9HgvQO2QHWeLT7t9gQ+xy+E4bd054PJ7vRIarhCYh5irUERyO1VFbGYcAsp1BMYJ9iSGuijKZEq4tfEkpkWUmwCx+r0Vg36VjksRWsh/Ca/WV78UpoNb39cNAmYSpm1bRcEFgQbQbyfF7C2WTfs77jOyXdL4nvCnTg0ay0+NjJko54hjIDUir3GvnEZ2JTgrajlJFlDve8qVP/K1qaQ7hhnh6ArfnSPURstB8yR7D5s7nFN2BEFnUbuirZm4s0C9IWm3rAcd+3nzK36kguBUkC+VWd+eqrxiiMxDTvk=","authorEmailMD5":"7b6460d94795ae02211b102b0dfe5355","message":"Isn't GetAwaiter().GetResult() the best way for a synchronous top-level method (for eg. Main in a console app which can't be defined as async) to call an async method?","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"","date":"2016-03-01T08:09:52Z","timestamp":1456819792,"authorUserId":"disqus:vetiarvi"},{"_id":"5a110b54-e282-3ac5-af93-e9b2c6d49086","authorName":"Stephen Cleary","authorEmailEncrypted":"tVyJ01uEJz0Po7rn63DsUAI8TO76IS1SC9JKOu9BWUUNfQsAoX5tmlQ+4BcFQRyH6Ox2KESK42LrCFqBWCrYfMgm4+Y9X5ilRQjL3hSCQn6zXyDVXGXfW1RcR1Oc/5uRbr4JQKsJxXIgP83sfGIZcL+X0Z/vo04GW7R9LzWw0mGRWXYmpceDIePX8sj+w6robsrfjGHi7GqDJfIt5/Us9UKsL/UP4nOM9piioU5TTINfuDkdEEAsurhHh7zAI//JXPAh7GF4yCpwZeE67Ggg2cE4pFK8Xm7+DiUKqdXVJ29Y//HTQZo07pdMHhnfck3rG5Ul/Z6c2rpFHN10YmOgVeuo+7fnkrq6aUO7tWrNzYhFCfRfUwIxsoSI+tx21YEodjTrLHPX0hehGHCpNqUkzXUer1UKwN/ppBJzhoHe2vFSYYbeUG4noRVyMnzCseTbXntJHLncQWIVyJ02RTkJHfmbVcB0+faP2e/7X0oDJZyQq+uZxm+I6nrHWGZz4V0DgQlLi2GCDweo3VpSivUa05bzTtWO1vPJah5K1aTDTspqfQg/TViW4MUvNzMOJxMkXPE0QklgSsNKivSv71//D4/dSWHSAOCKyYnoHjpBuYFzwzZKX9PaPcQeHf6oefATuLTMgrfixbWjlL0HdGbFZJL48g57I8RzaZj6RzJGENw=","authorEmailMD5":"ad2250182ff26a84dda974e50cd94382","message":"Yes, that would be one of those \"rare conditions\" I alluded to.\r\n\r\nYou can either block the main thread (having all continuations run on thread pool threads), or you can install a context on the main thread and give it a main loop (having all continuations run on the main thread by default). One such context is the AsyncContext in my AsyncEx library: [http://dotnetapis.com/pkg/N...](http://dotnetapis.com/pkg/Nito.AsyncEx/3.0.1/net45/doc/Nito.AsyncEx.AsyncContext \"http://dotnetapis.com/pkg/Nito.AsyncEx/3.0.1/net45/doc/Nito.AsyncEx.AsyncContext\")","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"4686f886-d126-3873-802f-f72e366b2d4f","date":"2016-03-01T13:00:08Z","timestamp":1456837208,"authorUserId":"disqus:stephen_cleary"},{"_id":"70b8e7b9-783e-3c2b-8cef-996ae72eb625","authorName":"Max","authorEmailEncrypted":"b/6oEu35pgJ+CgL/cgQ2YbHY3kNBo5PxBT15mcvZeP+VRde7/ccU9MSKXQa/F1p8RfQ7rCS2rxLM2cDVlDFijkRuoptY9f2/r7KQUle8jgEQysVWZxo1UW3vDO6Kadf383oWm47u4DAlpWo8VRIgdqz00HiEy5Pgd7zJYQDqZAOybdraMBFhuefcFa+0s5H1Mfq7FZABY/KCrSRsVRwCnXj5GQsnfN+M3VEvlZAGsmESq2Vq2a5ObUYxoc/bzWxXjtJRsdTnasOewgKlT5mjrXz6EkChM7YEx/IqajneAoI3bFITWWylUhncLrtH6/c4t06pxdmvWJnnbI856ibbWG2U9cNtQNQ2HTTWu2p/wLgz91HNf9mm3YjIFE9jTa4IVjffgyMRJByVi7I33W2SVf4yHCNu0phFUvxkRAmW6MfkOcYIv8Z5suLB5tCYCzSqqNn2vayX+I0lZBucxYb7yYNADXCgeAAJEavY9dCrk6HyhBiT98j8Vmdpb8MCmF8Ag8qyxWBPWKH9KNemkkm7aGSiVy6rAtjHDcIceDggW5/a13CEg3G6LzwpRbN4919TWvVl8fX4davj7UHzwb3ZymDjwiBAWyTS6yCjXNLerimUBxTd5Ub/RS2DSgNPp0FnHMu4qHzDTu6+p0bI8bast6rjVLo5sULWkgfJeZ7nBCE=","authorEmailMD5":"605b046ff2b480851e0607a41ed2215a","message":"Our application is still based on Cloud Services, so our \"background\" processing is worker role, which is just regular thread.\r\n\r\nI take your answer as approval for the first approach, to which I was leaning. Thank you for the quick response.","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"d1f6b5b3-75c0-397c-a98c-218262cad02e","date":"2016-12-05T22:07:03Z","timestamp":1480975623,"authorUserId":"disqus:disqus_tBCipkZ9pI"},{"_id":"95e8a37c-81a0-32c4-b89a-c943dcfae0da","authorName":"Max","authorEmailEncrypted":"NtjFc0DThWO5dbbYWsURzakEYjuPtynADVZnCeZPK149geoXeBLecpfS0ad/5UPGhJo7vD2tcXZ746hvO/8Z8MPbAvT/14dCdMuZoE7phvn8Tzs8eWAcihsqEhLopT4ffXvBvNPyGpAnQp/Ei3wa9Kzc265IEW3wP2VdhgYZST4n7Cti+8I+oBY1KOdbsMFcuOUetILpwh7oK5zavCuUMUkO6XqbTBYITmup/K+K5Pt3Xequi+RLhD3byWFGxfRfFg2YbN8qBdRHz0AG0cb+9tRfXnovaCjLKdRSNOGH3IePP9HMcFa6CGdNNnDJ3OJTxWUt0hrl9Vz8YJLhgYVn3uS1EMYHsNhrRgx7gdUWg3AhcSEahBAfoLaQ6tg84Gben5M/yqD/n7m8lWVB76dVJFF/iN5++p/Hg/bEpo+y/ESKKPut843RvTXuad+SgTTgdQ3OHh2jztzBIKYkPe1HUE8sAaRFRdIUG8TTuUMkJBUcpWRakyd7I4p4K5ztpwVgel1ExWqgcDXp705H7GSPFNLHhdYT2jknDWjVMr9eE3ykcQAQ6mGgh4PbUIZQJnkO4OveLmpoNQM5rGAp6e+1mAGP/Jhwxfl06+Aco0pdw/APd6HWobC6rZcMv9AvOq4mqszg7IVavrx140i1hQ5MvxhEGHT17KyyDU4ixYz1rl4=","authorEmailMD5":"605b046ff2b480851e0607a41ed2215a","message":"Hi, we have fair amount of quite complex code (business layer, involves accessing data base and other services) that can be used both from ASP.NET and some background processing. I don't want to duplicate this code by implementing sync and async versions of it. So, I see two options:  \r\n1. Implement async versions of everything by default, and then our background thread call them in the way you describe here. I assume the preferred method would be task.GetAwaiter().GetResult().  \r\n2. Implement sync versions.\r\n\r\nMy inclination is to go with first approach. It is more convenient and allows flexibility of making decision that something to be used in background process to be deferred.\r\n\r\nDo you see better solution, or potential problems with this one, like deadlocks, or performance considerations? Since there are no UI threads involved in background processing, I would assume deadlocks are not an issue.\r\n\r\nThank you.","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"","date":"2016-12-05T18:44:15Z","timestamp":1480963455,"authorUserId":"disqus:disqus_tBCipkZ9pI"},{"_id":"d1f6b5b3-75c0-397c-a98c-218262cad02e","authorName":"Stephen Cleary","authorEmailEncrypted":"auPl7NV43Vg9R9orG0jc2H7J5KBu6atcVV3MLzUjDUDrywYuke83S4/Hul7Ejr/8LG23WKKUKSeWz1oUb1XSYCIms1MxhKz67WcNgb++zOgL3fuqFfubSP7EiOXtWUmRSgOgdL0AQbZ+Km6dSFIAG9qjzQhOJNa6RaVYNu1qO6/WWqbLVtwHVUnQb6U5cA1LHsZ8xraLlrxnadhL+/biGwE0i+u5uKwjnEuYrc2Twc4GQgHqOOM5pgR/5K0R9tZ5sChcxznmVHpECqDHymmVvS8GjogzQAJO7Gj5WKlPhKM/e+vk1wqoru7Hdc1BNedfUFXNEAhOHHVJXqBc50PE3bdMXXd8SstKgc/ieQDEiX0bRKdu3jVw250zD9TwFO7XusARWkCt4pr1aflU9c9MYkEU4Fe40kb9NtD2Fcn40m7ewwKZMNN482vr6j6/p1ckag/UPjq81QJntb/iXzy8eOn+STTZNJeAQ5WIUDtDZh6Z4IdZPz9uRuPRTBh+/u+2V3ET69bnD7wsOa5mzOZlYxJuZlakD5qa+BaKCwtnyctyugbVpR/zpIaFUpYQcWr1IW78No/7wSVitAA0I2eGl48zzRVqg5RbrZj8gQovIblxdg4IbxUf94L778O6XdtPYmCCBUcUMrHspgADKo7lCt0oH/q1xF9Xi5bMrihrtho=","authorEmailMD5":"ad2250182ff26a84dda974e50cd94382","message":"I would say the *ideal* system would be to only expose async APIs. If possible, modify the background work system to allow async work - if not, you can just block with GetAwaiter().GetResult() (assuming there's no context). Under the covers, the \"async Main\" support in .NET Core and the async support for Azure WebJobs just do this.\r\n\r\nIf you really do need sync versions (e.g., for backward compatible APIs), then you could use the bool argument hack in my article here: [https://msdn.microsoft.com/...](https://msdn.microsoft.com/en-us/magazine/mt238404.aspx \"https://msdn.microsoft.com/en-us/magazine/mt238404.aspx\")","postId":"2014_12_a-tour-of-task-part-6-results-b6e44095-ed73-3545-8772-598d69dec4ab","replyTo":"95e8a37c-81a0-32c4-b89a-c943dcfae0da","date":"2016-12-05T20:44:03Z","timestamp":1480970643,"authorUserId":"disqus:stephen_cleary"}]