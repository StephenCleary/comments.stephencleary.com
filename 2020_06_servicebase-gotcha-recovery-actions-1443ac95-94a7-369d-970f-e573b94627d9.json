[{"_id":"4e0169d0-fcbf-11ea-9631-57118df469e3","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"","authorEmailEncrypted":"QrdZAywKkmu6B5ZTDI3a/86pVO/oakBBFwYtkeVx1DZ2hpbtppX0MiPa0GoO4p4Us8bswMmIQQQM4Kzx3DicpYYcXiYX4AVrS4W+/QjXOCo7FFDUvuiVmYHa+TCdn6fHegoibL6W4ImTbVfZFig5DcqOoCZNs72Q/qp4vyIQqLh+GI6LHEmuvjZvZz4rvz3NZAGsgMARCUO5BrlJXrD+zGO8w/08DEK5Co/kw2BdEKdyZWa6D++XQGk8B/WbDxpg1FOzlYrNBdkZbRy23X+MK0POTwzI6Y91rDk3WHoy5d8pJHXxLv4jYbZm7h0Vm66A78+3j+TBMTetVHN5yTwaoaKV49/vYqya+u1Hqof7YDr+BNTTrJEuWxIdGZtW5aa0aHAMbCmL0tn92K07yc1ib9XEY3/3GzaFdoqm+FGoHu4IkrU77XY5/ysnFwN3NG17vSUG2uh/dSf36Gc9wDfyLawXIHIpiAMc9WGMzUqO5kuJI7Sg4MmelMtK/Xv7rnk9fYkwTKiYqUSHOpo7HUA1rgGldqXgR1eQv8w254Fh3G4zJl1KUSL9qEhthEEJBnNa/xt7PGboJNPx4MBspj1vHtg45N6Wuw8CBGsu9X8cecUZnvKoqriLaN8Dg43uRy0tGtnyZQpBWjomF2pdBVprM5KH85xO3An8xNDaJMVgA1c=","authorEmailMD5":"5e1f64bbeb7c26979840ea986908d1da","authorName":"Corey","authorUri":"","message":"Hi I implemented your WindowsServiceLifetime, but every time I run the program with the inclusion of \r\nservices.AddSingleton(IHostLifetime, MyWindowsServiceLifetime)();\r\nI keep getting an System.ArgumentException: 'Source property was not set before writing to the event log.'\r\nSystem.InvalidOperationException: 'Stopped without starting'\r\nI'm using net core 3.1.8\r\nJust checking if you ran into that?\r\nWhen I remove that line it works, but obviously the behavior changes and does not pass the correct exit \r\nThanks for any help you can provide! -Corey","date":"2020-09-22T10:35:16.937Z"},{"_id":"8882efc0-057f-11eb-a2e6-2905133aa567","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"4e0169d0-fcbf-11ea-9631-57118df469e3","authorEmailEncrypted":"c1gEy32O0JYm8EutpJ/WYUnb76XVpkJi6wBNCC5r0nyfUNR0MOWAYf8NmZMHch2+miQjYmCty25E95H0ajonHwhBW72yLh6Op6pM3pINzOTZDaGZ0Pyn+6FD0fEGHx6snFELaW0mTiglOIs+cTjU4C97hcJeavnqfGahGnsz9EDW47wty20pCv3BGhvVT12hhHUzWbKgKYagwl7eJ0xGljzU1Lu3X9nNhYmGwEHsn09/dXNOB1LzsDQ42NdwaCWy2GoM9KPJG7zhrFtCrFS+Dub+zSsFb+n11zUWNkxhmksHQ7l5oW6bfao1qhgpZmuS8wWfmuRyTBOxnj+8Y4IlfotBlBoB2PSfIYYQvF2x4nmUDToWdaUdVRubzIk+a/qy44Y8xRjEesHbtD8r7GTF+Ud/RXYBAFaXR8LMKRQ9kJJxX7AarzqTKwkoIizSUqbiZ9xaj/WVyjeLgiFAfG7zAcccAoNjbKPowgCP1wo5Y6hFNNQuQZBygCgGNgVr6vM2zcgeRr3hHR2Pj8yQSnyienSirrFWJZGQu+fVAN2bNTCThPjgvKV5toNRVBN5TL+uPWihnNyjkhLYTkuli2lRXCkYMPj6rgXcL7cQ4PPSYWSoArG38g63yrky0FeFU+WI/nXi0+EYt3NschqKpunRm9qjlQhWyYIGX51+lNmsmWM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I have not seen this error, no.\r\n\r\nI'd try removing all other implementations of `IHostLifetime` before adding the custom one.","date":"2020-10-03T13:51:27.692Z"},{"_id":"5bbd4e90-1542-11eb-87cc-8f1892733f53","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Michael from Germany","authorUri":"","message":"Dear Stephen,\r\n\r\nyou have done A LOT to the C# community. I am a 45 old programmer. I started with Basic on the C64, tried some Pascal stuff on the Amiga 500, played a lot of PS2 games, learned the COBOL horror show (but never really used it - thank god), went into professional programming with VB 6.0 (it was reliable and REALLY fast, like C++ - compared to Vb.NET at that time) and since 10 years I rely on C#. Whenever I think of C# Async, I think of Stephen Cleary. At least to me, your name is like a brand in that regard. So...nothing else to say. Once again I am on your website. Keep up the good work. Cheers from Germany.","date":"2020-10-23T15:13:52.021Z"},{"_id":"2f880020-1657-11eb-b2ea-877e283118d8","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"5bbd4e90-1542-11eb-87cc-8f1892733f53","authorEmailEncrypted":"iIktDpDReSOGqtca+zFTrvr0OgZi2itjEgRdiw0H10De17+pzQ1MBwyYAI5Pjqbxxdp0cFAuXJSvRZecLa/1w3ZD6J3sUxXY44SWHQ4kmyOEBSoFnzhTv3s3rMsdXbxc4g9A2Ks0tIjaXt1BevLhNa7Tr89AGSjsiYQ/poQCbvGg3f1JxmnLmzhrQj4D8WwpmKdw37NV+C/ts8AxRJeKFSO5Qx54AKlgIIEEPUfF8utalGopuz7g7xqZHqC4pmsNIob4LaOTL4lOAve8EqYFdE2pKn8PoEAprvkKQZI8w+lep250RpcwZIIzAB9A5FKw1NdUcHea+PuhdyH2pPC+zcPuI3B4k7o/xas4dE7xlZB2mTwuu/Qqige361xR5W0KNWPLV2sar5TmOIUlorT9cUdXZ24dxBPZNQvvcuqDk3D8i9iKlsNNHgDMXfPuJ/9cGNoi2YsTDZjOjYeO3MV4mNg/oeSPnBLWpW3H+ZokUqhq05R2dKQS7KENcr6oPw4ZOOSuHYwdi0TWkY3Aa3rffLTp529MvcO/0WiBCnCL9I1tygvTPGvP+FzNu/5S6aiFJljG5yDlS1szNz9R40hHsbto4KRD4GKdTQZojU4vjSXJ1UUdKcGARLt+O99rNpL51+eTBdfUMFOtdv9nghRnmYFv6j22EGEOE9vZXPARIRE=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks for the kind words! I also started programming around the same time as you, though I was mainly Basic back then - Apple IIe ROM Basic, then QuickBasic on DOS, and finally Visual Basic on Windows. Then I migrated to C++ for many years, and ended up being *forced* to learn C# because I couldn't find a job anymore doing C++. But it's all worked out for the best. :)","date":"2020-10-25T00:15:28.320Z"},{"_id":"74f93ef0-331a-11eb-8627-c54baa791842","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"b62fff90-3319-11eb-8627-c54baa791842","authorEmailEncrypted":"EqJFfxN3bfz6gKMz4io1oBZ6b8Sdcl/TR4lzqh6eaQiBsXNYKBOCnkP6JqjM7EM8l8eEFpD4jqZbArvkgnsHq136BecfSGRAiDYNm54+PohCXDLy0HVkM27G2JS7lMivmn/qyWPi1mSeNHSSINgw0lKGTHIr7KIZT/wAtmeAMYxsrjJCQcG76rQnaZYBF4sD4gOwNsJT1CB4qtGpYDfAdpLE65+Np1A1bvE2Y7aAxmhn+5FPqJ5phvIyy6UsxuJND7W1+9aBO/iP17yfQMkcgkglBoN5Ut+Tnj3QrSHDwh++QS9llNU/hlVNtgVD212zUw4iho0F8MZVjXYoXgcX89RH7cEfxeNY2sElfjc9sUnERgnfnVp+zVFSFuqe2B1H1nu43Vkvylm4+GD1IlnrHtfMTfP6sgT+fHzLEMhKTJ0d84Jtgk1I0gYqOISCj8NpVWYEU7+yBg0tDJD3KYKCdUFxe7lFtSJbPynL+2c4BIjs9JUo4wDKGSg/lwC/KJAqLAusRKxftksXb4YaDZC4YR1PnKM0XfFWXaAB9yF/j0u58TSqovYWllny5gerxmftaYwQ86XJIBEQI0FsnQ2wqYtN8LL9m+ninMuVVexEs95c4TgjJAr/pCXvHQ2Ojv3RuP/tkiV9zPANaZkNW3YJqwOtlAUDsF5NxnUFtHmcKBQ=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"What's your runtime version?","date":"2020-11-30T14:43:49.267Z"},{"_id":"b62fff90-3319-11eb-8627-c54baa791842","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"8882efc0-057f-11eb-a2e6-2905133aa567","authorEmailEncrypted":"YYgh5uoJHHGk8rW/hcUrwKboRRACFvzH9DAr2v7DR65xmwkv9Rcuu9Rlazs3v9xQ4Fxs8pMkx9WYGpV7LkUW3WJH353AD8XCMCIEvBqNEDN8ksmoXrqQOKkNUR3OVVK4uPXZVpHiACHc/MXIdYCTwjY1Mf776Zz7rLSZeuY+7p/UV3IuR7nxw+2tgilV955TumoGH0qZ5Ut3u5iDfmvYSZEwudbdyWf2hlMTlEf8w3IZ1pJ8bwT+K+FfMf7M/YBb3JLNCLsID5qyTUYBSRN/lFdhkhu4DwPFaiq14eMqQqsf9jd73yUG9igpFTaPXdr4YTg2Y5WSxsdKILrGrqvY0UrfdY6qz6+cYh+VZXNK79V8Ll+v9VHoAh8rK8h2Qv8uzk2QFle6yU7PJkqLki/Ug1WuLuFB8PqMywubhoCT5BAFj5koHS1Pk1ffFAqPINO+yVq2TZ7lEhkdaaGxwrQwTz4SMeAneIhmnsNmW+1K5JoHfmygHjy1lCqIMZZ5hfoFzuV7zfUly3qayvgH8MUA8enIHkOIx/xxtiZYl+opKKfIsbHtMI6L1kXSb5xTtb/vAgGPwV527T2Mg/v8Rx83jrJYAmJeWzFx2BeRQS7UFzvXsRTRotb9/po9gEXYw1m9Zv1ay0Wj35/0Ky8jfTddVD7ZORZagnkLqUlFmN65DLw=","authorEmailMD5":"47076f2b88c5ee663bd0df8eb647e6fe","authorName":"Nick","authorUri":"","message":"I got the same error as Corey, removed the single instance of IHostLifetime before adding the custom one but it did not help.","date":"2020-11-30T14:38:29.133Z"},{"_id":"e96b9ed0-331b-11eb-8627-c54baa791842","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"74f93ef0-331a-11eb-8627-c54baa791842","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Nick","authorUri":"","message":".net core 3.1. Hosting 3.1.7 and Hosting.WindowsServices 3.1.7","date":"2020-11-30T14:54:14.289Z"},{"_id":"9d555700-283b-11ec-b469-69080dc81c3f","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"e96b9ed0-331b-11eb-8627-c54baa791842","authorEmailEncrypted":"SDJrp38uKXCM56SjnSq6gexNr+OlCzM+E+5Cos7TSZXqml5OygdDZHwnKU6KjvF0wVVLiKDd5jeSLYCm4cPt1eCYCyM/i07g5RpUWDT278MMxQ84wOY4XtzfmC/E6G4ZW6TfYBVac1jqJJLzpgxki/vsw6nbL/TQMEuP0gmA6/MTJ2OJ2BXexKqEzh3KYmmZeQtCoyVrpxciip7DuIks7/tIqj+QRnr5EOHuWG2NTmSfjHwCTdIl9SvapH0qw1367eGTxsJkKSfxUFRTuvfArF0sGBSNiDD2D6z6OHSIxVe1m3wNrJWd+pZkNn/YV9z+uhWVwqyHYVYp2xG01I1r5HcrPqKXDyZ1uEuIEbjlwet7N6ohVvOxcFiThKfA4C/h06ZvjN8+HcDiCXbyAa50jkUdmCOjNXI9l9ZN7BT64+Y0V3bvDubHj7LdAbgYsgIHB4HpQnaxpTEff91HDnT8WZosOwIp2//aGej5JV5ekIZi5YqngBB3drMBlbyCYZzVA8EDcEC7Jka2P3MvMAxE5DZhNtJOx/HrTBxyJKRFJAloOX/hi9jplmq6ZDuUjm4lV89hRbKKSd/PMvcX/PJKYE4P9PtSt0d6nxDZR8KWHuFVVCEZifJV3kob899c5Pa0lMCltonTz9/m26BUgXcD8oZQtOKo2yKU1BzzRIYA07c=","authorEmailMD5":"ed7695df3d199d694d048653b78e692e","authorName":"Todd","authorUri":"","message":"Nick, I'm getting the same \t$exception\t{\"Stopped without starting\"}\tSystem.InvalidOperationException.  \r\n\r\nTried this code to see if I could learn more:\r\n```\r\ntry\r\n            {\r\n                host.Run();\r\n            } catch (Exception ex)\r\n            {\r\n                Console.WriteLine(ex.ToString());\r\n                Environment.Exit(EXIT_CODE_ABNORMAL);\r\n            }\r\n```\r\n\r\nThis produced the following:\r\n\r\n```\r\nCannot start service from the command line or a debugger.  A Windows Service must first be installed and then started with the ServerExplorer, Windows Services Administrative tool or the NET START command.\r\nSystem.InvalidOperationException: Stopped without starting\r\n   at Microsoft.Extensions.Hosting.Internal.Host.StartAsync(CancellationToken cancellationToken)\r\n   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)\r\n   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)\r\n   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)\r\n   at JobRequestQueueConsumer.Program.Startup(String[] args) in C:\\data\\gitrepo\\JobRequestQueueConsumer\\JobRequestQueueConsumerBackgroundService\\Program.cs:line 26\r\n```","date":"2021-10-08T13:28:25.130Z"},{"_id":"be2ff170-283a-11ec-b469-69080dc81c3f","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"e96b9ed0-331b-11eb-8627-c54baa791842","authorEmailEncrypted":"bgt5rm0LctPWLZiefum1f/TvMtAIvqss3CLY/6Yefs9sSR0g4oN8vjDJV5J0M2YEQLZAXgjGRwROnHHm3GtRqzuvmLebmrygXi9WoWUOY1tB3ile0vi396ORmfHtvqYVWwayhM2GNB1ccW4153GI3aergbK46/q+uTR72Dwd4uAb3r+83Xdy3CW3aTDxBW4a6eULrpkIyXBYobol2hM5N/zjno3YYHfjooGaDdmp7S4ZS0+5W6w60RSz4qH/Ll0nYZ7cS/A476/Z63Rblse4x2yN2ZpOoKTJfIgjlSGGBaRjpkzE51ARoukMBlG8ncnGKvXszmI1qtEYfdfrMU+73FzeMkkiVmJrebg6Ai0txzP3PIM3pMFQGrjRGoJW88vYK47B/3kSwHfoZzx140MadR8r5PP9yovyLLUNcnNEtdyfkbBgh7isT2Ldt9aKrQ/78+8gXKaS08msePFvOQTh3DGl9PH11tOKVSsK6jg5iBNhhrQEtoPNazyT1nLNMNG/LXEG6wgCp7OT4gQIQoq8dlJY+LN5kAqpiMFN6jTCRSEQg3ojK/JLkMD/d7Ghbeu2a6pwcpQXRClaYwj6vIvf2ytHpSL7DaZehIjNgzvfdqSeio31HaOlfppGLUc81eT/Ca2IciQVw6Y48WgzBHxIS8nWPfKKhlUeY0FGMk4rDnU=","authorEmailMD5":"ed7695df3d199d694d048653b78e692e","authorName":"Todd","authorUri":"","message":"Nick, I'm getting the same \t$exception\t{\"Stopped without starting\"}\tSystem.InvalidOperationException.  Did you figure this out?","date":"2021-10-08T13:22:10.784Z"},{"_id":"fab202c0-1d51-11ed-84cf-2f4f292a5a49","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"This is so useful, I'd never have figured out how to get service recovery working without this!","date":"2022-08-16T10:55:45.584Z"},{"_id":"f77cae18-323d-40b1-b068-b2e81678feee","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"fab202c0-1d51-11ed-84cf-2f4f292a5a49","authorEmailEncrypted":"aqKK/4wQxligtB+ss7B6KQeUDzKRtw158gW5xaHG6ba3rEkYXPmEcqYkvRniN31KrqkvwmxBPa7XcTkkfepUTu7SqKNHMOZWt9L7U/OYgRPbdYxamvSpPABYv6iyNYUpG5FguaY7zMWE1Nmiij5mXk2HHEKsjV6DqcnS6Fcw5kBWZmMpns5vyaKHT2OttdjHlIUdW5eKEh06Vl7J1yol8gmSY5knif/flRLFBIAjrw3b073Eihtwjwyd+IMuMgZMJI2zsiwYqIrQ44HqGtJ1iGx4YWfcy0Mj4B4DGWVI6aUTCFbmLadojvvpvmCdXU15OngUhEM70v9yseh7WzfJeBHmXpSxPC4md1eD6Y90LU+43B3H2Hp1MH5S0OYeM0itT9yNaRYEXNindd4r3E7jc75+EwrINBe0K+k9jHLfmYtEY+CrZciwl7Ko5sKCvjD2T9cExAA26hvgTos9dKU3K1G6xeMGns+iKm9b1AfTgYkGMOzDnJ/1Q2OptxcLJEotlXwPN4Zp5qfYQZOMoIcGxWdUZmD37kAiIszNzQEzhJVc4fjNRi2DVX+v9LhznSb8g3y15HAjTrLM5aBmiAw01wtel6+HDYLC1woGncEo1uEn4s/QS4p33hLpmlI0NJbNXvf6X++S0Qwnx5huCIB3gOI0TJncypffhE3NB/eD80g=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I'm glad it was helpful! It took me a long time to figure out, so that's why I decided to blog about it. :)","date":"2022-12-30T03:11:28.0750860Z"},{"_id":"0ae02a4d-aed0-4537-a7eb-b0ca3a21af16","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"9d555700-283b-11ec-b469-69080dc81c3f","authorEmailEncrypted":"VrVYLiwXefb0qH0uNEv+fAbta6UQiSlkQd5xBdfNi4plsjFmgFVy6ogFubTanhQu6UePhVG+CukRZbjdHp55AdGVvpEGLR+dEMDQYlhnusBp2W2isJRMVRrzux4zZU7o90n1m5HBNxMnBNZO2q02mAoQcR7MsInjFUNniVpZiSmwiq+rBI/GEljkhPyMyHcQfCvLYaGhm9CVUKugu+7z1fF57mwrnWYhvXBiKNeCpVVCVrj81f4fSbE3YLcPM35UP98VGqP7Of/RVpmpuy2WP2pp2cN4AqdFwK3yKPRWBDUWjLycCvWAHy/5T6zIOFe/B1bkw/wih/cqh8n06eHyO92GlspxYaiqlnIZB1XVVBXAp28QfGia0xTnlWeCgUR2a8xOr6giaj1ZwtA/UXFhqtIhbBXWQUrzLNzXz0DGWQp2FwEuzRDTHHW/hlLnOsmqg8dp+wzIFRYNnKf9hvKb8SyfKYEDgcZMMqX9g6yDrO/zjAJj5Gp6h1VfiGD5B8OoBL2pa9TvSRO35q5lwHWNtPjBuEYN7n3L6XGxdoG80O2kYNBScHk8WxQtJmsyEZ2wCugQaz82ZzyMUTYnR7fa2jSC+th2SDHi2xPP1Vv3lq3zLIw0BeFNZqqayZOuOx5Vg41kFwD3f8hlM6/OHzTPSksXc49a3H2H+1b9ye7KQrQ=","authorEmailMD5":"45f1254ec5e81d5a52d6a0485e01ad8a","authorName":"David Hopkins","authorUri":"","message":"I'm seeing the same symptoms in 2023 with .NET 8, `Microsoft.Extensions.Hosting 8.0.0` and `Microsoft.Extensions.Hosting.WindowsServices 8.0.0`.\n\nLooking at the implementation of `IHostBuilder.AddWindowsService()` in a little more detail, I see that it *conditionally* changes the `IHostLifetime` from `ConsoleLifetime` to `WindowsServiceLifetime` if and only if the application is actually running on Windows and its parent process name is `services`. This is what allows the service to run as a conventional console app under the debugger, but with SCM-compatible lifetime management when installed as a Windows service.\n\nCalling `services.AddSingleton<IHostLifetime, MyWindowsServiceLifetime>()` overrides that conditional check and makes the application try to run using Windows service lifetime rather than console lifetime, even when launched by the debugger. That's what triggers the exceptions described by Corey and Nick.\n\nI think you can get the desired results by calling `.AddWindowsService()` as previously described, and then running this code:\n\n```\nif (WindowsServiceHelpers.IsWindowsService())\n{\n\tservices.AddSingleton<IHostLifetime, MyWindowsServiceLifetime>();\n}\n```","date":"2024-01-22T08:55:24.1308788Z"},{"_id":"b2695127-fc4b-4942-9843-434fe9c982b3","postId":"2020_06_servicebase-gotcha-recovery-actions-1443ac95-94a7-369d-970f-e573b94627d9","postUri":"https://blog.stephencleary.com/2020/06/servicebase-gotcha-recovery-actions.html","replyTo":"0ae02a4d-aed0-4537-a7eb-b0ca3a21af16","authorEmailEncrypted":"TtuffaE3Xfn/5OpKHpR3kve0qP2Ok0k/102lH66xR9vv1Gf/pzuajzic9Iym5d9h7lrv0EMdJ8CHOv1QCmuZKuD7nZDx4UbKHseINPPdxLf7HPVeNYWa1ca1SFEU+j4mxuwCmAKC4G7JuftocsQV+6RZowU82+XM24n7dqIB/+krWSAPyvmrX1jqSoX+cqBsEeQRf3iA+tt/MTT2OpxkIbfnDo1n779vU7ORgBGvol4BPv7q2p3PQRDDtHEsfBrdojJqsL9s0Hmjh6sLHTTLVmkbCpEDdu1zlgnvQYw4Z+A32t9joa+vNS8y+oAFR1nC4k3bFafuU4kAPTBn/gR9FZMdeBIKg6mhqHbygLWwznSNpaBBbuVhKupiJPY73vN0Veh48K6sgPVE4VKb3m7h1quEUq/uT/yQemil95ElNkADfSkE8qWSxgx6K/088g1lmMlkZx8ZnHRscBX530Dj9yLdp2ffj8h9SbQI3eSKTZXe+Ls9w86dxKMcWH64zlDozZymq6tNZg0NSMI1dLNLertjLbejxKrUowMFbEgIOHWMHFNnmQeGG5Ut5Aoh+GFn7SdORnQtxXaLG+2f4T96rW+QHRnukr55KDRxDKteTgoJk4pNk67HSdH9XgU7QtPTWV5xtYVD0p2AYKdJxGuO6n2vVRAKYw+R3NeGH3s8MtY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks for digging in, David!\n\nI've added a note to the main body of the article.","date":"2024-01-27T14:16:27.1102007Z"}]