[{"_id":"98d753ac-eb3d-3863-9a76-7134c45d03c5","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Unfortunately, I've never used ChannelFactory. I would take a look at the code generated by VS2012, and also see if svcutil has some options that would work.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2012-08-06T17:23:18Z","timestamp":1344273798},{"_id":"dcfc7462-9f13-3210-8922-83eb4b738520","authorName":"Ahmed Ghoneim","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/04493732797018605088","authorUserId":"","authorFallbackAvatar":"","message":"Can you add a ChannelFactory based client tutorial, I'm having many issues as I don't generate the proxy via Visual Studio 2012 RC","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2012-08-06T03:02:22Z","timestamp":1344222142},{"_id":"163d416b-2d22-3055-8304-32356398a0aa","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes. Real-world code would probably not use StartNew or Run at all in a WCF server. It would deal with tasks that represent I/O operations.  \r\n\r\nI find it easier to deal with the exception translation at the WCF boundary, and have the \"real logic\" in other classes. In this blog post, the \"StartNew\" represents that \"real logic\".","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-07-03T05:39:32Z","timestamp":1372829972},{"_id":"56cfee55-b735-35c3-8df8-f4cd15ff5cc6","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"why not just return Task.Factory.StartNew(() => numerator / denominator) instead of awaiting on the task. is that for materializing the exception and wrapping it as a fault exception?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-07-03T02:56:38Z","timestamp":1372820198},{"_id":"209f7521-cf13-3a06-a30d-187acecd19e3","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Hi,  \r\nAt client side Instead of CallCalculator().Wait(), how can we delagate result to another function( like old callback functions)...  \r\nI try the following,  \r\nasync Task CallCalculator()  \r\n {  \r\n try  \r\n {  \r\n\r\n var task = channel.DivideAsync(10, 0);  \r\n\r\n task.ContinueWith(OnWorkCompleted); //You should see result at OnWorkCompleted  \r\n\r\n }  \r\n catch (FaultException ex)  \r\n {  \r\n Console.Error.WriteLine(\"Error: \" + ex.Detail.Message);  \r\n }  \r\n\r\n }  \r\n\r\n void OnWorkCompleted(Task task)  \r\n {  \r\n\r\n var result = task.Result;  \r\n\r\n Console.WriteLine(\"Result From Async: \" + result);  \r\n}  \r\n\r\nIt works but if we try to divide by zero, I do not catch any exception at client side.   ","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-10-10T14:57:24Z","timestamp":1381417044},{"_id":"7ed4c3a8-01e3-32f1-97e7-28175823de66","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Answered on SO: [http://stackoverflow.com/questions/19294372/wcf-async-lost-exception-at-client-side/19295798#19295798](http://stackoverflow.com/questions/19294372/wcf-async-lost-exception-at-client-side/19295798#19295798)","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-10-10T17:26:43Z","timestamp":1381426003},{"_id":"1e453095-7ca4-3a19-9269-7c19639d8dfb","authorName":"Exploration","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/02883173275073527457","authorUserId":"","authorFallbackAvatar":"","message":"When i put this in my service the EndCreateTrafficAlerts method is never called. When I set a breakpoint on the callback(tcs.Task) line, I can see it get hit but nothing happens.  \r\nIn client;  \r\npublic static Task CreateTrafficAlertsAsync(this Release2Client client, IEnumerable trafficIds, TrafficMasterAlert alert, Release release )  \r\n {  \r\n return Task.Factory.FromAsync(client.Contract.BeginCreateTrafficAlerts, client.Contract.EndCreateTrafficAlerts, trafficIds, alert, release);  \r\n }  \r\n\r\nIn server:  \r\npublic IAsyncResult BeginCreateTrafficAlerts(IEnumerable trafficIds, TrafficMasterAlert masterAlert, AsyncCallback callback, object state)  \r\n {  \r\n try  \r\n {  \r\n var creator = new TrafficAlertsCreator();  \r\n var task = creator.BeginCreateTrafficAlerts(trafficIds, masterAlert);  \r\n var tcs = new TaskCompletionSource(this);  \r\n task.ContinueWith(t =>  \r\n {  \r\n if (t.IsFaulted)  \r\n {  \r\n if (t.Exception != null) tcs.TrySetException(t.Exception.InnerExceptions);  \r\n }  \r\n else if (t.IsCanceled)  \r\n tcs.TrySetCanceled();  \r\n else  \r\n tcs.TrySetResult(t.Result);  \r\n if (callback != null)  \r\n callback(tcs.Task);  \r\n });  \r\n return tcs.Task;  \r\n }  \r\n catch (Exception exc)  \r\n {  \r\n Log.Error(exc);  \r\n throw new FaultException(exc.Message);  \r\n }  \r\n }  \r\n\r\n public bool EndCreateTrafficAlerts(IAsyncResult ar)  \r\n {  \r\n try  \r\n {  \r\n MethodLogger.LogMethodCall(\"Started to execute method\", MethodBase.GetCurrentMethod(), ar);  \r\n ar.AsyncWaitHandle.WaitOne();  \r\n var task = (Task) ar;  \r\n task.Wait();  \r\n var creator = (TrafficAlertsCreator) task.AsyncState;  \r\n return creator.EndCreateTrafficAlerts(ar);  \r\n }  \r\n catch (FaultException)  \r\n {  \r\n throw; //just rethrow  \r\n }  \r\n catch (Exception ex)  \r\n {  \r\n Log.Error(\"An error occurred in the EndCreateTrafficAlerts method\", ex);  \r\n throw new FaultException(ex.Message);  \r\n }  \r\n finally  \r\n {  \r\n MethodLogger.LogMethodCall(\"Completed executing method\", MethodBase.GetCurrentMethod(), ar);  \r\n }  \r\n\r\n }","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-10-25T22:24:23Z","timestamp":1382739863},{"_id":"1958e4e6-5f67-3da5-9c56-84b88d03b103","authorName":"Exploration","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/02883173275073527457","authorUserId":"","authorFallbackAvatar":"","message":"I figured it out. I was creating a TaskCompletionSource with a state parameter equal to the this reference. (i.e. new TaskCompletionSource(this)), instead of passing in the state object like this....new TaskCompletionSource(state).","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2013-10-28T19:11:03Z","timestamp":1382987463},{"_id":"fd6be2cd-6f5e-3118-9ea3-1b69afcf2828","authorName":"merdan","authorEmailEncrypted":"vS057IDgZbvV3FUZyq28bCQLxpulsk2s6KZraV3fMV+/Zmr9KqTKD3PVeoAu4GgNPPghO0HIzK47zldq59pMJTGH4ci/CwuAfwW+mR99NwCtRC9rClnTIxD4a7O6folwDNWFirfHBHUqmNhafRu3FaCZQaT5coJTBnEC82mXTQDS+5Yoa1tK/9Z9Y8+rAPl8Y/bi9lxeFDLemvczGK9NZUYjgCrrm57GX4tmXF7sDL0TJBmDiRvyrW/Ogl5Wa0arVcRpQ8DwdObGiIs2rj6Y2XVc/DwQtpwJF0DOeFNFNH9xtSsTgSe5w+p0bw2iYDgG6rSIiQvyz4wIuu0lvCN7vTRf23fjAMGy/HpzdNcbUx0EFAaCcJ6fdpBug+dChNAuis72ypERD1Mp/boY+zziCFLgI6YsYLUJfNFHShYH1P10mswHHjstzAo9QoWSkligL4fbnMu2TpX5YFp3XnBsB4CYB0317/TunJK41mDcO8g1T7yzMxS8IA6LuO3bkJ/uplm+rx3lK4ajBAeJiiFphdpfAqCYxd/L9432FPkzBbh7hmpcmC16CAhByvj6TqO7Q4IqwEU0xCjhqZZYR8g3HzODYkr02+llLPqFHtIQ9FHwLEgxqI1Ab/bKJiMPyyOcXzhzqoRUP7vxP3j5QZ3jfAfLf4qyCF9XhnZcc2TZXgM=","authorEmailMD5":"27bf19f660f6ddf41e1aa042b9f8b68b","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Hello Stephan, I am working on a cross platform project that targets WPF(Desktop), Windows Phone, Android(Xamarin) and iOS(Xamarin).\r\n\r\nI used TAP pattern as you described, WPF works with no problem, but mobile platforms are not.\r\n\r\nXamarin throws SerializationException, saying that: text is retrieved instead of task, Here is a qustion in stack overflow : [https://stackoverflow.com/questions/25376930/wcf-task-based-service-consumption-in-xamarin](https://stackoverflow.com/questions/25376930/wcf-task-based-service-consumption-in-xamarin)","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2014-11-10T05:25:59Z","timestamp":1415597159},{"_id":"b9c33e92-1c51-3e10-9784-7dfb34e2890a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm guessing that Xamarin does not support using Tasks on the client side. Try using Begin/End pairs and wrapping them into a Task manually.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"fd6be2cd-6f5e-3118-9ea3-1b69afcf2828","date":"2014-11-11T19:35:56Z","timestamp":1415734556},{"_id":"fccc702b-7bf0-3bbe-b515-fcfb0af05216","authorName":"merdan","authorEmailEncrypted":"FjtRQ/mDxQ7buQELyKf/p2Hw1W01Xzq8GNFdv/U38xOjOggRb3rmnuITTyZkSYUIZ5HF6lXeqEH0PDlKiebVH2DkehszRPMqapO5UHXEg6rIMVe7jut+4dKpk6QZcQX2/GQvb3aq4gUnl632HYquxgUPllYfvSRKcuQeitr23IBjdJyqQrn95xCnANf4zCNbF96yIDDu0GHFofv/AUO6ScofVh/tsY8ZHRkMrZmKaM5GZYxGQ2zsoMVqOeeU0+/OjWGgXrPCUonkumoKj+BYi6ppNcPQ58aAAAfIuJoQ0Z4vFlGcWEoiirQUALVGasvoYqKY441V2k3Y1XHURAlANr5uniWgb4W6Hh7raIZVxHFy18HFPUnQ/Z8+MBU0lYtnvpG4TUe2juZhT0JIgbec08+z71pydGEZyufAQkSJF8OilW/SSDbpPmnZQTPfAihq9UZD5xeiTUdABsHhy35nq0VIURn6oOtqC1Zf+1mYAn6oWXBxJXPSBRpRcKOt932YOgKgK8f/+lExDUfypc/KVCbvVzzt0avi69FBxX6gpx+8bD950m+GNwpikC3dWLsfg+P/xirotIa+N4hkgBwNR5Utbzwkwq0XSBGWVnvWE6BNlK6JS9m9CpNR+Tkco3vmIHQ0iscOUp56xOnZLFl5YlEq93S1ykIFixTXzt0u0qg=","authorEmailMD5":"27bf19f660f6ddf41e1aa042b9f8b68b","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Windows phone application also throws System.InvalidOperationException.\r\n\r\nAdditional information: The contract 'IProjectManager' contains synchronous operations, which are not supported in Silverlight. Split the operations into \"Begin\" and \"End\" parts and set the AsyncPattern property on the OperationContractAttribute to 'true'. Note that you do not have to make the same change on the server.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"b9c33e92-1c51-3e10-9784-7dfb34e2890a","date":"2014-11-13T07:14:58Z","timestamp":1415862898},{"_id":"934f3e48-53f8-3747-bacc-4a76de24c838","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, but not in 2012 when this was written. :)\r\n\r\nThis technique is still useful today for platforms that don't natively support async but can support it if you have Microsoft.Bcl.Async installed (e.g., .NET 4, WP SL, most portable libraries). In that case the \"Task-based asynchronous\" option is greyed out and you have to do the wrappers yourself.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"aa420480-3d8f-394a-b6f6-8555487ec7c2","date":"2015-04-15T14:27:55Z","timestamp":1429108075},{"_id":"9ac851e4-94b8-34a5-9a19-3db28da11ef8","authorName":"elish","authorEmailEncrypted":"LDxYf8CbKV/IQh0hgupUCDvnsu3JVkaTKIiQaLN8mScURUO/akDjsKyKBaU8nOhbBGG61Q7WAxq9XSwQUf23P2SUga6zjbBtXALguakf1uEz91ZEwnKxQgDAz6w2rt0fT/ghSXGt3U1sXRLo5DoAamQpyVB5XYb7RvdLvdtxXytisoP+nHaCu7lh4oV1xn7HJKTc5Rfu+0y4eVjcGWMUdLONzj1r/uN4vPUTr/k8vfOk2jifefwZ+NiAF5P23bvlJCUXcCXoOty7l9+T4A/Z9uNjvmNGz4aKY8DpnKeixXcvBkvom59OxJammuqjB3lW4zrzHszcvpKj7FYzkUa8TUjXeBfHXoUzXiXf5YTS2jMqeVqquvkv0ylgi3OUQpypgZkfvqKVCulfUaB1fP7qaXyKCfuPDKkIzqTINi1VDkBrwcyMw7KDM0vwJF57VDEKyAiMsuVlyPw2et58Mr6B2OppqG4PR1r3aEPcDZbxyGQYEaVcoIRfAFd3m1TUdJDAhKLxKzQIqAr3hRaFywGp02MC4mynR6guxh20GQ4BmQeFhTe40Nzc7YafB0SfE7W4dvvu2wEHTuEFTdi7CEQC1trrWqrom7Mcem/1PNmDt1z8VvoKqzDchEdfHZuUaC+OgnkbjilBniA2NgJaZm3neuuGtpvhPiTEp62G+GY4z3g=","authorEmailMD5":"0238e17d220b34fcfb0f494f9f26ced1","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thank you for your answer:-)\r\n\r\nI understood that it wrong to leave the mexendpoint in production,\r\n\r\nDo you know why?\r\n\r\nIf this is true then I can not use the service reference because without the mex I have to do it through the channel factory and then I do not have the generated async operation...","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"934f3e48-53f8-3747-bacc-4a76de24c838","date":"2015-04-15T15:31:50Z","timestamp":1429111910},{"_id":"aa420480-3d8f-394a-b6f6-8555487ec7c2","authorName":"elish","authorEmailEncrypted":"jIQfep0OcbnSWnZbScYyV2ZAssFr+UyeAFY9IOBp4bC6mweSEa/L1rgozD4oeOIVNake+ynwhzyKR3YC7a0b1ifzWVC5HmvUruKO99HtmnLygDRi6P119zJFCEi/ul19oHHesi7L8/x6oKsJDXJFkNpwrbsuQfZ/skunM5yJBfLLW8x4FlCZOt15fQQoqXWPW/Qu4QFgcYdTuVGEDo5mrQ+i9FgPx+sorKRYoXtr1D28UC5urFWcI5frElEtFJF9Dk09bE96rQX6J+C+/uFn80llRk5pQhPTq81p1EDCwyy+bz1mN/8//UergK+MLwrr6632R9ZwyIkwYZQDlGJRBZyBX4NtHHrvl35LReJmS3LyGG/FCJZwOQQdOyRxS3UfdB/ul1ETijmL/xqHYceBzykP2bfCyBkPFKs1YkkJUop6yMvqY2LJjaiSMUE8MLpIsumdB0ZrkyJunZ6vTbRVzpuRKBUVlY7LbaoS8NsCnEi+nBH5q7rpA0KRJF+P/7AvMInW+TIoE5vfc7lOthe5siN05JbKcGb3c1C/PXcU5VKKEXg8yh4hhoauyh8bkUJf+pewfxSRpxvDel5HJmI/PKt+YkMJJGSLo2Avk3A28oD/jyY8Y5W3jjK6fagT1g9kXlLSSV/+aQsSzf4wIgT5+UEi1BDkgUG54F/MyrnhF2k=","authorEmailMD5":"0238e17d220b34fcfb0f494f9f26ced1","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"You can do the same thing by adding mex endpoint and use the async operation in the service reference dialog?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2015-04-15T12:52:24Z","timestamp":1429102344},{"_id":"b8fb0272-36fb-350b-9c6e-f94289be2f31","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm not sure that it's wrong to leave a mex endpoint in production.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"9ac851e4-94b8-34a5-9a19-3db28da11ef8","date":"2015-04-15T17:16:53Z","timestamp":1429118213},{"_id":"cd5cdfc1-095f-3d68-86a0-c769ce381d9b","authorName":"elish","authorEmailEncrypted":"CVT6yo206lZ081YFZHta8vsE4a5jXqZN6NKn2E2FqVW7pamMChkKTDEqYDVv2rfhjVNGmpGzluC3X86L20DPP6ITKKoFUPGATMo5bImwfOyW97hl4yTxABWmBlOfjSTm83NIlKsohL48LRQ9jFMqLiS4PCjHoTXLvcEls8xA9lLQs/LoklKtuX/OtjRfFm4Kv+MPERag9Y6ISE0PJ6CTuYDIthMGuM2kPfDpZ3Y6DjwJKHH/mmSJuOfEP9rkX8WDzoAqFyj+V69NdowUZa25S3hlRWUEbEQ8y0Mr2sLbvtxGRGrUXvbVcUSu7TMijC0wZ3b49ljpbvJHqLqniKz+yyhf3qNxJWqbwBcfxo3OajDZjHcgsW2SPscD9W4uxcYI/zj6NG++mnO8qEvSqItHX/2dY5zZRXXjBek9JcDc2xh3mrVDgiH2SrV9o0lGMyLawk2fc0DtlrIXC09Oo/X12KSx/bSyxoxviygZLRntI5fJB2pvNeH1OC16oB8X+WKnahMh1LqEen8/hvD/PVLayNCpC363gvnAtYC1qBOHCPPoaRRULKC/AubVM96wFmcsxOTrNmxShJrZWGaI0lumesNyMpvcnFRT6SMNgmdNKOpWTGnGxrJGLgILE3M2/37WoBBGtYiZtRh/SgSwDO9pVqWT2RPdPNppIum/F8+S5qM=","authorEmailMD5":"0238e17d220b34fcfb0f494f9f26ced1","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Ok. thanks","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"b8fb0272-36fb-350b-9c6e-f94289be2f31","date":"2015-04-16T07:26:24Z","timestamp":1429169184},{"_id":"32b03e4a-b576-3016-be6e-38ee6781a226","authorName":"Angus McIntyre","authorEmailEncrypted":"iRaZ9cp24Vqk8FDBdjUsPH57wd3MeGbTIAVL8rYR0JGLLV8UMHAqPplgFdLtl4uJeCgiXQFRXIjB7Zs2fZOIHP0wXxdNtuL2FpBBe17+KUzuMJR0VA0xkrYEkgAYlXM6n3chOB075IL0rwbQSImC8A+h+6R7OyV1DYVJgP6n2sNZx+oOs9ENdjPxlDeQSpIRsBWz0YRf34X9UMwAhevNQy5kP17NUCdRfj92hFmfRPjtFaOQxzRgODx6+ueLTnIHVFNUfzGrBQmQwTvFX7rGDMetBNPGdz3tm6j1c3DbxuY/G/u1nb14NK9ecssC2as6UE7RgpNi7osYAXQx2mrYSUQ6znbeDRchtArdm/mtF8LOXNd+uKiqZVPsbq+NzbOmoUlf3x5UMkxcuO8w3Cxes9GVqyGNT2Xnlgz0C+B1wXuB+55I1Z01EwB6fvt25nuJlDgzCTokL4EGVIcIQV0SvDko60Ixe3sOqJyw0eJW42ojq15b+w5hS0TWP7FRLrzDZHIZ7M2jpx8RNrBa2bdB7YVzYHu8XTkszxODlozxzAzlyoS5+7WHkh9B7zkjc9zfqF00NSNUTjbDAXi6QtVWcB/Ep5rqnPl/UFu2fiGJyoiGYNQdaSFmqYlPPxWwBi+wSu/LtIhxqNppOS87kFtSASmteZrtP6LEWzMQYhYLHaM=","authorEmailMD5":"23c77b53e35bfbd64be2f047a3d35582","authorUri":"","authorUserId":"disqus:angusmcintyre","authorFallbackAvatar":"https://disqus.com/api/users/avatars/angusmcintyre.jpg","message":"Hi Stephen. It's great to know that this just works but I am constantly aware that WCF services are intended for consumption from any client platform that is WS/SOAP aware. How are operations that return Task marked in the service declaration?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2016-02-25T11:46:14Z","timestamp":1456400774},{"_id":"35a68a95-ebf1-3852-ba53-1b861b28f9f7","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The Task wrappers are stripped from the service declarations. Logically, from a client perspective, a service returning Task<int> is the same as one returning int.\r\n\r\nAsync is an implementation detail. Clients can call any services either synchronously or asynchronously, and the service can be implemented synchronously or asynchronously.\r\n\r\n(The same is true for ASP.NET technologies, too).","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"32b03e4a-b576-3016-be6e-38ee6781a226","date":"2016-02-25T12:28:24Z","timestamp":1456403304},{"_id":"14ea8a80-cc53-3a3a-ab72-b1cd457c4087","authorName":"Angus McIntyre","authorEmailEncrypted":"pPEyCKdh30UiZ4bCKGZ8e7duwd1xX49zAWGrU4E40l8wfOWlNka/sC2OB0DQvuTDZv4WKDNUTIM6yEAmNiYYpO+SV75utQFGNC7dqevw++yg2nRxhnPd0kcwBBc/3QD+qcNdXq2djjAmrxcQ4WlTbF5w+PPf7BZn2Un5iay+lsAmEV+Dyj6CDfiXCOP7Be/BMqW0034AIXFjOCyl4QmXt6Bii+pZZOA/EVpiUj5cYD3T9HDhkfSDOPkp3TNM+UxpRA/8FncmfiF7dM7YdOGAEfn9ph5xLpPFndkMz34Wlds+UrhvEeirNfvPt+1witn8qIBK25o8+SMojuUPLpkJPGSpuOD4Q88rj5Yl+yckNv2+VqhSgIxtTSIKaUYPAEwM8OtIuf2odGE5vPTkxShWqLb8DWx3F3i9X441uDs8EaV2WDSI1m2MJfbISo9OFLOMafkDNhdgSrP8oAv54O4ebn49lOZDmDFqutkhtrqGXLP8Xv9paISIb01aDMxNbfKiokOV8xPmjfq7Ddx4PDSHMHnw+22teCSApTMRCaQ/t7LbSHyqI2/5kUPzSmpaDGmkugNk69/MMtr8x1sozVafUk/p5LrXj4aS6kWxfb8JcZqLs5D/rlXAWf9D36PH7JAkd3vcavl0jffKQX5VG5sMJRTZKW8ss89f8YkH7+Dd02o=","authorEmailMD5":"23c77b53e35bfbd64be2f047a3d35582","authorUri":"","authorUserId":"disqus:angusmcintyre","authorFallbackAvatar":"https://disqus.com/api/users/avatars/angusmcintyre.jpg","message":"That is great news. I've been working on a client recently with lots lines like await Task.Run(() =>service.DoAThing()). I can now update the contract without fear. Thank you for your time Stephen. Outstanding information as always.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"35a68a95-ebf1-3852-ba53-1b861b28f9f7","date":"2016-02-27T15:20:09Z","timestamp":1456586409},{"_id":"1a1be2ed-5ae5-347e-a395-020e0c172cd1","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm not familiar with these patterns. Do you have a specific example?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"ee054204-cf75-3e63-a4d3-c846ef3607aa","date":"2016-03-24T11:12:21Z","timestamp":1458817941},{"_id":"ee054204-cf75-3e63-a4d3-c846ef3607aa","authorName":"Andrea Ceroni","authorEmailEncrypted":"XC8dDJ7AwOqk3kJORI6jdU5TxWWk/1rul0gXXPn4zsu1i5OBE1NppizmRRjMOX+pz7elium6DGCy28ERICjeTsK0AFYjf/SU44FTEVhs8npILSjt+sMDfNra2/YU0pDJ1DX5odhcuem0p4UwRqDKJ5R11PTknbrbzhVmYu7M4c32+imbIDL4tRyG0lVJi2YIgzRjj0qBo4ZcwJ0gqju2Ogt4M9CIx70d/p6vxhBL0bEOMLOlYFS08WfPJyeEqRlLYigQUiWSI8k8LYQDCTd88Epec71jc+lHM/Ugn1AAHN1jq6g2xoaUKVSFgxs5tKbV+DLLupZWt338UWbnsgdlZFyN79gY5meyc6cS7kjS3m+2oXHyONhks0IrSu1Gly7GvpYClVmlhgK37a+Bus/9zouZIclfTuAEgm5JUq5TX1D1tqXzfFvsbEks6J69agUtazjveY3otbZZX+YwMMJWl4EAmzpwcyqkM/6eMOJVQRuthSLyLQt+ov6YfHjTXwTRKQ+zXxhkRgXKPkVNPsWj0kcEkXcqdrqJJqLlyUMGppN4pINsGtRxccpXQCfHdTxhmPe4iBfYb/etnGjmLfG3rsSU0V8eAZG77SaADe2T/NmSLx3iw+3QUgZUe4X9k5inn6fiKHLGQ6qavQ0fXD08avYxjTE5/P/H5dxEfJXuCVk=","authorEmailMD5":"40be30dc5eba76aca5555bfac97b90cc","authorUri":"","authorUserId":"disqus:andreaceroni","authorFallbackAvatar":"https://disqus.com/api/users/avatars/andreaceroni.jpg","message":"Hi Stephen. But with TAP methods is it possible to properly close channel if is faulted (communicationException, TimeoutException)? With non-async methods there are well known patterns or exstension methods because the \"using\" statement does not work.  \r\nThanks!","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2016-03-24T07:50:39Z","timestamp":1458805839},{"_id":"c431c0f5-d49c-3f9f-af6e-0c096f775258","authorName":"Andrea Ceroni","authorEmailEncrypted":"ASXkJwQOEg2Pz5yW3P+lz7m/yWf8AUwWcUwDHWDPQwSWsygdrgBM4FUqV6CEQEbEu+r4L73O8j4VcowFA5wVGKSU/3D732Y9mmuS5Y9m5HHRm0IAvMW7CpBBemIjXNRbtjK85yi2tRJ3osKX3TFlez/E1IHDz4coYy2VktysKuhKEkmUACt5G1U5VZyZfUZhIUPy6nfg4f2uqAOyNbEKFqY4teD8XHZA2UA7zyUC9XR1URw4+oWDU9LNQWoHANqcfQ+Ub+JAf1k4Q5DnwHlnv78ZzgVBh3c0fvccYxLDG0RmD9alfK9y4XzQQvYlWaGmqIQERM/uKNz+EsFinaA8mEdmPZy6CB5ECHyLkTPzpPV0VsT3Ygz/1/aHn2m5zsEMlUFlg7pz/ztQHwoXYWeaZY3Q1nX+VuJH8P7oKnjhRyhErnVPXiASCIIXajBfjpTHASgG+z34DgMfDTjcdp0lpx/3+mUSnU3i3Qg78ZSA6bDZZAkMWN8MfBCCd9C9+JsRazBEI0kW0BFHN09aHANGZ9Zgrj84hTqS6IJTunb0fcvw4JNGvm7A20vxd+OXJHn5yxnxNHLm3sjpKnA7Afp6wocvgkCDaSHqnISUgvkbb7zuIgET/BaMECjG6iFgFRZpKVB81Q5c8Af2JQ/1COsXtAjzbzdIwtmF9Sxvtr0TqZ0=","authorEmailMD5":"40be30dc5eba76aca5555bfac97b90cc","authorUri":"","authorUserId":"disqus:andreaceroni","authorFallbackAvatar":"https://disqus.com/api/users/avatars/andreaceroni.jpg","message":"Thanks Stephen, I think something like this:\r\n\r\npublic static async Task<tresult> UsingAsync<t, tresult=\"\">(this T client, Func<t, task<tresult=\"\">> work) where T : ICommunicationObject  \r\n {  \r\n TResult result;  \r\n try  \r\n {  \r\n result = await work(client);  \r\n client.Close();  \r\n }  \r\n catch (CommunicationException)  \r\n {  \r\n client.Abort();  \r\n throw;  \r\n }  \r\n catch (TimeoutException)  \r\n {  \r\n client.Abort();  \r\n throw;  \r\n }  \r\n catch (Exception)  \r\n {  \r\n client.Abort();  \r\n throw;  \r\n }  \r\n return result;  \r\n }","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"1a1be2ed-5ae5-347e-a395-020e0c172cd1","date":"2016-03-25T07:19:47Z","timestamp":1458890387},{"_id":"e3cc7f1b-329d-3d3e-9a23-1c16e4380349","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Ah, I see what you mean. Yes, that would work fine.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"c431c0f5-d49c-3f9f-af6e-0c096f775258","date":"2016-03-25T11:35:22Z","timestamp":1458905722},{"_id":"08b70bd9-1709-3697-a659-47dce4cc1492","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If you have CPU-bound work to do, then it's best to do it synchronously. This is a poor example in that regard since it does push CPU-bound work onto the thread pool - that's not recommended on server-side apps.\r\n\r\nIf you have I/O-bound work to do, then you can do it asynchronously. There's no background thread required in that case while the I/O is in progress: [http://blog.stephencleary.com/2013/11/there-is-no-thread.html](http://blog.stephencleary.com/2013/11/there-is-no-thread.html)","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"5b77ce7c-665b-3427-8d65-da337b9380d4","date":"2017-01-06T18:19:43Z","timestamp":1483726783},{"_id":"5b77ce7c-665b-3427-8d65-da337b9380d4","authorName":"Drew Moss","authorEmailEncrypted":"ZSmI2FdDdLcE0Lmn/8nwhse3LHHICxIqxUM/Wokx4UaNbcIgf34DWQ7u4fdn36phV8ze62TDlu1cNoA6IN0oITBJF1tObzfO/Xn4m2NA/ewdYKXXQ21UMW+ba9elNjFWhhhrVzPDuAq2lRVdHn39InSu0N3LG3sIvNuc/DWITybQ6Uko0UGQifGq8T1Ll8l5+FGt3+5DRI+vHWy59HTAJke+evJUypnfEZWn/AZ0ydbHxrrx5mpz4QZQWZl9pMBzgrU2r7iC8YkPL2GY8cRMjmJtl3Y+/VXoKlnfDM6k6eD6nhDiLWBW0oNPheYaXydxfOSTjQYy4vHqNJ/Ed7YFEiTIVdBGatnQidyXObVJttZkoebWzGvcDzkW/gpmVJkYGZnDjGQJzNU/YFc/UnIc/+Wf6703Mm+0A9jg6zp5wSFwvDbTEBAKkLDMXJ6GhyU5c6fPv8Oc14k3p5lIZ09IjPgRYqi2gKjHG2xuw4Lj57BuEF3tsoTtMPExBPODklyp/Nprgumf9k54vfHPIBvF2HYlXMcf171fuMR/CE/oZxEeIX9pykpapQFvT+iG7qgnauvlgJAGiVSzvMwQLFNZFLyoP2r/dbVyTppDmC+Uu/bTzep5+FucjD5iQDD5ejk6oaLpeAhDxlVwpoZ8OtC3XF3nrK68NIme5zAe4sSfpi8=","authorEmailMD5":"0beba79365b67b98ee3039d7d969f578","authorUri":"","authorUserId":"disqus:drewmoss","authorFallbackAvatar":"","message":"Stephen: I read your article ([http://blog.stephencleary.com/2012/08/async-wcf-today-and-tomorrow.html](http://blog.stephencleary.com/2012/08/async-wcf-today-and-tomorrow.html)) and this sample and have a fundamental question. Like in this example, if I want to do a task asynchronously using either Begin/End pattern or Task based pattern, don't I still need to use Task.Run which would create a background thread. So, I'm curious on how do we save the resource (i.e. thread) by using async programming. Agreed that the request thread is freed up, but we still need a background thread which would do things like (parse the request, make expensive remote calls, parse results, log,etc).\r\n\r\n\"What About the Thread Doing the Asynchronous Work? I get asked this question all the time. The implication is that there must be some thread somewhere that’s blocking on the I/O call to the external resource. So, asynchronous code frees up the request thread, but only at the expense of another thread elsewhere in the system, right? No, not at all.\"","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2017-01-06T03:05:34Z","timestamp":1483671934},{"_id":"e4b080ca-8d5b-3ecf-9f3c-65bfe4a8c842","authorName":"ayman metwally","authorEmailEncrypted":"qWADx97VxlfZWSnF/kbZ7Udacv6JenM+GVkdwVuU9cl6s7dcFvnyMBMkZIa7I0ApAxfhhl3cG38CbwD9hjK0ftPVW8iOLOTVpG9PYKQfBPhsyg/xGZdxvQwhUGeOxFj7qmITU2XxbSGY0k/t9vBroftNHzOKhGt8MUnWdowJ6DcyBxcZ1JeY3i6gREqkP46/kkqRg85Zp3YDhs2ivcCLRjG+tCPSW02iubtFRYaUumviHrrxut28PNCNHtu8/N/ua12krpo54fFRHkYsJkNy09uwwIi4kkrOE057zckRBk/3q7jrk/NL/7xe4xjVu8zXVOyECSickFLRdoeTlVQMaroYIXe6kgEyynXhpGmX9b9EySdHqEcdP0AX0UFaaDSLa+VWqpFfe1BPlVE0qvUy/4579lC010cEcNu8wO30j2EUd9ow2dyAdvi+Ql0KKaNHYahMOhZytKyX4iELAKXwQtgs4iQvslFUo618ulMT4SeJeZmufPjtZoJhXClf20FtsJMWOI4A+9tpHli1iLK2yd5D2Miz8pl2EOySywYS+n/1RsorWNYMpFjqJESLwdluCyAR5LHgeoY33XSSiNR2IknIGtWMnDXCuRtJnHaRoaiHvgFF/z3DSRaZSdbyaxhtufnUJ+C3rc+hIjo4GBpXZrKfiZ0KAO/bwcLQpbXc2Jo=","authorEmailMD5":"424e448aee11240309cca7b0023de2cb","authorUri":"","authorUserId":"disqus:ayman_metwally","authorFallbackAvatar":"","message":"Amazing post.\r\n\r\nI'm a bit confused as I thought setting the service as PerCall and Multiple will take care of the async behavior.\r\n\r\nOr did it just mean that each call will have its own copy of the service but however all a running in one thread?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2017-01-28T22:22:35Z","timestamp":1485642155},{"_id":"201aae5d-9f48-3ed6-92e4-380aab83eb75","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's been forever and a day since I've worked with WCF, but IIRC, PerCall/Multiple are just instructions to WCF to tell it when to construct the instance of your service. They certainly don't have anything to do with async.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"e4b080ca-8d5b-3ecf-9f3c-65bfe4a8c842","date":"2017-01-29T18:32:58Z","timestamp":1485714778},{"_id":"3514bca0-9054-3208-a716-bac9abe802f2","authorName":"Gene Vital","authorEmailEncrypted":"vs19sEByH2M5+OFThxYuDZJ+nX02xQhEoMEAW2Fm9mJWOSWXGFMpKAB7IKYYj1Ym+MNTE20Zu6BvDUnHZnP7P/kZM1T5ge8mId1BpKFYHPcTT5O/Eftz2SzdziiXIN5n2w8t4WQWI4zuGHCqp1wedN1tNr7xukmFkYTAXmcYmpZUSQfkTiCAUkIIhTs2bnTgHBjgbUmHWCDNhLE03EqLH/tjL4wcb1UkyO9CLOJhfDGW3SDe7c0pL2IzP+NXlKMfK8dWIyRLZPJyBXXrSqYf0C1JtgftHQNJojbI8nthkkb2WBkSbSqqWWhlDAdNcHGwCMyMqZGt5pMGQGtX8hPcCHBAEx3Y1btSN0UjZgCxGZjxi3XfU044bcW2GEK7AdPbVLwfEBfUmFgSXmrsBu3DffPFXPMU+H9exE7k2yZzqx0Uv4nvYPUSEjUDffxVkbczGVCzA5Z6P2CL2MoYwmYnHDWky0wxYCNRVyWsvdjimGHtIg9ZVpX3vgvB96/aaX/oKF02FUpX3ARbDoS3kzPoFt1jl/07jdvwMDDMMMHT6qginKRKd0Gg/+Mp2aAPTc8+rwbFrjXC5wO8Kp5yX48vVCoVz0siqz9EnnhXMzd7MV9OEGV3ESt9e3N6Q+DjN6zNlpVIi2AkQOXYUdkcpFAW9WIgtp0ZrxEYUAYCwgndoLc=","authorEmailMD5":"f2578f209735c78a64a4f7f312be5f06","authorUri":"","authorUserId":"disqus:genevital","authorFallbackAvatar":"","message":"HI Stephen. After reviewing this link [http://stackoverflow.com/questions/18622372/is-there-some-way-to-handle-async-await-behind-an-asmx-service](http://stackoverflow.com/questions/18622372/is-there-some-way-to-handle-async-await-behind-an-asmx-service)\r\n\r\nit makes reference to using this for supporting TAP in a C#.asmx web service. I reviewed your code but can't find any references to how to accomplish this in an .asmx. We are leveraging some new code and all methods have been implemented using await/task and I need to support using them in a large legacy .asmx service. Can you give an example on where to get started with it?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2017-03-02T17:32:33Z","timestamp":1488475953},{"_id":"07749ffe-e9c2-328d-b4c5-1c437ee958a9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I've never done this with an asmx. This post shows how to wrap APM in TAP, which might work for asmx.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"3514bca0-9054-3208-a716-bac9abe802f2","date":"2017-03-03T14:22:08Z","timestamp":1488550928},{"_id":"aeaa608f-05a9-3ef4-966e-7f673b3cc404","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"WCF must be automatically stripping the Async suffix.\r\n\r\nIn real-world code, you should have either a synchronous or asynchronous implementation, never both.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"b0c28d10-7d46-32c2-958a-7e43fcea0a73","date":"2017-03-25T17:02:06Z","timestamp":1490461326},{"_id":"b0c28d10-7d46-32c2-958a-7e43fcea0a73","authorName":"Alex  Zqwezz","authorEmailEncrypted":"Z+2+0GGwru+9tjJrJ8lIyPFfjeTCRJi8B9Dj2QsP1t5c3bo0GNGKTj86MlcNU2Acw1CN6Vhjc9twb8/4SQgf3uCph73QMeIihemiWICHOTBHPPUYEtWq6FyibbH9iDUCCWcWx64oawj/0CLXnatYMeS7NDJjjZoN4Vrob+iaPUppLF0DmlKJ7rfXeWncJhPawrscosMxPk7/baQLByTWbDwKKNRSoIp1nnw+p1dE96tFDhW1sITxUTOQZbOr9wb4TwOeCfMN4IN24Bp/4MAS7KTGNh0Qusbwx4R1Gbugb7Nt+WVJp85A71znO1h9FrZBaU9AaWISvg+K4MKZ7MeWyf2P2Up2MYJCKpK6Hb/HcA/dpTxiXkM35X7MojYXDPjJA7mCcjQldF3Sz0ayoWXOamHjx/6iCFWT93r8SjIGD4zkVUUc7s8q/2uqn7FbVy0x2pnqxjzMsTkdQcsEiax0gr25Q/DBzyyGDw7BFuakNAg9L5g9jxJm9rFPTRTPF517bS2vyARxVGrqr1SHlPwvBMD5KtMvRerP5kI28ESgJ+1rufpbCDdyWRx4zSHgXDkf0NCjggAGtrMjJHNpb2NKaTZoU4pgQQqHlC5OmWuQbuZTz5kJG/yjDxyJn83r+a9NLPB4YQkDusJtvPt8DsTE94WLQ/vk40F5wSfbEbSP9kA=","authorEmailMD5":"32b8d310c42484cbfa673d701a5638af","authorUri":"","authorUserId":"disqus:alexzqwezz","authorFallbackAvatar":"https://disqus.com/api/users/avatars/alexzqwezz.jpg","message":"Hi Stephen. When I wrote in interface for WCF two methods\r\n\r\n[OperationContract]  \r\nTakeDataResult GetData(string login, string password, string creditNumber);\r\n\r\n[OperationContract]  \r\nTask<takedataresult> GetDataAsync(string login, string password, string creditNumber);\r\n\r\nand have error - You can't use the same names for two functions ! Why ? Names is different !!!","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2017-03-25T10:45:12Z","timestamp":1490438712},{"_id":"91f51b08-ea36-3d2b-a703-ece742cc427b","authorName":"Drew Moss","authorEmailEncrypted":"LZ6B2RSG+m01ovDrTmLGVL0BXoc4zb2JmYIp80A7av8JBbnu3G+dIaj2PhqixzeKNbWFlawpX73xR3a9RN2rTrPG1WQ+iH6bxUVJ7XP/M1GNnoXD9MAFknOdLb+vd9u7T/WFjnDHQb9GYy+bVxe5jXCdr82ZshfMH2IH1NsOmxmZtmpT0myuZipCRAUi6gMvzC8OrDBb3UBIR9jds/P4ED8bJ1fM8G6QAjTF2MiHlMxp1HMWDeoQw79775AvRjKtToEdf2G1L0FOMu9w5XLcB4Vo4h+s4V1+MwgzolGWpZYuJge7lx+fedHlNiOBdmpaLEgFlrfxAjJpuh16CxGnxj3ePxjHyDrGAiEkKgzbZPIWDcNF/GFg1uLm8jhdFWB+kPNudQrolDlDh+DyHq7T8H5nsHhUVWcPLMXK/y2I7NmXW9m7uDX7hWdrFmjuJVPJRKulmxZt3npPhUv01UmvDUPXLjQWVZEbUtLEk8DBJxHND6eoilsVXOtEP1vYIZNc51q6iLOgTLrozRX/21MgivLYsHL4xavrIGU9JnBCccTX4dpwvjgWUXbp5ABXy5q8KwwKelg6X2YLOlJl4RxTtRaheGzZMWtoV6LJnbrnMqT9BRj4CS5PqCqWx0oE2BDehb5oIDt5T/c7Es5Xfjkgb8k0DBsATza0/DSvylb4/Sc=","authorEmailMD5":"0beba79365b67b98ee3039d7d969f578","authorUri":"","authorUserId":"disqus:drewmoss","authorFallbackAvatar":"","message":"Stephen: So, my WCF service has mostly I/O-bound work to do and internally I'll have to use HttpWebRequest (so that I can configure Tcp Keep alive due to limitation outlined in [https://blogs.msdn.microsoft.com/mast/2015/07/13/azure-snat/](https://blogs.msdn.microsoft.com/mast/2015/07/13/azure-snat/))\r\n\r\nSo, if invoke HttpWebRequest from Task based method (see below), do I still benefits of async programming i.e. can I process more requests when the below IO-bound activity is in progress and there is no thread consumed/blocked like it's outlined in article at [http://blog.stephencleary.com/2013/11/there-is-no-thread.html](http://blog.stephencleary.com/2013/11/there-is-no-thread.html) ?\r\n\r\npublic Task<int> DoWork(int input)  \r\n{  \r\n // Invoke HttpWebRequest and get result\r\n\r\n return Task.FromResult(result);\r\n\r\n}","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2017-03-28T04:19:41Z","timestamp":1490674781},{"_id":"c60fdedf-fab0-362a-b788-9ccc16b13cc0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If your code is using Task.FromResult, then it's not asynchronous and you don't get the benefits of asynchronous code. You should be able to use await with Task.Factory.FromAsync wrappers around HttpWebRequest's Begin/End methods (see [https://msdn.microsoft.com/en-us/library/hh873178(v=vs.110).aspx#ApmToTap](https://msdn.microsoft.com/en-us/library/hh873178(v=vs.110).aspx#ApmToTap) ).\r\n\r\nHowever, it may be easier to use HttpClient, which wraps HttpWebRequest. Also, it seems to me that sending keepalive messages may work better than setting SO_KEEPALIVE, but I'm not familiar with that exact SNAT problem.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"91f51b08-ea36-3d2b-a703-ece742cc427b","date":"2017-03-28T14:17:02Z","timestamp":1490710622},{"_id":"07a3fe7b-b015-30a0-a752-d0146bb525fd","authorName":"vinhent","authorEmailEncrypted":"vSUBCiJQEpTlz9UQCD2lg0Q5iQShomPFk+T5fVNHKCDQyMkas1uTSaD6GTHv4ujJNIA0jYMuAQA4BwLydPf7n3+y4JTONKxayX0qPu5igQbumWYMYPYsAjQlLPvNuUX1nmeDKkocO5aXK6voWOUPyn3L+EFmVS9uqsa8D3C/uuq0dFsAgEkWFPoYPxdz5dIpDvjLytzCPHLa/HO5bAhrsGLKcrUq57T5ffFaqm2BC5hJpjAhLwM+kJlhGS8034qoEWL8DaxEKU+zz5+5qRHwNSQTMUezdks/zAaaNxBU2flc75/ax5m5k8SCVNceU21X0ZPZL2ZgIFXSarQluH9CorB83IZHFrOX6JIhDsNKfHXARDiATpC5bNW+BLFMPw7f8ZoVBHH2KBrjnXr/XuHC3UvoopBKcd7SlBYeDB2eRF9a9nbSUQuvRuj2PFvI32lO5Y8Z9fdMaFN6/ss9ocNUjl1jQOYVUA3/YKDhZCFUTfvq4tGOocGGsYl+siVzDO9Pf+sxfsai8CQGC1GuPknd+vS8c6JpV4Y/rVj7s1zcO2MVEfasqRvY5VmwpavHL8rxqomYS/GhspN3oGDb+fjiSG0FABpspAMMp+pqwXLV78YM1JQeOYR/v+Q1SFkMVUP2xvtwtgZn7ECf4lS7EIMS/+NGPhJWyCZxpr01S7Vmv3M=","authorEmailMD5":"4e9d619f1a01bbb4f1c209dbbcad2498","authorUri":"","authorUserId":"disqus:vincent_gravel","authorFallbackAvatar":"https://disqus.com/api/users/avatars/vincent_gravel.jpg","message":"Hi, I have a .Net 4.6.2 WCF application running in IIS and I'm having the issue that HttpContext.Current is always null after an await even if I specify ConfigureAwait to true. Is there any thing I can do with that? We try to not use it after await calls but sometime we can't. It's a show stopper for us to move our WCF rest services from sync to async.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2018-01-18T19:31:49Z","timestamp":1516303909},{"_id":"599b0eda-ca6d-31e0-83e9-32ebc21e3793","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Please ensure that your web.config has httpRuntime.targetFramework set to 4.5 or higher.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"07a3fe7b-b015-30a0-a752-d0146bb525fd","date":"2018-01-18T20:19:57Z","timestamp":1516306797},{"_id":"a222050c-604f-38ed-a2c8-d14c6993aecd","authorName":"vinhent","authorEmailEncrypted":"LfGYlsevRL1Lzb5Hln9rnWBTLNClDe0LuuRniVc70Z9fOq9SigoxcaJ1X+apdCy/Jn4jHDRHR0xXtHLIobptxauaATF87qjVCNaQ4H/WKCP2NdphmGO9yje4sLNaUv3WMdP5o5wJ3s1qnK+JGVjk1YzoYI3Ar0J4nQrvitQYtSBQYUsRh4C9yPsZRw1iTAxNJfoxyWqyX5tAlnsipdIJZqTQxdYm4LEOhsvb71H9Wo075rFri29ceZ4H2Tmo7EZkekiAFq8F9hoIL2ByJP5BPqBkUbJQaoDHUz9koQYOyHuHmNehRh6T99ukaDVTXGA3g4E7n6ZllrhA3p3u473Q+VWbQCeCbPOhXM0nVFotW8bCA8BNuUf7JqN4MbttU4Tk5vTIcMiRAZmvkrSSoGsgbQGSYZ/3w2lRYlaAPXBPusaHCABDXLNrXqMLlADDjXTaKIgSFLG6r/I/jE09ciu74fcrBQyVJlrtpasiYEzDzqL6QbVXF55FFlJiLguIdwWbGVQKNf3ayIjKcdHt5XYKhqHD60faBfaM0vLOl3PsIGSRXzceKgHKdMoqN2oHwsvjtnEfq3cHHkNl7a0WZIaJdPbwSrDvWihdO9T7FFbhwBkOgzpTWH4HP9UcXFDJS0PlRiDSCbMgoZK8uhK83PKdNNinPWACOfrPMdPSNWkCE4k=","authorEmailMD5":"4e9d619f1a01bbb4f1c209dbbcad2498","authorUri":"","authorUserId":"disqus:vincent_gravel","authorFallbackAvatar":"https://disqus.com/api/users/avatars/vincent_gravel.jpg","message":"Yes it does have <httpruntime targetframework=\"4.6.2\"/>\r\n\r\nI did a lot of research today and it seems to be a known issue with WCF... bug.  \r\nIt's a shame because I'm having some scalabily issue (blocking too many threads) and doing async code would help a lot on that but I have some logic based on the headers of the incoming request which I use HttpContext.Current to get them, like in my IErrorHandler implementation where I can't just copy those value and pass them. Also using the Items list of the HttpContext.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"599b0eda-ca6d-31e0-83e9-32ebc21e3793","date":"2018-01-18T20:59:09Z","timestamp":1516309149},{"_id":"8ebcbedf-66fa-3c41-808f-1fb8019d7dd0","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You could try using AsyncLocal<t> - it's essentially a strongly-typed HttpContext.Current.Items, but without actually being a part of ASP.NET.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"a222050c-604f-38ed-a2c8-d14c6993aecd","date":"2018-01-19T01:16:22Z","timestamp":1516324582},{"_id":"3ac91931-6c74-31fc-9330-d417e9f375dc","authorName":"DickP","authorEmailEncrypted":"AcF6VpEayeKm9RPaKPjBV8MJT67Jgmn1P05b3qIAC2SKCZIDRC5PM4Lut7lWNspCcqlfLK5QYTQayA/clH1IaFK7kHRKJKKOUulD2jxZq9GNb+4cLGOkZZBi8Oqilcujo+1ehcecqSiVakINBzd4OdC4KESPWr3Wzxj4kJWQ/l9tRog7JUIEVmi+cNX/PWkBaEh9KFwjzjzAYFqcfo6pbEq0q/FmF90UFQpdUgBzeovExCOxo9oG4X5YCHbSnH28sGL+Bn1eBU4B4uipfni9Xat5QBMzV+EGphizo81NosO22uhI3556SYSjaEvrkm2lNs5uxGWjCIR6uBp+5OAjZhZGJvT+90wt5Zl92EfuTFYXuQsxiVbpi5WXY9ErxJU9CIIZOhnYwWzqkiZCjRRbCH9RzoSbSRRbeO6mFJAWsEAbPstGgWKSv2IPcaMIrOJ9OHoOZ90/k71ZKvBRO1xAhc3sO6Dat/+EtNCY0d5gX4fW8J3bUiv68SYo5rPHgIutdp1qcQOWqMCnjU7ji76KWlEi537xl4Y5MNErDmFNWw3jEIyh8WmAAwkZpm8EomT/ZdgSR8+HYGp64C5mG9ccIDxKGvrSngytNmHWKGEpi8Amxf78DID/mkWpNajypZe9qjDmWvrqSnxvUB35GG2CE7ryXTlt+2QjF1R2ClEicJY=","authorEmailMD5":"33a553da13151bffb2e5e33efbe2548c","authorUri":"","authorUserId":"disqus:disqus_MYL9vvFXQc","authorFallbackAvatar":"","message":"Stephen. I am committed to WCF for the time being for a complex fintech project. I am currently using 4.6.2. My app includes both I/O and CPU Tasks at every tier. I generally only use await when a method contains continuation code or needs to handle exceptions. Otherwise I simply return the Task. What is best practice in the service class? My service operations often have just a couple of lines of code to instantiate and execute a business layer class. Does the WCF runtime prefer a returned task or an awaited task?  \r\nI use PLINQ in the service layer to parallelize a large chunk of CPU bound code for requests with batched payloads. I just leave it to block. There is no continuation code. Is there any advantage to the WCF runtime in wrapping it with a GetAwaiter and awaiting it?","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2018-02-03T12:57:49Z","timestamp":1517662669},{"_id":"e39931e7-25a5-37dc-94c7-8c92ebb56aaa","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Returning tasks are fine, as long as you cover the edge cases, like if your synchronous code throws exceptions or frees resources: [http://blog.stephencleary.com/2016/12/eliding-async-await.html](http://blog.stephencleary.com/2016/12/eliding-async-await.html)\r\n\r\nThe caller does not know nor care where the returned task comes from. The async keyword is an implementation detail.\r\n\r\nThere wouldn't be an advantage to wrapping the PLINQ code in a task. You're probably best keeping the code as is. The *client* code that calls into the WCF service can be asynchronous, though (and likely should be).","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"3ac91931-6c74-31fc-9330-d417e9f375dc","date":"2018-02-05T18:53:12Z","timestamp":1517856792},{"_id":"c382ca52-927c-3966-918b-c742231baa6c","authorName":"DickP","authorEmailEncrypted":"vtjQ0pQ6mCYFpr/yQgMVRRF8L/DOj/nZIFCSbDwoT7Kx7cIpMs4iq56Ugs0QTlZTdD8WMQcRRWqaxxz1YdS/+hJjAdAFDjSrhKnpugSZu7LpNq+TQtRlovyFTt17y+9smFZATE9eZufGmM6NoQqybwARPe9MrwiUJ9oIvUWpj+Usi76b+FXyyIxtlFYpbv0v4gnnAaHya9tNuR1qZYS6jBgecv0nkLigyY4XWQtPpPjt7nFSuGybESh/o6Rg2ObVDoFoMeU9LCQuvxbfAqu7jgMJtjQKABurlxZDULO/k263lGYkwabsk2MXP2CIirsteuKAFBBC0yp/ditGOXBMgNcovbMBt/rho4lLBVvn/Ouw+WHJz3IXOqqHLc7zbNaDVrLQwUhIyVYFgrP8IIYMp0fNQFf4Rtkjpqz0ttiEynTRZEMSGuN7bbS0psCiJkJ/TzvnROruwyIEsuLpEW526LwGQWfIGiToaPrakzEpJMc7Mb6uO4mL9hJ11ubu1pdzcQqC11QpWh9q+S0rFq4qqgBqkAObQtl4thiGKHb7G6AFfPp9SFkiFzskQ4lCdmcu5s0Q3aAkftDm8chKx5KbGd0G8wFoXhDOoNB+cxwPKQ9Tiw9YLz548oXU/tpF88plLqUqpv8V0YKC9FsnnG9B/OzR3Ck8AucOk5lPQEOBjbk=","authorEmailMD5":"33a553da13151bffb2e5e33efbe2548c","authorUri":"","authorUserId":"disqus:disqus_MYL9vvFXQc","authorFallbackAvatar":"","message":"muchas gracias! To be clear I was asking from the point of view of efficiency at the service end where the immediate caller is the WCF DispatchRuntime on the server rather than the remote client. I conclude there is no reason to treat to the top level service class operations any differently from any other action class: only await Tasks when there is continuation code or error handling.   \r\nYour blogs are so helpful. Thank-you very much.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"e39931e7-25a5-37dc-94c7-8c92ebb56aaa","date":"2018-02-06T15:53:16Z","timestamp":1517932396},{"_id":"dc66635a-a456-3148-9b8f-4211c5d234cd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"In general, I recommend awaiting tasks (or someway of observing their results). It permits your calling code to know when the operation completes, and (more importantly) whether there was an error.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"c382ca52-927c-3966-918b-c742231baa6c","date":"2018-02-07T01:43:42Z","timestamp":1517967822},{"_id":"a64ec8ef-2f2d-32ee-b7ba-fe3991d8fd7d","authorName":"Rahul Agarawal","authorEmailEncrypted":"JVY4WGSIN0qfdDnI4KnuVTVn+Nwv0rjiUeSr/deuJzYuiTt1GpowkU8FajF7lkCRihLmaY+DdkFO1CoE+1RsJ6bMlqTE8u9lb48K/bzxkYNudwdIwxpgT461KhPNyl+CZKA4ae6+tnMHiww+VIH1QdL3co8/N6W06XE8b9uuZM7HPIayfCuAJp/uKYzeMt7cwC2cZrOGi0h8tsqcFtBhYfjvtPc2987kWabo1Sw1FFaNISsAMqW797HditWl9p1Zaf2qmvGtItD+mXUJ38bPiiicv6hfm6VJ1RBLlPemq7H2FCsTPHUGVRVX8ii+sjvktla88K9/AY53gdK0IJNNQ43F3fwDTmVSCJK+PQqjHPmGrFUQPaGSkW5EtZAqogm/BOV9ZVv8ddXruqATjpV0+h8sK/Famq7qiVyASi1d5pF+6RLC+Oxq4WxPZzyZN32rtR41kBoDL3hIWxLN+X2hJfaKS6SIbXJHl4Yz7TkiWa6Y/T9aY1Kd4rTdTaKdyUf0fcWdRPeK95XONA/t0vBySlRcIZW6BibeQROPNZMSqviB9M75bZ+vAQ2iYSP7LtNa7hnGEUvbF86eKVOPXLhQJmXmiPkEYIwHDDEt2qx4lQQa5o+R69I+9loChbOrm7uPuOnsU2k04uqPiCgd+WLFaGUfkLPsoU9piJCjeSzZmsI=","authorEmailMD5":"69741a9fe307a187f4510492b65943b4","authorUri":"","authorUserId":"disqus:rahulagarawal","authorFallbackAvatar":"https://disqus.com/api/users/avatars/rahulagarawal.jpg","message":"hi Stephen. Thanks for great post !!\r\n\r\nWith in a same process I can understand how async/await works - like await on task will free up thread and once await on that task is completed, some thread from thread pool will be assigned to continue execution of program following await statement.\r\n\r\nHowever how all this play across boundaries am not able to visualize. For example If wcf service contract says Task<person> GetPerson(int id) - once server side operation of fetching person record is done successfully , does WCF run time returns Task<person> object in SOAP body (with IsCompleted = true) ?\r\n\r\nIf yes, client side run time upon receiving task<person> as completed allocates thread to continue client side execution following await statement ?\r\n\r\nOr WCF run time just returns Person object in SOAP response packet ?\r\n\r\nJust a little background : I have been using shared service contracts and custom WCF client channel using channel manager for communication vs auto generated proxy. Since certain DB related I/O operations on server were time consuming, I made them async and updated my shared service contract from Person to Task<person>.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"","date":"2018-02-19T14:37:51Z","timestamp":1519051071},{"_id":"c1e52544-b7b8-3ddb-b084-f07a42fa09d9","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Each process is completely isolated.\r\n\r\nOn the server side, whether it is synchronous or asynchronous doesn't change the network data at all. It's purely an implementation detail. In your example, a Person will be sent, not a Task<person>.\r\n\r\nYou can verify this by not using the service contract on the client side. If you generate your proxy instead of using the service contract, you'll get methods that return both Person and Task<person>, and this is true whether your server function returns Person or Task<person>. This is one reason I'm not wild about the way WCF reuses service contract interfaces: it exposes this implementation detail.","postId":"2012_08_async-wcf-today-and-tomorrow-962c9b7d-5731-340e-90d7-2697f0bef315","replyTo":"a64ec8ef-2f2d-32ee-b7ba-fe3991d8fd7d","date":"2018-02-21T13:34:08Z","timestamp":1519220048}]