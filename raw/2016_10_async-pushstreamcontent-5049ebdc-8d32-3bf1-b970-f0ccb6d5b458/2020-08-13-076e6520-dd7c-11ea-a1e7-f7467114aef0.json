{"_id":"076e6520-dd7c-11ea-a1e7-f7467114aef0","postId":"2016_10_async-pushstreamcontent-5049ebdc-8d32-3bf1-b970-f0ccb6d5b458","postUri":"https://blog.stephencleary.com/2016/10/async-pushstreamcontent.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Can we flush the ZIP file immediately while we processing a large number of items in the for each loop? .I mean Can each item stream can append to the response output stream while downloading the file in the process?\r\n\r\npublic HttpResponseMessage Get()\r\n        {\r\n            var filenamesAndUrls = new Dictionary<string, string>\r\n            {\r\n                { \"1\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                { \"2\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                 { \"3\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                  { \"4\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                   { \"5\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                    { \"6\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                     { \"7\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                      { \"8\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                       { \"9\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                        { \"10\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                         { \"11\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" },\r\n                          { \"12\", \"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4\" }\r\n            };\r\n\r\n            var result = new HttpResponseMessage(HttpStatusCode.OK)\r\n            {\r\n                Content = new PushStreamContent(async (outputStream, httpContext, transportContext) =>\r\n                {\r\n                    using (var zipStream = new ZipOutputStream(outputStream))\r\n                    {\r\n                        foreach (var kvp in filenamesAndUrls)\r\n                        {\r\n                            ZipEntry entry = new ZipEntry(kvp.Key);\r\n                            zipStream.PutNextEntry(entry);\r\n                            using (var stream = await Client.GetStreamAsync(kvp.Value))\r\n                                await stream.CopyToAsync(zipStream);\r\n                        }\r\n                    }\r\n                }),\r\n            };\r\n            result.Content.Headers.ContentType = new MediaTypeHeaderValue(\"application/octet-stream\");\r\n            result.Content.Headers.ContentDisposition = new ContentDispositionHeaderValue(\"attachment\") { FileName = \"MyZipfile.zip\" };\r\n            return result;\r\n        }","date":"2020-08-13T15:45:36.115Z"}