{"_id":"cc019440-59e1-11e9-9ce8-4922cfe39b3e","postId":"2016_10_async-pushstreamcontent-5049ebdc-8d32-3bf1-b970-f0ccb6d5b458","postUri":"https://blog.stephencleary.com/2016/10/async-pushstreamcontent.html","replyTo":"","authorEmailEncrypted":"ZTX/jTIaeSv1W8Rs0eES8XTFdFL3bhKTOxLgQHycKiJG8S6uyfkrFJNqUjOi7ChT4rm3ejhNy1k95Hn+NhtNzNiUugFIwMLtrNguxAIMvGXoq15LEHUPz6snrjHfeKvZRNddDiExk6g5sR2YUZ7WdtO6NpXN1eNPbf4v8hQlVRFbfTrgferb6OnG2UTVhXdOrZdLwQxTnJWWa4Cgf9EAb5VUcbtU/0e+Vc/BTsJPGB3s1ui1KdxbShrxGy4vlW2nqanJP4ISDvAlFITiWCzHr6MmHmMgB8bOK1yQH9CqGdwVUz3eVz2u8tXtcYEqeS8WEYELMNoWGqRHi9NomcTI2miVBjHWON3fRLIGCWVYYTSRFTB7plhPX1CEvD3R7Cyo8I2eDP57gy8PLexrRcr3V3gkgbuXkzLLVImeTZEoTrFDhwgXoY9Sdx/GMI0UL9gvbgwZJDXPYz7dD86dAOxA+mMDkaNzHPhoHQRmv+E1G67L7n3AvXy+zQVzHea7tl6NoltZNA25JQin3BVcKhhojtnKN0Vku1TzsIqHC/EAsAo0s0X+8FlraiLqd9gVnqHP/o+qKMvf2mgQluCt8t8R13r+SBwb9ECZtnPDmjLDF1wxft4rzaYbv+SiMCBn18r3KY78MbygbKAY6QrWhQZrJnYmpYS89jV82kG1gf/+a4Y=","authorEmailMD5":"cb99972df868b756f5d5fe31271602f1","authorName":"Neelesh kumar","authorUri":"","message":"Hi,\r\nI am trying to zip files that are locally present in server using web api. I'm using dot net class ziparchive to mutliple files. When i try to open the zip file that is returned, it is corrupted. \r\n\r\nSample code is as follows\r\n\r\n        public HttpResponseMessage Get()\r\n        {\r\n            var result = Request.CreateResponse(HttpStatusCode.OK, new PushStreamContent(async  (outputStream, httpContext, transportContext)  =>\r\n            {\r\n                using (ZipArchive archive = new ZipArchive(outputStream, ZipArchiveMode.Create))\r\n                {\r\n                    foreach (var item in Directory.EnumerateFiles(\"Folder containing files to zip\"))\r\n                    {\r\n                        ZipArchiveEntry zipEntry = archive.CreateEntry(Path.GetFileName(item));\r\n                        using (var zipStream = zipEntry.Open())\r\n                        using (var stream = File.OpenRead(item))\r\n                            await stream.CopyToAsync(zipStream);\r\n                    }\r\n                }\r\n            }));\r\n\r\n            result.Content.Headers.ContentType = new MediaTypeHeaderValue(\"application/octet-stream\");\r\n            result.Content.Headers.ContentDisposition = new ContentDispositionHeaderValue(\"attachment\") { FileName = \"MyZipfile.zip\" };\r\n            return result;\r\n        }\r\n\r\n\r\nAny inputs would be great.","date":"2019-04-08T09:36:34.246Z"}