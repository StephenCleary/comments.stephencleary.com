{"_id":"6624ea34-dc5d-4535-bb1a-7559a96e5bf6","postId":"2013_08_startnew-is-dangerous-4c5e3290-63e6-3320-85d1-3054cbca80ce","postUri":"https://blog.stephencleary.com/2013/08/startnew-is-dangerous.html","replyTo":"","authorEmailEncrypted":"HuZQ/3wor\u002BRb/TBVNP\u002B/PiSayfYOnDAHmdBPpahgx56kyqu52mL2omrJqEQFdEOYOZoTpy2PtJzmaxz1\u002BzcoFszemOGGioJafEJinzjz9sF6HUt1dVc6hFgmfkg07zhOXxyEZbqJJyLqEYybJb0Iaz32V65Tk/741F5utN8M\u002BSgs6jWGcpf4\u002B6ZkpI7FbOT3DyvmtdgumV525lVQfOp2OpsSdjUe7JW4fSSy/el2CBt9ktKA\u002BZAWI9p5Bi8YQXhUdstFIu0ISMQUoepT4NTNDoF6vZKRglr4WJhTH4GYg2yAnaKQ3V\u002BsbR\u002BIh\u002B4AEykNNCCdiw0wq3/6Z0dHcYl/V3GVK2a8IP0fk15u5wjf1rgvGtl5Hv9UoIVop9lLvKw5aVJPRDutR7moh4Ht51Yzio7JzhuBWpQeUf\u002BVskcMo5CeqGPffA1yb2KcaDWOBWGridmTeiYZWoD6Z1dBCq/N9CbDvAy1XzeHiZ0a\u002BjesehXzxWkaucR1fkn8wjXBEyeKzURT5mtePRW/zmQq7tdKgGyMPB3cFXEBAmvTYIkVt95HQ14mhZykimgH0b6ytHdLhhWjcCJvyWy4Ark3\u002Bqgsa9WuknGLg43mlb4qjtdQeHVSo42yMMI85tc2qufoPYJqoa1yJ2B72X\u002B2luwCZQvAStt2aGiR9d4m6vlXTt\u002Ba2Fk=","authorEmailMD5":"a426a2f79f8aed79a0b6b16d092630a8","authorName":"Norm","authorUri":"","message":"Hello Stephen, please, I do wonder, do you think this is a legit use of Task.Factory.StartNew, with LongRunning flag? MyBackgroundService is running entire application lifetime and reading \u0026 processing items from the channel.\n\npublic class MyBackgroundService : IHostedService\n{\n    private readonly Channel\u003Cstring\u003E _channel;\n\n    public MyBackgroundService(Channel\u003Cstring\u003E channel)\n    {\n        _channel = channel;\n    }\n\n    private async Task ReadFromChannelAsync(CancellationToken ct)\n    {\n        while (!ct.IsCancellationRequested)\n        {\n            var item = await _channel.Reader.ReadAsync(ct);\n            // Some long running processing (downloading files via sftp, saving results to DB)\n             await Process(item);\n        }\n    }\n\n    public Task StartAsync(CancellationToken stoppingToken)\n    {\n        for (int i = 1; i \u003C= 4; i\u002B\u002B)\n        {\n            Task.Factory.StartNew(\n                () =\u003E ReadFromChannelAsync(stoppingToken),\n                stoppingToken,\n                TaskCreationOptions.LongRunning,\n                TaskScheduler.Default);\n        }\n\n        return Task.CompletedTask;\n    }\n\n   ...\n}","date":"2024-09-16T13:32:43.7588965Z"}