{"_id":"d0b445a0-a1b1-11ea-8eb8-dd03539bb7fe","postId":"2012_11_async-producerconsumer-queue-using-7d55b643-a325-3ba0-9ffa-7ec6b0363eaf","postUri":"https://blog.stephencleary.com/2012/11/async-producerconsumer-queue-using.html","replyTo":"832a40e0-a1ad-11ea-8eb8-dd03539bb7fe","authorEmailEncrypted":"CQy95zFuAXmkkeAgov6taFARLP5wgdYppVFgahiob8YTrYR+O+W39X+6lIolIj6x+t5bciRjFT26fpl19AQlIlF7DJe0hfPVwgm7F6jXerBUohDG1kYA+eqljrOT6yYIJyU2uiFWuKFC0LNeRD4Yt3zx9t2g4rs2G3asv4RVTcvy+3iRrtV6kEnf0oA1dlzoyliNhYoU8Kg5UYf47FHXdOtBHBg6b7Jruhy/Xf0e6tll75DPkDHidnD+l+kmzV2vegVgnx2pyzdXyPsc1x8LNrvXJNdtr236JQCoTy+T8GMCm9dsCrtnRYiYSTZt6kqrJmnVEeMPvOw8bwMFch7LiD0VtY17gjA5LXmtSWDt4GH/LdkBOF3CJ9z554CSacXJ6w3fGU5YWQdtFjAqWAjzO4C35IXTpAP23LKrfDPZXgRPvhO42fKhGVfaaby4FLd5hyX4RiRCrjjirR/oZfR47haPUwlSLNbgLyf+KARdyWG06qbtyopk24QsKuwcDvUq3OGKFxgdrEBnRSP86+gnv742Af8NO7zs+frIt/YQFaSoNoz7Vr93yxrchQBYqlN9KYOir/GUWhJm9EETDSxrnC39hEodLUSx6Pt7f92rmu6Gy6JX7OxQkVjJTXrPPxiwnZnEBTnfrHeQu8DjIighv1dazEjCVmZqkFmjGmoP5qU=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"If you need a per-item \"notice of completion\", the best way to do that is probably with a `TaskCompletionSource<object>`. The producer should create the TCS and place it alongside the item into the queue. The producer can then `await` the TCS's `Task`, and then ack/nak the message.\r\n\r\nWhen the consumer completes the item, it should complete the TCS (`TrySetResult` or `TrySetException`). Be sure to structure the consumer code so that the TCS is *always* completed one way or another. Completing the TCS will cause the producer's `await` to complete, and it will then ack/nak the message.","date":"2020-05-29T13:39:27.318Z"}