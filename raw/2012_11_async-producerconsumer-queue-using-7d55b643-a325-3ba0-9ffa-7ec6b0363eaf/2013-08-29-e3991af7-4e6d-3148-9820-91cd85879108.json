{"_id":"e3991af7-4e6d-3148-9820-91cd85879108","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"You may not need TPL Dataflow for this.  \r\n\r\nFirst, you'll need to add a TaskCompletionSource to your \"message\" type. This will act as an indicator that the message processing is complete.  \r\n\r\nNext, you'll need to handle the throttling. If you're using TPL Dataflow, you can just set BoundedCapacity; otherwise, you can use SemaphoreSlim.  \r\n\r\nTo implement the timeouts, use CancellationTokens when you send the message. For TPL Dataflow, you would pass the token to SendAsync; otherwise, pass the token to SemaphoreSlim.WaitAsync.  \r\n\r\nBlog comments are not great for sample code. If any of this is not clear, post a question on Stack Overflow and I (and others) will take a look.","postId":"2012_11_async-producerconsumer-queue-using-7d55b643-a325-3ba0-9ffa-7ec6b0363eaf","replyTo":"","date":"2013-08-29T20:08:00Z","timestamp":1377806880}