{"_id":"cbf82642-ea1f-3cbe-a60e-a96abe79589a","authorName":"Peter","authorEmailEncrypted":"lgi0jybPjx2h8nO39zNjJSATPGUHk4e/rB896dZ8wTUndmbW0pmQxTDQx9zFW8bMxqQkCduDRfk0N+kw5Kq0J1NSd+/U4E0DVOZP7z0SIRDeN/8AsNvpO5gIa6kidjQPjE2nqm8YqktOgTBhXbuqk5C5o6qC+mI2vzQSiWyLlmGuGzPotrBipBsOQhmYueYZZLB7B/7+1MxxwyM/mViiNMmRua67AgxGM93McIkE25+0YxpkoxeWtk7Ki1avHkOHBCxpmBHlp1hqKmtOaKp13d4NTwJ+Gm3eoSaBMsMJBXnUaKV/K1pWG6uPQGbQdYXqw2BL/aUJmgrulzl+2+ZcZUFt6ZV98yup2Unu9eo/ERW6wFqG9yyR8GY5gov/D+dZzO7DhSEurWSBpHVw3KhAnVWWZSXFN6w6BYSbmVkTQzqIL+j+otr/ZICNqZWaXmIIuPxtPnkGx1RTUO/XBsG4YKoN2x9Ww7IhuhG2IwkE9pRvSlSu8fsN2U18bAzyAWWQJH3hJzu7ZTFrxantR2ELxxHOThG78rTd5aMxeSdNYALkJ77gwnlo095Cu69id24cPIJE7T/eEgS4w9l88WTn6QSYWMu0+BUPV9n1KebRQ8WcZV1HlgdMeQiAjpHoyMV9dA7FLR7Ehmz8CBxpuGAMZTZwQfJkCPkbbPehhcR62JU=","authorEmailMD5":"a7432534416cef14f3958dd9224ed0e9","authorUri":"","authorUserId":"","message":"private void ReadAsync(IAsyncResult result)  \r\n{  \r\n try  \r\n {  \r\n _socket.EndReceive(result);  \r\n _packetProtocol = new PacketProtocol(_bufferBytes.Length);  \r\n _packetProtocol.MessageArrived += Client_ReceivingPacketDone;  \r\n _packetProtocol.DataReceived(_bufferBytes);  \r\n }  \r\n catch (SocketException)  \r\n {  \r\n Disconnect();  \r\n }  \r\n}  \r\npublic void SendData(string data)  \r\n{  \r\n if (Encoding.ASCII.GetBytes(data).Length + 16 >= _bufferBytes.Length)  \r\n {  \r\n //spilting data  \r\n string[] splitedData = DataSpliter(data);  \r\n //sending them  \r\n for (int i = 0; i < splitedData.Length; i++)  \r\n {  \r\n if (i == splitedData.Length - 1)  \r\n {  \r\n Send(splitedData.Length, splitedData[i], 0, true, false, true);  \r\n break;  \r\n }  \r\n Send(splitedData.Length, splitedData[i], data.Length, true, i == 0, false);  \r\n System.Threading.Thread.Sleep(500);  \r\n }  \r\n }  \r\n else  \r\n {  \r\n Send(1, data, data.Length, false, true, false);  \r\n }  \r\n}  \r\n/// <summary>  \r\n/// Send the data to the server/attacker  \r\n/// </summary>  \r\nprivate void Send(string data)  \r\n{  \r\n byte[] dataBytes = PacketProtocol.WrapMessage(Encode(Encoding.ASCII.GetBytes(data)));  \r\n _socket.Send(dataBytes, 0, dataBytes.Length, SocketFlags.None);  \r\n}  \r\n/// <summary>  \r\n/// formating the data that will be sent.  \r\n/// </summary>  \r\n/// <param name=\"data\">the data that will be sent.</param>  \r\n/// <param name=\"dataLength\">the length of data so that the server can check if the data transferred successfully</param>  \r\n/// <remarks>\"dataLength\" is only used in the header</remarks>  \r\n/// <param name=\"spiltedData\">formatting and sending data in a different way if they are splited</param>  \r\n/// <param name=\"firstIndex\">check if we are sending the first index of the splited data and we will put the header</param>  \r\n/// <param name=\"lastIndex\">check if we are sending the last index of the splited data and we will put the end of packet</param>  \r\nprivate void Send(int parts, string data, int dataLength, bool spiltedData, bool firstIndex, bool lastIndex)  \r\n{  \r\n string formedData = String.Empty;  \r\n if (firstIndex)  \r\n formedData += String.Format(\"\r\n\r\n<{0}|{1}>\", dataLength, parts);  \r\n if (!spiltedData)  \r\n {  \r\n formedData = data + \"\r\n\r\n\";  \r\n }  \r\n else  \r\n {  \r\n formedData += data;  \r\n if (lastIndex)  \r\n formedData += data + \"\r\n\r\n\";  \r\n }  \r\n Send(formedData);  \r\n}","postId":"2009_04_sample-code-length-prefix-message-ba45f669-db06-32ff-ba50-472b420edace","replyTo":"7d3cec0e-567d-3723-8718-ff3e06d670f9","date":"2017-09-29T14:18:33Z","timestamp":1506694713}