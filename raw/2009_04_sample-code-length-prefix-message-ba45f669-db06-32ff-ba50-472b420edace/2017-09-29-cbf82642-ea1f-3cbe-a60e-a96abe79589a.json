{"_id":"cbf82642-ea1f-3cbe-a60e-a96abe79589a","authorName":"Peter","authorEmailEncrypted":"cGOBqf5pejo6zKWsq2tGNb02sODLZAtZomBGS5oRB8xNkXymtZHNXwV9McwygC9og3TIviTNdjuNOc+lKdYkPxdysttgKcyHvlcOCxMDl3Zk/AonWIPH4ziee5BFLlo2UlS1w4Qkd8p7NaSi9XrBBAiIY8szNqGjpvoKSqd+os+Vp2Xbo25QcXinyzUjYnqi8nHCCsuKffsSjUzXbI98I4kBlBUFksMMCfQdRtB/sRsUIx+WjxMWu50/yfSoHzl/bZw+4uRJpVkT9qBpFTMZnVxs0z0sFclkIfaxvLFSkypA7dSK7YAVO0gIeP1cQoZeiEEMnDSr4EgvSAjopoqSnM//6ngra1SEv7OYWw7z9qMM028S19sqv4otoo+iZpsthVrs5XEAQ7Ty3bHdKEPPV2r7DOzKCnVw9oXm00yksQ16VWIVzNVw9+n4G31GTfSORzBvxop1nBOcb/94UYuHPmFCJ8pRpD+qqPh4aL7fQ1N12sic0uMuEyVFnz3v07YWQONzn8i10v0vwmEa1xXwLOWEgqlonFyAeNHPyd35s496FT8gHfFde4qeFj0FoaB0ZRJGC9kw/9Do0HVJMQsbO789fyydH1GnoRsrcaNNNFhdam7crlePqeZx4QzFi30gBLBg/CVZQbAgKkN3jtwYGNYCaoTmn9xFVtwahpmVqjA=","authorEmailMD5":"a7432534416cef14f3958dd9224ed0e9","message":"private void ReadAsync(IAsyncResult result)  \r\n{  \r\n try  \r\n {  \r\n _socket.EndReceive(result);  \r\n _packetProtocol = new PacketProtocol(_bufferBytes.Length);  \r\n _packetProtocol.MessageArrived += Client_ReceivingPacketDone;  \r\n _packetProtocol.DataReceived(_bufferBytes);  \r\n }  \r\n catch (SocketException)  \r\n {  \r\n Disconnect();  \r\n }  \r\n}  \r\npublic void SendData(string data)  \r\n{  \r\n if (Encoding.ASCII.GetBytes(data).Length + 16 >= _bufferBytes.Length)  \r\n {  \r\n //spilting data  \r\n string[] splitedData = DataSpliter(data);  \r\n //sending them  \r\n for (int i = 0; i < splitedData.Length; i++)  \r\n {  \r\n if (i == splitedData.Length - 1)  \r\n {  \r\n Send(splitedData.Length, splitedData[i], 0, true, false, true);  \r\n break;  \r\n }  \r\n Send(splitedData.Length, splitedData[i], data.Length, true, i == 0, false);  \r\n System.Threading.Thread.Sleep(500);  \r\n }  \r\n }  \r\n else  \r\n {  \r\n Send(1, data, data.Length, false, true, false);  \r\n }  \r\n}  \r\n/// <summary>  \r\n/// Send the data to the server/attacker  \r\n/// </summary>  \r\nprivate void Send(string data)  \r\n{  \r\n byte[] dataBytes = PacketProtocol.WrapMessage(Encode(Encoding.ASCII.GetBytes(data)));  \r\n _socket.Send(dataBytes, 0, dataBytes.Length, SocketFlags.None);  \r\n}  \r\n/// <summary>  \r\n/// formating the data that will be sent.  \r\n/// </summary>  \r\n/// <param name=\"data\">the data that will be sent.</param>  \r\n/// <param name=\"dataLength\">the length of data so that the server can check if the data transferred successfully</param>  \r\n/// <remarks>\"dataLength\" is only used in the header</remarks>  \r\n/// <param name=\"spiltedData\">formatting and sending data in a different way if they are splited</param>  \r\n/// <param name=\"firstIndex\">check if we are sending the first index of the splited data and we will put the header</param>  \r\n/// <param name=\"lastIndex\">check if we are sending the last index of the splited data and we will put the end of packet</param>  \r\nprivate void Send(int parts, string data, int dataLength, bool spiltedData, bool firstIndex, bool lastIndex)  \r\n{  \r\n string formedData = String.Empty;  \r\n if (firstIndex)  \r\n formedData += String.Format(\"\r\n\r\n<{0}|{1}>\", dataLength, parts);  \r\n if (!spiltedData)  \r\n {  \r\n formedData = data + \"\r\n\r\n\";  \r\n }  \r\n else  \r\n {  \r\n formedData += data;  \r\n if (lastIndex)  \r\n formedData += data + \"\r\n\r\n\";  \r\n }  \r\n Send(formedData);  \r\n}","postId":"2009_04_sample-code-length-prefix-message-ba45f669-db06-32ff-ba50-472b420edace","replyTo":"7d3cec0e-567d-3723-8718-ff3e06d670f9","date":"2017-09-29T14:18:33Z","timestamp":1506694713,"authorUserId":""}