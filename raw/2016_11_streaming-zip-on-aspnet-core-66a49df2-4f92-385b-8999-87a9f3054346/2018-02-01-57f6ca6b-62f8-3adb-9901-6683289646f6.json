{"_id":"57f6ca6b-62f8-3adb-9901-6683289646f6","authorName":"Chris Pratt","authorEmailEncrypted":"eXClwED5OxgzW3PQIxs2kmvBKH7Sv13fSvP6QmSSnCpCdnQ75N0OQpNnxtgS7Yj1ow9DRMQKyzKKQT5/EIdhKtYuYrrxstkzTDDwJjtxhIfFGepoiJ3qVhu2Zh0vpjFP6M0qtHhAb46mDNXLpOv8wmQ31oDRww/zhbZCxwifCw+hGzonOZ2eQCCBc3D5a0tpoLQHN6rF/xnYzjQ5n3cgS7rTv6dl1hyx2JRqt/1y2aom/b2LZa9nu13gzbl97FF40gRInIuTH8PV9cluPdIzo49gzbSYbHZiY4HLPCY6UWz6PkDbfXh+g2+iXG+3Y2oJshW0OD4xX6lCaPLiEa4g5zoWOWTz4DchcRgryG813zMDmdmp8FN9msFzV/zQuus7ixd7/vysBi5kQCI8rKcMIlg0WmTdXV/hpshqvbau+c5MFnwSoQ2H9fzEfYuCJWQcafHsFxXJqah4zGDJHAOxQlRTp5C5ns5Es13vQ1WCLnkyLpYbQ30S752oxuH0JUYRGOQ5NuFA6dIaNioQR7Gdm8YpsaJ8V1F6IvekTRSK/iXupSalhzldQQ3RlmF6jIDmwb2FUL8MVQScubx669fxa0M1+01wGp2pgdHIcrBvy9rgNhzT668uyg8V/4RK9hiLaiHRdKkg7jpubAeBc7PrPfBkv6yUNxheL2qC4EVhMRg=","authorEmailMD5":"9d0a45dd92ecc2cb15cdbc5f80befb15","message":"There's an absolute ton of moving parts involved in streaming a file. Having the content length allows some optimizations to be made that cannot occur without it. For example, if you need to reserve space in RAM or on disk, you can do it if you know the content length. Otherwise, you simply have to make a best guess and then potentially move and reshuffle things if the content ends up exceeding that. This is similar to `MemoryStream()` vs. `MemoryStream(N)`, where the first needs to be constantly resized, while the latter remains constant (at least as long as you don't exceed N).\r\n\r\nHowever, as Stephen pointed out, you can only get the content length if you create the zip in memory, in which case, you're no longer streaming. The speed you lose by not having the optimizations that come along with a set content length is a trade-off for less RAM utilization and a more immediate start to the download process.\r\n\r\nIf you read through the entire issue, though, you'll see that while setting the content-length did provide faster speeds, by far the biggest boost came from setting acceptably high buffers. The reason is two-fold. First most disks are more efficient at large block writes than small. If you've ever attempted to copy a single 2GB file versus 2GB of many small files, you've seen this first hand. Second, having a larger buffer means that the same optimizations with a known content-length can at least be made as well for the length of that buffer. While data still needs to be shuffled around, it doesn't have to happen quite as often, leading to faster overall through put.\r\n\r\nAll that said, your primary limiting factors are always going to be mostly the read speed of the source medium, the write speed of the destination medium, and the bandwidth of the connection between the two. Those factors will usually outplay anything going on with `Content-Length` being set or not.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"46b49d28-4ca9-32d3-a56f-7403d899b9c7","date":"2018-02-01T18:29:29Z","timestamp":1517509769,"authorUserId":"disqus:chrisdpratt"}