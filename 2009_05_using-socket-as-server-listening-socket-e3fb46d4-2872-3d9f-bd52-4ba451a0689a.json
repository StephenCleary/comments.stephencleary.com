[{"_id":"7d501e1c-78bf-3b6a-bd96-f1b64bd943ef","authorName":"Ali","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/13277015394096768085","authorUserId":"","authorFallbackAvatar":"","message":"I must say this is the best and most organized resource regarding TCP/IP sockets. I wish you had it published in book.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2010-01-04T13:21:59Z","timestamp":1262611319},{"_id":"0801563c-4648-3385-8109-829b91b3c4d6","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"This post clarifies many misconception !","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2010-06-06T04:50:48Z","timestamp":1275799848},{"_id":"5056225b-37e6-3ff5-bb66-5b6d6c7a9a34","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"it is nice explanation   \r\ni have one quietions that what would happen if one to one connection is stablished and an other client try to connect?","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2010-11-29T10:23:22Z","timestamp":1291026202},{"_id":"7f521895-213d-3c3c-8965-e120791bdaba","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"@Anonymous:  \r\n\r\nOnce the connection is established (i.e., the Accept operation completes), the server socket normally begins another Accept operation immediately to allow other clients to connect.  \r\n\r\nIf a client attempts to connect in the time after the first Accept completes and before the second Accept starts, then it is placed into the \"backlog\" queue. As soon as the second Accept starts, it will complete because there's already a connection in the backlog queue.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2010-11-29T19:49:27Z","timestamp":1291060167},{"_id":"9d0626d4-878f-35c0-ae55-722c97c9fde5","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Best article I found net. Really thanks. I can buy your book if u write","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2012-09-28T20:00:50Z","timestamp":1348862450},{"_id":"5d519393-5cdc-3a3c-a43a-d5cd11b23acf","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Nice explanation of the backlog parameter. I would not have known about the int.MaxValue trick for server class systems.  \r\n\r\n-Brian Gideon","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2013-09-05T23:14:38Z","timestamp":1378422878},{"_id":"0820b7dc-78ce-389c-b205-22ba40b9af8e","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"re: Accept - The new socket is completely independent from the listening socket  \r\n\r\nDoes the new socket inherit the listening socket's properties? Specifically, if the listening socket was set to be non-blocking, is the new socket also non-blocking?  \r\n\r\nThanks!  ","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-03-14T09:53:13Z","timestamp":1394790793},{"_id":"c32bea8a-945f-3c2f-938f-4cafb02d9f79","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Yes, it does inherit those properties. From MSDN (WSAAccept): \"The newly created socket has the same properties as socket s including asynchronous events registered with WSAAsyncSelect or with WSAEventSelect.\"  \r\n\r\nNote that \"non-blocking\" has a special meaning for sockets. Sockets can be blocking, non-blocking, or asynchronous, and you want asynchronous, not non-blocking.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-03-14T16:40:16Z","timestamp":1394815216},{"_id":"0cdf8437-8b5a-331b-a414-265ba942a7f3","authorName":"isma","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/09993433847955674221","authorUserId":"","authorFallbackAvatar":"","message":"Sorry, I just have one more question. Is it possible to know how many connections are avalaible in queue ? ","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-04T18:30:28Z","timestamp":1396636228},{"_id":"bdac11ae-0759-3656-a421-5d4b55a122f1","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Not to my knowledge. Remember, the backlog queue is intended to just be a small buffer in case your server gets temporarily behind. You should always be accepting new connections, and the backlog should hardly ever be used.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-04T20:15:47Z","timestamp":1396642547},{"_id":"e3ca6ceb-8691-3c69-8cb1-a8a603a90258","authorName":"isma","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/09993433847955674221","authorUserId":"","authorFallbackAvatar":"","message":"Hi, very nice resource. Can you please explain what happened if the backlog queue is full ? Do you think that is it a good idea to increase backlog size in order to run load tests ?   \r\nthanks","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-04T17:25:47Z","timestamp":1396632347},{"_id":"f79b57a8-d913-3f5e-84ed-21095b5db192","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"If the backlog queue is full, then connections are rejected (before they have a chance to be accepted).  \r\n\r\nYou should not increase the backlog size when running load tests; the backlog queue is specifically meant as a throttling mechanism, and in a load test it's important to determine how the system will actually behave in production. IMO, of course. :)","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-04T17:33:01Z","timestamp":1396632781},{"_id":"f7e6542d-b78b-343e-aaeb-f13bd6257c3c","authorName":"isma","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"http://www.blogger.com/profile/09993433847955674221","authorUserId":"","authorFallbackAvatar":"","message":"first of all thanks for your quick answer. and for sur you're right about the load test :-). In our case we create severals instance of clients. They are all distributed on virtual machine. The backlog size is set to 10000 connections and ours clients received socket connection exception from a certain number attempt of new connections. I'm trying to find if the problem may come from the backlog size ... ","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-04T17:53:11Z","timestamp":1396633991},{"_id":"c71558c5-0096-34fb-b50d-8d1a9dea5b36","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"very nice article!!! Thnx a lot...  \r\ni have one question. When a new connection is accepted, it communicates on different port number?? because in java when we create server socket we specify a particular port number, like ServerSocket serverSoc = new ServerSocket(8989). So server socket is listening at port 8989. What happens when multiple clients are requesting? New connection is accepted as Socket clientSoc = serverSoc.accept(). So what about port number?","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-13T22:21:46Z","timestamp":1397427706},{"_id":"508026e7-44db-3485-88ff-e7ea1c1f0323","authorName":"Anonymous","authorEmailEncrypted":"","authorEmailMD5":"","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Thanks a lot sir!!!:-) This article cleared my few doubts:-) ","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-14T22:55:14Z","timestamp":1397516114},{"_id":"ac4b2455-97ee-334d-9974-1a36eb6f27de","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The new socket connection is actually bound to the same (local) port as the listening socket. This works because the remote address/port is different. I've updated this post to be a bit less confusing.  \r\n\r\nThe \"uniqueness\" of a TCP/IP socket is based on four variables: local address, local port, remote address, remote port. Not just the local port.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2014-04-14T18:26:47Z","timestamp":1397500007},{"_id":"a70cd549-88d9-3d38-9111-16ad15457f7d","authorName":"Mark","authorEmailEncrypted":"BO5dopN+zGVeW9GVv5kw5JOJL9mnu2T8yN24BbJdANlPS7rWgTfqYMzYHwQ/L8GZ1P6ghkrkenYUqwLrA8GMEM03eDuODRt8XxEjcDicES5D+FZbTLvb2j4zqa3wKSokh2NxoFpXReoTm/OJSWPIHXoRLZH5f74SHuiEJQHZ4lfQeam7p6HwIIjknrFHy3VJw+gF++RJtAZQadPvkvLL7BbGNiTphRF0pFLdHF8JlWiatEjuKS9yMCKl0pYeLcJ6E+GImrqED8ICW0gwhfh6d1gSawZ2lZaMTNlXFT1eI8xquDa7lvtAvOIZldemFo9NajGINP7UAInh33zvsba81pIVpWK0YmfCKEjpChzq7tGj4MMzj4l3sm2CDbOJUSD5URMRy+F1b52WX++a9PC14uJFL4DltrAPjyf+Ncyq0OmO1TT7ZHZMCasbPRPVc2XuJnZ9GrfuWrdluiTYPp48ooHEh05BpxKnTyfbPZWhgCSVE9FFBB7VQSrauJDr+ymuqL/g/LlwcpJp12Y9B4/qgWeJCGIJ35v18ElBUxOv4ciVSrjdxNlpvG+u6+psayRzuEbcC6TOvneaLcUwrEfGfaCLzZ0hwSbnFsBwWNXR05K+Xf4IjmrQ+mhV2lHH4L2nLza2XA8Bg79Ora/2busa5oojKN+dO249OtSdOmaivA4=","authorEmailMD5":"fc835b48a687e300d753902af6b5b6e4","authorUri":"","authorUserId":"disqus:the_one_and_only_mark","authorFallbackAvatar":"https://disqus.com/api/users/avatars/the_one_and_only_mark.jpg","message":"Thanks for explaining that a listening socket can be closed without disconnecting (I assume that a shutdown is also not required because of the same reason). I already thought that this was the case, but it's always nice to have some back-up.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2017-04-03T15:06:48Z","timestamp":1491232008},{"_id":"11b5f03b-ad7b-3a59-820a-5dbfee4971e7","authorName":"GJ","authorEmailEncrypted":"nMx7OrIbJSbCcRzpFxt3op/QsIsoTsSL1I8P4dtpPWkUviL3BDiFysyxtQX/FRhcYXO9I5IdACcIHfh2z+MIU30zKM8pZOOUOETDhlfhtMGc1wTxWaVoHYoaX+kSDppBX5o8jxmZ9C2N47qGH8OcxbdSrVwg8QjHLWALF3VLMV9JJH1teeQZ5wWrBOeuhiKuVsnlDAJNHNUqnkdWDWE2Lk+YixF8w718wlPHHVyNJuvohzhM5jjet4VDcjSafRIqNPV1tJpVYSjK8I1FuYbOp6UdckO2/v6+q0IbScXgigO29t8+0WDAtJ0KUITkCYCIFaB5QLHpoeSrz2BZW5anVpBd1KGAY2G+Goojmfc3ZKbjmcpWkjmyusFPVsdSyVwXbvSqzH1Eshuuh5FLslqEYsG6nAmd71B56KYTeQ0/igfGDBXiLJCp4IvXLGDh55Uw7eRh5ayvSsnhN+++YMFUnJBwcRV12gUrX2yH6EkVMdmRb2xxxiBaHn1y/dvLYU+XJ0GB9VP0+CDsrI4GA1muLQcQxHimiJrg0MPt9uljCm3bS664F1kUhO2dCOxannUaDN1k+hclrzeujfJEUDFqeUEJxlydZL83+2GMpe5rwixrBzoVKBjCUs83I4Nb7Ao1FdGKDtbII/GKxzn/ASG+HaVEEBXTK++WIHkKeayDMN0=","authorEmailMD5":"53e4cefc220eac057f36702aabdf6e6a","authorUri":"","authorUserId":"disqus:disqus_a7UBianRUN","authorFallbackAvatar":"","message":"Stephen, Thanks for this post, really good.\r\n\r\nQuick question: An app I've been asked to look at has two listening sockets open continually for serving new connections (port 80 and port 443.) This has been operational for many years. Then one day, the listening socket for HTTPS seemingly simply closed (HTTP was still open.) Our apps listener socket continually services new connections from other clients.\r\n\r\nCan a large amount of submissions from clients to the port cause this to close/crash? I only ask since there was a large number of submissions around this time. Is it possible for port exhaustion to cause the listener to close? The submissions came from same client. Confused, any small pointers greatly appreciated. Running on 2003 server. I could create a watcher thread to periodically attempt connections on 443 / 80 and if unable to connect then reattempt creation of the listening sockets.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"","date":"2017-10-06T10:30:23Z","timestamp":1507285823},{"_id":"d352975a-5cb1-3063-8806-db5ca8ad7c6e","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The first thing I would check is how errors are handled from Accept. They should be ignored (after logging, if you want). In particular, you don't want any kind of error preventing Accept from being called again.\r\n\r\nTo my knowledge, large number of connections cannot cause a listening socket to close on its own. If more connections come in than there is a backlog for, they would just be rejected automatically by the OS.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"11b5f03b-ad7b-3a59-820a-5dbfee4971e7","date":"2017-10-06T22:49:15Z","timestamp":1507330155},{"_id":"8d5987d4-0356-3a0e-b32c-21f60983321d","authorName":"GJ","authorEmailEncrypted":"LCXZrzhjzqaEWOOI7ZpdVbmJmOYdHTV9WN13Uo/EyQjjkfmeC97aINXSsDsVafmXmxIrJM9R7p3QphT1+O3090kLw3lGl8sTaWe8DQ+tSd+KERhk83VvRqARvSXDqxQEx40k7jNkItnLSOloRTUI4oXbewSDeCjrs+fVJbhmUOnUYWmXXYVfFPoi91fohS6sZM1WT8vZNbldhTpqaHf6DjiY3klLpuUec6s5xbSM1Bm40fI+2QSGhUfPhGWd8VA0rYouiqjvhpgc2FbN5xh/F7G2j2USry9Y5NAYEQwQQwOK48C/id6744vwyUj+zwCuRK230IOoBtX9szZVnPWoZ1zSsF+kN3JrVNFZqHDOrOFnck5VNNwDPwsl9lTtHqQ61HWUMX5qlQY1LxKqbLzjgK3jFlJPeJX+f5KSlFJODwIu3G2K5y82sw9h/nY0yK60e8EZ6Q5qfvVJobSYWX4RpWmcELFnWHMuulcFcIls0mLup3KcUjzhtXdjkhoPeimI9/eVYT7P0NzFTw184wBml1cAAI4Z2KoZBmgQG5TMTNTplU5hWrGKEPUdYKG4S43RxTMB088xkjb3oGzL8PCKZes5SabQf6V71hMDrpWzAdYeohL6EY/ZWhb5/W2Q2xbXsydxVnIu3w5U0eLvX/3lWzVh/pBrORf+NlI0JsWX208=","authorEmailMD5":"53e4cefc220eac057f36702aabdf6e6a","authorUri":"","authorUserId":"disqus:disqus_a7UBianRUN","authorFallbackAvatar":"","message":"Thanks for replying Stephen. Much appreciated. Adding logging on the Accept to see what the heck is happening. It's a once in a blue moon scenario so I'll just probs add this into the build and see when it crops up.\r\n\r\nAs you, I thought the backlogged connections would simply be rejected. Thanks for afirming my thoughts on this.\r\n\r\nAs an aside, I did find buried in the logging already in place another potential issue with SSL connectivitiy. It looked to accept the connection but complained that \"error:140BA0E4:SSL routines:SSL_new:ssl ctx has no default ssl version\". I must not have been setting the default TLS/SSL method for SSL objects newly created from this CTX.\r\n\r\nGonna try adding in \"SSL_CTX_set_ssl_version( m_context, SSLv23_server_method());\" and try and simulate an occurence without an SSL version. Never seen this before. First time for everything. You learn something new everyday. :D\r\n\r\nCiao ... for now. G.","postId":"2009_05_using-socket-as-server-listening-socket-e3fb46d4-2872-3d9f-bd52-4ba451a0689a","replyTo":"d352975a-5cb1-3063-8806-db5ca8ad7c6e","date":"2017-10-10T08:56:19Z","timestamp":1507625779}]