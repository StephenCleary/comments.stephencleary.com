[{"_id":"33a36c2b-ac3e-3e29-ad1f-a22742ed2a5b","authorName":"David Fowler","authorEmailEncrypted":"Zq48PrkUxGoyeGismMPGBlduGGc26t2HSQ8PChP+Gu3X4ve/2tTFE9MAECU5jiOtgFWM9i+P7PNlPJd7siZ9m8y0o2rWHZnqqpuNHxhGZOeOWktBhxEojloUfATd3tVLFt9BKWEy70iu1dbBZypbDReCbIBmgWsP8iJShl55j5PbdUn8qydrQT/Sf+YU9kFBR3J+pmw2NkkhBn0EDy/c6zy+oFPkhluqAgogcO5nq5Up/DGoaSY+QF7NC2YRrjEyK9tIU3KBNEYj4o0uiX23xfBEn3650IIAcAXhWgWiJ5J0+iJI40vekmKWxVvA+xxWiq6kK4ob8ETYRFT/JxTR1jDsW6ntuJZUqXrXD5GkhFYPZAb2Gk+5Nxg4w1SW7Lqpj3Ak4lIVo8YENdFOPiD+a6lT71TKs00LQc/Nm11V79MJ+9zG0KnOm3HzgJiDRUWa1C24Z6Eqdb7gLgCM4/VIJz2q3ahdhAtfyZPYmg5bXKI+8dwL51daUHSUWEW3fnSEcDdtOLTJsfZ+CZK790Ne2pAqjo2Ew0fJK6VW5Jwzw3Nt4jJNIwHkD9bjh4dAo0I1PrFaGau2HX9kgjgG15M26/5tca/xUe78vLHh1nFg9RPQJ3vJQ2PRDRRaFg6PC/9l1oD4UrnWgmgPsmNRwEaU4solOiKmQaqthscqvd93EPk=","authorEmailMD5":"1fe64ebb176498be5f73ab51986c6b7b","authorUri":"","authorUserId":"disqus:davidfowl","authorFallbackAvatar":"https://disqus.com/api/users/avatars/davidfowl.jpg","message":"We like to call those types \"pubternal\".","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2016-12-03T11:19:46Z","timestamp":1480763986},{"_id":"95de6f3c-1536-3cd8-96ea-a90f53329ba8","authorName":"Ciaran","authorEmailEncrypted":"WFl+xG9qH8yEjw6vuN2QEfQouzJQPY8iwFSyI+TYwbs42efHI2HrfTjdZO+K47g+924kd0XBsbwTKudPABrzsCPa2wk01zcW+oboDNoghaqwuceqj6XG8nn98BECG0Q+Dd2UkFWYW3GJjQocLyqLMKhS64S67DhWWGUdsaXGXH96wiBOoU+MUY7inF2c/JE85lHsO5wTpBG3O3q1LdUh2TIyX0iXgHjlASUWhCILrumsgYcBlEfD94w3G+JXanCBkY+ZRKiqoILWdAgPRxzrMU84Zpe8pPMv7oekX0Ev5gHJhtoNlGWfCTA6fGxaMd737S9LoXRNWK11w2YX39S9mJtGc6ws6vJuHbMnTo2b/HWH5D6GCztoUBiM3CWzztHr0JcP/SJyOe2wdW1eAAtkFlLoXJ652FKpz07gtPws1KNUGXi4Zdu2sPfxMBLLRpFij/yDe1jy0VtEqHvjb0LVy2iTJz9JY9c9R+/eN2hTVEFyZgtX2KuyVopEhH5rWxstAL8b4QigkVIgbGGUmznhBZ4Fk1U+dJkkvsQUQC3rYnf/zPsW7Djd44mRedG5BAjwB2D+hO1zNDjW2rXAZrMZLq9dt8JfeEe9GzPo4xdeJT8L3g04DYrfrzcEYfcI/dORa6fhZUi28j2FNBMHmkA8CdwDSfjEGN/vGrXSy0Ak86I=","authorEmailMD5":"8b9a3228988bf7a950f9c76f965a3677","authorUri":"","authorUserId":"","authorFallbackAvatar":"","message":"Hey nice article,  \r\nI would like to do exactly the same thing you have done here with streaming a zip file but instead of streaming a zip file contents I would like it to be the results of an entity framework core query, any idea how I would go about this? Effectively I want to stream an entity framework query results to a browser via a REST style [asp.net](http://asp.net) core app . Any pointers or advice would be greatly appreciated!","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2016-12-11T16:27:10Z","timestamp":1481473630},{"_id":"833426fb-fd8a-3a2f-869a-29090688e0ca","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"The normal way to do this is to just return a list of your objects and let WebAPI handle the formatting.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"95de6f3c-1536-3cd8-96ea-a90f53329ba8","date":"2016-12-12T14:49:01Z","timestamp":1481554141},{"_id":"122de461-ce0c-376c-905c-ede044ca6776","authorName":"Joao Rios","authorEmailEncrypted":"sR1sHLZ/y+hPSiRBt3DeT3Sc1xt1H/BEBUAEdsKX3qB3KUM7UkQnd3Kd1Cy0VOxhknPPCA64ii84pdOaOjL2Sk8T/O6mKs5jNT5E4hMLyjJT/AlVQAqKMZRqpw2Z5G8uPFu7Ak9oMmDFZT6t3jim4um5k4qhpT1M1uYn6k6rPoj2E4lYZyQDTum1w0HCv6X1nGjVpydDT0vhH0xz4sgP2ryy/bmYSodyEsYLS6S1eKkMxz/j5lFQ5Oda45Im30mm2s2nmsmsVzffef8rrfDR/2qkyAuLGs3TBIqmovLwRisi2CqePjzos1YnfKx0BuOmBEghoIxn23YNTV06FAwQ5gcVJDa/LiZzugTvLFBcZP3Xo3zppsTgbB304IuXRWjpvba9M1VWjDhdkwqpZo0yIDZSSR05BGxc/VXWLcD0lrcHpYyLBvUn1TsTNq2S9M8ZBC1zdO94UlXfu/fOQKCyOOpyHZNyBqZVrVi8FuH5eXOLcrNP35bfMuSkzDXcGHqH2W7TcxQE4GK4IbqmHQ1iHaSgMaBwFHqfqUUxofF9a36W4cHY23eVVP1nqRBLpfjZbcSOhlx/hf3lAz7pxny4YPhjw1KPjBdv6cWbAJgBgYpcKPi+M97D5YMZOO8WLCFctQ71YK5CqBOoLl3AG1ORjNYgR0IFe7Ik9rryl+DPbi4=","authorEmailMD5":"d83afad010b608c6dfcb93a53325653e","authorUri":"","authorUserId":"disqus:joao_rios","authorFallbackAvatar":"https://disqus.com/api/users/avatars/joao_rios.jpg","message":"Great article!!! I really appreciate it! My app (aspnetcore ) runs fine in development mode even with the production url files, but when I move the app to the production server ( IIS 8.5) I receive a network error. If I launch the application using ¬´dotnet app.dll¬ª , the app console log displays:\r\n\r\nfail: Microsoft.AspNetCore.Server.Kestrel[13]  \r\n Connection id \"0HL51OH8H5MIO\": An unhandled exception was thrown by the application.  \r\nSystem.Net.Http.HttpRequestException: An error occurred while sending the request. ---> System.Net.Http.WinHttpException: The operation timed out  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at System.Net.Http.WinHttpHandler.<startrequest>d__105.MoveNext()  \r\n --- End of inner exception stack trace ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at System.Net.Http.HttpClient.<finishsendasync>d__58.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at System.Net.Http.HttpClient.<getcontentasync>d__33`1.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at ClientesMetrocal.Controllers.FileController.<>c__DisplayClass5_0.<<get>b__0>d.MoveNext() in C:\\Users\\jrios\\Documents\\Docs-JRios\\Clients\\eia\\develop\\ClientesMetrocal\\src\\ClientesMet  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<invokeresultasync>d__32.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<invokeresultfilterasync>d__31.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<invokeallresultfiltersasync>d__29.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<invokeresourcefilterasync>d__23.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.<invokeasync>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Builder.RouterMiddleware.<invoke>d__4.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware`1.<invoke>d__18.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.<invoke>d__3.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.<invoke>d__3.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.<invoke>d__3.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.<invoke>d__3.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Hosting.Internal.RequestServicesContainerMiddleware.<invoke>d__3.MoveNext()  \r\n--- End of stack trace from previous location where exception was thrown ---  \r\n at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)  \r\n at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)  \r\n at Microsoft.AspNetCore.Server.Kestrel.Internal.Http.Frame`1.<requestprocessingasync>d__2.MoveNext()  \r\ninfo: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]  \r\n Request finished in 21884.6286ms 200 application/octet-stream","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2017-05-19T18:35:26Z","timestamp":1495218926},{"_id":"b85b2496-9fce-3eb0-a992-44827e7f51bd","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It's been a while since I worked with this, but the first thing I'd try is reading the `Content-Length` header from blob storage and explicitly adding it to `Response.Headers`.\r\n\r\nIf that doesn't work, you could create a wrapper CustomStream that is seekable (CanSeek is true, and Length is a constant). That would be more code to write, but I know that approach would work.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"cb10f95e-0219-383d-bf8f-dce4b76fc823","date":"2017-07-14T13:52:19Z","timestamp":1500040339},{"_id":"cb10f95e-0219-383d-bf8f-dce4b76fc823","authorName":"Jean Roux","authorEmailEncrypted":"d+BpRum2di75YlsxS2VchH1uclzmdjM/dHbeqLbRqWotouyIZDr7vawC6q/1e1wRFsbVC0xUq51iM9clz7VRTsX1PG46y+Fc2O3r47HjwfygSBfEJOZl2VvCTPWAccZEpmYGdLLyIPtQjxPdQZ+RW3Is/erVND7rJdndAoOEiOCmmstMnzh7XKys7T3Lwsl94dHq0UBIqDenPG8J5P78AdlTVde119cqO1IXlarLdvDm5+9yGzO723UK0GtjWfjE0fkr3BVjhdJ8LqJFaEEbrtU6MvJ8RoJDqTviMezG2pip7VJotXnYZJ5XJNDPaw7eNtf+YvbeQXv6hLCJ8bl1AUWDvn2vQoufwZBxesZqShdtz3pcxspZ+5+Xrbnt+OIQDwLj0UXK30atuiKzCWg/ghOvfTSy2RsLTbOj2wNRLd+9pWRmnVA1WdpUeCdtawSMQkeaXtQeMannMO3X3wcfqDXqWfoJu5RFSutiAmbugN2t3U60CLqyRVeZDzYKcUv8AAU/7EhGV3TWhHPm5Xm8kaGlK//3K/2i52jU7KkrX9IDKVT8pSe3uzLKqW/rBvt9P0I4BpGU1a47JG/9o8o7M+H0OLv/X6l7vBFKNob+9/5YdWssZ7BRDNAmbTKn1zQ/Afvd6dKe1VpsBIPCHSc7wc78RltyogsAu588TthVAyo=","authorEmailMD5":"a2b4b9028e9b3dff221dafd99789ffd0","authorUri":"","authorUserId":"disqus:disqus_EVflszDfJr","authorFallbackAvatar":"","message":"Hi Stephan\r\n\r\nI've been following your async blog for a while and it is very insightful although sometimes a little above my pay-grade. I am busy with a normal file downloader, in our case video files. We are using Asp.Net core. In our old project we used to to the whole thing to check for ranges and the chunking a byte array to the UI. However in Asp.Net core I tried to use FileStreamResult but did not work as expected. I used your example above but could not get it to work properly. The problem with the FileStreamResult is that it doesn't look like you have control over the \"Content-Length\" thus t he browser cannot calculate the estimate download duration making it an awkward implementation as the user only sees the current download size and not what is left.\r\n\r\nWhat I am trying to achieve is fetching a videostream from Azure blob storage and sending that down to the client in an asynchronous way. Can you please give some direction here.\r\n\r\nThanks","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2017-07-14T12:58:35Z","timestamp":1500037115},{"_id":"3896eb96-005d-3057-aaf1-900cb0479c40","authorName":"Chintan Dalwadi","authorEmailEncrypted":"HuNkyfCf9qPIYTmRL131fqVKIzvj5Zv3M1dSrhYyxi0kt9yoaijSii3Cbq8Qzrt3TtGhgdqwP5vX0uVPtRuegaUSypHN6ppdyzMZfXk6x/d8NUqvvZQcPrAaNtplcvzIUu+S9TVxv4P9oYNw2UpeSxp8mG6eDgZaE+dRibGztRf77vYnfORPwvi7h/zxoUClDJ03nVRFGG55YuRVmj3dNqCGTQZ35+lREv6WzCb7TyXPYlnZFd51+HephL1bHDAyKy0VQf0n2sCws5Jp/ks5mU4I+nTVimGAUy5WFJrN23Rz82lzNhq07CNZW9gQhzQ0hNYeLJPkdvF63K0Rq5tJZJsQ6Xv46OuQCUpA1UrIEYSs1cBzALTdwgMnMBqkNxXIASgEMh4EkfBTZbuuDY8fGu3Z1otrSibkuEPWTWffRTuOk6hINReVvKqloGjCEKTB8VsdBx7X9WJZSrKFlgrs5iqsPUYL+dOLzRi/5iOgFbEMl61XbQ3PQ9w3IHlBDICMzGz3+OGF+g/iCcAo3WRbbKf9gRPP5RdM90UyOJyhLxHN6ULyDx4T2oX64v+d8r0Dh4xv7UikWoxSvhr1YSHdSSRMxO03JbDGd4KNnZlJO7SAq/LhAtLmZ9a0zhnsLYj2cdj0ZSVak/Z88AX0ssPFm6G5azgiYvC/8p0NyUCTXM0=","authorEmailMD5":"37f6f0b085fd6d5fae5b596da3b36ee7","authorUri":"","authorUserId":"disqus:chintandalwadi","authorFallbackAvatar":"https://disqus.com/api/users/avatars/chintandalwadi.jpg","message":"Hi Zip download spped is very low it tested with 120 mb file it only 3-4 MB/second. Can we set content Length.   \r\nThanks for this article .It's help a lot","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"833426fb-fd8a-3a2f-869a-29090688e0ca","date":"2017-09-03T19:29:08Z","timestamp":1504466948},{"_id":"3d9f1e28-830b-3c17-91ff-3594937f1341","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Zip download speed is a function of your server's capabilities and the latency between client and server.\r\n\r\nYou can set content-length, but you have to send it before sending the data (since content-length is a header). In order to do that you have to know what value to set it to - before sending the data. So you can't zip on-the-fly anymore. You'd have to zip up the whole response in-memory (or on-disk) first, then set the pre-zipped response. So you'd use something like FileContentResult (in-memory) or FileStreamResult (on-disk) instead of the approach in this blog post.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"3896eb96-005d-3057-aaf1-900cb0479c40","date":"2017-09-03T23:28:06Z","timestamp":1504481286},{"_id":"39f4b6f0-fdbb-37e6-87cc-66de43b10a90","authorName":"Chintan Dalwadi","authorEmailEncrypted":"UUQ7hLua957ItFgLqA2/ZJ+caBYlJjC8XyGSKVco0FkYw79oQ0NsOoxa9qQt+DD+RKVTFLCfZD4ENkmM7wsTpKSiCmHOpivQPUDEIoWsqvoK9uGOcPUishlIU1508Qlpee4C2a52yns4ekS+tnOJTplBf8p6vTzLAKu20kzRj7iDXK7vm/7plel+F1X3SvzZlQMLjRw10+sg2fg1PwfTXwu7Nw03kOUlwwgystcCfAkD6nVgMPlDSvd3QInNkbVKPnBAE/if+zx9uimZ1QHtSp2fCHBNj9/gxd6Jvdu9LcOmYa2k+LBc8q6kiyKgmOnzMJ4gIBnX69CkT1Wre3/pJmblA4S54dZ3x/s6P6qm138W0YhYx6mxsc5BpkUSueVFH2u5ufzmwJGLSLanXbuTPbVqkwqXPkDuIZQjveG/hHkgnPtIRoe1Ol7BhkeREI0uE89sSmjzcqd3Bi/m+Qw3xxujEtR8inM4oJnH21rACo+CuW22A4absTAykq1wufINwEIBP5n3ZOy9oO0D0m25XKvG3ibM3IY1odtm4WWumyncHN27nJNqdXkwXfnK3Q1rgp75NOwmCDGh8Bq42Wm8gLjxhqUh84exSjQWi7BXTh4FNd9REHbcBNkzuNFmzO6836UgbezF6diUJwp1bBEjiiguDXqqHXQtRV5byLGUxQs=","authorEmailMD5":"37f6f0b085fd6d5fae5b596da3b36ee7","authorUri":"","authorUserId":"disqus:chintandalwadi","authorFallbackAvatar":"https://disqus.com/api/users/avatars/chintandalwadi.jpg","message":"Thanks @stephen_cleary:disqus   \r\nI am testing this feature on Azure Web app with S3 plan.  \r\nand client side with one of VM which has 820 MB/Second bandwidth.\r\n\r\n:( Any other approach to increase speed like increaes buffer. We used File FileResult for FileCallbackResult. Is there issue with FileResult ?\r\n\r\nOr Due to missing content-length i am getting","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"3d9f1e28-830b-3c17-91ff-3594937f1341","date":"2017-09-05T13:38:18Z","timestamp":1504618698},{"_id":"591ebdc2-31b9-326f-b6ea-4e0d597ebd57","authorName":"Chintan Dalwadi","authorEmailEncrypted":"Nh/lqK5JBWQGIDeFCK5HhPJ/5EetXu9OjP9p04ERxpLTDZm/N7P9nP3H4FFz8x2M+hSz2t+Vn2YYWthSAg/azdRSsweXoqh2iUI4n7XngCSxNIoUXtDoxamxZpgE8fO95Lxg5WfeBm4DiOA3NOdrwGFuJLi91WfkrJGsxERyr7pFslvwbTWh075l4rOkKSM9OH+yWCeCsqgPAWpI5yRkoJ7X+4DbmbmoFBb4AIJEI6PubTOYiCfkytmDFoA+XGcX+Xg7EoP9xfF+JYpIZcvKvnUuy3NjvO4NvIOD/6i8wLgZ58mbucPUi8Am4GQMjz/yuKsnIGJLbV6dTe2pnR1CvZEn68nmObVApNx65Y+TzdX8YXuG6pJnGOuhWVzBOba36IjPIqtouzFfT4WjYseecW4YChCa4qJNd1ohctnEM6UPt/bZRzQDvUh/fihXxydOLc5kBxdF4ndb6fptwZLBVQkF2u8zgGHED1yXZlQTGdnDlymMwfUFR13BCZJJZypeL6B1Qm2nJNjYciOSk0wLmksxV1EeMbLBHjpkztzaDPdAjJf7nFzqLSiVniMy1vlbflfMERtQC/gVV2BIPFBQTCMNuqeZ6qEWcE6dklDdzWWwcSrbP55KfifqWLUB0c6f/bLOinFe4xdTVZXmwu2r/yKo3C9UP6atBkyQakuzb7I=","authorEmailMD5":"37f6f0b085fd6d5fae5b596da3b36ee7","authorUri":"","authorUserId":"disqus:chintandalwadi","authorFallbackAvatar":"https://disqus.com/api/users/avatars/chintandalwadi.jpg","message":"Can you please try to download any large file without zip from api. I am getting max 20 MB/second speed if my file and api in local machine :(   \r\nTested with .net core 1.1 and 2.0","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"39f4b6f0-fdbb-37e6-87cc-66de43b10a90","date":"2017-09-05T13:39:30Z","timestamp":1504618770},{"_id":"2341b67f-26e7-3263-9a4b-9e8b615cafb4","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Missing the content-length header wouldn't affect download speeds. You can certainly try using different buffer sizes.\r\n\r\nAnother consideration is that zipping can become a pretty intensive operation over large files. This is especially true for most Azure Web roles which tend to have lower CPU capabilities than your average laptop. It's possible that the zipping is your limiting factor rather than your bandwidth.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"39f4b6f0-fdbb-37e6-87cc-66de43b10a90","date":"2017-09-07T18:29:08Z","timestamp":1504808948},{"_id":"d1da3beb-c668-330b-b9db-4c777c05a98e","authorName":"Jeremy Simmons","authorEmailEncrypted":"BNlikdcWKkRms3rVE7u8Zye4G8XNcyF99BA+oEHVOcBZUj7J57vBBY/YTDvYs+n9r/5dT8ROe+SCPNrJt8qbOulFpVeJSv8fiw/WCR2C1OmqjFjY1edVYlgC8XV7a+oDrfBbgPGY2KgpFFTmc6NfA1S+bK2mF5D9azyDHk2w/nEW3+eqZE0RoLEZoF1yGuHK4MuXFRW0mfH6vDBvKvEUM6zhcZn5GxH2jnlOyCUW9Jf2zN80DxA3dgbRwiCr7zzIOPkzaOaARJGoR3FUao44wDH8ltQQduH1CvHtjKxRcGERa/FlB6N2r8747Z3QqZklM9SsWbveLH0WcKXGjb9nd30ll/wujrVHubalAfxUOUIA12HkVWkhpcFM0nqlN22St6p+jjDIVG0DCwlL/NyCZT+2JRqWx13cBSiGAEswUFf5eCE6aN1WuyPmCbwbgCgG1D7uKkG8brezCg0L8oXzlEgcIxsCg6cn6sZpHBMzCOh4MZwRGMKmTn2pWwZX6Sjb8YkswmdOtjy1Hq9lEQQzQLWTTkUP5FZxxMa7Y0+qiu9CJC6Vyx95MAE2Rhb+6Agzl7t3Bz1j5a5KHlr+lQtI9OJTx7nC5E1KP8/Ewg6awe+gseR4iJS3BdlpntiMVJeN1kCZge2VyPxgZ+UdIWv8dG8xHi6ctNMrtgCb2zHFLqI=","authorEmailMD5":"99e6c0ee35ada42e0ff6ca9877df6504","authorUri":"","authorUserId":"disqus:disqus_eRnmkFAxQj","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_eRnmkFAxQj.jpg","message":"There's talk about how Chunked vs Content-Length does affect throughput: [https://github.com/aspnet/Mvc/issues/6045#issuecomment-304108560](https://github.com/aspnet/Mvc/issues/6045#issuecomment-304108560)","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"2341b67f-26e7-3263-9a4b-9e8b615cafb4","date":"2017-09-11T18:35:52Z","timestamp":1505154952},{"_id":"29deac70-bdfa-3657-b7c9-4cf6ba548d7e","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm not sure what would cause that. I recommend that you reduce the code to the minimum necessary to reproduce the error and then post a question on Stack Overflow:\r\n\r\n(Sorry about the delayed reply; Disqus has been sending a lot of comments to spam and I just noticed today)","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"122de461-ce0c-376c-905c-ede044ca6776","date":"2017-10-04T16:21:17Z","timestamp":1507134077},{"_id":"184f7669-c860-3659-84c7-80256cef6b6e","authorName":"Joao Rios","authorEmailEncrypted":"ttigK+7Q6ied9IrAQ6WgnxlRkCjiE4jZnQHNxvKujXhteiwR+hgq7BLgKTbL2EgShgqoWWvvpBcfWx0h7c+QyDPQaVSzahfpQ76/diD1y5G68zZV4f6RVGomdEUYgNOoucIsraJCjLqmHbtbCHrfOkYO4xXjvjirAxk0w0/dvlBQsP7+4kwheibz9wi6ZIxPNi4prAZK0zePwhhvvPkT/Q1l4MdkehSfknfqpPwwUnAvZhfMXEetvXpcMKEFNRAbjGK/+IkjiV+uRmexQR9owbmhVOTlmyWg74/np86D1dcbSnjLkhVWdmkfY8Hxu9dtYQnCtikrJZFUhNgm617XMU9aEP37Ghbb1PtE4wGtN3RLgNZFCNS17hnheLEkgVLyAuNxnG9og2t9NfEFumLJH/55XENa9B6NP1tsFxFqpEJKEVNe9ba9tCTm8T+5pa2RrTkvX523T/C3cS2ggTbgjABWiMCSirhgiDq2pfVLbJNVp060B74k6TiheaJTshHT2gaS2xSHjNUmxYrb3lKG6QpMJ85ACePoqhfLIuQ93CETPuIcXbDSK2QLKeZnaNAncIUfTyDUvfq3LIMrVTxyEpUqj7L31X1Q8LeMzsSNG2L+INN1iV9v+dZd4Lf4GiWEAB7QsOY3ldj+xb7hMao5CXIpB4/fcD9BFTFDnIfKEoY=","authorEmailMD5":"d83afad010b608c6dfcb93a53325653e","authorUri":"","authorUserId":"disqus:joao_rios","authorFallbackAvatar":"https://disqus.com/api/users/avatars/joao_rios.jpg","message":"Hi Stephen, I solved it resolving the 127.0.0.1 . I added the line below to the hosts file (mydomain is just an example):  \r\n127.0.0.1 [mydomain.com](http://mydomain.com)\r\n\r\nThanks","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"29deac70-bdfa-3657-b7c9-4cf6ba548d7e","date":"2017-10-09T09:42:27Z","timestamp":1507542147},{"_id":"26b52abb-3419-3a04-9bc6-8c769ea1d160","authorName":"Alexandre","authorEmailEncrypted":"fU9UjRcrcoCMDMaeIOK8diE64I9zxdiyR2+nle+uEbnTxH3CIQHCkedW/TYc/gw0+b2e5o7XPAtvWQpPe7oC9HdrBC85Dq5YpvxvcbYL2qXe2DhWZ1AkR9soBmOcqqRtAIKdPvvcmCXWjAMybuYcaR3mUNeYrepTCO6wu5jbuiV4qpUZyvjj1pwkpAhG7VJt7pTHWZKyU/f1o51lJemJeF/bSUYY7ncF1+GKHm18vniFbW+2/n+WO+ZR0BPH2RiSIIcJllobDkPsdPRMymwznZ0rtwVL3hw96iDi+znHhAPOLcosRvwqgFb1kQXY+1zWBZv2ro3E9OJM2RVYDUGZgTp3gaEe1d4dnkGiQI5jzGDe5ZmcLU87Ay4kgWFm/3HXHU5JACxg1o9Bukcr5fnPjYN/bj56s/TXHO8OeeMneUJvj9uvubavfgYNc0amYy4G/WxHXY7T5CgHUEyaYocuZIQ9h+DYPz/c3fW+oWWC+v5t1GsT5ejKkB02fhO3ysmA9MkorJoar514LcDYn1L6D5ngY7PW8dE7pm8ba63bxRlsJAEAxrBnQukpPSW4GnsadhRLsxtA8KLMuEzByHJ6/HD4a9fj2idCqId7UCcULaoLtwaPbVcslYtwiPtIZnTJCR3/dEyOwoarJw2YrjtUbAZrx98Glj2sU7eOMdhECyw=","authorEmailMD5":"8a498979b502ccef94b0233896f448e1","authorUri":"","authorUserId":"disqus:disqus_QVAUurATHx","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_QVAUurATHx.jpg","message":"I have been able to fix it : SetHeadersAndLog(context, result, null);","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"92154e3b-6148-3219-ad89-f9f7b8375f2a","date":"2017-10-16T18:53:37Z","timestamp":1508180017},{"_id":"92154e3b-6148-3219-ad89-f9f7b8375f2a","authorName":"Alexandre","authorEmailEncrypted":"SRknNUxfbPTF2eQiIvkabZcej1JOaoXegzt9UP/j/VsXiZ+7ijPDlFAtod3DjZ9/58EHChJsiF51tA38R5vsl+HVXWFtsrLm75bNjteCxGoUbAKFTp8yHiMoroJiWk1QaIgr09WU7uBEaArhm+cPB5etpBaKHH74x5m/4K6jDzN8LNrk1kMHY/NtT4FKqrCI3gme5QqnFWnl2BBfvG2p9uqwLHgse/Nb7bHIineWkUbHuUqlb2ZIZKBo8Z+3kadSk2rstfOEcwrKfEU/pvScxigUEYMqrHA9Yj2ZwWrDnaXdXByZY3ZJLKFId6i8trIWDHzPP+fBrmBEBg9BKdnylrRfudIepiH+UQIfuFcvWC1tC4shWCGYid6MHSptBnRzDcpxL0garv/8E6b4cRFaUPQvJe4uZFW7Cj7n2e/GdqdnyOtYPhAdfzXJzJQAhV2zkqYAAQ7wMYaJnoWyAjnCOdz/BTlRTk8StIEPAOOz1/enV2S7q2n1urnzKiPHREhKVeJaiC9XL76aTb9V+ShCj+khFkVfVG+I1yYUHCO636wMStcK6d1sQ0aom7vy3+ZOFyEEOnHJ83BJnNBhiI1FRZl6CwdG9cMouygZzlPooW94s/4nWqJJCnSQrxLrnaXHMmfRgmQbU4X/twc+psofA21dfGZbVQyz8oGw3VLNeXM=","authorEmailMD5":"8a498979b502ccef94b0233896f448e1","authorUri":"","authorUserId":"disqus:disqus_QVAUurATHx","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_QVAUurATHx.jpg","message":"Hello,  \r\nI am not able to use it with dot net core 2 (with mvc 2).  \r\nI got an error on this line : SetHeadersAndLog(context, result);  \r\nfileLength is a mandatory parameter.  \r\nThanks,  \r\nAlex","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2017-10-16T17:34:08Z","timestamp":1508175248},{"_id":"46b49d28-4ca9-32d3-a56f-7403d899b9c7","authorName":"Darrell Tunnell","authorEmailEncrypted":"RWelfglaT48bzskea4O+ddXP099k+IIkimBYjlCMuUZ+DxQRwkNVAAq38FWt21U0fMltb1wibPwVnX3y+/RYFZ3OAbs0BEDzK2nbgTpQKCmWlf1GExix4X09mKuOmqiwIvAawKL3mL8OBYIvCgbfr72FT7rNf5Tjmzsb5QV6AyX8QF7JUC5r8C6tWbPeM9hnEAen9bykYGHEomgvQXE4JKKlZuTihWPGxICUoFi8b9KACCS2lxMt4QSA7uGF19WV66DX882Q7wTyG470xVuBJ3VURvqjHeZStIx/ZDxlrSR2iTa2u+rYiiM8w/12eb710FI9St9N+tUGYE39A2LTAC+Wa2tvNUbm+BmV2LS0nFWF+MXdarfPkrmgrcr8z0M48VFF8Dbp3TVMjpfWepa/+++za+4HyrHKJ36Ut9+ASlPUf/e6zKOpK+kMk9O36z01vsP1hX2uYTPGqyk+ph72rKjraq7Ju0YDXkQXd7YVGvWqmdyMIKWF97tbH3+q7Mdbyv0P2sphIerltb46GtZFdPBEw++VPyCZPYDH7jLzEmg8LEb2DhoLv/xI7OYPYik6sDEMbYe0GotQCEJhbpjOEe5ws/kL5DoltZfBwZngT2WObSHyEoJRPes722zfmWjAvhGTtvrTyqo/SlMimrLc/fgq5rb3iOiy4fuIry7k5Xs=","authorEmailMD5":"0bb5aa0713109cb69634ee5e6261f6e1","authorUri":"","authorUserId":"disqus:darrelltunnell","authorFallbackAvatar":"https://disqus.com/api/users/avatars/darrelltunnell.jpg","message":"> Missing the content-length header wouldn't affect download speeds. You can certainly try using different buffer sizes.\r\n\r\nNot true.. Setting content-length does seem to impact download speeds in some scenarios. See: [https://github.com/aspnet/Mvc/issues/6045](https://github.com/aspnet/Mvc/issues/6045)","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"2341b67f-26e7-3263-9a4b-9e8b615cafb4","date":"2017-11-14T16:32:23Z","timestamp":1510677143},{"_id":"838ceb5a-9942-389d-83b2-698dbc9c2e0e","authorName":"Remco Groen","authorEmailEncrypted":"X+vlS0LYCUdiCeb2uUJ+JHUJxYmEPZFaX47sQ48caFBw8UyMkd/cjfb9qhkhHAbSojP1NjG2KWi8cgV8OniWfVVzI+cAtqPvOOLpTXx1SFL3a8QIK/QxZgngE0SEkCXCdM6+nRU8TXs6n4YHOI8JvZJnWHfBhGihsTg7s1xarVYSTDNT7Xq6kZZE48si4v1cgOYtkPoESyrk4TpKEWqpUuHjWxfN+M7lM+PJD7LH0IXOQUQAydNERrDQihqPWMKVrrO86FX1vDe7b/J6vjCA7+Qy6lybmnPy74UFoWVXezLsNtwUySCvUe43kCaDF1PEtNF6CoNx86b4dmPd1d9ulAWNMBMuZBTQ4rW7n0qHZl64/4fnRzYZ2Yicd/hmR3vgALQvXvEnHT0I+lBNjaEA7fIjoiUtl28NUvoHCRf7aRuzXrmJsQQywCJy3RBqswvhQ5OjwL2+QPNQb6Us0LlTZABQRb/tXvoN4sRUTIlRiLGzkgE/MUAKJSNeG3bKFxpj9L0+E1ZJjrdMsU2Pd92XODwfn60eiXLmPaOw4aAqUR04O+X/1H80f81htzEbGn+xrBSldMmRCL42ZH+h2Hlm3EeOZdi9p3u8o5ruj03374gU2MZUaxk3P+bUWuqEG/c9Uzfd710NiUSdF8USSStupLfsMSKIrVBauCHBex8QwNM=","authorEmailMD5":"708442f0947948957d3e006edd30c058","authorUri":"","authorUserId":"disqus:remco_groen","authorFallbackAvatar":"","message":"Thanks for the example! This is still a working solution in .NET Core 2.0 and the user experience is great because the download starts right away. Appreciated!","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2017-11-24T09:54:48Z","timestamp":1511517288},{"_id":"68d011de-396d-3651-9b98-b6b2cd066a4e","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"It should. I've only used this code for a few-hundred MB, but there's nothing in this code that reads all the data into memory, or anything like that.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"db24384b-db91-32b1-8be7-c7f4880642ed","date":"2017-12-18T13:27:57Z","timestamp":1513603677},{"_id":"db24384b-db91-32b1-8be7-c7f4880642ed","authorName":"rbonini","authorEmailEncrypted":"hQIrv6ubKYEHuU3hg0duxn/6287lYZwKNy5K0cCntPG4pWUzFWwJyy8QV0Pb0/FIvPJxtkYDDWD8C09eBqEpt1bC9ckn06QdN7i+PT/sdn9/Q+SzOYQyMk/KKq5ffswWZrRuvu+clgnIxsSX2021eHW0ED/zYQTisWBtZyp99W0ka8AgL/xWgOIkTjX/AoWQdarP9EfzTObexDecMNc8ebx2ESLNn/uJr+Kojt9Kpo+se9Oq97KSBiF5XAy4Rx/VxV2s+5PaBmRWWApeOTa/guOquJDwbLtfJOfyDy2LBDLZN/uXfdDoafyKqnwA5xfHs5cjVxgJPixhvT7/SRjgC9uFDfpRhIYfrPSAOceNqfGH4xWQYR0pMSAVl1w2q2Te/XqXa8C3PnzUU4NHbXAA965Ijdx8fpiIDiG5MoudpN1RTYlAx52iM7S3uksbiSHnY/9vTiIEa8ZJ+1NbZUgngwPzqlLW7CLeL3Os0lhz1oShNi3WVMNmagmBguUkxy76MnX8ETZGkLYqyVQ4qO3S4nQD/6xZJ3eu5YLzCYMWg8G+X/ZgvTcAkzziwOtnt0bJohmnuMYIZPocHQ153iYBIibSmgq+ZsGkNhofbMcu+jM+2WkW+T79GoJ5Cmi3Om2eQZJ7poryXqFhL578eIbCUmmMuELO9tNHSGkH2/z1WmI=","authorEmailMD5":"ed2fb2cdad86f2ff31f86a8a099cd4a6","authorUri":"","authorUserId":"disqus:rbonini","authorFallbackAvatar":"https://disqus.com/api/users/avatars/rbonini.jpg","message":"Hi Stephen,\r\n\r\nDoes this approach work for large 800Mb+ files?\r\n\r\nThanks\r\n\r\nRoberto","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2017-12-18T12:29:11Z","timestamp":1513600151},{"_id":"88632f1d-722f-3d83-93f1-a29b608a2780","authorName":"Joao Rios","authorEmailEncrypted":"gWhk3nVJSrszGydqrpU8tzJvoNuoSotZAnFplk9prBVXPQzEjr7MBTSHgfRf9KPrEwTf28FWjP+khPgrzSeOVcAKaA7qJjKxOGQl/z7nmYfNKwcVzMDOZsqySXHHW79p12vPEAaazW3iMWyzDAszwv4+a7VJRzY39S3mzFZuRWC0ik43lntSZYXdOteWoOXhI/f2H6QG+VGpsVtfe0jYmlBBE5jmD7NQ9B5gi10NHmSMHuFPm1Vynq8XelMSZzkokl7FwmflApGrLVIvkZqfJpI1ayM1Dh43y7VB10EnacHIv2MkjzXp2cH+HyY3fAdgY1R0e1BpEx7d0i+MYaaViJy7RZ/DihSTAIY0Shhz/EQBWesETdWY/26313HdsGd8iQTw9q0MORc7YrCXCNQ1YdyOYK+bTQyIXqQ07gWWAq29WAl3uu5P1iUqCl2gEpWWvB1NecPm3FvvvCzuMk0FFTw+89ADbzkkHUD47xNnU++c5kQoi8VDDBoY8FjifaGE6MgsAtDV+sLxHO/QsZYLPk0qneQ0z3tYVaS6bh0mQG1M40Ey+NG8tHYOyeN+XvSm52syoiD3u3NC3HT+kPJFnBTrb46cl3c38RzjjZFiij3R3CvE6ybuqaHhHyDKShBbOnipW5jTdynRWHhH9b9+kQRrMjpslp1fUXn4+6wh8SA=","authorEmailMD5":"d83afad010b608c6dfcb93a53325653e","authorUri":"","authorUserId":"disqus:joao_rios","authorFallbackAvatar":"https://disqus.com/api/users/avatars/joao_rios.jpg","message":"Hi Alexandre, Same error here when migrating from Core 1.0 to 2.0 , fixed with your change, thanks a lot!","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"26b52abb-3419-3a04-9bc6-8c769ea1d160","date":"2018-01-23T18:13:29Z","timestamp":1516731209},{"_id":"57f6ca6b-62f8-3adb-9901-6683289646f6","authorName":"Chris Pratt","authorEmailEncrypted":"C9wDh//nczs4WyNcT+B6QGGrAFDa5Ffb5sF6T4q/L8nAfpltmOBxP2dDipB3pcAx+Wy7ch2Ce6PgSVx10BR2vM67fnBKFNO57nrVPwc33/aUKEkJAkj2rR12Nyw9vcZb5yvYYzq0HcA4gqZXl4xxtHWztP8/0VeAwSov13146lAqv0uC9Cl0UbhVQoQ1sPjbVTCxyh9a+OU6Ni0PPYF9sfu45M6LMFVayT8G+J5k2p9nBZxEHFR7Dk9CelMO52urSzXyjT0HnDtfrSEhsO6qw10edUGsE/7stoEwUyEnIoVqqkEw/XnUDHcvaJ3huBc9AV6OAdibF03BzdCurzCYZDmj2UcMjFnI1RzaaPIso6T7Mhp0l33Lxkxa+J9aM4L+co2v0sNHvdXwSA4z47VQ1ORxQBE22hEFOd9NLsp5oPXEXzUEamP+mPAu+DgnWOcdfF2y3GTDYk81qJsOvzNen3iGh88OpN3Q8PTgHYotsUlA+QH1AsRtKaeBKdTqX/M9PsSX63lox0U6wGG2LCtBMZFj0ocQwvfLN7ujA2OYgdz3HqweBMqYuFcwxOwX3tbj9tC/Xe6ukabQy87Hy3E703tbEsxeEYBO9nujAJZWrjYDcXDhaJ3VhQOAG5UNxHWHptKHo92wsBPA7LG6uZefNorpipusY61Og0o8OIBTOoY=","authorEmailMD5":"9d0a45dd92ecc2cb15cdbc5f80befb15","authorUri":"http://www.chrisdpratt.com/","authorUserId":"disqus:chrisdpratt","authorFallbackAvatar":"https://disqus.com/api/users/avatars/chrisdpratt.jpg","message":"There's an absolute ton of moving parts involved in streaming a file. Having the content length allows some optimizations to be made that cannot occur without it. For example, if you need to reserve space in RAM or on disk, you can do it if you know the content length. Otherwise, you simply have to make a best guess and then potentially move and reshuffle things if the content ends up exceeding that. This is similar to `MemoryStream()` vs. `MemoryStream(N)`, where the first needs to be constantly resized, while the latter remains constant (at least as long as you don't exceed N).\r\n\r\nHowever, as Stephen pointed out, you can only get the content length if you create the zip in memory, in which case, you're no longer streaming. The speed you lose by not having the optimizations that come along with a set content length is a trade-off for less RAM utilization and a more immediate start to the download process.\r\n\r\nIf you read through the entire issue, though, you'll see that while setting the content-length did provide faster speeds, by far the biggest boost came from setting acceptably high buffers. The reason is two-fold. First most disks are more efficient at large block writes than small. If you've ever attempted to copy a single 2GB file versus 2GB of many small files, you've seen this first hand. Second, having a larger buffer means that the same optimizations with a known content-length can at least be made as well for the length of that buffer. While data still needs to be shuffled around, it doesn't have to happen quite as often, leading to faster overall through put.\r\n\r\nAll that said, your primary limiting factors are always going to be mostly the read speed of the source medium, the write speed of the destination medium, and the bandwidth of the connection between the two. Those factors will usually outplay anything going on with `Content-Length` being set or not.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"46b49d28-4ca9-32d3-a56f-7403d899b9c7","date":"2018-02-01T18:29:29Z","timestamp":1517509769},{"_id":"063ddeca-d540-3dea-9678-d62696fc76ff","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"VdrM3GLTKqfgtiO5TVnviuko3j3B9yQBL+TmHF7BEaRZGZg6Nmj345oA7adM70zRrDjgbuwZQYc4gB1tEsmEHtOgh6Cb4wNe65PMl+Q820Bc2YjxJTcmtHGTG102bJKfy+iYfev6d9V6ze4OtUQReus0kD9cZ6EbCMk6gdWSkSAQp7Ob0PK069Kp35M9o3COC/xLa1U1GkzHpYHklSXW160aezeLIopX4F5FBUVkk9pc8IeKKU5KAjqouQ5tT/isaFiDVHxtmMIUsfZaREHtf2Zm4pTj04ZqaLVrooIArmMzU60nBpJNv5ysD346CFLC/upCbBy4pBusZ6RQybiUIsOiZAB9UIuoaRyGCFPaAhlrh/QWKAxI946yiVMPjcTomAeX3amiPtOiC+2dMqynew/smdFmoH8n2GcQAi4LWJoJwxQibGir3caso9wqV3QoGG6my5vkEZSZGq67uMs02aWt5XmEufgLH8IRguOObbab8Ol7mizObU7cvsGyMpvlemad44yng8ISCIKfLg/Ed0bEtxN/WySC/4b/98PF9rgqLOjC1pwXDCjMUKIZ+Thf/TsvfzkRsweaAFOolhpalH/6GV96QS4ei3mOF8Qmur/QkbXhjAj4xK0VZJhpLmFzijJT5b6FvBG5p0llrNOMTO4qvJuPExMPqnY+CKeT7Fo=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"I did that, and I get an exception at runtime that the method is not found.\r\n\r\nThanks, I‚Äôll keep playing with it.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"3ec97c46-0a86-3687-be57-24afa79f40dc","date":"2018-02-07T16:26:09Z","timestamp":1518020769},{"_id":"106f7686-d4d7-337e-8ae0-147737d29fe2","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"HXdwb8xLZORFEUAgcNZJJkb0SmMpH6/6IgJXzaJT4Txjt4f99g1GC9g27nvZk5L9YrmYvVVl7vOFVlv0FLzR/wMsSu9mTp8odpYtRIkXGATO/x8rHKsw3wzOVm+LL2RrK4QqTDKEmyweuMXOGQXB2RoF8uPgoN7QmsOoR7TK9WVFYBb51nbumSrHnyLPm41tFOc6NWYMojX3bgUNo21/Fkw0ADX47Zj9nQQXGiCtYgg1E5p0nILFUhDkr6CT0QYMrnTZty8Lacaw+q8LY94opzyC0gZ36RbpIbu6Q2s6RuT8vWHbkYdiDLeUfOjuVw4bBhINThaUcaY+zo/WoiTFf4tuHY0hhXHyKTBaC098xnbEcRiWsGK720Jd4Ic+Tt+kTtEx86CSpQZVlXgOmTCEju87mQ58neCfVpIUfuMOOGcQaB/ehg4tEAJVCik0oumFZsVZq0qE0t50eDPU9c78DAVSyjYppuHwboFUOUIm5z05lwvK/ucgYEFkNxoKARkL9i9j20bGwresn18d7H3ogC9tyqMAIal/tD+1pwK8Xs8LTmUZXNAUGKn5IC7dlXU64jIXjM9NgxsAbQd2fZ+Em6mp3U2bFoaG5AiM0bsB7EtJeyM4jnnjSQ4yZ6pQC53rj1I1vgxCz+ySiO9T5aa2GkhvrJ+w9BBmPSb9If5jkRY=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"This does not work for me with [asp.net](http://asp.net) core 2.0  \r\nThe SetHeadersAndLog method has a different signature, but when I change it to that, it gives a runtime exception that the method cannot be found.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2018-02-07T05:37:25Z","timestamp":1517981845},{"_id":"3ec97c46-0a86-3687-be57-24afa79f40dc","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I haven't tried it with ASP.NET Core 2.0, but others have reported it works if you pass null for the fileLength parameter.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"106f7686-d4d7-337e-8ae0-147737d29fe2","date":"2018-02-07T16:22:15Z","timestamp":1518020535},{"_id":"53eece30-0a3d-31e3-a3a8-37074d10c488","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"UVZ/nH+8q1wD/S+WSMBab063nNyu4PNhlccr7KgKntk7XpvvQ6NwWOphM8rCG7gdKshrs4Supi+54fVftW6BASBdOBFxCy4M+HGCNjz0jyLHIMgciEQ9xaxHcbKOA/v6dMKcWXdXwtBW2ZiG7hgQsPCYjS6UQ3vwPdfYGtXbDVTQfF25/vmPjr/GEDJLx8f9RSwM9hgJN7wCwWxI7OVIWbn9d8UmXWIHezhK3HEl7izuzhPdyS60IHhYvsgDjbjdOoXmZLSah3b8Xc8jCksuBf6R0X6N3wxBk94d9JTEf2jFB7TYJgXbyXw8lKr1rXbdwz0LH+SivfCleaUmPL15gwPGHVZsLPfUNjXIHH6EsN/tEA3UaXhxEU677+ph8nwEA01NQ39y2oB5fW307LC32OMPxxFjJLtrvIlkdRHOsEoJVcDm6Vs3xopbtSasOxVPgWhWhdQ/VooiziUcspgKwGJ7KfeHoGA4QOJPEi98SvVnBpX1ZNY0nm5W3Wiz++lVHgDLL3+WE2zhAvmF8R5In1xeL+urOy0WrWj2+eqmrc0akiOr8fVYyd/ftfmXDyuMy8i03+7o6HTsPWIF3WlDWzTav2e5IrHbBjltQqzV038mDMyt+Jcx7afmugMb1iu80OY47+/ghsA7GOa4HEfGCSWhJj3bsrAt3gBDgfwAbJM=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"I hate to bother you here, but that is what I concluded as well.\r\n\r\nThe trouble is that this was working fine as late as December.\r\n\r\nSo, some upgrade has made it stopped working.\r\n\r\nIs there a place where I can go and find the exact SDK and ASP.NET Core runtime that are paired (compatible versions) and download and run. The versioning and the packaging (what includes what) is a bit confusing\r\n\r\nThank you.\r\n\r\nETA: I verified that I am running .NET Runtime 2.0.5 and the SDK is 2.1.4. That is what the Jan 12/13 release was.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"d896cb77-2fec-338d-9993-7e73657e295a","date":"2018-02-08T19:31:45Z","timestamp":1518118305},{"_id":"d896cb77-2fec-338d-9993-7e73657e295a","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That exception does sound like there's a mismatch between your sdk and your ASP.NET runtime. I'd take a look at your final binaries and ensure that they are the ones you expect.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"063ddeca-d540-3dea-9678-d62696fc76ff","date":"2018-02-08T18:48:52Z","timestamp":1518115732},{"_id":"27db602f-f449-330d-9fa1-f9edd4a18508","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"MK0V/vfLsN9E+jSxiuTaDuEh1+SQGFkjyN3TnDAd+Y3TUTVi71shgVPduKPzTXJbe8l8ox0bBWZHu7U9N61oZ5MVbWZzRVzRoJxvI12exnvvDAxWOEbQ4knhh/SQ3x6YKsjOup8S21gne2lzy9mtTw8a4xJ8IZhktWniJ+GenVhkn7rkJw9zx9zp0mulvx0j7dyIn3ugT/XVhM41We8oZ6cu/EXjdy8Wu8mnpSnxt/iN37QFRao9VyDK9TAS73uXYK2D+p7JWFGYvyJW8t7Z7RSHRGMDJFGwsvA0BsFiH8Gl9ewMOaunmGHAQpJsiSn7FudrLy+al9DMtSuojsAp19sQrrF7sY2QTCeuMq3l6R3w/p7wrkNwqIDNcujRJQebOlBMuw0rn+xS5Azqy1TYted/H3S+HMGISvS762FW+P+82wRIbOcXMGrqEkwx5iARsIyJYPTt2WpgbDkvCZnYlFhvHYnvzCLKOYYx0JxUbRGCp/3FHwDr7WZ/BZAZnJRWcfM2JtY0oduI93NuBEXkFt8nP0jRTsQOORd5vK5E5D5/GAgnBRfQgov3WMY2aNM/TPxvNlc+0ZSBEfbRpFRPRp3Rdj1kCHLgCJzCdT3sFmznUW5LKLoZxzfF7GcbgwSlojdHNSq3uf9eHp4syNXUxvQtRBJhtrFerwiwNCRg3rQ=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"I am increasingly certain that I have the correct assemblies, and the SDK/runtime do match.\r\n\r\nAnd I recall it working fine with a prior version of .NET Core 2.0.\r\n\r\nIf you happen to try it with the latest SDK/packages and find the issue to not exist, great.\r\n\r\nThe namespace for the base class seems to be different\r\n\r\n[https://github.com/aspnet/Mvc/blob/40d027fca3d1b61d6dfd8acd7346dfa45ebc3ec6/src/Microsoft.AspNetCore.Mvc.Core/Infrastructure/FileResultExecutorBase.cs](https://github.com/aspnet/Mvc/blob/40d027fca3d1b61d6dfd8acd7346dfa45ebc3ec6/src/Microsoft.AspNetCore.Mvc.Core/Infrastructure/FileResultExecutorBase.cs)\r\n\r\nThank you for your time, Stephen","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"d896cb77-2fec-338d-9993-7e73657e295a","date":"2018-02-09T00:08:07Z","timestamp":1518134887},{"_id":"b6e16dd6-1ac3-3a61-9cfb-e7f3cef87bde","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"I8LmdIZQSoZy8G0zDbz2u7HfZDfcoI+a2smKmS1ayCP9bu6PntaMDqFgvE94YPRT+qPmSyV/kaLG/TA6hYdUYmoOzv0uMJEWhIo7D0V0iL01Mf1WLn/EJSDTD11E5MGDCdpg61XJtVZr1zB/vD0OajyJD8iYK1Er4Wyu7PSxGxQ1UNEOKHi0dvtExt8WlIPXz5och0F8R9f3O1ke19T9optDAvXOPpdSQ95o0OlFs53uaxufEa5G3lu1W2mOn6Rwv7ijnyxgwR+GnaS5OlRnguCmhDqC+NEL9rg08VKdp0IdEdhpP4JqdxrvlCO3ZJlYwh/QO6tHLKkdNgxqEOKmLjezIJd59WzIWfDo1QUPyRLjuyDfQ1gAiyzN6BrH+tuIIbKQEnwoDONjcJkGDJcztCzJVwFsj8RcK4s5yIWIcl66fhHRe1HoSMYZNw9owAVw8xc0ODUy4YG+SfEuUs7ej79FOqL39uDGPVQEGtbFFno3Jl949dzXta9dPwOcQlZaL4qBjoyepafMwJqGjllbKLJ212KbOHZtvJYesZC0GcRXh0zALPqFaNjavVzqkC3fBS4xtSiplWqbOpZgPq1eSumWK9CLjKizo9mQGeDA+NWOk5X3mGWIeQcSwETg1TwQkEVQYsivE1nQ3iiQb0eF3VKEqS92LJWOOUAFCpzEzs4=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"If you are interested, I have the issue repeatable in a very simple WebApplication created with VS2017 15.5.6 containing a simple GET operation, and your file above with the necessary adjustment to SetHeadersAndLog","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"d896cb77-2fec-338d-9993-7e73657e295a","date":"2018-02-12T23:35:22Z","timestamp":1518478522},{"_id":"0a18fb2e-57b8-3423-9aa2-a27ddbc48b42","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"n7FyDI4+HEzIym59fug+v+3lMfhMBXInoeOwNO3g4YfUBGykG6pYdtSM1T+AOTSVqiH1PGjEg5ZHfa4UZ4oonkfFBOJePY/+FksCsJiX8gB3fsL55kLvDj4ym7/E/Tfa3b9FhNycymd8GRPaf3ZPGr2/wQL4xbWiEUVV9tBtsS4HaGOYKgpXFpecb8IWtRQLWuUhIaWjiGfZ6CQ0yyK5J7sGhjvM7O4NbDupiF37hjImo8h9EE2KdOO0j4G0x9HWUJiZBAEvorJl1vz2kghKfKmYGbJC0M53UCDGrBDUn/+yHnpu1Ht3WtFoqAFgeafC4MstD4dmlUH+4CADLHDzOZwA5QEKP7gUp2NNMF6MJx55uIZxryofU4gt4uDOMilQhBeQFqBo4PPe2nFCxzkZsm9CZbX4CpyYeV8ZebPaHDIyDz9ragsyeHUprsJpUSY5g50w5mmBP99+HGIrRMAx8gYLBeofY7LtcdFsU5QHeMCKAH8AKiAjrQmfPSWyXa5A0ewdtmb5IHCFiFaOIhQAyDqp5AOJs2whviy7CzQc1ftz5LoZ863wmLbgQjZ+ABq4C/rcUAOU4pGXzHOckuenUDwBTNgXBQ9ug7MJWeGlbmnFIJW8zbJ03Vj/4Jk0G+N55fuwy87sWd9DbThBQNty09Qgl6lsPhQRsdgWkAh+Vn4=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"[Asp.net](http://Asp.net) core github project.  \r\nBut, weirdly, I can no longer reproduce it on the same machine two days later.  \r\nI created a .zip of a stock web app, modified to include just the get method.  \r\nFailed reliably.  \r\nZipped it, submitted it to aspnet core folks.\r\n\r\nThey could not see it. And frustratingly neither could I.\r\n\r\nI have to assume that it was a pilot error, or a cached copy of the assembly.\r\n\r\n[https://github.com/aspnet/Home/issues/2874](https://github.com/aspnet/Home/issues/2874)","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"385847ed-240a-36f1-bcd2-878cb44f7689","date":"2018-02-17T18:26:04Z","timestamp":1518891964},{"_id":"385847ed-240a-36f1-bcd2-878cb44f7689","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"Sure, I'll take a look. GitHub or Gist?","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"b6e16dd6-1ac3-3a61-9cfb-e7f3cef87bde","date":"2018-02-17T12:56:20Z","timestamp":1518872180},{"_id":"3b8b1ab1-0879-31f7-a213-d79b164b47d7","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"That error does sound like it's picking up an incorrect assembly from somewhere. If it happens again, go to your Modules view while debugging and you should see where on the disk it's reading the ASP.NET dlls from.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"0a18fb2e-57b8-3423-9aa2-a27ddbc48b42","date":"2018-02-18T01:38:10Z","timestamp":1518917890},{"_id":"d88c2b1d-3172-3ff8-97d8-086b3714fd87","authorName":"SK üîéüëΩüîç","authorEmailEncrypted":"Sf5wesvw99GYFkvTWRNqL0qF5yMMBxHp9T/QyfTPkUFpHphax7E8ubSMezEYchBo9ClUNtIZJRMfjSNg273PJkogq1b2rF8qCWNR4P78RpwQVVC8L6C/6HKL+26em/Z85BoGVOcSJudJ4+p5r2ncMy0K1uUbtIxBx7kHeWlvGuzcM7gPLgoaVDiE8wQhHScHEObOLx+ZA9gla2MQTWYtKlHyx0utQHvXz3nE0+eGY2ffk1vWZoRLok/7dMog6CSFbr89vNHPlzxysSwjgdL2/j9Wpw6MMIOKu6lu5HZaBjS4rpx5YL576BAssZRoZMbFyWOyBJ6IPwXqfV3b4F+IyXO5wcEUWUMZv9tghM6mqkcSTm70Km4SIw/YRqd0gVLPgCeTYmY4whx1yVr8qOJoy0cnQhY7BceHcm6Xi0Kbrmo51XUwDtp791sMTV7i/aTFr+6bok/pU89i6zzfH3uGi9haZWw7t5EIAFD9RFXzLG8IidmGhXb5AYDNh1F/WeEYr5AcMbq2kCkXdTwJiMM9YtgxENvqYmZO5nW71Xqe/wuppZV+KuDWMiWooqpFcrU5S/HvX6r8KALpgxNe4OxiMSlizc6M/jmLzrPRkue8n5D4ywHpdGttlZOOo66ihBCcJsAQ/vOogSbd2qyinyKop0IwHLsqGBTfhP/P4SI9+oE=","authorEmailMD5":"1e6002d636f34420c2d39634f8a6e51c","authorUri":"http://cultofsundries.com","authorUserId":"disqus:disqus_sk_user","authorFallbackAvatar":"https://disqus.com/api/users/avatars/disqus_sk_user.jpg","message":"Thank you, I had done exactly that. I wished I had taken a screenshot or a movie. It was bewildering, and yet I know that I would not believe it if someone were to report such a bug to me. :-)\r\n\r\nHappy that it is resolved, but will watch it like a hawk.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"3b8b1ab1-0879-31f7-a213-d79b164b47d7","date":"2018-02-18T06:11:59Z","timestamp":1518934319},{"_id":"29a60aa7-ea4f-3030-99bb-b3088f9cc2bc","authorName":"Kamran Sadin","authorEmailEncrypted":"snauUlJjiiJ1DQ6Pvc8fIA9D4XwqMgR8Kl3Ay2Jdx452wAnnQ8vzfupSly9o9GB8Qwc0DPt/b6ENZAIoPEilEEjwjE0k6gUmOt4cH+qTb8PG+DrgeOeRx9xivOsVi/6CSSveai2kgji1zbEzd4Y1AkXuiiulmszPNmKbS/gvw2mQTCOgZgKgxSGk4YSnxj9472/scRLSFTrxuzDnteMJPxWsto3cpm3aqQB9L/sckDhvokTWAwYjsLMPThS9Hn13KGSpP8bW/0C3jnvCttiwuSP9BKojG2ENouTKQEc/PNUI4h5UgVwL6O29Voj7tEAKSwuUEwYnugxppcprrLYXoS0jcezQmWcJYiwptqG2nu/ayu+aRomoYPEZEb1mqLUhIQTvKlv/NoW5lvFGoo9T76dYN2zahPlo52S/1+BREA092kHGO/b5xQJYL6DHsXJVzHsyKlvOkNyzV1JNAx861ZNTmEVN0sZ/r8TogHYqn5QpI3ZLsrr8gtb7jMvv1vneKnn8TGS003Bbf/PgtfS+IOByCXUmxuoOL5fuO3eFE9/GUzJcLjC8WbxYwQVrLhkcHCjDQcFI2JJpc8PQircwH2e7Nyntb5M0WPCHnNLu/K9c6kL0sxipNW1LOyiw1lGW7Sg983btyrCH2gwAss0eUR2/H1Jdz9elHzU4rZ4BPTY=","authorEmailMD5":"bb619e621fd548607244b61c0936c5e3","authorUri":"http://sadin.ir/","authorUserId":"disqus:mrsadin","authorFallbackAvatar":"https://disqus.com/api/users/avatars/mrsadin.jpg","message":"very nice article. how about getting file content type dynamically in Downloading Simple Stream example code?","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2018-03-11T21:32:30Z","timestamp":1520803950},{"_id":"04f3fdd0-9a2f-384f-a763-e2ac94309d0d","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"I'm not sure what you mean. If you have a different content type, then you can pass a different MediaTypeHeaderValue.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"29a60aa7-ea4f-3030-99bb-b3088f9cc2bc","date":"2018-03-15T15:03:21Z","timestamp":1521126201},{"_id":"3bb9a6e8-adcf-3c5c-82d9-641ddbe1a0a6","authorName":"Daniel Brown","authorEmailEncrypted":"gyqC4t2RDQlsVQVSh8leyD+6NUP41aBmpeqptTT62enbw1J+dtE9kKioFVxXr265PApw7RIdfBwD8TyD3utESkzCwh9qnM9Z68OYnc9Kpa9vMhaoh8BiZntCsr4wUbG5nslvATjs8bC3SV6SGjBF7uaXcd/4V6EcgeZWmGZyV3fr5SyGPnLL12LdVQaaFI0wak52g7M+NdSHz27HyQwl/mLN1DoGo/s3aC6vAZcPfLW4T6Fxd4aLaMyPNJORacR0lVYF85VB3vL4onESoT52fbhtyRkO/9Go2a+9MhrGF4Uil3CzsfHToVyOdIQzSbC8eZjfxt68Mo/8uLjpAT09VmlIVZWzGPY22SkPrpE9KTeJgr5F4zzvbPeJVr9Dn7LHOOlVrfR0K4kRdNRK0e0VpErPzhSFuywFaI/EQlAv2w608K1GGbzFpYtWSMSXS8Z2i+0PoQckgbiPy4j78j+knvWvQh+IFkdTdYUdnCKC81AzKAHP7gc0MnxHrv/FvL0tgbb+TV5Dn8nRg2gLx4UdiyvCyMFAcBZpSGJC8XilpctJB7XCpfxXe/SpdwJMrvqOZmuM+ainQ+Sb/Oh5QlsOTInNp6W8wH6J4nrAQVwsh4oRDF/xLtRE4VxNE8oh6a0w2W9FwmweT7TdH6UkJrwoPBvNxpwYvuCTeobpMf598bo=","authorEmailMD5":"2cd388e92d03f2ccc4ce26e708926949","authorUri":"http://vtxt.us","authorUserId":"disqus:danny_brown13","authorFallbackAvatar":"https://disqus.com/api/users/avatars/danny_brown13.jpg","message":"FWIW, I have it working for 1GB+ files","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"db24384b-db91-32b1-8be7-c7f4880642ed","date":"2018-04-20T12:32:28Z","timestamp":1524227548},{"_id":"55d22165-482e-3393-9e26-cb538cffc70c","authorName":"Kamran Sadin","authorEmailEncrypted":"","authorEmailMD5":"bb619e621fd548607244b61c0936c5e3","authorUri":"http://sadin.ir/","authorUserId":"disqus:mrsadin","authorFallbackAvatar":"https://disqus.com/api/users/avatars/mrsadin.jpg","message":"I have used this code and it works perfect but just one problem.  \r\nWhen user start download file from \"http://DownloadSite.Com/[File.zip](http://File.zip)\" in [mysite.com](http://mysite.com) Internet Download Manager does not show estimated download time and it does not part file download.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"","date":"2018-05-22T18:57:33Z","timestamp":1527015453},{"_id":"6c1ae3bd-9a68-3cc4-b000-3d4d6a0fc87b","authorName":"Stephen Cleary","authorEmailEncrypted":"","authorEmailMD5":"3db7b6e14d9da42751e4bab03bc4d034","authorUri":"https://stephencleary.com/","authorUserId":"","authorFallbackAvatar":"","message":"\"Estimated download time\" needs a content length to calculate the time remaining.  \r\nI assume that \"pause\" and \"resume\" are using range requests.\r\n\r\nIt's not possible to generate a zip on the fly and also support content length and range requests.\r\n\r\nFor content length: the server is generating the zip on the fly. It won't know how large it is until it's done generating the entire zip file. So it can't send the content length as part of the header (the very first part of the HTTP response) unless it generates the entire zip somewhere and *then* sends it. It's not possible to generate the zip on the fly and also send the content length at the beginning.\r\n\r\nFor range requests, it could - in theory - be possible, but you probably wouldn't want to. You could in theory serve a range request (e.g., \"start at byte 1000000\"), but you'd have to re-compress on the server everything up until that point (e.g., throwing away the first 1000000 bytes of the zip) and *then* start writing to the output stream at that point. This would be slow and wasteful.\r\n\r\nIf you must support \"estimated download time\", \"pause\", and \"resume\", then you can't generate a zip on the fly. You'll have to zip it up and save it somewhere zipped, and then just serve that file like a normal file.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"8ddffea6-bf06-3c67-8f89-facc7ecc47c5","date":"2018-05-23T15:13:07Z","timestamp":1527088387},{"_id":"8ddffea6-bf06-3c67-8f89-facc7ecc47c5","authorName":"Kamran Sadin","authorEmailEncrypted":"","authorEmailMD5":"bb619e621fd548607244b61c0936c5e3","authorUri":"http://sadin.ir/","authorUserId":"disqus:mrsadin","authorFallbackAvatar":"https://disqus.com/api/users/avatars/mrsadin.jpg","message":"Actually I need pause and resume support for downloads.","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","replyTo":"55d22165-482e-3393-9e26-cb538cffc70c","date":"2018-05-23T05:23:04Z","timestamp":1527052984},{"_id":"bbf8ee60-7ed4-11e8-af0a-7d93e525cf63","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Hannes","authorUri":"","message":"Thanks, great article, really helped my out :)","date":"2018-07-03T15:21:20.104Z"},{"_id":"705928b0-8a9d-11e8-8090-dfd17e364c18","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"Xr+TgHgNOsy8Vjqy85zGPBm2cCbkNptJO3ldatmUpTtWgZBboBftRmzAsw8XkgzyQDLGvei+oCvDdx119jgzEdGnzpQslrGOlj6OatpfhckVKBN62QfyOvOEmVgatMFqh047ySygHkE/GI2nkBSzaBclHqE94Pg5fLnpxGdj0BQSgapQh2V9QViScHInNmBQNjQOGz2ttNLT2nNnAO9vyUOzMPgHPEE+pKOyNUtl3stoNeTyFmYMuG9IIH4dAw1rYVWqs+q0WBZYhh46iOuyr3UgkFEp4Mm3ZJwT6/E4mE0Gqp4NcFaHQkFbDL0tp+rwSAE40XYn6N+iDaOLHNLWPFEhdWpGXv+IUvTAyp68XkpddBXAYUNIAPtrjh9h5lQAfx6CwZEoMZdkuVvnf+COlBEJaIqewnyvCEM1aZbfqJfJKAQCMbFfExieAvwWvsVG79+YYZQlOsa2wwf1zMURO9JTVrp6bLI0555zC1P4tJcZLJX96vPQ7SQAdD+AnS1rsHpRvV2EsdqY+RnGV7vn/PG3REVwXfEm/Ia+XkynfYcrFyC4qXEraF16FErV9+zbtaz6vSlv06eAE2mXXa54I55EdAcZk7kKie+JvlQUjp+Uo8zYB+33bYMUth7Hh0sw/9GHW4AQ9A+WTGFCaoLBRccibStWUr7bTKhSZAEZtio=","authorEmailMD5":"a7f648f6c3151fd5fe0b5e855ea45c62","authorName":"koudenpa","authorUri":"https://koudenpa.hatenablog.com/","message":"Thanks. This article is great!","date":"2018-07-18T15:15:43.892Z"},{"_id":"8db8ed10-9488-11e8-a1dd-499116808ad6","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"http://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"6c1ae3bd-9a68-3cc4-b000-3d4d6a0fc87b","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"PeterA","authorUri":"","message":"One alternative to this; could be to create the zip using some other background process (independent of the web server).\r\n\r\nWhilst it creates the zip send the content.  If a user \"pauses\" (or drops or something), the zip is still created, just the chunks are no longer sent to the client.\r\n\r\nIf a client re-requests a download with a range request, simply continue the request from the background zipping process.\r\n\r\nAll of this presupposes that the zip file is basically required.  Obviously generating the full zip file if you don't need it is (almost? - context dictates if it is almost!) as wasteful as generating the start of a zip file and discarding the parts up until the start of the range request.","date":"2018-07-31T06:11:25.298Z"},{"_id":"9cd957f0-04fc-11e9-9a4e-a50effefcdf5","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Shiv'sExperiments","authorUri":"","message":"This is really great article. I have implemented it for .NET Core 2.1 with little tweaks .. It works as expected. \r\nThanks Stephen for sharing this.","date":"2018-12-21T08:44:22.589Z"},{"_id":"e473ae00-1c3d-11e9-85a5-7f61d3b02144","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"SGGiy41dzyBoGGY2EMlcY2Ewr6cp66sV53D/7G67YSjIHhqj5KFq3IISfJtcZC4wijZO+NKY0TDU5wupxu6RSJvm0lrbG38wQL2ji78L2PCHGNtgilCiTFS/flYwQ+YZdEjcYGzOEQnBhT7t1lctfAVvT78rzNco5Z44X5/XxEdgs2B5jQtNoD2nx7+NyCyMEGAQwsla3UatDj74OvmNNnlJeXw90kXWQL6NTbjQ5zoXc/c6EYSsIzxSODaDr9r8hveqv55JVVnkldfl2Vn47rDIUiRGctBix2s91YJSxSnNiird9AkOcKIPq3Zc0NEmbVNXp2/MrnbNrpJbGDx7y/Jy7/ynbqj9L6Gfml7RBVXwGgLHlZg9UTr6zK+XJqBm1e6djDbHx3wMRy2EUrQXuQTzySopC9IW+ubw58tj1/KF9OtxSG7zic9Xm7F61s1m4fwVJv1wgAPf1hZnxUVQslUPp8WHc5dUuJqWAtFoKbLAeVEeKZsmG4hRcNjd03gZXSwsuFZHVH13B5io6mWtq7WbdT0FcxA5ERMetfKiKMOP0EtEP7J0Dj+VpJTGl0Zjhd2drPw+ionzEGvtg3HWjF5KWvPvojr7CjbbhZG2Sv1easbXJRUI2flLr2ug5893nU6NqcDwS2VaXDLZCwyB2XX0WerDPbzbSBSFEDgWE9E=","authorEmailMD5":"3aafff39df4c5d8c05880e181ee5e3a6","authorName":"Felix","authorUri":"https://test.de","message":"This code works nice. In my use case a single request is rather slow; I need to send batches of requests in parallel and stream them into the zip in order to gain more speed. Here it gets nasty.\r\n\r\nWhen I just do it using a semaphore, I get `Entries cannot be created while previously created entries are still open`, which kind of make sense. When I use your `LockAsync`, it turns out the same as running the requests in sequence.\r\n\r\nI was thinking about a queue with event handlers, but I did not find much about it. And I don't know how to get the zipping code into an Enqueue event handler.\r\n\r\nDo you have an idea how to achieve this in a simple way?","date":"2019-01-19T22:59:36.837Z"},{"_id":"16198380-1c6b-11e9-85a5-7f61d3b02144","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"df068a60-1c50-11e9-85a5-7f61d3b02144","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Felix Kiechle","authorUri":"","message":"I got it to work with this solution: https://robertwray.co.uk/blog/wrapping-concurrentqueue-t-to-make-it-eventful .\r\n\r\nCode here: https://gist.github.com/Kiechlus/1acfa39aab662221510d6633f08f8c62\r\n\r\nI got some significant speed improvment for my use case (fetching many small files which need lot of I/O to be created).","date":"2019-01-20T04:23:07.537Z"},{"_id":"df068a60-1c50-11e9-85a5-7f61d3b02144","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"e473ae00-1c3d-11e9-85a5-7f61d3b02144","authorEmailEncrypted":"aBykko0aUqq43p1dchbs7XFGE/Gv225SwRI+HJMvIWsx59+DP42QE/u2vSuod5h9CD/XP140dLos8pYVLxoqPXIWSNp382JomsC6p/JXjct5pM8xqD4io444dpSMYpbnVzcoKj/OZiawCZC37dCd7SZfVUqKaPeIV0fiz3CFmXzbvFCxPwXqYySsfNHmcZ5EUMg+hudh9MSQpkN0A5pHecop/N7fBfZIQfnaG5qGFDW7TxnnGT6UairtYH4jyqxsHZMapJoSeVYfyurGCIyYKjTQx8F+O9Fi9uuC/aNwTjqlaYi8Bq68J2Uthy9aoWFgCob+u8vTbbPMlX3RtJQPSMi9OPoE+Pq31W2IPHF5Duz2PaHZZrBtMz3UDtJ70nGI2IrUHbFjIunj+5WLZ1MJutiwHIYeZldB8zbiAzfnDJkt+YqklGxcXqDMTaio9R0MOqI1n+uPZbTQ0NAjpD1xPLSuzPivh6+kmYUcPZRV7UgNOBr+HENx/nVFsZ+MbDMSX4/In3hmjiBIifMw2BZiGsH/1pdFPF/0OrMK+nufDLGj81vtFzuEwEsmgwbky8AS5YnU8hasFfLeEkdupnaQfZ9apGeWj6MDwUpquYBYZ8UBVgUexam5XU1ADrLI+5w29ZuIlHtyo4q5IcQAmxKTUDVV+56wykJjp5btRWFfrB4=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't think that's going to be possible. In a zip file, each file entry is sequential, so it's not possible to stream multiple entries at a time. Zip is an ancient file format, not at all like mkv or something which is capable of multiplexing.\r\n\r\nIf your bottleneck is the *download*, then you can certainly do the downloads concurrently. But they could only be added to the zip stream one at a time. So you're potentially increasing your memory usage since you'd be buffering the other entries in memory as they wait their turn.","date":"2019-01-20T01:15:28.964Z"},{"_id":"3e4d0b40-3b80-11e9-97f7-73cce500929f","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Francis","authorUri":"","message":"Hi, im trying to use this example to download a existing folder into a zip file\r\ni've done the following\r\n```c#\r\n FileCallbackResult result = new FileCallbackResult(new MediaTypeHeaderValue(\"application/octet-stream\"), async (outputStream, _) =>\r\n            {\r\n                using (ZipArchive zip = new ZipArchive(new WriteOnlyStreamWrapper(outputStream), ZipArchiveMode.Create))\r\n                {\r\n                    foreach (string filepath in Directory.EnumerateFiles(existingDirectory.FullName, \"*.*\", SearchOption.AllDirectories))\r\n                    {\r\n                        string relativepath = filepath.Replace(existingDirectory.FullName, string.Empty);\r\n\r\n                        ZipArchiveEntry zipEntry = zip.CreateEntry(relativepath);\r\n                        using (Stream zipstream = zipEntry.Open())\r\n                        {\r\n                            using (Stream stream = new  FileStream(filepath, FileMode.Open))\r\n                            {\r\n                                await stream.CopyToAsync(zipstream);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            {\r\n                FileDownloadName = $\"{package.FileName}.zip\"\r\n            };\r\n```\r\nIt works as expected and i'm able to download the zip file from an angular app using \r\nhttp.resquest(method, url, option) but when i donwload the file and i try to extract it on my computer\r\nwindows says : The compressed (zipped) folder is invalid\r\n\r\nany idea why?","date":"2019-02-28T17:42:40.460Z"},{"_id":"77473fe0-3c27-11e9-acf3-f3a95f1b52a9","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"cb7c0f70-3bb7-11e9-97f7-73cce500929f","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Francis","authorUri":"","message":"Hi, thanks for the reply.\r\nCould i set the content-length headers before the callback if i know in advance what will be the .zip size ?\r\nAlso i've tried extracting it with 7zip and it worked well","date":"2019-03-01T13:39:41.964Z"},{"_id":"7c078fd0-3c63-11e9-acf3-f3a95f1b52a9","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Francis","authorUri":"","message":"So actually for anyone interested i found the error i had. After looking into the doc for the ZipArchive CreateEntry method\r\nhttps://docs.microsoft.com/en-us/dotnet/api/system.io.compression.ziparchive.createentry?view=netframework-4.7.2\r\nit said *However, if it is not formatted as a relative path, the entry is created, but you may get an exception when you extract the contents of the zip archive.* The problem in my code was that i was doing a replace of the existing directory fullname for string.empty to get the relative path and in doing so i forgot to add a \\ at the end of the path, so the relative path began with \\folder1\\file1 and i guess ZipArchive did not like that, so when i remove the first \\ it worked.\r\n\r\n```c#\r\n            FileCallbackResult result = new FileCallbackResult(new MediaTypeHeaderValue(\"application/octet-stream\"), async (outputStream, _) =>\r\n            {\r\n                using (ZipArchive zip = new ZipArchive(outputStream, ZipArchiveMode.Create, false))\r\n                {\r\n                    foreach (string filepath in Directory.EnumerateFiles(existingDirectory.FullName, \"*.*\", SearchOption.AllDirectories))\r\n                    {\r\n                        string relativepath = filepath.Replace(existingDirectory.FullName + \"\\\\\", string.Empty);\r\n\r\n                        ZipArchiveEntry zipEntry = zip.CreateEntry(relativepath);\r\n                        using (Stream zipstream = zipEntry.Open())\r\n                        {\r\n                            using (Stream stream = new FileStream(filepath, FileMode.Open))\r\n                            {\r\n                                await stream.CopyToAsync(zipstream);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            {\r\n                FileDownloadName = $\"{package.FileName}.zip\"\r\n            };\r\n```","date":"2019-03-01T20:49:19.800Z"},{"_id":"cb7c0f70-3bb7-11e9-97f7-73cce500929f","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"3e4d0b40-3b80-11e9-97f7-73cce500929f","authorEmailEncrypted":"NWzXuPQAwXS03smNZDN1uAEWZfqY8hHKFZtuCTeP09wrJu8G3XPVvCFXKqQOFWakK6rF/VYPKLkA/nm8v46642vZMF4uXxT4g//x+676zhlEGbzJOhpwFB+Itpwgvuia8fNJcM3v4bl6Z9pg2KQ+0KsxxYB1AY0pWjlhsr6TWlNHDijkXTbA+GLhjHCUX8iomlErRjWG6PgsUSALKINVYC7nO/mCyXkV56XFVJFNWLck/MyqF/CKnkmu/lmwBhKZjHHhOJ7O9EMs0fQFWNZeRUApuxMqKk9vhSD4g1k/+fJfzzZAn1ZA4dMJyEGrsyIEfsuIyTrhZwnnvgH0qNtFteAFUCzoLvJ9GstyRLcF3MvgoxQ9FfVgJU6pZLHJDd6DsCLKsQ5o/P0c3W94Rz2+pCyPLorQtzSmkbIgsMCtLhXsswJ0n5LzS3Y607FseXYhHIQcK+ICHwPT5ULtO83NMA4XVWz1i5Q2hXrgG/sKumxyKJGiEiD6GnM4X3+vpSVcqmleDp4bYXYug46g4nkowolDFmNmM9W6KZImbUiEDGib5zQQgNxkopy52MFWKLn9BwLpGmFyu9KTnfUCMN3pDqEOsttCt1M4QR7vSAD6vjiHW3c/DtYJD3pZZAaIr0HF7ZutIzLH1bpEHEmpG+NOi7Sw5Eqcdtn9zpb/ZbuT7wQ=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I couldn't say. The code looks correct; usually this kind of error happens if you forget a `using` statement, but all of yours appear to be present.\r\n\r\nAre you accessing the file before it has finished downloading? One of the issues with the \"compress on the fly\" approach is that the response headers do not have any content length information, so the browser doesn't know how much of the transfer is remaining until the transfer is done.\r\n\r\nIf that isn't the problem, try capturing the data in Fiddler when running each program and seeing what the difference is. Or it could be a Windows client problem: antivirus or \"blocked\" downloads can interfere with opening downloaded files. Try opening the file with a third-party application like 7-Zip.","date":"2019-03-01T00:20:19.570Z"},{"_id":"d35c9e70-3c30-11e9-acf3-f3a95f1b52a9","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"77473fe0-3c27-11e9-acf3-f3a95f1b52a9","authorEmailEncrypted":"M/enmcp9jw0AGnX6ReT2Mu0iNfVTlhnGxqk+pyQ5Lt+qhlSQnP4m5YuGcBkDWq1zmWTMXXJZBJowxqadhAMcU8FAVYzS6SMeEB7ATCPLCht71EAvuCrEhHS9ph9w8htZXyoO1Gwh0bFf+5KqCpSrJVwWfONLXRfLN/4wKLTVcYbc5t7wv0zA3AqhlgTHuH0vCO3Eo2ZrAxlVztjHb0G3TSZr7WqkqDGEc2lM5jDnWZU6HP6vo38s3osffkm23oNxnjZ2G1Ofp5mlzdaEHGT2wUtiYAivoWdnkKBRjqs4KZxXJ5fPLidF11aOdrlscf8s0nhIqs+gXUdlfWIpj3gRfQN8roMUxLQQLNfbXmJqycKeZg21AV9EdS20bT+QAcRfEPch70KAsalQWPswKOd8xWLXK/r8uPWSjVzYt7CONGNlpmUKUBSzCk4nsDvtSvRonHZhdOmdg3TcaE/Ta7hXIDSGjZiet3WUCdZaZzHzIZveCjl2S+eIMb0fQJuKGEltFVjrcLqEEmw+VxxJL3GZD32A4kNrPmj9qT0a/hoNw6T6xo/aJokU9E6FhseTDl/8IoNYPbEzU4cbbGDXY9HAPxhHWjxYQy+YM9DXHhgyljx3TuCnn7Nas+m8niWGQ1/SqhG2M6b8m4WY53+QYdjKrySdJsEi7yv6X1x1OY02Uig=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Yes, you can set content-length by passing an additional parameter to `SetHeadersAndLog`.\r\n\r\nSince you can extract it with 7zip, the problem is probably due to [\"blocked\" downloads](https://superuser.com/questions/1142985/dont-block-files-downloaded-from-a-trusted-site).","date":"2019-03-01T14:46:42.077Z"},{"_id":"1d4d32e0-4403-11e9-ab1b-b1484e5f4180","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"4e81f180-43f8-11e9-ab1b-b1484e5f4180","authorEmailEncrypted":"k3mB4vNvOcTG9UXHJeZqxBGCtIAzISggW2BbuuRG0Dydb6i+aAw1QOPvvmbuOiiLaoM+2OSm/qDKAoRCiQEtQqvdQha8iDD68D2li5tvmS9o+HtmL94cRjQ/0St+PmDXBxY6TD59J2YORidmfRzndVk0MhUDmPOM2hnXNSO8BMqu5AeKu4qNUOO5yya7XyM/zSE2najj3FSGocyu2Uzw+lYm6WX/Ssliv0KvXlzJ/bqZ+W9WeNT99STuLWcYi+paHBSF4Yrc0IZ18CK/S0BVENpjS2yxXuZXFx+JDyRT1K8VM+XmQ0BKCY7xnrzg2s85hSLVdNzaWv1fX+10AnsDiiYsixd+DvJDVAr7S5FtsjAYUUrXfrHN1w4Drxt2TXx+Pof0WduaHauGNa/+8MKZP2zqb77e+StRsNSX8741iaAC99ujfEFIqNUOgwTKJtRS7BdcqI1q8cyUy7O0xvPeJkKPEMRW04qBVJoXcXpnjnnlQPYRW8ptc4nRTmgcKZvKZW22Ks1YQHixTAggw0VT36T5NxsFbxgx48Iocj6ujU7Ot0ICfD/ZfM9acI2n8jT4Dpu/CNbnGXcksS5mgXeiteWgeLgYHEceqzJ3b3OQ9nKqFdzmHjxyiZtbmFfTrgHjHia2kATDHy7qSHHGsPvHIpFUGAVr2hlDJiGYfPK+Fsk=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Have you tried this? AFAIK, it's not possible to send the status code after writing to the output stream. The HTTP protocol requires the status code to be sent *before* the response body.\r\n\r\nIn the case of failure, your best option is to just let the exception propagate, which will cause ASP.NET Core to \"clamp shut\" the connection, which clients *should* interpret as a generic error.","date":"2019-03-11T13:39:38.466Z"},{"_id":"2730ddf0-4405-11e9-ab1b-b1484e5f4180","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"4e81f180-43f8-11e9-ab1b-b1484e5f4180","authorEmailEncrypted":"wjfaXwn+6UoPPdcJ0Uwt8NSmxmfq+cusTBuuDLQ2KWuv+ZuMtpqiqv/TKBMcLv4rq9JYl9uUYfJ+W0eXPQxSP77TgB4WfkCpJzC30FDs7tO2XBv/YPWHYQbF4ERCIuOdcF7UhrQklKMs49qWtB8jUi9W0XztbFc7Z45fWMbAkCsM65H62QFx8VLZS+js+MorWqIGPapOFqUyqu820Sh7Dmj8RxqgsbDA8L1wnw6Ug6a5AJwqBcu5thioL4T2zy82HxRMM2Pp3aSH+GpJ8kUa/2icavoHHEskP5NiXGl+04VrKSuela14JgFyB4II6Kjs33XxPgI+xsHyCNlArb3y3642V7NdMWGLuiKF6vb9RcKT25mzJJgV/56HPmzShHRs3PGNb1MJzD5KT6103hRYxinwdK5BWgCc1BzSYRgG8iSs59LHeJCfWs77F7ts7jZF6HdqqSXdpD1273/3LCcVyvY0HqGw2pDfyD3iNh7ndXTmEKB/Zn2QBCbt7mANtBBTKIr/V2DjHE/QLGs3gkoPi4EXn8ktQ8+DoAupKrmw+/ZjHdrX3UlFBrVDweSNV1gTA3N9Wf5eUCTjEXQRNAxgfuqpLacE/qgjv0LAn52DJrX9yupPDS4cmuARR9nZ9agEVCVESUjqxL1jwUPsmH8LW5bI6d5HvzS7UXVeldKaeRw=","authorEmailMD5":"3aafff39df4c5d8c05880e181ee5e3a6","authorName":"Felix Kiechle","authorUri":"","message":"But this only works as long as nothing was written to the `stream` yet. So it doesn't really work unfortunately...","date":"2019-03-11T13:54:14.091Z"},{"_id":"4e81f180-43f8-11e9-ab1b-b1484e5f4180","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"nDTTAV/+0s2qWjfHILnTzgHnGAubTVo6CL3s6JaYwHEAQBzYkB49oafXZ+jcb2ByL6rR1bpAP5dylF5z1CIb48ZbFczzWA/tHRJ5hFPfpHYsj10JCXCKldFzHVZP3pwJKOso/41qY/U9fS96J+8AkzP8yk/XMaPREoBpFQcS9BAU/xiKy3xhUDUPsadt/6r/eVEqWxbLo4jxPJocjc33ZKw5xlvlgcelXA30b21s3eqpKXsQq6tjf3IfxLNHV+tHiwXlu7bSHaL2XyreOawBXCxnFOGrZ84toUrgK/jvG9VT6Ijrw/oWJbg6CsGFLvUTqjdf9REmLH/Ez4PJ0DSxk+ZpLj7CM3/BhSfuF8bc3oAlO2Z6w+rq9QAHFvcDOUarToCKEWsCgiO67oaOlaEtGOC21/+YCPFEqD/irxjI648ymW7l4ETfc25+wOdshSmdzUQ6yJwLVa4hVII1WDtubIJm4bWLEHORCThCqZBew0eH9Mp+8c22GEbl3aZXsyf+v5AdA/1Hws6TwuMGBPl2ncVB90A2TDqPJqYkieWfVu48iMT5C+dWzpy6yJvWaidbfKY4g8W1qqNMWsf+j6/xP7UMOuDqO00LfSet/ZXtjR+q42ZGwovgfGjAbEYyhQwlOCsoBHcyqENZIg0XK0Ti97wrbeQ8LPE0SsQ23W06qQM=","authorEmailMD5":"3aafff39df4c5d8c05880e181ee5e3a6","authorName":"Felix Kiechle","authorUri":"","message":"I was desperateley searching for a solution to make the request fail in case something went wrong. \r\nIt seems the second parameter of the callback function `async (outputStream, _)` has a property `HttpContext.Response.StatusCode` with which I can mark the request as 500 in case something went wrong from which I cannot recover.","date":"2019-03-11T12:22:16.543Z"},{"_id":"39a61b40-476f-11e9-b781-f3cf519148e3","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"1d4d32e0-4403-11e9-ab1b-b1484e5f4180","authorEmailEncrypted":"qnT5rBfc4SSfzbyegV9/HUjixbb+wYBZBdQxAFvU9itaaMzRBPSORkJHDl8O99E/KS6sRaVvz7dfBb2EUhG2h4QbHZ5zUgb4LsyV9hWXK6k3aO2YZMEcdlIgDqn+MBmZ2jM/w9dqMixEwEp4kV2mj4kPtHl0dWFdLXtA5sgfCiXnWUb8KcYLbORPnRhInd09b+gadl1qrWZvjbGd3qoQg30iUGi1B1LT+vEq0Kv5R+YNwIo3xYVwtrlormGfXp7klLAmMYZ9DDVP3FUrpx/FuBF9lv/b2RlONwniMvm8PAPBaFJVFBuOu4klzDWMBYJJaR0J7J3kSNKu1ARFvsKHg2bBHnXzve5PhKaHF8DvR83liFzDXtHCthyfqczfwX6F6G4OHwv5olTMPsl6V5iH1tWwkhtEuqZThD5NgicAOYG0PgaqjbqI/2gq17k0Y/QjP3qlO+NFUkSPwdbY1gYvt5EbVIx3ZbnyxOGgdpADc4iwM63UOPFuU9OwyE4KfxuYrnJtV73AypZ+rQ/EfLp7m8BN7jJhAisO2Dy+3iimnBN1K9WTkEkYDEHusElqt+tvc2ibA9DtQfweRqX6E4y5bPWxB2OXtn+fPSV6SnwD2MflVOXS1AgP8Xsk4tHvyBfs+hrgGk297oxmVNazP8Kd9aUlNqNL90AIPDP7RoXM8j8=","authorEmailMD5":"3aafff39df4c5d8c05880e181ee5e3a6","authorName":"Felix Kiechle","authorUri":"","message":"Throwing from within the callback didn't work for me. Finally we used the Polly library with a `RetryForever` policy. So in case a dependency keeps on failing and does not recover, nginx will eventually time out the connection...","date":"2019-03-15T22:11:05.156Z"},{"_id":"1a307760-b9d4-11e9-8877-cd438f83f435","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"ieqhIlFFj6WS0FSiGTybTP/I3lsNvFIX9rl3urhMGK0MKIQvtZ+iuGceIqI5s3JBwFFLcx/cD0QvyP7g1uV0F0cK70bvJWaQipfCg4iekk/hYQGwYAEiQ9tltWcNI6yBNIqhkphuZ7ayBrjM42burTPzpvRO7d/4u3b+Ot7+97LQZM85ZgIjtve7irRaiW551D6QH5N4fNVc2xRNzBySFubqG2H2OGDzQ5qvFe93mQBhnraQKiutLxmqXA5WP2JDwA1P9fflPuJ1JzzB5cwV4B94QCDY3upsXYQhH3AGCftRqFPRbaYadv3XkWaO4gEDxZOZdv1JjnDRfv9vEwf9OHMRdNfA0gpUC/+3KdWFfDSuh2KR2CCpstacWgvW3yJyYnnzFu7iAsTSfMwGSggln0BhYxAbA6+A++6SaL00Xy3dcWLfomxPtnf3+ht/2V0wgbhbOOBm6KHK+B32q4+lcBPtEV1zu+ZS5XImJlxrs16+Iz8pVkjDd70iFTVxMrCahe9+svM0wMUwUkYA1kNnamHhxhlveeTomSffdvg9SHVAgyaOhi2FUf5cfROrTa/LzYsEi00SF7OzIxCuXjatwWWbMBlFkGThKK+tUvjtzl2GDTmbQKlZ/RhAYLW17ucYHKghoxBE3ZOiILLJOh6saAWYGVJImIGVTtWPHyjJabA=","authorEmailMD5":"d11a023af0f17554d9d44cfe55297bf2","authorName":"Derek Broughton","authorUri":"","message":"The perils of using \"Pubternals\".  It seems FileResultExecutorBase has become properly internal as of version 2.1!","date":"2019-08-08T12:00:23.937Z"},{"_id":"6ca87820-b9da-11e9-8877-cd438f83f435","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"bZ9islDFU7gLlJwBf6oaSU9Zb09NTo5xfLnM1dJK5z6elVwo9WyBJWYgcrJTmgfeo6GY4L+3faic3azyP1/KPQVS9J4ib97+AnbJM26Dpe/kFOzSummYp2I0PC0SHEgbPa5WJ+7yLXB3RWsRkbIzIoVRdZbJyvehSxHSeMoVXzn09HobA13seZ6up+hrSt/f+JrC0va8bdU7AEwpOYdDRnRAiKEHcQGqOri6C5PL5syqLjDQuYp7pbWwHTB6AOvurZZgvYJ6nOkY6ZlfhK8qIQun+xkSyMcj4s/3qMW9suyAJUEwBeylCbGaMh9O0lBACVmvY5zA1ZKvaAT5V0kyeg9jVr/geBNrFlYxJ/p1oNQT4W1hjQLPsSxlQjr7RvHK4pSNY30mAxlP9B16fonySjMVDqfAA0Ua+/ibzVzU7VUJhgXsoZNhHjgl8JpGwhfXUIkB1MCiejpOtqI24+ah7WqLzY7xykBPhebNctkn9PTKNTufKNbkdkXk5U2w+85ssPWlACoZNlHRyI93oHNLYfPoNRLkyneLqc394F7BIEGlSFRobQzZRjFpGTyZl9wSpuP8dz5bFHhNEJ5gk+mYsTlXptpN0m6rf5HC0K52b7FByb9WR86YU75IEKWIMqvyZauIZxj9fFs2YrSfiDdVFgkltVzs/QlUoboQKpObsqA=","authorEmailMD5":"d11a023af0f17554d9d44cfe55297bf2","authorName":"Derek Broughton","authorUri":"","message":"Oh joy! FileResultExecutorBase has been removed from ...Internals, but since 2.1 is in Microsoft.AspNetCore.Mvc.Infrastructure, so they seem to agree that it should be public","date":"2019-08-08T12:45:39.166Z"},{"_id":"c1830780-b9c0-11e9-8877-cd438f83f435","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"16198380-1c6b-11e9-85a5-7f61d3b02144","authorEmailEncrypted":"mRtxXp1o+e33uNCOF2VfiKuP5Q7+5CtVt6D/TmzN25Ddp/rpC1l4Sl8ICyVnKDdmZobDIhRStl3VZ6Pq2zy8ISpm7NTxrapCUh7YlLZSETUj2AtNCKuyF3npjlKHRC/E2M9DziSxHSm4ciVaW2yR5S/dlc5d6O8nB/QRR+G7MDoG7mH273FBf8AQu9+/qJycUMEJQT7K08zeTV1bTDBt5MxonoqTcuRcMFpqWkSuaO82AmUqPHMUS4MXPuFzHbUCm/5Wg+/fZUHvI3nD1uUW2mYUwNkwrLBnn6dyHYiy5qfXZNQmtEPPivRPP9A0NAhlthDgnyjPI+gO4bD32skxo/qYShqPSeXUTVIDqvybXfDcJPSzDahnLKVRzgQTmz+4noiXomzL+64DB8leQTV7apYtava1i00xUntYYJl37RgdwbT8CzUp3p0Hs8Dm6Gmx2zhm8ZFf7VqG4QHV2NdGT2W4gZccEFrVug/F6My3+ma11rcEyxSJyzRcVkmaQ8a51aWWIPVhg+2MoWfu9ln+R+90kLeF+eNTWmiT1FOwYl0HQ1ZuE+S2ykM8E0B5tl9hkEq7/uNqRAwnoqJ+XMMf66yp3evxzdwromwIwf6T7nsaj4PsP4q3224YxqhUJyQvJKwX/G7EARWo2myPnEmkVYge+JOxEJWNDMhXyLnV+sY=","authorEmailMD5":"d11a023af0f17554d9d44cfe55297bf2","authorName":"Derek Broughton","authorUri":"","message":"I'm so glad I read all the comments! I was wanting to do what Felix did, but after reading Stephen's comment, I think I'll implement it his way first, and only if there's an issue try Felix's. In my case, I'm zipping up the output from a number of GeoServer requests, and I _suspect_ the main bottleneck is going to be at GeoServer, so I was planning to run the requests concurrently. But I think having all the results in memory might also be a problem...","date":"2019-08-08T09:41:54.642Z"},{"_id":"5f9dcb20-d411-11e9-985e-d7733b393af6","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"6ca87820-b9da-11e9-8877-cd438f83f435","authorEmailEncrypted":"kAae1acFjJJEZntrwx/rTAhpGrMYNPNzTUvhI8WnZF9BDRpQ4UMNlPA+NL83a4d0JzI3RRPm4cOdIROST2LLR6AZEUN6bBftdt2Yuk7I5Ze2VyXZIzS9dkO39SIVzVwrgXtJ6UClk7ipArh6NHPz81Y69UD4MO13+RVShfbussV+gEnrIEYNqRDk61z8hg3teVhGOinVJffeNyT3/KqdVw6087MowjfMqYAaaSGd52fS5Z640P/CbRr8L870MjQdZeKpfKDcWvJh3YMZDUZs5wF4Tf1tdFsg4DcDBIo8E6l4gysbPnD9nocUtFnTrZWhTzOMf1fl+XJQX3jX6501tI0IvyQhUrObaFOwbul4prZPwdjS6k59lZhaUJjZYtki86W7KnDfB/SyiH0CgT/lEhv1hZrqAwaHNSWLXprdSjm/BafN4TESb/rzZ+/tQCACVkynPQY3+s6irP1yTRha6+ZJ3SokK/x8BaAzP+NpcI4W193xU3Eb1jturshjp/TKhPKHVdwxgzfyl3y2IiMZuDJHH+nMm3r4cwSQc8TTk5EVjNh7bpV2VfjJXzm3IrONT82es+PoEqlaBm7IjcUaa6NWTWm8GA310l85XQE0sZVJfm+SWV8lYHj5BIPH2HbneKFO6FnmdDpxsO297mIvh1FI0Td7KN84wpF1cyyCbAM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Good find! If I have time, maybe I'll rework this into a real library.","date":"2019-09-10T21:24:29.921Z"},{"_id":"a1e25450-040a-11ea-b774-b96eee85c6ec","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"jb26w1lCnkgJRvn0KHZzrcjOE6sZPclGLC9U2COL/iEdwLkdRXRE+WSsbFfSGSxRCrBVOpjv2Svhp5+RSdEcuS5b2ctOb6HFN42sQLlQJfT2s2uAX7P6vgwBPbb+kNhdaJ2GH31d5XwYxhHmJQQj0lZsFMSCttc+G8qPMJJnuqbUne9EF/pqW+1ZPLQPsHE6i7bE5noFl0rHZAvxCmvrKRICSXZQ8q52AZ/545kFHaR2jOo/JTu/jIckTX2j0rBKhdDIcJUL2GNYGjp9mfd+4DfYJR9SVQhDCHQcIy3XQcC71w3fbPJKDNWcPw714ZsyvPMtaVwvF36QOtHu2CiVpIxn6D5v22GeKkMuhnqVmF8v4sQRDpHBL1IdxlGXVh7PFLVDOnK8jzFfnbIWZTJJZ+goZgCSmdVbTrdyGPyAYHdZP/RpIEhBAG0pTUeukQNtcnseje9gZ7icCGa/shH3g9mDmhaRlAImyThkn3TrW/Z7RbwMk9VL2fYOnbCjfWC6OALSO94H+mle9MinDBivULhD71SbesEXQqzfC5ZgF3cPuiU9UWJKoeY8Ht6VR3Y9eXMOzgOFbGfuXJZtHfjhhWCGo5Dj316/GXmkSFny//W+xRLw0GMG/Q+rNqOhDltZgDRQndhgkwLiDo9w0oZnMNuAwUbqbmnkXxVW4aSNyNw=","authorEmailMD5":"3ba0958f44043c5a10ea0a3f19497e17","authorName":"Taylor Graham","authorUri":"","message":"FYI since ASP NET Core 3.0, Synchronous IO on the request/response stream is disabled. This is a problem for streaming zip's because they call a synchronous dispose (and write to response stream).\r\n\r\nYou can get around it by allowing synchronous IO on kestrel config, and this will fix it for all routes. However, I feel like this a bit heavy handed. Instead I change it at the request level specifically for the `FileCallbackResult`, since that deals directly with the response stream.\r\n\r\nE.G. in the `FileCallbackResult.ExecuteResultAsync(...)`\r\n\r\n```\r\nvar syncIOFeature = context.HttpContext.Features.Get<IHttpBodyControlFeature>();\r\nsyncIOFeature.AllowSynchronousIO = true;\r\n\r\nreturn context.HttpContext.RequestServices.GetRequiredService<FileCallbackResultExecutor>().ExecuteAsync(context, this);\r\n```","date":"2019-11-10T22:37:10.363Z"},{"_id":"317bdb10-0a30-11ea-8fbb-250f4f5477d9","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"badman","authorUri":"","message":"i'm trying to do the same but for video streaming that serve splited or segment of file .... when i execute  it with full async code, i'm only able to have 2 sec of my video in VLC media player and when it's sync i'm able to play it in VLC but i got 1 image every 10 sec LOL. Below a piece of code as example: any hints please ?\r\n```\r\nreturn new FileCallbackResult(new MediaTypeHeaderValue(\"application/mp4\"), async (outputStream, _) => {\r\n                foreach(var segmentName in contents ){   \r\n                    using (var segmentStream = await myService.getObjectAsync(id, device, segmentName)){\r\n                    //using (var segmentStream =  _minioService.getObject(id, device, segmentName)){\r\n                        segmentStream.Position = 0;\r\n                        await segmentStream.CopyToAsync(outputStream);  \r\n                        _logger.LogInformation(\"segmentStream stream size = > \" + segmentStream.Length);\r\n                        segmentStream.Flush();\r\n                    }\r\n                }\r\n            }){FileDownloadName = \"test.mp4\"};```","date":"2019-11-18T18:21:09.659Z"},{"_id":"6d78cc00-1b78-11ea-91f4-bd5a4438eddf","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"a1e25450-040a-11ea-b774-b96eee85c6ec","authorEmailEncrypted":"JkrCHh8CKsKp+Q2mahk6NrDIXPktwhqwxQBI6+eSFKNXVwpQKeKNdsW3LAIBpIHNO8DBc6RXgkkca58JCCPAz96/JHzjIVSd/b9JhIZMJl3SkSnOy9odj16RjjGzL8TxqTWkM8P6dBCcRlG4S4FE75och3V9fBJCfs4OXcbDoW8cmp+IgldFXT26wXvT8SLjVHh+1YldOFi8DgQlhr/rLyJOyJZBVykmS9nqAIVYKavbo9WXevNpFaCk+Hh5Aw9Bx248NYHw4w5QQPOo/7NIhyVDuP0wsVkq6RhHR/Zak4F/JuB1oolrngyFEL8LeUM8AKO9cd57872wpfin7m+HpBdIG+S4VbqcPdWOBygvyqyx0a5+TiMRkbV63I2hdJvzeYmvJqQ8cnS0eBUcrElen7xORl5sqrXk6+Gx5L6JLN5DGq4hJzqIt/pg0izikZblpEnxroAFazgDs3RuIPcevrUUvI+jJHeJD5qoiqapWAMjQXAv2DrFC6mNAGImK2gL80/BpZvXQOxtJrdfsT1G+ykG1gehk466QtQiQ5zH6aflG4KwfiGbHYBaFanYhhtYcGSVSGqi/PLBvjwi/0YDX8J1+gMWWJrCreIh1q8SExDOPqo7TO6Ub3i+oUYKt8o1dZzmJNgAVQDbAt52lUgdERtiIqFqomHhYFjoacfqHSE=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Thanks for the tip!\r\n\r\nThere are currently open issues for [adding async `ZipFile` APIs](https://github.com/dotnet/corefx/issues/5681) and [async disposal in particular](https://github.com/dotnet/corefx/issues/42130).","date":"2019-12-10T18:11:03.975Z"},{"_id":"a529ffc0-1b78-11ea-91f4-bd5a4438eddf","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"317bdb10-0a30-11ea-8fbb-250f4f5477d9","authorEmailEncrypted":"iiPzivy9Ek/yYtgSLbZqi975M+nshU0b+uXrmY2zy2bDF1mQ/OvuYUMFudt8JVxc/TGNnBsD0DXj5yO17J1OsYzZM3FLlZ+4QO/m+Q+tM1x/p7pHo9Ws9s1egua/ISrIkZtW07SCm8kGuRltHmypYunqboYSCU1sLLZ9pG0FsSBN2+t9a5KehXJe1YFSLcODnWb7YEJgK8+i1kFVJG5NmrPVeU3kCelLKJnXHqRXZuCUme9FvCKlXoTel9W0ZaIYjr2Kar2nB23VMnqPqKIpbMqYOfztH6d80PmmtzCjczRDsQajsvzYeXdnWP+X0cptltCyC1+bjPllQbTftgcpr4y9TMhJILwoZTfMaaHWerLzxOoHbTqXsJ8HSordZLbWmiIjfkZiqaHSZS0vm4y736mHtgWtqyU1fbpnsipCxZla/wy4lVPBigRZD5+uUgqKXJTwQyoifTa7en2HduNWRj8ZBJdkgvJ8hkITGMalM0WV+4Tp3aY9g0irgxkuBen2YVC+OWKOABKFg32CGFM0eVSDvwW7fdAhDQQG3hqJGDxN+8m3neJcP2H/BwhDosUWAmXC4mY6AX9jt0dvsyVLH9Dvdyei+Uj8lwTy0LVa4K70tzgNqvuBo0wYL01kyHMeRkTh3/VJAvOYfln3Iy+aoIqO6xfgwTc5v/3amLul2fc=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Debugging code written in comments is pretty difficult. I recommend posting a question on [Stack Overflow](https://stackoverflow.com/).","date":"2019-12-10T18:12:37.274Z"},{"_id":"1c8c6430-8916-11ea-bdd3-d38d9c9465ec","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"piSWdnrQ/+/z5R6uqsRPK5TBT9nZO3zJKgRrHDAIxB2lNUajrBlal2kpJhSwkSfZ7arOW87lcy0pM0U41YaLLovg6iDLgROPjppYHcCzvzv59cYSwtn+BV8j0TOeyQRse5uZRRDnV8URHuXPhHa/SfbwCs25V55SXowR1EuUbkZOvMdcjZ8q0jXPHY0PQNH6wakBtJJTWQ1jVxbn0QrMmO80PwwNo0FJpndP834ng7zRUNqgdompcsWQdwt//6/lj55WUkbRI6fmLfnr2qcV0gs89QEN2tQFEEN0gW38i2zOe6HstUj5TT0MV+MJukktHpvIcm3cyxbACatMBscLhJ6fu+eCiwzX4UD/9S8TqlrcNB0ExVR+jQ9C7hGyZE9LTPNPkN1T32t3u7AlmVVzvVXhiMVn3NcyGpLc6+AXldsy4Ck0OsntiK/aprl3/GGuodkrkMkjwDVOUCv3Yv+cuaMPU4AkkYhT8dBGBCKfjEzF0f4Iha6hig0pbwWNKJcYMmBn8WoO6wkHbQ6WYrcotkMV8OB7N1vsycCH+QwmQLbbHEytbPVwLs17yS8Hh6BdhLyQAzalBOgry4RvwI7LOaM2V1wCFHMssU4eafTgYN3mf+ghcYO+4r/vQZI7BxQcpIEFzl2e++ORwBxrIBuAOLYKaUN4m2/Xt6VT+Urw9t0=","authorEmailMD5":"01beb25a687c791b9500aff49e8b69d4","authorName":"Keerthinath Ganjam","authorUri":"","message":"is there anyplace where we get implementation for .NetCore 3.1","date":"2020-04-28T06:04:25.202Z"},{"_id":"f3dfbf30-8999-11ea-b960-112f598cbe30","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"1c8c6430-8916-11ea-bdd3-d38d9c9465ec","authorEmailEncrypted":"G+Cua6TvcGLLT3JLwC1IK75CVhA4QbjvcI60ZFLWSTP/AO0VOlQvuSalCcz/EpwAtRTRRf1WToSFx/RXD8W0fCDxgY/gBUgK1zo+qIy447KvpxH62uL59HVHp2UDM3uuFaIB2GvNaLEIAEghDyWsHYTUP7XWj7eWzM8VlcJnYkp1Fo+/mnrdbWbhD09p3ezwbHyE1fkCj1L12LqxREmreZUtvfxv+kJVkXpNzgkgIUWmBlIYntH7HmPaI6K7pqU7Ws+CkO0wNbZz0+BShNgcBXuvgYtQo6uCLzJcub7eFMLinZJLYH7gM2ERD6pYA3G30gkqM86b4yxvgURqrv+LKvpnJ9ev3RQ1t057juIR1tZ2P6xmcQ7M1CzZwg6ogRMkbRjfBEUQ8mNUvaffkO4yqPf6CvLpGzRVfSq60IwYokalxX7WJv9jcLybYi30vs8z4as9A5pMN7fjIoP8I4HXF2TVCf7KLRPgnJu90OWYUDpmB48rkQObqp2Vw6rq1YS1EEv8150Un+UPpuUr0GNXF9rfcPx3CuisSme0W4cblrKWtaLlU6vkN4x5NV59x8us8eFU60h73yJtcvx/4C6KtnoIA9un7cbVFhm1J1wRDJD/W4SPg0tYYfr7OGPS8idcdY1zAjgwj042elO/hKxqBgakILcRvKUIHWs8t6/SUNA=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't have it in a repository or anything, but I believe there are comments on this blog post that provide the necessary changes.","date":"2020-04-28T21:48:10.600Z"},{"_id":"12111140-8aba-11ea-b55a-838e917a8f7d","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Andrew","authorUri":"","message":"Thanks for sample, but it appears that at least one byte should be sent to browser to show SaveFile dialog. So in case when file generation take 10mins user will wait for 10 mins until this dialog appears.","date":"2020-04-30T08:10:36.271Z"},{"_id":"bd5fe390-de1c-11ea-ac08-4764ab6ae2b0","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"2730ddf0-4405-11e9-ab1b-b1484e5f4180","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"John","authorUri":"","message":"Hey Felix, did you find a way how to handle an exception in a callback? I have the same problem for in process hosting","date":"2020-08-14T10:56:00.887Z"},{"_id":"115467f0-df30-11ea-b06b-f39deb301518","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"bd5fe390-de1c-11ea-ac08-4764ab6ae2b0","authorEmailEncrypted":"SovqpIHiQZ/lFZ86rUr0lUxjZECLRsb0dRUcCwhpjLH4h/twUtLUx9608RiHVrrKOHBWkEx8dnbiz+gnnpngQvtTO8OblnIHGM/0WjTSuN5uZQXexm01V42iwYm9ln07uDsPbMmDkB919n7KtsbWXMcpNWMtibvZt3BR9mGqfHwId+66fO7jFlvgJEXDwbdGopKDdZ4I9HEJXbsmDR4XloblZF5i5Mw8ywh53beMwcqNOPHofEHxiRfL77CaUFGouWcCIMxquPjhoZSfn9ZBDpF8PDAp8XM58kZ1AtE0MMpTYT2/BKcLL23sr1iEbYtmBJbNE2mhfnYxLIpXQRQpvkZ6eilsz7++dyubnk1mQPVeD1GtnFrofa6aqmFRISZuYucrtPXS/YZHNUSa+XWIBX9GFX6a7yc+yZja8+jyCRYRDUB4SWPmJvJVyfuqwPjpzFfHc/r0ipqQold1m5rDDkoJ+pul8zmGuivGduK2MZBwPlxSeG7g26vc/1450ntjo55iXyd4mPCd4rrIfLy3fpWdI2szEo0Nto81LDiGmxq4xKz5ofVx4OO5ZbnfJxb08v0XiCpGO0eJgAku9ZshxNP5Gy1XJkg3OMV5UtjfXSbXd0dxBqFmWFMjCp7gCAUSqDgdAnfFfbVs/J1XPfAE2Idlivn8eIHBs2KlcnPBtMI=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"It's possible to handle exceptions, but due to the nature of HTTP, it is not possible to send an error status code to the client.","date":"2020-08-15T19:46:53.300Z"},{"_id":"5fdbc6e0-e091-11ea-a668-898d98a0aa21","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"f5662910-e075-11ea-b2c5-79132952d92a","authorEmailEncrypted":"rAtEIlBChlXaOvXwC9Jpor05Jh1HIvtzkhj/FS2+KrqoFMgU9wxBug7G2/5VwX8kRyKWE29a2893VZ1EX2t3YLc73Oer3fx06fZ1zu+i2X8XfMHqqmZByIMZz8mfwudoZ3eeF/hRuNY0pm8vbF3fXcA55dVZbUe5EcbB2riK8yrbO1JTJXC/OlICt5D9bpbfCqjeTtSjoz7SiiHnkCfRrUySLnZ6pyyt98o/cCAeWyLToReUkaurau0naSEmHc3ZzeZ55aXdk7kk0hUmAhqCqKKkWsf1twqqFVzYRFA16TiDLVXBuU51o/2gN/W0GhuVmeMZoN3vzRrUUVGDUE/rt7kIjKych5gCty9fVSazucT0qXge7gxtMqojUKDxiceu2nrdHCQcVgrrZv5BHGg7suVQNQcOvXlLvBwQVHMhOusQaLh/ZSPJnVXztDlUDo06kYHAigQ7sQEIbXta2d54YeI2fXxo6Z54Njv2h/MhYUhwXsESyslYH6KIwPeiRmPmVT5xGIwfFGOuD3ljo48wJww153hAAVVpePvlzRrb9wWRQ0HScgFn8+3x0maQPfFbMGniGiGqlJppUlMJb6KPlFv6eagH3ngigTUX+DRY5rBC9xOuLDF676l8OuWOEPtuiQqZMpWjBwEmATFPxrM0uQVkb7IK7+ZBUDgWtjsWxLM=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"It sounds like your app is already doing everything it can. In the cloud, you'll have an Azure-controlled load-balancing proxy that actually has the connection to the client. Most likely, that proxy is (gracefully) closing the client connection when your app (abortively) closes its connection.\r\n\r\nThere isn't much you can do in this case. What you really need to do is control the behavior of the proxy. There may be some special headers you can include in your response to change the proxy's behavior; try checking out the Azure docs or contacting Microsoft directly.","date":"2020-08-17T13:55:57.455Z"},{"_id":"f5662910-e075-11ea-b2c5-79132952d92a","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"115467f0-df30-11ea-b06b-f39deb301518","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"John","authorUri":"","message":"I would like to handle an exception in a callback and terminate TCP connection (I try to use HttpContext.Abort() method to abort connection).\r\nOn my local machine which uses Kestrel, error handling works well and browsers show 'Network error'.\r\nBut if try to handle an exception on cloud (Azure) and abort the connection, then it just closes (does not abort) the connection and returns corrupted archive.\r\nWorth to mention: Response headers include 'Transfer-Encoding: chunked'.\r\n\r\nAny ideas what I'm doing wrong? Thanks","date":"2020-08-17T10:39:42.616Z"},{"_id":"48f87480-e21e-11ea-b403-559dde49292d","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"67adf690-e1d1-11ea-8525-a52b943aa31a","authorEmailEncrypted":"iAMblwrTY6UAvHduoKAybVkkQRS4+LiFcaOQS4njc5j0jwrbyw/1p/pS0eID6C4R4Yp7Q1yYhVnrGjUberNIaPGnUYrcAoeDH1LiG6DADwujgi3QnFwnuvxL5vABfNtNFBHjVHqkZ4WzfusFpMgnDNi9cBIsSDG9wEv6YuMijsg1QAe57XZjkvtKb/PxOASZrqe/TSNe/12kytvz+CBqQ/V23oLDWpVo0ZJ9FqFa67MeCwFPf2kGLpmeZlPvIazkbDNMNnIXwhx5Hyzh0hZtYUVKz/y5/GMnwHU+4++zJv2Zz3kf3kUgrgGzITOx0VVVVUS867CTUheH7/io10F0x8bWlFS2SSHZjGmrSkjpIxivoLoPhvNX9wP6yktvNOZDnHj7s0V7e5JJUoEQL6DM9lN4EOwp6FgkkjZjDxoDOAnk6ylH7wPl0vQDueTPTgHsI3xECp9n3dejH9mMmVybCBbV/uTcy1elTFsArHm+7ud50NEDl0J6HPzFHeiWQG0gbKGZ2ifvDDMdXYUM6gRMKd/0xj2Q6td0duPvAW9FvbZL6aRVlOzPVXm3HFRfhF7rjORB9fJk+HGcdEDO6fEK8+19+W/Q0EfD6MXsdrMNH4pUv3H6hcHfAeJPiZIYe071kgWGeQ/hFGWQ+nOw5ZN9VOvShkTKe93hL7TlVNus3do=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't know of any existing API for this, but you could try writing your own `CopyToAsync` that will [flush the stream](https://docs.microsoft.com/en-us/dotnet/api/system.io.stream.flushasync) periodically.","date":"2020-08-19T13:17:09.183Z"},{"_id":"67adf690-e1d1-11ea-8525-a52b943aa31a","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"12111140-8aba-11ea-b55a-838e917a8f7d","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Dev","authorUri":"","message":"Hi Stephen, any thoughts on Andrew's comment above? I found the same issue while testing. If I try this code with a file which is in excess of 1GB then the zipping takes quite a while to start. Is there any API which can push out the bytes into the output stream as they're received from the file endpoint URL?","date":"2020-08-19T04:06:49.486Z"},{"_id":"c73fdf70-e1df-11ea-b71e-05f8f661988c","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Dev","authorUri":"","message":"I encountered the same issue as Andrew mentioned above. If I try downloading files which are 1GB+ size, the zip download starts after quite a while. Is there a workaround to be able to stream the file contents without the await?","date":"2020-08-19T05:49:42.950Z"},{"_id":"88792390-fbee-11ea-9ada-3b32d0d07a17","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Thanks you for shared!! :)","date":"2020-09-21T09:40:50.229Z"},{"_id":"51696550-a476-11eb-9dff-fdfced712c39","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Craig","authorUri":"","message":"First, thanks for this terrific article. The scheme works great. One thing I have recently tried to do was have a zip archive nested within the main zip that gets downloaded. I just create a new ZipArchive as an entry in that main zip. Then I stream files to be contained in that nested zip. Everything works fine and is included in the download, but with one caveat. While files are being streamed into that nested zip, there is no download activity. It waits until all files have been streamed to that nested zip before continuing with the download. Any idea of how I could make the streaming of those nested zip files continuous as they are in the main zip? Appreciate any help. Thanks","date":"2021-04-23T20:56:04.697Z"},{"_id":"d2769cd0-a480-11eb-8f32-25dd396a96f6","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"51696550-a476-11eb-9dff-fdfced712c39","authorEmailEncrypted":"Or0vwTKicnB7ybR0AqINzYrbM9CzpuwoiKgt5TFEwv6qvlr3DkzL8jkGaXhIEpfTDS5enSHZiN5pjbRyhUlo5BvHtEPtjkAfCzLp3w+VEiUVTRZZjngn64zG2I/7WiYKWAHeXW2K88EjIw3Sse77/zVafA7mBc/I8X9KS0tfChPxVxOQTFrVef+Qw5wD6S928MeNCNMMQSODFk8nCemwaONTI1cHX3n495PCbMnvSstkW6fBaNLwEtDo9t76NIKEaVl2X618mFLvT9pUfjku6pMs0P5YUHpwkCVfWlJUGBV7MFDYXjXgmTxpmWgtm2a2wWSosCXw2GsKNMEMKuOsEE2S7fq2oJkohvG1qqTDVEUOQoXGtUmBEUmCuW9uUtSrAqXTCgGPoVFMlcsMmQmpjJ8nDy/QFvS+F3MZu+f1Pbsof5G+nnmdiH66T2D+wlFPCFsmsj0guPhw3jjWql4OqegxbfJsMREJLYDFhxfggxcQ8Yq8EcV4vGSje21zI1dqjOJaSpJwzzDPRsvI7SXR0syvLyqZkWB9x+jTyOz41FEd1JTdxWnFfY7r6eQFoaTTbA854upr8hXqlh4ug63BHXQh7olJ7aAigLtgN21X/etuiy6TYkcSA4jLJ47MC32TaAxillNnHYaeaJ2pw2B/WE3RJwVfnHu1qKs2hqurPgU=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I don't have experience with nested zips, but the first thing I'd try is to use some kind of stream flush on the stream representing the inner zip. It's possible that the zip support for this is just insufficient; .NET doesn't have the best support for zip files.","date":"2021-04-23T22:11:16.355Z"},{"_id":"efd03c40-c5a5-11ec-977d-6b38092ddf9a","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Javiseeker","authorUri":"","message":"Hi Stephen, Thanks for the article!\r\n\r\nI tried implementing this solution on .NET 6 for 1 GB+ files. Sometimes it brings forth net::INCOMPLETE_CHUNKED_ENCODING error and does not complete the download. I noticed this only happens to some devs, not everyone. Also, I tried using the logger available on the FileResultExecutorBase to send any exceptions to application insights with no success... Do you have know any possible reasons for this?","date":"2022-04-26T21:15:02.739Z"},{"_id":"2f4fe630-ffbd-11ec-8278-c132177ae00a","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"efd03c40-c5a5-11ec-977d-6b38092ddf9a","authorEmailEncrypted":"jcAnduKYJmCERcJk4o82uyKdArsJr0cIL5t9ngdbYPsHQvvZKbMIIgp+mJbvkJN4SwiOeeVaAIHLPQB+0inmTDy76/jAuGWlMDmBWpencd80vQCcZoIxMR+C95Wu9DV0eWSCtWXSbev035s1Tq1gSaanP97YKbYGpijKQXpRq8LhJ/5zRDZ5JNUqX+ltDm8YZ5QMhscvK01Z8n1GtjpFlHFwAY4o6Eun9Tu7c0pkxFQZ4cw5faw0AIwb/2+R7xf6VAdgbVMxShBiyc/6wyYCbHn+loilVmf3WRBRlJSbnkz6ZOkQLgIYdAJNOqlx9sB4wyVwcL+zBvWWPbFOYU5tpLLGRFXfNwIwP8Lv7r6GlUy2quhDycsigSRPRWNM4EvBDUTG5wMDZc2eihfX4gshH4GScTlbTQiElnQ5OTtXpwYx9rSE3aKaAYNRShC318Mvhu/nVKqFGCWBIIuhr6+HoPTTBpAXIBmDPfKpG+Na4mf0J7Ex66QjS03EE1E3pPSpx930q7MYh9yxlzZotSoOc6BBExEFXGLQ5h78b5ky5pn0wrGEj5IjtnDPV+bQxw+c5SRBnsln3h4KnXdxO04VvG8WdGAurWx+o2oeACc6CydQ3Sfl6mGL5wSmupITLXBoqiTQujJykVy09+LZtc+X43ju8F3IKLoNSXBbEHnVfeY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I've never tried zipping files that big on the fly. My first guess is that there may be some kind of timeout occurring. `INCOMPLETE_CHUNKED_ENCODING` seems to indicate that the connection was terminated before the download completed, so my first guess would be an ASP.NET- or IIS- or proxy-level timeout.","date":"2022-07-09T19:27:35.073Z"},{"_id":"b9f31e04-7ec6-46ff-8eeb-af5fedf967f3","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"Kq6tai9L7MYwbDIaXfssoPI3tY4WVfAE25AOq0fUfKoko40vcH5dP8QDRR7ZsuQh1cxQgLO/f/VqAg0gMn3WsW8Vbsj5TAUgiv9d6UYieL5az8NN8u7CDgIQMnlJaTqO2215n9jw4RSukYsp3mpbdc7jd9qBd3/tHlPqS1gr8VDn+wWvmE9oIiCQOeteplxOa8hbiveRX74EBCVMbzBk4DUycybrCUxiOQvXWGTJH8LXTpX9vEbqVDJfD0REW62Ey/MBUj62TRXfd3r5+fwwiNPVpt6kwPcM/TuwkLTkI+A4rrA1cNRf1i9ZLW6PLH5gSHnbq/5SsKDE6oz34YP1LKeOLrGgAntinTd6RPMdCNXGFe9Xr+XjZsRL98wEauvT/UweHYkwxjxg1QEGdbTjBSwx5awM1qIEW0HnVfF4ifahtVSjUZYe1b0oZK2+hDqvXM8dlZmWnnuklPC4yibGjwPnKL6kpZ7F0zC/OXRYRrD4cPIKltqWPZK+2MEU2sFphvkvFM7kH0Mx+OObjMgtsCfh8P1ggzhYICajNYESiC9eRmoxFH9Z7DdLxth7eRi5BxM8aEhKWCZ3T+6oq63qOV5OSCUZI5mE7iSC2/kFhUG8Twf96NtPgnGUf113T9AFZgglaKmgry584LzZQrwLEADc4Gfn3hT1h40H4v42PSA=","authorEmailMD5":"765809ea8423fc957649c71842f53342","authorName":"Matt","authorUri":"","message":"To anyone trying this behind nginx and experiencing problems with the download not starting until the zip has completed building on the server. Check your nginx config to see if you have [proxy_buffering](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering) enabled or various proxy_buffering settings turned on. You can either set this to off in the config (**proxy_buffering off**) or have a header in the HTTP response from the endpoint with **\"X-Accel-Buffering\":\"no\"**. Nginx can save to a buffer before passing this down to the client which can cause issues when implementing this behind nginx. Other web servers may have similar configs that cause similar issues.","date":"2022-12-19T14:08:48.1766161Z"},{"_id":"0dbd307c-54c5-4cc4-8d58-cbbe75a2885d","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"b9f31e04-7ec6-46ff-8eeb-af5fedf967f3","authorEmailEncrypted":"j1mXwtFg8rjmPtR8neByatkWuDAGMimhmCS0itlwfK9d2zVLn7ZIZhoGD7rIK+Ih+yFj/RLsdI3qfh/2usmK2Y9gTsbMhq9Nqr0eG1mirE1WvXrqkVF6oiSrluGNDqb0r4pQXpGkm/ACcKyaE4Iid8BY5yX7qMwk3ZSeqhQfepThOy2T/1d3uA0Js5tS50HED/GKt9e1lEerAWovTlZVt09iS7YftVExpxh+IwJoP1+Znm/tjiNS4Td7NMnJv8re3yeWQXFYJYC4yEfYHIaV9IaXtFI0q1Pw+NRNCHfYllRUJuf3ivxZ8Ji6ci2n8rIUrlmfZvtpdfTu4HbuMOhiGH8xJlHoZizkZESXvWJcr720L6UncMBk1agm89KppznCXGzO3iWstx9v7mv63+8eChy1YVhVqN1YjccMiahMCRKGASt9xTGXzD/KKc/MLEVeoKbAmzCMYyQ0JOVekOIWQ1rqdbeoGtA7RCISiTnIvqFR5eMtL1ZtYny7s7lt4boHcvfsnuEZAd1LgC1KMxkaa6fbbSTLAwvNJWAOHr9qGpk/De040wcGtChepNpKzehDsWDX8N6XzcQsxOPQYjmI5J/2XgYJOA0r84o3hFVa2dErNGF4ZAzNQlu01vlD42qv79BFf2/LCux+b6p+JHdubGX3KdirXQomod1A91RLIyI=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Good point! Any proxy that does its own response buffering will have similar problems.","date":"2022-12-30T02:45:49.3479135Z"},{"_id":"7b4e19fc-95e1-4605-8623-016592ed076b","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"i6l0YMSer2PQ9ifc+lZntcaA9CZVlgXV/ndYcFjnH+TtoN94jzqpTYGvHc4S8JRT2DQRzlD+TKQqecuAlRC0QHi4gvPTCf4x2X9RlUTvAi2o16NIa6k8fYaLBW4W1Mjd+kNg7/+MVynCyfFOzKnAVQeG5VykLApBTyxwsBMOv2yKTaI26R/ibYxKKVzfxBPAc+PhHav6n9TzlbjwMQd3YJalqXkiDuXmeE0We8QJY7f+aIgWPfBdw8GSo5IYtlNmmeAlQwYqY13YISJmnA3evmUq85ND4jMmmDKbvmm0Qp0WZCsxOEl0Wa9tV/VTbCnYYq5YayaQCNM9ARYHnndlFpQuh69VHAZpaT/RV3CKOj+yWq4AAe7cfXrnOIk1a+q8jXk3q6xgSDLFR4Tte1EFPuoAEcGlAfuOQD5xjV/NimI8RDC9rkuH+cMfculX5nuKMQvoz7AT1lG6tPnAqofDGL06GDi1XKH3hSqJzQAoihwD7BKSQRMaBdmf/IuzCgeV/2DDDPUGqkXFc1dNFEF0d6b6UBP+BKur+zIg53bXFM2hdb1Vv8HpAk0Wu6gKSWKruEGRZwV91E3HWfbZaCx7LwS03vfceg+ebkP5UJpVC0VU0YDsfHG5gh0lJxlLdWcYamhjjbOEAQdYYJpTur0QgYgSrxYAg2FL1e37euruL+w=","authorEmailMD5":"5824db34d31c02dee1e67494c817d276","authorName":"Yves","authorUri":"","message":"Very helpful, I think I just found this the second or third time already. ;-) Still works in ASP.NET Core 7 with a few minor tweaks (different namespace, additional parameters).\n\nWouldn't it also be possible to derive a Stream class that reads data from a callback method? That stream could then be used anywhere and make streams truly dynamic, not just in ASP.NET. Probably a bit more complex to implement because a small buffer may be needed for the generated data that wasn't read yet. That stream could even integrate the Position hack for the ZipArchive, if that's still needed today.","date":"2023-02-13T22:22:12.2909249Z"},{"_id":"e89b3dd3-c254-41ba-9f34-17549683492b","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"7b4e19fc-95e1-4605-8623-016592ed076b","authorEmailEncrypted":"pC3sHLBQkVibqhvKcuUFSU1y9iOFoHd2AabUvYzxcFM2CLrJaQfM6MqzhqDoVPE+oDt9oQlBwbqUKk6opUg2HEi3WoaUcABfAjqfZZX8XGsFYXtYrNkSSSS1C+rLmIQrG6/EV0wBo0WwO76ClqrM5ng4CQ54dOtnmTN6nRDcgGR39y1+t6BGwBkBgEpsbCY6jLIDVILf0GvcfdvMfgonG4AkYtBk0BWAPdSFNrMdvt1imgnrWbLbbO/D1PWt63TbeovCg+5RypJMtsG8aDNDGQc0nGkSxTWH/iBZruj/zQT/cFJgCOM948TIjBLChOOkwOuK2HqVOp6WwWwUd4alwxfFKmDLOyKqqycAwr/PEdMTG3zmH9++039ZPBmyibiAcULuC7UpgJ/QDebB7Qm9OT6SK3PFrMFuOpVRV2hv9hl4FtUIlxP6Qow0Tggotaiqu9XiWyTEy4A4x9K3RqEiBUU6oeIk+pcd/ZBbXFA5AtMX0EzXaKYUqWfHNFZdj0bad/4hdq+I90/VWpldzphR4RwmL+ul1VG6sKiwBIEBOZFAUBHhRHJmxxUVpW1ie6BoSjTntSZczdNq0Xs+s7nuIp0L3SyuXO78GriP2fj/AlEnBW33DfqXgMaKREK+IgaVAmLuUTLOG4Oz2dzd/h/BYXby6h+yzmYdpGn+v4mNVNY=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Ah, yes; I did [update this code for .NET 6](https://github.com/StephenClearyExamples/AsyncDynamicZip/tree/net6-ziparchive) but it's not easy to find. I should probably just publish it as a NuGet package or something...\n\nYes, an abstract `Stream` would work, too. Although it's not as straightforward (the `Stream` base type is rather messy).","date":"2023-03-07T23:40:26.7665403Z"},{"_id":"473b57d4-be55-43f1-8795-bc3ac989b84d","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"","authorEmailEncrypted":"XUg26zx+mmkBhNCitUtotchyi6WEyc94LbW1cjyxNtG8XnpHQ9T4ROSM8FR1YdDXS5vt0bgtGo8nHjWY5nNTVt9c3ZVBtG/LD9lBqBDHCviX0RlD/C1alDOhahWEAlmpkYbBWapnffCMCjZfN6kXrZbt4BUEB/qst1P0fWFL0OzC29nPN5yvhqr0GYXUgQXVBOIc7yv4GRf7ZkyWbI4qww+Atqj+QrYqGRzQ64etwQmdSkekfQDmuCKNXYEZme01Hl6ABf1BDugzQEFLJ64Wo+U+ZYL/rw3vRpFlqjOAUajEUMqtH1fRs3Q1p+tUQZz59HXw+HDUOyDUoKuI20fD3kbmzohxsfjxBpajimdpMOyzewslPe5tAN+fVZXXyG6CP3s04R9476SQjsKkV+o2QhxUWak3IJeZa/pj8H8eE8fsk8QFSYrQ0++/hzHutBk2O7EkyyDD3SC7HC9I3J3DzJJd3IXCuIRhm6+Mam8p8Z6YA6QtrEAKDueODuzC8VtOmb7eS6fU84djZxDwxCW+SDUXRhPI6ZOahhw3M5NJCI93Y54+n3H61UBzf9dvbMSMwwmKGglNuoylg/m4M14Eyps6GBIjcdbeZVnGLrmXrLGsCCxZ4G8h2DRbVnil7U8ibriB5XCTQ6J6T4vPphxzD+GXLKhS79CFyckKsJQlcLQ=","authorEmailMD5":"8eb2af4b2eba0379409dd073e7e222a5","authorName":"Fidel Ernesto","authorUri":"","message":"Hi Stephen,\n\nI am trying to apply the same principle, but to stream a zip into an s3 bucket, it works 'fine'.., but in the process i am losing some headers (zip headers), so when i open the file in, lets say windows explorer, it shows an error.. but when i open with 7zip it works, the are inside and is not corrupt or anything.. this is my code:\n\npublic async Task UploadZipStreamAsync1(IEnumerable<FileResponse> result, string keyName)\n{\n    var initiateRequest = new InitiateMultipartUploadRequest\n    {\n        BucketName = \"some_bucket\",\n        Key = keyName\n    };\n\t\n    var initResponse = await _s3Client.InitiateMultipartUploadAsync(initiateRequest);\n\n    var partSize = 5 * 1024 * 1024; // 5 MB\n    var partNumber = 1;\n    var partETags = new List<PartETag>();\n\n    using var memoryStream = new MemoryStream();\n\n    using (var zipArchive = new ZipArchive(memoryStream, ZipArchiveMode.Create, true))\n    {\n\n        foreach (var file in result)\n        {\n            using (var originalFileStream = new MemoryStream(file.File))\n            {\n                var zipEntry = zipArchive.CreateEntry(file.FileName, CompressionLevel.SmallestSize);\n                using (var zipEntryStream = zipEntry.Open())\n                {\n                    await originalFileStream.CopyToAsync(zipEntryStream);\n                }\n            }\n\n            if (memoryStream.Length >= partSize)\n            {\n                await UploadPartAsync(_s3Client, memoryStream, partNumber, initResponse.UploadId, partETags, keyName);\n                partNumber++;\n\n                memoryStream.SetLength(0); // Clear the memory stream for the next file\n                memoryStream.Position = 0;\n\n                Console.WriteLine(\"Uploaded\");\n            }\n\n            Console.WriteLine(file.FileName);\n        }\n    }\n\n\n    Console.WriteLine(\"Finish parts\");\n\n    // Upload the last part if it exists\n    if (memoryStream.Length > 0)\n    {\n        await UploadPartAsync(_s3Client, memoryStream, partNumber, initResponse.UploadId, partETags, keyName);\n    }\n\n    var completeRequest = new CompleteMultipartUploadRequest\n    {\n        BucketName = \"some_bucket\",\n        Key = keyName,\n        UploadId = initResponse.UploadId,\n        PartETags = partETags\n    };\n\n    var completeResponse = await _s3Client.CompleteMultipartUploadAsync(completeRequest);\n}\n\nasync Task UploadPartAsync(AmazonS3Client s3Client, MemoryStream memoryStream, int partNumber, string uploadId, List<PartETag> partETags, string keyName)\n{\n    memoryStream.Seek(0, SeekOrigin.Begin);\n    var uploadPartRequest = new UploadPartRequest\n    {\n        BucketName = \"some_bucket\",\n        Key = keyName,\n        UploadId = uploadId,\n        PartNumber = partNumber,\n        PartSize = memoryStream.Length,\n        InputStream = memoryStream\n    };\n    var uploadPartResponse = await s3Client.UploadPartAsync(uploadPartRequest);\n    partETags.Add(new PartETag(partNumber, uploadPartResponse.ETag));\n}\n\ndo you have any idea of how to solve this? \n","date":"2024-12-03T19:52:07.0433763Z"},{"_id":"1ee6eaf4-1b12-459d-af17-1763a6c4e91a","postId":"2016_11_streaming-zip-on-aspnet-core-66a49df2-4f92-385b-8999-87a9f3054346","postUri":"https://blog.stephencleary.com/2016/11/streaming-zip-on-aspnet-core.html","replyTo":"473b57d4-be55-43f1-8795-bc3ac989b84d","authorEmailEncrypted":"dT5dCkf62/jBZGmBro55XGynkicrsuxpFl0QGkQaVuctMh7ICGmKFAp4ttR4sOG+9M8g/kgtQFGJorh/LDHslCxVP2+IHrfMfius2/1NfMKbXqz+ZF+bdBk7bCvYS4GyZu4b6xl3T12SULfWwsD+W20NWaMlz/SJpUdgtxFiUQMSMYZ6RP/drkgRnvEoYbW62gS3VY+jKW2adYjaa2cHVR0on+4BOqsrKpXz8ALKr9vxYu92IIb1xsEh7jnSRtx70yLPW3TfcYK7fHf0eeePjBSkGLVOp81GtZKqiO21EBD7K1cJjUqbcfRhNoHDY5GuA0YV8uOb6PS+BNUguNPGeNTtQnPPy2YdmoWGIHkwgVSpz6ApO3QzOccCEt3xh2fP+NkH988kwPwyrMCGwyFc7N7fZy+DVRgpTdu4mM7aplr1S99x3qxofc83wN0Ptig0Llg/PmOtHfMkqts7gIiJudsqyCM+Gf/pR4SwUxKIk3ok4b8qwnJ+mwtdlxC1M34LpYMhXG2i+BBoKysg7rNyrCFdfprHg55w4UhpvddcBalcmgrZlGLMDG+I6NblS+giCjho7GCz66gcbQGC3F8YkWoE/iBon47T/pBWTQtFudWDUbd3oue9Q2/vHwkx2h/YHGua3OQNvqmJFNSgVh96wXC+KzIExdOfbUx7aKsL/+E=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I'm not sure what the problem could be; it's kind of hard to read lots of code in comments. I recommend posting a question on Stack Overflow.","date":"2025-07-19T00:09:25.7749676Z"}]