[{"_id":"cf2c7070-9bfd-11ec-821e-314c356cbe73","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"d2c35700-9bf6-11ec-8320-57ad1d99e0ac","authorEmailEncrypted":"u85o7HVHNm4dEV0foMsNEIRqOypQlO2/xc4bfGHgpbYBYEK7RT0BPZEq/TMcImy3E6M2hsp7nxLqupfwyYtwoPg4TD2HqGEq/6CjdEK8q7PtZQRrh94xNPNF1qQdYDh61F5aVpvVJeRuV+L1lHobwMIU4P+GgaAWzUcb/yQeDoo0LdUe4JzpbFqzofphZ4izNwKSZejy8F7/CSyW27mzSHSDM4hvM+VquOLzaLOvgEHE/CLyc2gKY7H5JnPoTnR3GHm3v2THDdPqXncER72JqXh5bM1IHjomYuRhcq9tu0XfO7eKntZCK+/kE0XsFMpSfY2P86Wwyq1avL3xjxK9otjoIqbedGdSxE8uoHtBDkBZGI5Ca41QMHDeQInTusWxgJ/h1wunl8GImIZgei8+fduGt7scTtCBX4MEQ1MHSf9IVrdP48SU8JMVNKLZZtyP9wqoMfjuzmHSdqJgQv2XPH7sO7rXyoVLzVayA0oOZL3rorrilpyU24dRA1dd6AAucW+xdezjWdliPXhb0xVDS6Yva2VKakyNfiENzlZvYJzyHKGVmDkEssFa8+F5bzPF78y9QcuewXznD/dwMWtmn4VUQ6H3WX2m4lwyKt3AY3pSLbzUI95WKmIdZol1tlyjRmjwM+9/38bXBX7kTzevgP1asp2gEqGMODkr/MNQzaI=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"The cancel button is only enabled when `_cts` is not `null`. Either `!` or `?` just ends up silencing the compiler.","date":"2022-03-04T20:58:15.438Z"},{"_id":"d2c35700-9bf6-11ec-8320-57ad1d99e0ac","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"Shouldn't...\r\n_cts!.Cancel();\r\nbe...\r\n_cts?.Cancel();","date":"2022-03-04T20:08:14.421Z"},{"_id":"08cd8cb0-9c53-11ec-8f3f-5fb84fd1010b","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"pOg44RGbmCaczwMx6JWGRqzLnTenou3FMNnNeswDZzWElJZPta3KIIsbOhW42huaEVdbqA/HpNt8JzwSUZusgT+Cy5oV/sFoFfaTBDRlXYGeCnnRlxFd/zkfKr8rRAlvlNtnAC5rMUZ9kF5/wM37Fz/gtCjerB+6DPtn/W4Tp2UV/P0IvmfOi5uFG7C9yJgsBKXittZPgpf+4Ez33cr+ghF7gRhoBzM4ra2SUWom91ZNoukyfWmMug7gz7cLbPgtDwDlIkCoxM3ZBcGJSrIh5aWgMzk5PvmmLCcgbvdMXnY5T9sz6Ere6Rod6z1W+ufOqwO6e9w4tiHJj8yTIxYklq1/AS6cJoDqEKKVZI3hX/OwIBt2o/9KEIDONsgUXp85kTZ97DV8f5Li28kXxZ5+dIoGsQ2ql4rEDOXtB18SnZfbkyh7DJkivGPwqZUphg+WHQ6zR7mOAdvZy+qjtDZw1zhdXN15lVnmXXLHbwxYACsVagh3R3zdRhx6jbiII6kqERFq+bJIr50X5PslK5Nt4cgtLG7LwizojDrRsweWvj+/D5VCz4qsNtTq0mwyqhD0dIwJ/d09oE1CEzVtZjwqaP0ZEZ3K02+YzNmAUgVHvN+8HG2hMry/vSNXEeHaZx6Knf4lssUyCY/bfQAY00+8r4ccDvwXn7F9jgIy67diAyI=","authorEmailMD5":"5473de3439038d22891045e7d8984dc7","authorName":"macias","authorUri":"https://przypadkopis.wordpress.com/","message":"Maybe it is worth noting that support for timeouts is half-baked. Despite having TimeoutException in case of timeout regular cancellation exception is thrown so on surface it is not possible to tell what happened. Of course you can wrap the code with try-catch check which token triggered exception and switch the exceptions but still it is pity this is not built-in logic.","date":"2022-03-05T07:08:18.772Z"},{"_id":"77ee8ac0-9c19-11ec-8832-6185bb1baf57","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"cf2c7070-9bfd-11ec-821e-314c356cbe73","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"My mistake, I was not aware of the existence of the \"null-forgiving operator\". Thanks for the quick reply.","date":"2022-03-05T00:16:14.452Z"},{"_id":"e5b71cd0-aa19-11ec-b52a-eb0d8ec9ea52","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"08cd8cb0-9c53-11ec-8f3f-5fb84fd1010b","authorEmailEncrypted":"jOjxr7mitPXf42ICHEMepOQx2qR5Wh+aZ3XRmYU3boN9oF+cGitW8lgnkdSBBmAWEqV02/YmptHQIvwelPLgLWTTszy9E62sEOmJGlrn5uv3pdcaCGWCxO9E2wIjU5aWpLMexZdg9PriPUSFTsA+JqexxBW6+DzEG/jwI8ee2GnfsghjN6NeK1LOsGIF/+DmK2dMInLTheUZOdLwL4NJ5T+MK8sHzVCVOeqryXlzvi3qmlphjTfM5ZlYLVDxgCE0wYTdd+yvM+VZli//x0vu7MCwnvVzK0Xu49JINrwGP2Qxenku6LntmiFJiXMFBk+TJufFigKmKDap4mFnyqqcSroBOmV8J2SjsBxDTvxiwyXg2w4MhYrW2Ls8GFKJ35EQ3ya5mv23m/WqIXekI/oxvccWLV6J7J/to+ktGoUynwfQZJTjwsnDhlclld+GyjPZ4lWZyZ2d6oKgD9xH8la81wUd1kQg50l5vkrLmuvi1OTq733vUMUBQ7KazsW8U1jif9F55k0tZ3KQYkeFlQ+Qwp4TvKadIJMJRi0gKj7dCQxlG7z7vrwE7aTDuMRI2cdMp69p5c1x2aiQ9BhJiFoIo1ZP663KO+LVO9kUpRnPVUDltC8Q8kfdF70/v0EqqXKreTsC5E02Gc+PncuB4CM73QB1x7FM1MWsDUpP33oowBE=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I agree that the timeouts - and `TimeoutException` - are confusing. Timeouts may or may not be a kind of cancellation. In the case where timeouts *are* a kind of cancellation, then they do throw `OperationCanceledException`.\r\n\r\nI do cover a pattern that can be used for distinguishing timeouts from other cancellation in [the next post in this series](https://blog.stephencleary.com/2022/03/cancellation-3-detecting-cancellation.html). It would essentially look like this:\r\n\r\n```C#\r\nasync Task DoSomethingAsync()\r\n{\r\n    using CancellationTokenSource cts = new(TimeSpan.FromMinutes(5));\r\n\r\n    try\r\n    {\r\n        await DoThingAsync(cts.Token);\r\n    }\r\n    catch (OperationCanceledException ex) when (cts.IsCancellationRequested)\r\n    {\r\n        .. // Timeout has expired\r\n    }\r\n}\r\n```","date":"2022-03-22T19:54:34.835Z"},{"_id":"0ad7d4c0-0dd7-11ed-bb11-83695a393411","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Jess Rod","authorUri":"","message":"_\"For example, you might choose to keep the start button enabled and just have it implicitly cancel the previous operation (if any).\"_ \r\n\r\nIn case we opted for this approach (not even having a cancel button), would you please shed some light on the best practice to cancel the previous operation (if any)? Thanks! \r\n\r\nI'm not sure if the following would be a bad practice. If we used \"using\", by the next time the start button was pressed (if the previous operation was still running), _cts would be invalid (disposed).\r\n\r\n    async void StartButton_Click(..)\r\n    {\r\n        _cts?.Cancel();\r\n        _cts?.Dispose();\r\n        _cts = new();\r\n\r\n        try\r\n        {\r\n            await DoSomethingAsync(_cts.Token);\r\n            // ...\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            // ...\r\n        }\r\n    }","date":"2022-07-27T18:07:57.148Z"},{"_id":"c2058ba0-0e96-11ed-aae8-9f19883eb780","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"0ad7d4c0-0dd7-11ed-bb11-83695a393411","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"Jess Rod","authorUri":"","message":"In case someone is reading this, and Stephen Clearly hasn't answered yet, I've come to this (better) approach:\r\n\r\n    CancellationTokenSource? _cts = null;\r\n\r\n    async void StartButton_Click(/*...*/)\r\n    {\r\n        // _cts is null when no DoSomethingAsync is running\r\n        _cts?.Cancel();\r\n        using CancellationTokenSource cts = _cts = new();\r\n\r\n        try\r\n        {\r\n            await DoSomethingAsync(cts.Token);\r\n        }\r\n        catch (OperationCanceledException) when (cts.IsCancellationRequested)\r\n        {\r\n            // Operation canceled\r\n        }\r\n        finally\r\n        {\r\n            _if (cts == _cts)\r\n            {\r\n                _cts = null;\r\n            }\r\n        }\r\n    }","date":"2022-07-28T17:00:18.360Z"},{"_id":"7f0b4e61-1ad3-4978-af53-92ddb363dc26","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"","authorEmailMD5":"","authorName":"","authorUri":"","message":"\"This cleanup is done when the CancellationTokenSource is cancelled or when itâ€™s disposed.\"\nCancel does not dispose of resources after creating a linked source.\n```\nCancellationTokenSource top = new();\n\nfor (int i = 0; i < 1000; i++)\n{\n    CancellationTokenSource l = CancellationTokenSource.CreateLinkedTokenSource(top.Token);\n    ////l.Dispose(); // cleans up memory\n    l.Cancel(); // creates memory leak\n}\n```","date":"2023-08-21T19:23:55.3223136Z"},{"_id":"94ab7842-c1ca-446b-b060-781c79a54959","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"7f0b4e61-1ad3-4978-af53-92ddb363dc26","authorEmailEncrypted":"jwha8bGEzrU19gNwop9PvVAGRnT4qrAijl7wOXuHxAlWkJIkoeYITTcsBOeWmvwMjSSQt/KRrcZqhSan3QBcmDUuFr1Ll46v0R7XFYQQx32nRPROFRDPiF8isbQ63Ol3Nrhj6nthe186ltQLwiAYoKLYCIcOeSQcqNxKZoUESZkQkyOQU6KglFZbLLVoamzYLL6wocBOnGm3XNzWOHysHG/l8DMwjr5GQJ/Cdaf+zjwwExwqSCgxs7jU9eIba8pkh7c2MJHvHhqHbWOf7ucgr3vfCdhwsDuddCw3CloaEVRKfwGADbNY81GT7qzE2XBHTAkPYov8px069WIIIUsodBELCTKinEpTqW2bovYlUKRi2fZ9sDXXbI3ARbkcMpysO1oYwE0wk1EfTqjosn3RFYkVgMhCJQv4hvy3NHPd/KsF1xKVtkoxy18YTBKbPyiLbFVtkWeryEkKxXKHz9K+41RhPYu+rAGGTNF0y9kLdPu2zEeTKmS9xrgmAXUc6W9FjTJWltpQ/BHCbIbrDOrV/F1BHg40ckWc5LCPvNOerleGwvJ3eN65Xtfh91auvtHMQMin98MHzbC518unZFZjO4Y8Btet+lduJbzwfeOIUyJS2ytbcWWDVBkrDDCPM6vX5chL5QgWSw13lUvX7R+6BEgkcKmEClgQ1URg7yxiC+k=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"The cleanup I was referring to in my post is the list of registrations, which is cleared both on `Dispose` and on `Cancel`.\n\nYou are correct, though, in that a `Cancel` of a linked cancellation token source does not free the registration from its \"parent\", while a `Dispose` does. I'll update this post to reflect that; thanks!","date":"2024-01-28T02:35:37.1856671Z"},{"_id":"7d85a466-0ea2-4aa5-a0c0-3824371ac5e9","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"wmrGjfqOmYRkofNXwxlBU5SUCQwvdBma2/l/KFuYP/Rs3kZiB++5dJ79KZ5ShHc2MGyQv4oLG+2NCjkkwa519z1oPEiakfOcK/5i49YJge8N9wawGkJ/oNIGpoxuxmKHodmaUxiBIcE3Z5lQzry2ogL/6TMMmyGNXDwXbi9J3N056qiGP66jrGWvPQ9PZYNxeCOrxm25COyn4A7q5LkKdLFU/6x4bt0A4/yrXXnnPNgCkp9nytpfrTQ6t6ilkUY66fyfIfQNHe5sUK3kQEUbdFbnZthxmdcWduDeDfVIQOGrKcEBABT7vfN/vsFUVlrDlY7rpBD2c3kt/Sz49mLMTnFa44GTCHydbFLNpZp949eygAKsuSJ4a8EmkESCm44N4cbk//SCNdUNbfi0mYF1S4Enq88MN90jZy3Ri/IlE1+UwBuiK5L/SPT3zE9rU7ria0oBwluBXSsJdTml+qNW8EuPE1J6NwM1ij2uQykWgtvDWdiklU3Io1OOzYlU5T+6d37PJGOYcKP+H4c7zxfAdxJLeqP8blL1YgXkN92m/hxEDePBgdG+vTp93R8Cm18wBQQKIaclN14S/0YRf0NuOJMdZNAUA6hMlVdd8sXyFD2Mz7hqMHEbsMi7uUq5OVaxuv4sLsKTF8QVwOWji1/1hvwE61v8X585n6D5rO+ygIE=","authorEmailMD5":"86e9b9eeb487faa20682aa8527a8a137","authorName":"Mike","authorUri":"","message":"Do you have an example on how to cancel/timeout/kill a thread-blocking method, such as Thread.Sleep(TimeSpan.FromHours(1))? \n\nI've run into a situation where I need to forcibly timeout a method that is blocking the thread, but CancellationTokenSource doesn't appear to be my best option since I can't check for whether the token is cancelled. \n\nIs wrapping it in a Thread(), and doing a Thread.Abort() after a desired period of time my only recourse?","date":"2024-03-14T15:39:49.2410255Z"},{"_id":"9d4f6035-3267-42f8-a47f-58c4bcc05cfa","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"7d85a466-0ea2-4aa5-a0c0-3824371ac5e9","authorEmailEncrypted":"BMz+z4UdZRUAkd3Z5Ix2/39tdupOobuebad/HhTU5aMRqFgaAmJ382XrG9+Nm21zYA6W1ANgy40n1aeIXGYPmD/nHFcMJd+YGepMFWlYAHrZMazqXIAdVT3Wo48p5pxJegQjMypm5ZHa6f07FnNa2yAX9+jG1QYUWodOPm1WNGh6QYpiFS5Ez5xQ2NVIwu7nTLU32b9h+pv/JBTTqSi+yJcD4gVm8NY4vPXA3TPAZZSPcR2lOZhS+v4ek2SnN9BuSePtVA0WkWhiYjuyXQHbqTDYbSbsVq6UcRpVZ0gZdxYwnyDTdtIXikeUxTUz0/VOlfpbJn3X3hW/dTWf+uRiQ54YW5Ku/cw76MB4IDxImET2lAXiACkmX9YmVixJm9a5E7Zqpe8TlATRJwo7ORY6IMKKo23h34GUzWBpG9CyLpYGL4UKBN18FeW6/khsgSDEGg8UjA37g5ez9n6Elz49TqDvFucMGghCbJUMY++KMe7+56/bd6gVD4Tp/V4ldT31A4zMZ1KqtarcjKkR8tdaLbNrgym/x6PaxskOm68XnYZB/8trdZQtxbeaeA4cGlVhJAlpiFU1R1ejPe82LF0augI1dKQSvPvM2vziFGRCCfVaaRjxn9GZRwgsufkNNDVT+YbvUjRXbeQemXmZDz/7Dd7cwWXJtH8mp0Mijctwn6w=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"I do have plans to finish this series (someday!). The last entry will be \"how to cancel uncancelable code\". But first, try as hard as you can to avoid that situation completely: can you add any kind of periodic check for a cancellation token? I've seen code that has to do blocking waits add short timeouts (e.g., 100ms or 1s) just to check for cancellation. If possible, that's the easiest solution.\n\nBut some code is just uncancelable. The only safe solution in that case is to isolate the code into a separate process (separate threads do not provide sufficient isolation). Then you enter a whole world of kicking off the process, two-way messaging via inter-process communication, etc. It's a real pain but it's the only safe way to cancel uncancelable code.","date":"2024-03-14T18:00:49.1267863Z"},{"_id":"0984c2f4-de92-487c-a85a-1e53f03bcb51","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"ZrP7YAbRcXlk0yWlp8p9dWKwsjHnfLF4Sr5byCndZsmlKAyYkDHVxsFiKxqfOFV+M4M8paT1GYoIwAKgL4qEiBbK3zM8hSSZWlwrKvmvlO7ktRG3P1sdb3086Nc24BIO7Y40lPlCndGrZpjNNU9TZIChEKSpEWFp83ONDV5XR9CJI0ORyMX/Bn5+uLdDtq5bmxlz6HaotDa6WQOLz8laxTXNIQoFH+/BquuIeL5HlnLNP9rTVobNFAxf7wqtpUWBahfVv47zqmvy+OZPqKq5vgQPJdr4bvgOlHkTM90SHv1GGwbX0Z4vT+qlPdKxU865/lkCHfdHvyLW2ihXL9v6E5YS/9a9aSC+VbVXfnXiYD11luU2JU1Liqm+8f2j8vfZ4r+MPMjoBbb8U+6Io52jYAKU1fJs6EmAptiXmPi1EMjH/AZ0ehizork+EfFD971p5eME2fru8NHynX5W1O2G8KqwgcSJoGs0MhWOweiL0SQ87cYt4+zPzkep5xkKrbWgr7HohtztHcu0eZYdlCgXYbG162CJj168Is5yHDeF6kuJfFzWQaOox0I4NxeK4YMkI5mbLdJQkf2HmXo84+E73Y/wEBwMbPQDXk4z80PcDyTzV5hdpmJlL7iobJqKm9tGnjXK9jc9mHzn5rGfx1UU5loXEnFLW0Mta91TkKFL4gc=","authorEmailMD5":"c11d34cec748e365c7fe4e9394637216","authorName":"Maxim","authorUri":"","message":"Stephen, thanks for your posts! I think \"Clean Up and Disposal\" is a topic which might warrant a separate entry in your series on CTS (judging by the number of question on StackOverflow) :)\n\nI also have a couple of questions on the topic:\n\n1. _\"You can either cancel or dispose, but you should ensure one or the other is done to avoid resource leaks.\"_ - It seems that Cancel does not do exactly the same things as Dispose. So in this case you mean that GC will later dispose what is necessary through Finalizers, OR do you mean that even without GC, calling Cancel by itself is enough to avoid memory leaks?\n\n2. _\"If the CancellationToken is saved and used later, then you donâ€™t want to dispose the CancellationTokenSource.\"_ - Could you clarify why not? I thought that if you Cancel and then Dispose - you would have just an orphaned cancelled token, but I assume some operations on such token will cause an exception? Can you clarify which operations exactly?\n\nThanks!","date":"2024-08-12T14:15:41.0445183Z"},{"_id":"09c3b24d-44c7-4d18-a73e-1e635e631ced","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"0984c2f4-de92-487c-a85a-1e53f03bcb51","authorEmailEncrypted":"E5MT1W6cxFE/cXiWI/mbkdL0xZCLBHBUUkgH0crbuT0QmxoGvKgB7D3nPabq7V8giHSjMrYSE1aFeSkHtAaGcAqknC665Ad7r/AGLOfL94xEx8H3zEvlPI86qE0UbfAwdWddQZpe+37xKonjCgbPMNDjsoHTvM4j6iSPMIi7A+/p9nxe5IAi8r04Xl6v6GdnEVZoaDwKNnxzdu+P7NcCkZ3yGsKFKuz2PPJqUK+PiU4plpwzoyrOlGgSm1Aq56kZWW6JOQXktvplRw5k4ptubLXH6c7BGWQnTWRyIOBldkr1th4qDOZiHFZ66tAelD8Wm+UE8tMqR8E53T5hLGOjRM7mzVwPBaMahXcAAiyWj9SKsSBRC9K3XCHZ2BiDUSvK2ICVyO6mycJT+v1RGTCh5dtQii3eeQ0BgqdxSm8hP5EgmmqUL2A0grOaLq2ybgcLHeWWU6IJoHP4rF5z85g9x5wmQqExUin1YmXIF6iEZXG9lq3O+d6OCTXYVUCiC0Wc5L/QiALDDagAdPPZEbvYkrxagl/ypv9O0FYm3Mi4ZPnhaSWJ2xrMinYNvI/Qw/Rx1SosKiUazsiu9hsre6eaUZckBJo7tL7p9AN1U1uO2Vr0Vwg8EW4K/3ZeqYjxVAQ/zRn96NH7yWv6Pu6C0xQLIby8Xg0ORAdKnoFeELcglfk=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"> I think \"Clean Up and Disposal\" is a topic which might warrant a separate entry in your series on CTS\n\nThat's a great idea; thanks!\n\n> It seems that Cancel does not do exactly the same things as Dispose. So in this case you mean that GC will later dispose what is necessary through Finalizers, OR do you mean that even without GC, calling Cancel by itself is enough to avoid memory leaks?\n\nIIRC `Cancel` and `Dispose` do behave slightly differently, but they both avoid memory leaks. It's been quite a while since I've looked at that code, though.\n\n> I assume some operations on such token will cause an exception? Can you clarify which operations exactly?\n\nYes, they would. I don't remember which operations.\n\nI think I'll answer both of these questions in a future post on clean up / disposal. It has been long enough that I can't answer from memory, so I'll have to dive into the source again to find out how it works. Tip: if you don't want to wait for my post, .NET is open-source, so you can find out how it works the same way I will.","date":"2024-08-15T08:02:45.6749193Z"},{"_id":"73adf692-507e-4000-8169-c48c29c5b84f","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"09c3b24d-44c7-4d18-a73e-1e635e631ced","authorEmailEncrypted":"o6HeQGWDrZ+dbw2UVuaZdVNkQ2pSNI8SqXNcWRZYT5xEIOo41qaBFPjTG3RKTBsKm/Vr52oKJU8BjgZQD0Tzbsmr4AknKnwsZsOWINQtbWtsoncDla1mrYKHFk4Xyg3Seo2R7j6i9CwOYE9apoY8JMeydb8z5aTs8zOhq/ZYJPkJXSXSz4rux0C1CVErUy/CST24UeOObjT5t3/EuIpmVb/acmSNwQfXGCgCc9z3mU3ELIM9NG9FTcLMSEU278yHwzgaNE+xUpe+/BAKJnvCCcI22xFiW6I3uMvNMJXOEyeJxSzqzJJcTKZb6TUyDy416PGPoIwVxPs/4ch7/yb9ftMOSuOFvWu8LYz3EDwyKaqL+4FC/KzBV1/EvfMSl0PU+CeymtmUcVcrnx3sv3wRLJGVg6GlL7EqlUJnMiz+4aFqEy24OjnxB9Cj2bbBkWsSnq+MLSR6VriNpMm5CnYLr9O72rCsyqFg5+9P60n3+nP+Kul4To2K9QfouAfn2OBl4v2dT51SaJHLOaDGsuPHjK02ionxo336bD8s0ZBk03yKTYBMLYkwcYNpo4o2sgAJTxsINmxyvQOZ6eFaaI+pYJkEdaxYQ1zni7GiBtOtgwHQnXUhMTq8jfK4oMqEtJTCNyVI2cdXCsb5bhaVXzpmCyHpEuMsyhCaNVhX5JiIwzo=","authorEmailMD5":"c11d34cec748e365c7fe4e9394637216","authorName":"Maxim","authorUri":"","message":"> _I think I'll answer both of these questions in a future post on clean up / disposal._\n\nThanks, that will be a great service to the community, looking forward to it ðŸ™‚\n\n> _Tip: if you don't want to wait for my post, .NET is open-source, so you can find out how it works the same way I will._\n\nYep, I was hoping you remember this things better than I do from the top of your head, but it seems I will have to go to the source to figure things out ","date":"2024-08-15T08:26:02.3517901Z"},{"_id":"02df535a-4068-411c-b023-8e25d086697f","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"F1FbMA9gq0mZAR0M+xXSvftu/L1+vbVf6ZDGM5Z9AbkyGS7SzhUopv9SJlecxTt1LPUkxUj5EWknlqXhd6bHsDK0xE0KGg1hiKN0D8WejN6hvBVT046RExjl9jAmbBoZHKCG5Sb8n3ZPqSVeSRxSEgrULQ7d5wZIyg7IrMyBdCPMGRP0y4xcLASSPoiGM3brw07CKXjTy6C3C/ROfRkRcyankxOmxalXtDjyX8KFIZrErxNxQCYBmG39Wt1lZfMR8i7mm/b/J1hg11Hi4eIz0OQ+UN8ncsF6fSkfkCT+K2KG0P6LvBpZq2XRNcq0Tfo7SQJPJdoIraXFn5UcjcDzPB/0Atea8gqoMJA6Hhr5VX0VxzxUZUUgQAASZ05Dfcu8HnBDDvFGlPTxpwlE5fAoKyRPtR0dg/JF26enyYAeegLEeSRzYrppemnMN6DnxcdHak/yp9FjJu3Wrc6VerQsx3hUZTcdzWErnFpLNQiHT4FzgLS7Djd1mSO9zxqyOwffIv1UYnA/bfJBFnURFclasaKLX6mqXya6laoHpjEgGuVuKoCilVWxncqzTqlU/Z4gveb3fCFOeznPRAA70KKxVEaXpa/CuC+4klVZgq6xr9ZjHp37UwQwUKjrSwOvx5JhuevrNu9FvSg+smx6WLbL90dxSYFLg9evFaor+70yEQ8=","authorEmailMD5":"02b2b843388c866cab51a735f817b291","authorName":"Doron","authorUri":"","message":"In the last paragraph it's unclear what CTS you call parent and what CTS you call child.","date":"2024-09-09T09:09:53.3364939Z"},{"_id":"e252c274-5fe9-44e6-b263-82cc676e7e2b","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"02df535a-4068-411c-b023-8e25d086697f","authorEmailEncrypted":"OdMY3ljzrpuJBxi+ZHToOsn4ByhvRX61eAEX2IDrfShS5lUyRtqFn3YmviICeju/7TeFcK3A47RaB7MlMPotvOkL6RQQfNj0aMHqjC1ZSoZQ126Eeq6NOENu1omVoJY4llB0BOV4okXUyb3BzOnCJEDW4j2hiIlbM2PMcocbuaTJrUrxWBx/ikJrsTevcqoawBVkB3lLr89tktRyJxVkxjhUYToEeU69c8bMkxEmd2YHDPZt71JOpC7AxCKqAFFFeY17XN4mZkGUoI+ulaTO2OVOyG2kz/5OKHro3ncpxuGdVO8AiKjgwuHkzGnVkw/Ho2CB/zuR+aOAQNzHl2NKVZgJil6kltSnOvYOZBSNaxaQo4LRR9sfDK3ZDrKadqcJdOFloXkSICmXfI/lHdkrPcSUq7yK1KbdHYzqAywhjhm0vwBA2VvEXgA4w71CK2AOnzIK4bflrw/4/FC2bWwbbDNi4Chi2WmssjET8Vi8X3tgtvJXdmhtGU3fwgVGpIJfSnPVrY4SL/BNGprDaud7e864JLw/pxx3KcISp4x/RvuL9tzti2zFeb2fx/eYUYgm90qSdyQhk6oAqQdZ+zh9pCpbJjagEwcFYHR9gWKyxAfa5FPyajaMymM9Nv8dsjPnZFe86Yx+S0jD9VJEEw1gizaV2F5rY3iDNReLNe7X70E=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Yes; I haven't written the linked cancellation tokens blog post yet. I'm referring to the outer CTS (the one that is created first) as the \"parent\" CTS, and the linked CTS (the one that is created second) as the \"child\" CTS.","date":"2024-09-14T05:58:21.1986464Z"},{"_id":"2991b6b7-f259-4908-87f1-f04c9dcf6944","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"43fc3c16-3cf1-4d2e-97c4-d72631fdc001","authorEmailEncrypted":"vrWs/xYXR3qLDhUkHDCior3IjJy5nm1PBJRrHvzhkxODPliHxt5PdQGDPZKUgBX5SNGfaSwqN1IHHF8jrtN9cYBRovkV8b7VvBVKc+omFoe7CRRR4cxBZIOpYwaD8218Gg/suTtSXiXl/ysM+7dQkxL2nrqYXt7OHIxAp1kvZR6Qsp3MFszfbejiJCG9Db79eRXoXR0ZA+0bWx7idGWu6Np+eorLyW/U/SLlwFklwWuER+9ObNf3Q1PFh8xIYZgbUIYyLecv3syeYFp5yjQVkctvVZz9HR9tNiNDndVQPEJLCptBBtVR/D8xJbd2RrnYO2VAXo0HWAPx9+OfRn2pdov0qVFMj7JaVi7xJTfURkpYj5ngihwYfMhIlZ1VRO5tC8otCtvsiRpHKgUme71QrjWlCFAy6FrsN88u4k+TxkhIOlSVCBHJCFSWDfH/NlsD2kZvW3ojsywnOJnYsUGdFom9UmmaxQJST+MWP0gVMd5W9V7sOvCrrgmaZlFTKRXRrm+pCUnMXsWC3DyB8FunvNvfClTrxI0H57hWmV1akaQwRbmgp8q1oxwofJzvqbgt3/L46uqvQAUUgEk3NtjbPv3VOlOi18BkfYAbN7bx1q771VXEAXNJcUHIbM0uU+q8roddk50xjyi+RzaaOCUeWrM/g3bO0vfj4lj9WBYhlMA=","authorEmailMD5":"23448e78d187fba56d8bc263081ac5d8","authorName":"Stephen Cleary","authorUri":"https://stephencleary.com","message":"Great question!\n\nWhen working with UI code like this, any time there's an `await` then the user can interact with the application and cause other things to happen - including clicking the Start button again. So the user can do this:\n\n- Click Start. The Start button is disabled. `_cts` is set to the first instance.\n- Click Cancel. The Start button is enabled immediately. `_cts` (the first instance) is cancelled.\n- Click Start _before the first operation completes_. `_cts` is set to the second instance.\n\nNow there's two operations going. The first one has been cancelled, but it hasn't actually completed yet. It needs to check whether `_cts` is its own `cts` to know whether it's an \"outdated\" operation that has already been replaced by a newer operation.","date":"2024-09-29T19:02:22.5653175Z"},{"_id":"43fc3c16-3cf1-4d2e-97c4-d72631fdc001","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"","authorEmailEncrypted":"fiyr7P1AM0jqFdV6g4xII8zTMdjU0MClju9qBftiMAVzwTAb0z5Oeacoi/l9QbVSxNsotIu8YgSnprgEH83cvbp3nZIc6S7BoRY0q+rY4FaJOwnS0ZyjRJOh5weq5k9bQd7Z6NrZZLAHS499O57+bQmK7RJayB+a8SYAdZM0m98kvN4ovGt1M9ydT0CKSvFntxn6iw4q7xKAyIYF+R7f6qM1ItcLsKMHNdFgs82eyo07qTkBWq0nP/E3Ht6V+NBoj8TTUfbUbBvZciZMeDi/lReemzYYl3h9uIL/eP6nsEPRgzAyUQyvVISZMaevqnHFveg+OX7ahGE1yX/9fLPYtitvRmfhe4EHMd3Z68WGmy/j69tWojAZzZJ2RSgbaP0A22G8v+Y1ZiIoS8TepJs8bFIg6hmwCOhUJN/Zm8+vBNF5RhwTU5B3FCx/Uqv/j2W+ijHZB9XROEBi6AqQd2QF6Hph+qbjpgqW4bFDT6PBY5MiVJCKm9c3BHzdW8Og6qfFMDimN/ma1JhQVt13iEEQuKrhNw4sp4PnMlkWU851GChB4imOvSLUD8jTnVVO7Ic7Vg7AzRUKwam2YkSMS554ck4DKG8HCmxUdZ8ZvIoZxUwKgkVQ0QaGU26cpc3zuy9EAHwq72ggDeaooEj7xjNnurr8Ob+HCSq4xGWDrXQUOn0=","authorEmailMD5":"ddc8897076e9931d3efab58d8c08ba25","authorName":"Sagar","authorUri":"","message":"Hi Stephen,\n\nThank you for your great articles !\n\nI am a bit confused with this code -\n\n`// Create a CTS for manual cancellation requests.`\n\n`using var cts = _cts = new();`\n\n`// In this method, we can check whether we are the current operation by doing (cts == _cts)`\n\n`// This works because _cts changes every time the start button is clicked.`\n\nWhat is the situation when `cts != _cts` if we are setting both of them to refer to a same new instance of `CancellationTokenSource` like this - `using var cts = _cts = new();` ?\n\n","date":"2024-09-29T18:51:49.6143344Z"},{"_id":"67dbcb48-93d4-405e-84d5-42ca92fd31f8","postId":"2022_03_cancellation-2-requesting-cancellation-d627708d-a45e-3a5d-8359-b4af914f70b0","postUri":"https://blog.stephencleary.com/2022/03/cancellation-2-requesting-cancellation.html","replyTo":"2991b6b7-f259-4908-87f1-f04c9dcf6944","authorEmailEncrypted":"DCJMURh8yRlHFw3ImLHCrtV2uo0z0+LiCVfd34HpuNNEcK5Stn2JTE5L8+SjXRzF3zuJD5aPsLWh14Lx5XKXIJYC49EkTpE9Y+m50pJgXdf5D2rcdpr2Elp0DqJxvvjryLaZr9g9M3l4WGO4IuR7DOKcZEprjew61iN6hvG0Ez3F2saagtn1D9rXckO78WL6AKm1C2kVWQvEiz31g0aaXLZSCknAWkJJH9ml7gpW3envkFfkqs1vymXtBPHttOZImlsj8sQ0FiUiFM1QMrhmeplAOdH+AnocNpE2JSIFysHTkkeOX7gvBUG7zd9UiB2QOfn3+rH8iKctDoyXDQNtnoem1J/0/akfADJFXRcNvm2hF/ZO9dFuMa/bET+J8LGAkY1AIqfbZkza9Wbe6G00cERhfcwWph4FYKRII1vIz7Ivrar9F37WmLWbItOzxSaTP6hO7gF3JbCp81mYCi5UTgOz2JK58vcCezPNdA3OB1t+g1DAuyTVHKVJsAVSw8qO17zJdtjrhLIE6bqdcrGmQa0sC21o4FBQc3YPhix7ih1qDbeqxeeF8QEcRxHuiF0zP3vJXedYgd1I0V+OZ19URNJzX6DbZ7FSNxIUyjnyE/wJ+mRrUet6aLau+wKotjFa4S+nz4KC619Ai5l8DkzUZI0w7sQY3Imrrh7R1P/Dias=","authorEmailMD5":"ddc8897076e9931d3efab58d8c08ba25","authorName":"Sagar","authorUri":"","message":"Ohh ok, I will check the different scenarios. Thank you for your help towards the community !","date":"2024-09-30T14:38:45.0898757Z"}]